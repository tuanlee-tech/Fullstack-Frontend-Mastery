# **Redux Thunk vs Redux Saga vs TanStack Query ‚Äì Guide Enterprise-Ready**

---

<details>
<summary>## **üìå Overview: Ch·ªçn ƒë√∫ng c√¥ng ngh·ªá**</summary>

| C√¥ng ngh·ªá          | Kh√°i ni·ªám                                                                            | Vai tr√≤ ch√≠nh                                                                        |
| ------------------ | ------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------ |
| **Redux Thunk**    | Middleware cho Redux, cho ph√©p vi·∫øt async action d∆∞·ªõi d·∫°ng function                  | X·ª≠ l√Ω async ƒë∆°n gi·∫£n, fetch API, submit form                                         |
| **Redux Saga**     | Middleware Redux d√πng generator function (`function*`) ƒë·ªÉ x·ª≠ l√Ω side-effect ph·ª©c t·∫°p | Qu·∫£n l√Ω workflow nhi·ªÅu b∆∞·ªõc, cancel/retry/race/parallel, background tasks, WebSocket |
| **TanStack Query** | Lib chuy√™n qu·∫£n l√Ω **server state** (API data)                                       | Cache, retry, refetch, pagination, infinite scroll, background refresh               |

**Logic ch·ªçn c√¥ng ngh·ªá:**

1. CRUD/async ƒë∆°n gi·∫£n ‚Üí **Thunk ho·∫∑c RTK Query**
2. Server-state centric app ‚Üí **TanStack Query**
3. Business logic & side-effect ph·ª©c t·∫°p ‚Üí **Saga**
4. App enterprise ‚Üí **Mix Query + Saga (+ Zustand cho UI state)**

</details>

---

<details>
<summary>## **1Ô∏è‚É£ Redux Thunk ‚Äì Async ƒë∆°n gi·∫£n**</summary>

### **Kh√°i ni·ªám**

* Middleware Redux cho async action d∆∞·ªõi d·∫°ng function.
* Ph√π h·ª£p CRUD ƒë∆°n gi·∫£n, fetch API, submit form.

### **Tr∆∞·ªùng h·ª£p d√πng**

* GET list, POST form, PUT/DELETE item.
* Async ƒë∆°n gi·∫£n, kh√¥ng c·∫ßn cancel, retry, parallel.
* App nh·ªè, logic ch∆∞a ph·ª©c t·∫°p.

### **V√≠ d·ª•**

* Fetch product list
* Submit login/register form
* Update user profile

### **∆Øu/nh∆∞·ª£c ƒëi·ªÉm**

* **∆Øu**: D·ªÖ h·ªçc, tri·ªÉn khai nhanh, g·ªçn nh·∫π
* **Nh∆∞·ª£c**: Workflow ph·ª©c t·∫°p ‚Üí code r·ªëi, kh√≥ maintain

### **L∆∞u √Ω khi mix**

* D√πng cho task nh·ªè, legacy code
* C√≥ th·ªÉ mix v·ªõi Saga ho·∫∑c Query

</details>

---

<details>
<summary>## **2Ô∏è‚É£ Redux Saga ‚Äì Async n√¢ng cao & Side-effect**</summary>

### **Kh√°i ni·ªám**

* Middleware Redux d√πng generator (`function*`) ƒë·ªÉ qu·∫£n l√Ω side-effect ph·ª©c t·∫°p.
* H·ªó tr·ª£ cancel/retry/race/parallel, background task, WebSocket.

### **Tr∆∞·ªùng h·ª£p d√πng**

* Workflow nhi·ªÅu b∆∞·ªõc: checkout, payment
* Async n√¢ng cao: cancel request (`takeLatest`), retry, debounce/throttle
* Race & parallel tasks
* Background task & real-time: WebSocket, polling
* Conditional flow, global error handling, navigation side-effect

### **V√≠ d·ª•**

* Multi-step checkout flow
* Chat App realtime v·ªõi WebSocket
* Retry payment API khi fail 3 l·∫ßn
* Cancel request c≈© khi search realtime

### **∆Øu/nh∆∞·ª£c ƒëi·ªÉm**

* **∆Øu**: Clean, maintainable, ph√π h·ª£p enterprise app
* **Nh∆∞·ª£c**: Kh√≥ h·ªçc h∆°n Thunk, verbose

### **L∆∞u √Ω khi mix**

* Mix Query ƒë·ªÉ fetch data, Saga x·ª≠ l√Ω workflow & side-effect
* Tr√°nh d√πng Saga cho CRUD ƒë∆°n gi·∫£n ho·∫∑c animation/UI logic

</details>

---

<details>
<summary>## **3Ô∏è‚É£ TanStack Query ‚Äì Server State Management**</summary>

### **Kh√°i ni·ªám**

* Qu·∫£n l√Ω **server state**: cache, retry, refetch, pagination, infinite scroll, background refresh.
* Gi·∫£m boilerplate Redux.

### **Tr∆∞·ªùng h·ª£p d√πng**

* Fetch API v·ªõi cache & stale time
* Pagination / Infinite scroll / Prefetch data
* Auto refresh khi tab/window focus

### **V√≠ d·ª•**

* Blog App v·ªõi pagination + cache
* Product List App v·ªõi prefetch hover
* Fetch orders v·ªõi auto refresh

### **∆Øu/nh∆∞·ª£c ƒëi·ªÉm**

* **∆Øu**: G·ªçn, m·∫°nh cho API-centric app, maintainable
* **Nh∆∞·ª£c**: Kh√¥ng x·ª≠ l√Ω multi-step workflow hay side-effect ph·ª©c t·∫°p

### **L∆∞u √Ω khi mix**

* Query + Saga chu·∫©n enterprise: Query = server state, Saga = business logic & side-effect
* Tr√°nh d√πng Query cho UI state nh·ªè (d√πng Zustand/Context)

</details>

---

<details>
<summary>## **4Ô∏è‚É£ Khi n√†o d√πng ri√™ng / khi n√†o mix**</summary>

| Tr∆∞·ªùng h·ª£p                                            | C√¥ng ngh·ªá ph√π h·ª£p            | L√Ω do                                                                       |
| ----------------------------------------------------- | ---------------------------- | --------------------------------------------------------------------------- |
| App nh·ªè CRUD, async ƒë∆°n gi·∫£n                          | Redux Thunk (ho·∫∑c RTK Query) | CRUD nhanh g·ªçn, kh√¥ng workflow ph·ª©c t·∫°p                                     |
| App l·ªõn, workflow nhi·ªÅu b∆∞·ªõc, side-effect ph·ª©c t·∫°p    | Redux Saga                   | Qu·∫£n l√Ω cancel/retry/race/parallel, background task, WebSocket              |
| Ch·ªâ qu·∫£n l√Ω d·ªØ li·ªáu server (fetch, cache, pagination) | TanStack Query               | Gi·∫£m boilerplate, auto retry, cache & refetch                               |
| App l·ªõn enterprise                                    | TanStack Query + Redux Saga  | Query: server state; Saga: business logic & side-effect; combo maintainable |
| State UI t·∫°m th·ªùi nh·ªè                                 | Zustand / Context            | Tr√°nh Redux n·∫∑ng, g·ªçn nh·∫π                                                   |

> Ch√∫ √Ω: Mix Query + Saga l√† chu·∫©n industry cho enterprise app.

</details>

---

<details>
<summary>## **5Ô∏è‚É£ Danh s√°ch case & tag**</summary>

| Case                            | Tag              | Gi·∫£i th√≠ch                               |
| ------------------------------- | ---------------- | ---------------------------------------- |
| Fetch list API                  | üü¢ Thunk ƒë·ªß      | CRUD c∆° b·∫£n, async ƒë∆°n gi·∫£n              |
| Submit login/register form      | üü¢ Thunk ƒë·ªß      | Async ƒë∆°n gi·∫£n                           |
| Update/delete item              | üü¢ Thunk ƒë·ªß      | CRUD ƒë∆°n gi·∫£n                            |
| Search realtime, cancel request | üîµ Saga b·∫Øt bu·ªôc | `takeLatest` cancel request c≈©           |
| Debounce/throttle API           | üîµ Saga b·∫Øt bu·ªôc | NgƒÉn spam API                            |
| Retry khi fail                  | üîµ Saga b·∫Øt bu·ªôc | Retry nhi·ªÅu l·∫ßn, delay gi·ªØa c√°c l·∫ßn      |
| Multi-step workflow             | üîµ Saga b·∫Øt bu·ªôc | Checkout flow, payment flow              |
| Race condition                  | üîµ Saga b·∫Øt bu·ªôc | L·∫•y k·∫øt qu·∫£ nhanh nh·∫•t gi·ªØa nhi·ªÅu server |
| Parallel API call               | üîµ Saga b·∫Øt bu·ªôc | Fetch nhi·ªÅu resource c√πng l√∫c            |
| WebSocket / Polling             | üîµ Saga b·∫Øt bu·ªôc | Background task, real-time               |
| Conditional flow, global error  | üîµ Saga b·∫Øt bu·ªôc | Side-effect n√¢ng cao, clean code         |
| Async form validation           | üü° Saga optional | Lib kh√°c g·ªçn h∆°n: React Hook Form/Yup    |
| File upload progress            | üü° Saga optional | Custom hook/Axios ƒë·ªß                     |
| Animation/side-UI logic         | üü° Saga optional | Lib chuy√™n d·ª•ng g·ªçn h∆°n (Framer Motion)  |

</details>

---

<details>
<summary>## **6Ô∏è‚É£ Roadmap H·ªçc & Th·ª±c H√†nh**</summary>

### **6.1 N·ªÅn t·∫£ng**

* JS core: closure, async/await, event loop
* React state & context
* Server state vs client state

### **6.2 Redux Core**

* Store, reducer, action, dispatch, selector
* ‚ö° Mini Todo App

### **6.3 Redux Thunk**

* CRUD app nh·ªè, async ƒë∆°n gi·∫£n
* ‚ö° Product CRUD App

### **6.4 Redux Saga**

* Async n√¢ng cao, cancel/retry/race/parallel
* Background tasks, WebSocket, polling
* ‚ö° Checkout Flow, Chat App Mock

### **6.5 TanStack Query**

* Server state management: fetch, cache, pagination, infinite scroll
* ‚ö° Blog App, Product List App

### **6.6 Mix**

* App l·ªõn enterprise: Query + Saga + Zustand cho UI state
* ‚ö° E-commerce App:

  * Query ‚Üí product list
  * Saga ‚Üí checkout workflow
  * Zustand ‚Üí sidebar/filter state

</details>

---

<details>
<summary>## **7Ô∏è‚É£ Th·ªùi gian d·ª± ki·∫øn**</summary>

| N·ªôi dung           | Th·ªùi gian |
| ------------------ | --------- |
| Redux Core + Thunk | 1‚Äì2 tu·∫ßn  |
| Saga               | 3‚Äì4 tu·∫ßn  |
| TanStack Query     | 1‚Äì2 tu·∫ßn  |
| Mix project        | 4‚Äì6 tu·∫ßn  |

</details>

---

<details>
<summary>## **8Ô∏è‚É£ Output sau roadmap**</summary>

* Portfolio side project enterprise-level
* T·ª± tin tr·∫£ l·ªùi ph·ªèng v·∫•n: ch·ªçn **Saga/Thunk/Query/Zustand** v√¨ sao
* Kinh nghi·ªám th·ª±c t·∫ø: cancel, retry, WebSocket, polling, multi-step workflow

</details>

---

<details>
<summary>‚úÖ **T√≥m t·∫Øt logic ch·ªçn c√¥ng ngh·ªá:**</summary>

1. **CRUD/async ƒë∆°n gi·∫£n** ‚Üí Thunk ho·∫∑c RTK Query
2. **Server state-centric app** ‚Üí TanStack Query
3. **Business logic & side-effect ph·ª©c t·∫°p** ‚Üí Saga
4. **App enterprise** ‚Üí Mix: Query + Saga (+ Zustand cho UI)

</details>

---

<details>
<summary>## **üìå Tham kh·∫£o v√≠ d·ª• th·ª±c t·∫ø c√°ch d√πng c√°c lo·∫°i**</summary>

# **9Ô∏è‚É£ Redux Thunk ‚Äì Chuy√™n s√¢u & Case Th·ª±c t·∫ø Enterprise**

## **9.1 Kh√°i ni·ªám & vai tr√≤**

* Middleware cho Redux, cho ph√©p vi·∫øt async action d∆∞·ªõi d·∫°ng **function** thay v√¨ object.
* Th∆∞·ªùng d√πng cho **CRUD API ƒë∆°n gi·∫£n** v√† c√°c **task async nh·∫π**.
* Th√≠ch h·ª£p cho app **enterprise nh·ªè ho·∫∑c micro-feature** trong d·ª± √°n l·ªõn.

---

## **9.2 Case th·ª±c t·∫ø**

### **Case 1: Fetch danh s√°ch s·∫£n ph·∫©m / user / blog (CRUD c∆° b·∫£n)** üü¢

* **M·ª•c ti√™u**: L·∫•y d·ªØ li·ªáu t·ª´ API, l∆∞u v√†o Redux store.
* **D·ªÖ, ch·ªâ c·∫ßn Thunk c∆° b·∫£n**

```javascript
// actions/productActions.js
export const fetchProducts = () => async (dispatch) => {
  dispatch({ type: 'PRODUCTS_FETCH_START' });
  try {
    const response = await fetch('/api/products');
    const data = await response.json();
    dispatch({ type: 'PRODUCTS_FETCH_SUCCESS', payload: data });
  } catch (error) {
    dispatch({ type: 'PRODUCTS_FETCH_ERROR', payload: error.message });
  }
};
```

* **Reducer**:

```javascript
const initialState = { list: [], loading: false, error: null };

export const productReducer = (state = initialState, action) => {
  switch (action.type) {
    case 'PRODUCTS_FETCH_START':
      return { ...state, loading: true, error: null };
    case 'PRODUCTS_FETCH_SUCCESS':
      return { ...state, loading: false, list: action.payload };
    case 'PRODUCTS_FETCH_ERROR':
      return { ...state, loading: false, error: action.payload };
    default:
      return state;
  }
};
```

* **Notes**: CRUD ƒë∆°n gi·∫£n ‚Üí **Thunk ƒë·ªß, g·ªçn nh·∫π**.

---

### **Case 2: Submit form login / register** üü¢

* **M·ª•c ti√™u**: G·ª≠i form login/register ‚Üí c·∫≠p nh·∫≠t auth state.
* **D·ªÖ, ch·ªâ c·∫ßn Thunk**

```javascript
export const loginUser = (credentials) => async (dispatch) => {
  dispatch({ type: 'AUTH_LOGIN_START' });
  try {
    const res = await fetch('/api/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(credentials),
    });
    const data = await res.json();
    dispatch({ type: 'AUTH_LOGIN_SUCCESS', payload: data });
  } catch (error) {
    dispatch({ type: 'AUTH_LOGIN_ERROR', payload: error.message });
  }
};
```

* **Notes**: Kh√¥ng c·∫ßn cancel/retry ph·ª©c t·∫°p, Thunk x·ª≠ l√Ω ƒë·ªß.

---

### **Case 3: Update / Delete item** üü¢

* **M·ª•c ti√™u**: PUT / DELETE API call.
* **D·ªÖ, ch·ªâ c·∫ßn Thunk**

```javascript
export const updateProduct = (id, updateData) => async (dispatch) => {
  dispatch({ type: 'PRODUCT_UPDATE_START' });
  try {
    const res = await fetch(`/api/products/${id}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(updateData),
    });
    const data = await res.json();
    dispatch({ type: 'PRODUCT_UPDATE_SUCCESS', payload: data });
  } catch (error) {
    dispatch({ type: 'PRODUCT_UPDATE_ERROR', payload: error.message });
  }
};
```

* **Notes**: D√πng cho enterprise app: CRUD ƒë∆°n gi·∫£n v·∫´n c√≥ th·ªÉ l√† Thunk.

---

### **Case 4: Th·ª±c hi·ªán workflow nhi·ªÅu b∆∞·ªõc nh·ªè (v√≠ d·ª•: add to cart ‚Üí calculate discount)** üü°

* **M·ª•c ti√™u**: Ch·∫°y nhi·ªÅu step async, nh∆∞ng logic ƒë∆°n gi·∫£n, kh√¥ng c·∫ßn cancel/retry global.
* **Kh√≥ h∆°n case CRUD, nh∆∞ng v·∫´n c√≥ th·ªÉ d√πng Thunk**

```javascript
export const addToCart = (product) => async (dispatch, getState) => {
  dispatch({ type: 'CART_ADD_START' });
  try {
    // Step 1: add product
    const res = await fetch('/api/cart', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(product),
    });
    const data = await res.json();
    dispatch({ type: 'CART_ADD_SUCCESS', payload: data });

    // Step 2: calculate discount
    const discountRes = await fetch(`/api/discount?cartId=${data.id}`);
    const discount = await discountRes.json();
    dispatch({ type: 'CART_APPLY_DISCOUNT', payload: discount });
  } catch (error) {
    dispatch({ type: 'CART_ADD_ERROR', payload: error.message });
  }
};
```

* **Notes**:

  * V·ªõi **workflow nhi·ªÅu b∆∞·ªõc, c√≥ race, cancel, retry**, Saga s·∫Ω clean h∆°n.
  * Thunk v·∫´n x·ª≠ l√Ω ƒë∆∞·ª£c, nh∆∞ng code d√†i v√† nested ‚Üí kh√≥ maintain.

---

### **Case 5: Fetch data c√≥ pagination / infinite scroll** üü°

* **M·ª•c ti√™u**: L·∫•y nhi·ªÅu trang d·ªØ li·ªáu t·ª´ API.
* **Thunk x·ª≠ l√Ω ƒë∆∞·ª£c, nh∆∞ng ph·∫£i t·ª± vi·∫øt logic cache/retry**
* **Enterprise tip**: TanStack Query m·∫°nh h∆°n ‚Üí t·ª± cache, prefetch, stale data.

```javascript
export const fetchProductsPage = (page) => async (dispatch) => {
  dispatch({ type: 'PRODUCTS_PAGE_FETCH_START', payload: page });
  try {
    const res = await fetch(`/api/products?page=${page}`);
    const data = await res.json();
    dispatch({ type: 'PRODUCTS_PAGE_FETCH_SUCCESS', payload: { page, data } });
  } catch (error) {
    dispatch({ type: 'PRODUCTS_PAGE_FETCH_ERROR', payload: error.message });
  }
};
```

* **Notes**: N·∫øu enterprise app ‚Üí n√™n d√πng TanStack Query cho pagination / infinite scroll.

---

### **Case 6: Conditional API call d·ª±a v√†o state / role** üü°

* **M·ª•c ti√™u**: N·∫øu user l√† admin ‚Üí g·ªçi API A, user th∆∞·ªùng ‚Üí g·ªçi API B.
* **Thunk x·ª≠ l√Ω ƒë∆∞·ª£c** nh∆∞ng verbose.

```javascript
export const fetchDashboardData = () => async (dispatch, getState) => {
  const { auth } = getState();
  dispatch({ type: 'DASHBOARD_FETCH_START' });

  try {
    const endpoint = auth.user.role === 'admin' ? '/api/admin-dashboard' : '/api/user-dashboard';
    const res = await fetch(endpoint);
    const data = await res.json();
    dispatch({ type: 'DASHBOARD_FETCH_SUCCESS', payload: data });
  } catch (error) {
    dispatch({ type: 'DASHBOARD_FETCH_ERROR', payload: error.message });
  }
};
```

* **Notes**:

  * V·ªõi workflow ph·ª©c t·∫°p, race, cancel, Saga s·∫Ω clean h∆°n.


### **Case 7: Cancel request c≈© khi search realtime (takeLatest)** üü°

* **M·ª•c ti√™u**: User nh·∫≠p search ‚Üí cancel request c≈©, ch·ªâ l·∫•y response m·ªõi nh·∫•t.
* **Thunk x·ª≠ l√Ω ƒë∆∞·ª£c nh∆∞ng verbose**, ph·∫£i d√πng `abortController`.

```javascript
let controller = null;

export const searchProducts = (query) => async (dispatch) => {
  dispatch({ type: 'SEARCH_START', payload: query });

  // Cancel request c≈©
  if (controller) controller.abort();
  controller = new AbortController();

  try {
    const res = await fetch(`/api/products?search=${query}`, { signal: controller.signal });
    const data = await res.json();
    dispatch({ type: 'SEARCH_SUCCESS', payload: data });
  } catch (error) {
    if (error.name === 'AbortError') return; // request b·ªã cancel
    dispatch({ type: 'SEARCH_ERROR', payload: error.message });
  }
};
```

**Notes**:

* Thunk l√†m ƒë∆∞·ª£c, nh∆∞ng c·∫ßn qu·∫£n l√Ω `AbortController` th·ªß c√¥ng.
* Saga c√≥ `takeLatest` built-in, code clean h∆°n nhi·ªÅu.

---

### **Case 8: Retry API khi fail nhi·ªÅu l·∫ßn** üü°

* **M·ª•c ti√™u**: G·ªçi API, n·∫øu fail ‚Üí retry n l·∫ßn, delay gi·ªØa c√°c l·∫ßn.
* **Thunk l√†m ƒë∆∞·ª£c nh∆∞ng ph·∫£i t·ª± vi·∫øt loop / delay**, verbose.

```javascript
const sleep = (ms) => new Promise((res) => setTimeout(res, ms));

export const fetchWithRetry = (url, retries = 3, delay = 1000) => async (dispatch) => {
  dispatch({ type: 'DATA_FETCH_START' });

  for (let i = 0; i < retries; i++) {
    try {
      const res = await fetch(url);
      const data = await res.json();
      dispatch({ type: 'DATA_FETCH_SUCCESS', payload: data });
      return;
    } catch (error) {
      if (i === retries - 1) {
        dispatch({ type: 'DATA_FETCH_ERROR', payload: error.message });
      } else {
        await sleep(delay);
      }
    }
  }
};
```

**Notes**:

* Thunk l√†m ƒë∆∞·ª£c, nh∆∞ng code l·∫∑p, kh√≥ maintain n·∫øu retry logic ph·ª©c t·∫°p.
* Saga c√≥ effect `retry` ‚Üí clean h∆°n.

---

### **Case 9: Parallel API call (fetch nhi·ªÅu resource c√πng l√∫c)** üü°

* **M·ª•c ti√™u**: Fetch user info + cart + orders c√πng l√∫c, ƒë·ª£i t·∫•t c·∫£ xong.
* **Thunk l√†m ƒë∆∞·ª£c** b·∫±ng `Promise.all`, nh∆∞ng kh√≥ handle error t·ª´ng request ri√™ng.

```javascript
export const fetchDashboardData = () => async (dispatch) => {
  dispatch({ type: 'DASHBOARD_FETCH_START' });

  try {
    const [userRes, cartRes, orderRes] = await Promise.all([
      fetch('/api/user').then((res) => res.json()),
      fetch('/api/cart').then((res) => res.json()),
      fetch('/api/orders').then((res) => res.json()),
    ]);

    dispatch({ type: 'DASHBOARD_FETCH_SUCCESS', payload: { user: userRes, cart: cartRes, orders: orderRes } });
  } catch (error) {
    dispatch({ type: 'DASHBOARD_FETCH_ERROR', payload: error.message });
  }
};
```

**Notes**:

* Thunk l√†m ƒë∆∞·ª£c, nh∆∞ng n·∫øu c·∫ßn **cancel / retry ri√™ng t·ª´ng call ‚Üí code r·ªëi**
* Saga `all` + `race` x·ª≠ l√Ω clean, maintainable.

---

### **Case 10: Polling API li√™n t·ª•c** üü°

* **M·ª•c ti√™u**: Ki·ªÉm tra tr·∫°ng th√°i payment ho·∫∑c job status m·ªói n gi√¢y.
* **Thunk l√†m ƒë∆∞·ª£c nh∆∞ng c·∫ßn setInterval / clearInterval th·ªß c√¥ng**.

```javascript
let pollingInterval = null;

export const startPollingPayment = (orderId) => (dispatch) => {
  dispatch({ type: 'POLLING_START', payload: orderId });

  pollingInterval = setInterval(async () => {
    try {
      const res = await fetch(`/api/payment-status/${orderId}`);
      const data = await res.json();

      dispatch({ type: 'POLLING_UPDATE', payload: data });

      if (data.status === 'success' || data.status === 'failed') {
        clearInterval(pollingInterval);
        dispatch({ type: 'POLLING_END', payload: data });
      }
    } catch (error) {
      console.error(error);
    }
  }, 5000);
};

export const stopPollingPayment = () => {
  if (pollingInterval) clearInterval(pollingInterval);
};
```

**Notes**:

* V·ªõi Thunk, b·∫°n ph·∫£i qu·∫£n l√Ω interval th·ªß c√¥ng.
* Saga c√≥ `while(true)` + `delay()` ‚Üí clean, d·ªÖ test h∆°n.

---

### **T√≥m t·∫Øt Thunk n√¢ng cao**

| Case                                  | Thunk c√≥ th·ªÉ l√†m | Notes / gi·ªõi h·∫°n                                    |
| ------------------------------------- | ---------------- | --------------------------------------------------- |
| Cancel request c≈© khi search realtime | ‚úÖ                | Ph·∫£i d√πng AbortController, code verbose             |
| Retry API khi fail nhi·ªÅu l·∫ßn          | ‚úÖ                | Loop + sleep th·ªß c√¥ng, verbose                      |
| Parallel API call                     | ‚úÖ                | Promise.all l√†m ƒë∆∞·ª£c, kh√≥ handle cancel/retry ri√™ng |
| Polling API li√™n t·ª•c                  | ‚úÖ                | Ph·∫£i qu·∫£n l√Ω interval th·ªß c√¥ng, kh√≥ maintain        |

> **K·∫øt lu·∫≠n**: Thunk v·∫´n x·ª≠ l√Ω ƒë∆∞·ª£c m·ªçi case enterprise, nh∆∞ng code d√†i, nested, kh√≥ maintain ‚Üí ƒë√¢y l√† l√Ω do Redux Saga ra ƒë·ªùi ƒë·ªÉ clean code, support cancel/retry/race/parallel d·ªÖ d√†ng.

---

Ti·∫øp theo m√¨nh s·∫Ω vi·∫øt **Redux Saga ‚Äì chuy√™n s√¢u & case th·ª±c t·∫ø enterprise**, k√®m **code minh h·ªça clean**, ƒë·ªÉ b·∫°n th·∫•y r√µ **v√¨ sao Saga m·∫°nh h∆°n Thunk trong c√°c workflow ph·ª©c t·∫°p**.

</details>

---

<details>
<summary># **10Ô∏è‚É£ Redux Saga ‚Äì Chuy√™n s√¢u & Case Th·ª±c t·∫ø Enterprise**</summary>

---

## **11.1 Kh√°i ni·ªám & vai tr√≤**

* Middleware Redux d√πng **generator function (`function*`)** ƒë·ªÉ x·ª≠ l√Ω side-effect.
* Th√≠ch h·ª£p cho c√°c workflow **nhi·ªÅu b∆∞·ªõc, cancel/retry/race/parallel, background task, WebSocket**.
* Gi√∫p code **clean, maintainable, testable**, ph√π h·ª£p enterprise app.

---

## **11.2 Case th·ª±c t·∫ø**

### **Case 1: Cancel request c≈© khi search realtime (`takeLatest`)** üîµ

```javascript
// sagas/searchSaga.js
import { call, put, takeLatest } from 'redux-saga/effects';

function* searchProductsSaga(action) {
  try {
    const data = yield call(fetch, `/api/products?search=${action.payload}`);
    const json = yield data.json();
    yield put({ type: 'SEARCH_SUCCESS', payload: json });
  } catch (error) {
    yield put({ type: 'SEARCH_ERROR', payload: error.message });
  }
}

export function* watchSearch() {
  yield takeLatest('SEARCH_START', searchProductsSaga);
}
```

**Notes**:

* `takeLatest` t·ª± ƒë·ªông cancel request c≈© ‚Üí code clean h∆°n Thunk v·ªõi AbortController.

---

### **Case 2: Retry API khi fail nhi·ªÅu l·∫ßn (`retry`)** üîµ

```javascript
import { call, put, retry } from 'redux-saga/effects';

function* fetchWithRetrySaga(action) {
  try {
    const data = yield retry(3, 1000, fetch, `/api/data`);
    const json = yield data.json();
    yield put({ type: 'DATA_FETCH_SUCCESS', payload: json });
  } catch (error) {
    yield put({ type: 'DATA_FETCH_ERROR', payload: error.message });
  }
}
```

**Notes**:

* Saga c√≥ `retry(n, delay, fn, ...)` ‚Üí clean, maintainable.
* Thunk ph·∫£i t·ª± vi·∫øt loop + sleep.

---

### **Case 3: Parallel API call (`all`)** üîµ

```javascript
import { call, put, all } from 'redux-saga/effects';

function* fetchDashboardSaga() {
  try {
    const [userRes, cartRes, orderRes] = yield all([
      call(fetch, '/api/user').then(res => res.json()),
      call(fetch, '/api/cart').then(res => res.json()),
      call(fetch, '/api/orders').then(res => res.json()),
    ]);

    yield put({
      type: 'DASHBOARD_FETCH_SUCCESS',
      payload: { user: userRes, cart: cartRes, orders: orderRes },
    });
  } catch (error) {
    yield put({ type: 'DASHBOARD_FETCH_ERROR', payload: error.message });
  }
}
```

**Notes**:

* Fetch nhi·ªÅu API c√πng l√∫c, Saga x·ª≠ l√Ω clean, d·ªÖ manage cancel/retry t·ª´ng task.

---

### **Case 4: Race condition ‚Äì l·∫•y response nhanh nh·∫•t (`race`)** üîµ

```javascript
import { call, put, race, delay } from 'redux-saga/effects';

function* fetchFastestServerSaga() {
  try {
    const { server1, server2, timeout } = yield race({
      server1: call(fetch, '/api/server1').then(res => res.json()),
      server2: call(fetch, '/api/server2').then(res => res.json()),
      timeout: delay(3000),
    });

    if (timeout) throw new Error('Timeout');
    yield put({ type: 'FETCH_FASTEST_SUCCESS', payload: server1 || server2 });
  } catch (error) {
    yield put({ type: 'FETCH_FASTEST_ERROR', payload: error.message });
  }
}
```

**Notes**:

* Saga `race` ‚Üí ch·ªâ l·∫•y response nhanh nh·∫•t, x·ª≠ l√Ω timeout d·ªÖ d√†ng.
* Thunk l√†m ƒë∆∞·ª£c nh∆∞ng code verbose v√† nested.

---

### **Case 5: Polling API li√™n t·ª•c** üîµ

```javascript
import { call, put, delay } from 'redux-saga/effects';

function* pollPaymentStatusSaga(action) {
  try {
    let status = '';
    while (status !== 'success' && status !== 'failed') {
      const res = yield call(fetch, `/api/payment-status/${action.payload}`);
      const data = yield res.json();
      status = data.status;
      yield put({ type: 'POLLING_UPDATE', payload: data });
      if (status !== 'success' && status !== 'failed') yield delay(5000);
    }
    yield put({ type: 'POLLING_END', payload: { status } });
  } catch (error) {
    yield put({ type: 'POLLING_ERROR', payload: error.message });
  }
}
```

**Notes**:

* Saga x·ª≠ l√Ω polling clean, delay built-in, d·ªÖ stop/start.
* Thunk ph·∫£i setInterval/clearInterval th·ªß c√¥ng.

---

### **Case 6: WebSocket / Real-time** üîµ

```javascript
import { eventChannel } from 'redux-saga';
import { take, call, put, fork } from 'redux-saga/effects';

function createSocketChannel(socket) {
  return eventChannel((emit) => {
    socket.on('message', (msg) => emit({ type: 'NEW_MESSAGE', payload: msg }));
    return () => socket.off('message');
  });
}

function* watchSocket() {
  const socket = new WebSocket('wss://example.com/socket');
  const channel = yield call(createSocketChannel, socket);
  while (true) {
    const action = yield take(channel);
    yield put(action);
  }
}

export function* rootSaga() {
  yield fork(watchSocket);
}
```

**Notes**:

* Saga `eventChannel` ‚Üí perfect cho real-time & background task.
* Thunk g·∫ßn nh∆∞ b·∫•t l·ª±c v·ªõi WebSocket ho·∫∑c long-running task.

---

### **T√≥m t·∫Øt Saga ‚Äì Enterprise Case**

| Case                          | Saga c√≥ ∆∞u th·∫ø | L√Ω do                                          |
| ----------------------------- | -------------- | ---------------------------------------------- |
| Cancel request (`takeLatest`) | ‚úÖ              | Built-in, code clean                           |
| Retry API                     | ‚úÖ              | `retry(n, delay, fn)`                          |
| Parallel API call (`all`)     | ‚úÖ              | Fetch nhi·ªÅu resource c√πng l√∫c, d·ªÖ cancel/retry |
| Race condition (`race`)       | ‚úÖ              | Ch·ªâ l·∫•y response nhanh nh·∫•t, handle timeout    |
| Polling API                   | ‚úÖ              | `delay` + while loop clean                     |
| WebSocket / Real-time         | ‚úÖ              | `eventChannel` qu·∫£n l√Ω background task         |
| Workflow nhi·ªÅu b∆∞·ªõc           | ‚úÖ              | Saga d·ªÖ chain, maintainable                    |

> **K·∫øt lu·∫≠n**:
>
> * Saga v∆∞·ª£t tr·ªôi ·ªü **workflow ph·ª©c t·∫°p & side-effect d√†i h·∫°n**.
> * Thunk v·∫´n x·ª≠ l√Ω ƒë∆∞·ª£c, nh∆∞ng code verbose, nested ‚Üí kh√≥ maintain trong enterprise app.

Tuy·ªát, gi·ªù m√¨nh s·∫Ω vi·∫øt **so s√°nh tr·ª±c ti·∫øp Thunk vs Saga vs TanStack Query tr√™n c√°c case enterprise**, k√®m **b·∫£ng ti√™u ch√≠ ch·ªçn c√¥ng ngh·ªá + code minh h·ªça**, ƒë·ªÉ ho√†n thi·ªán README ‚Äúenterprise-ready‚Äù.

</details>

---

<details>
<summary># **11 So s√°nh Redux Thunk vs Redux Saga vs TanStack Query ‚Äì Enterprise Case**</summary>

---

## **11.1 Logic ch·ªçn c√¥ng ngh·ªá theo case**

| Case / Scenario                                     | Thunk                   | Saga                     | TanStack Query                    | Ghi ch√∫ / Khi n√†o d√πng mix                   |
| --------------------------------------------------- | ----------------------- | ------------------------ | --------------------------------- | -------------------------------------------- |
| CRUD c∆° b·∫£n (GET/POST/PUT/DELETE)                   | ‚úÖ ƒë·ªß g·ªçn                | ‚úÖ l√†m ƒë∆∞·ª£c nh∆∞ng verbose | ‚úÖ RTK Query / TanStack Query ƒë·ªß   | Thunk nhanh, Query g·ªçn h∆°n n·∫øu ch·ªâ fetch API |
| Search realtime, cancel request (`takeLatest`)      | ‚úÖ nh∆∞ng code verbose    | ‚úÖ clean (`takeLatest`)   | ‚ùå kh√¥ng h·ªó tr·ª£ cancel             | Saga th√≠ch h·ª£p cho enterprise real-time      |
| Debounce / throttle API                             | ‚úÖ th·ªß c√¥ng              | ‚úÖ clean                  | ‚ùå                                 | Saga clean h∆°n, tr√°nh nested code            |
| Retry API khi fail                                  | ‚úÖ loop + sleep          | ‚úÖ `retry(n, delay)`      | ‚úÖ auto retry nh∆∞ng logic gi·ªõi h·∫°n | Saga n·∫øu c·∫ßn workflow k·∫øt h·ª£p nhi·ªÅu API      |
| Multi-step workflow (checkout, payment)             | ‚úÖ nested & verbose      | ‚úÖ clean, maintainable    | ‚ùå                                 | Saga b·∫Øt bu·ªôc cho workflow nhi·ªÅu b∆∞·ªõc        |
| Race condition (l·∫•y response nhanh nh·∫•t)            | ‚úÖ nested & verbose      | ‚úÖ `race()`               | ‚ùå                                 | Saga clean, Thunk code r·ªëi                   |
| Parallel API call                                   | ‚úÖ `Promise.all`         | ‚úÖ `all()`                | ‚ùå                                 | Saga d·ªÖ cancel / retry t·ª´ng task             |
| Polling API / Background task                       | ‚úÖ setInterval           | ‚úÖ while+delay            | ‚ùå                                 | Saga clean h∆°n, d·ªÖ stop/start                |
| WebSocket / Real-time                               | ‚ùå kh√≥                   | ‚úÖ `eventChannel`         | ‚ùå                                 | Saga b·∫Øt bu·ªôc                                |
| Server state (cache, pagination, infinite scroll)   | ‚úÖ l√†m ƒë∆∞·ª£c nh∆∞ng custom | ‚úÖ l√†m ƒë∆∞·ª£c nh∆∞ng verbose | ‚úÖ m·∫°nh nh·∫•t                       | Query chuy√™n d·ª•ng, gi·∫£m boilerplate          |
| UI state t·∫°m th·ªùi (modal, filter, theme)            | ‚úÖ                       | ‚úÖ verbose                | ‚ùå                                 | Zustand / Context g·ªçn nh·∫π h∆°n                |
| Async form validation / Upload progress / Animation | ‚úÖ verbose               | ‚úÖ l√†m ƒë∆∞·ª£c               | ‚ùå                                 | Lib chuy√™n d·ª•ng + Saga optional              |

---

## **11.2 So s√°nh tr·ª±c quan v·ªÅ code & maintainability**

| Aspect                   | Redux Thunk                 | Redux Saga                          | TanStack Query             |
| ------------------------ | --------------------------- | ----------------------------------- | -------------------------- |
| Async ƒë∆°n gi·∫£n           | ‚úÖ nhanh, d·ªÖ h·ªçc             | ‚úÖ l√†m ƒë∆∞·ª£c, verbose                 | ‚úÖ auto fetch, retry, cache |
| Workflow nhi·ªÅu b∆∞·ªõc      | ‚ùå nested, kh√≥ maintain      | ‚úÖ clean, d·ªÖ test                    | ‚ùå                          |
| Cancel / Debounce / Race | ‚ùå ph·∫£i t·ª± vi·∫øt code verbose | ‚úÖ built-in effects                  | ‚ùå                          |
| Parallel / Retry         | ‚úÖ `Promise.all` + loop      | ‚úÖ `all` / `retry`                   | ‚úÖ retry auto (limit)       |
| Background / WebSocket   | ‚ùå kh√≥                       | ‚úÖ `eventChannel`, long-running task | ‚ùå                          |
| Cache & Pagination       | ‚ùå custom                    | ‚ùå verbose                           | ‚úÖ m·∫°nh, auto invalidation  |
| Maintainability          | ‚ùå code nested khi complex   | ‚úÖ clean, readable                   | ‚úÖ g·ªçn cho server state     |

---

## **11.3 Khi n√†o d√πng ri√™ng, khi n√†o mix**

| Scenario                                              | Recommended Tech Stack                  | Notes / L√Ω do                                                |
| ----------------------------------------------------- | --------------------------------------- | ------------------------------------------------------------ |
| App CRUD nh·ªè, async ƒë∆°n gi·∫£n                          | Redux Thunk / RTK Query                 | Quick setup, d·ªÖ maintain                                     |
| Server state-centric app (fetch / cache / pagination) | TanStack Query                          | Auto retry, cache, prefetch                                  |
| Workflow ph·ª©c t·∫°p (checkout, multi-step)              | Redux Saga                              | Cancel, retry, race, parallel, polling                       |
| Enterprise app full-stack                             | TanStack Query + Redux Saga (+ Zustand) | Query: server state, Saga: business logic, Zustand: UI state |

---

## **11.4 V√≠ d·ª• k·∫øt h·ª£p ‚Äì Enterprise E-commerce App**

**Product List** ‚Äì **TanStack Query**

```javascript
import { useQuery } from '@tanstack/react-query';

export const useProducts = (page) => {
  return useQuery(['products', page], () =>
    fetch(`/api/products?page=${page}`).then((res) => res.json()),
    { staleTime: 5000, keepPreviousData: true }
  );
};
```

**Checkout Workflow** ‚Äì **Redux Saga**

```javascript
function* checkoutSaga(action) {
  try {
    const stock = yield call(fetch, `/api/check-stock/${action.payload}`).then(res => res.json());
    if (!stock.available) throw new Error('Out of stock');

    const order = yield call(fetch, `/api/create-order`, { method: 'POST', body: JSON.stringify(action.payload) }).then(res => res.json());
    yield put({ type: 'CHECKOUT_SUCCESS', payload: order });
  } catch (error) {
    yield put({ type: 'CHECKOUT_ERROR', payload: error.message });
  }
}
```

**UI Filter / Sidebar State** ‚Äì **Zustand**

```javascript
import create from 'zustand';

export const useUIStore = create((set) => ({
  sidebarOpen: false,
  toggleSidebar: () => set((state) => ({ sidebarOpen: !state.sidebarOpen })),
}));
```

**Notes**:

* TanStack Query ‚Üí server state, auto retry/cache
* Saga ‚Üí business logic workflow, cancel/retry
* Zustand ‚Üí local UI state nh·∫π, tr√°nh Redux n·∫∑ng

---

‚úÖ **T√≥m t·∫Øt Enterprise-ready Logic:**

1. **CRUD / async ƒë∆°n gi·∫£n** ‚Üí Thunk ho·∫∑c RTK Query
2. **Server state-centric app** ‚Üí TanStack Query
3. **Workflow ph·ª©c t·∫°p / multi-step / cancel/retry/race/parallel** ‚Üí Saga
4. **UI state t·∫°m th·ªùi nh·ªè** ‚Üí Zustand / Context
5. **Enterprise app** ‚Üí Mix Query + Saga + Zustand ‚Üí clean, maintainable, scalable

</details>

---