# Ngày 17

## Lưu trữ Web HTML5 (Web Storage)

**Web Storage** (bao gồm `sessionStorage` và `localStorage`) là API HTML5 mới, cung cấp lợi ích vượt trội so với cookie truyền thống. Trước HTML5, dữ liệu được lưu trong cookie và gửi kèm mọi yêu cầu server, nhưng Web Storage an toàn hơn, cho phép lưu trữ lượng dữ liệu lớn (ít nhất 5MB) trên trình duyệt mà không ảnh hưởng hiệu suất. Cookie chỉ lưu được khoảng 4KB mỗi cookie, trong khi Web Storage không truyền dữ liệu lên server.

Dữ liệu lưu trữ có thể được truy cập bằng JavaScript, hỗ trợ lập trình phía client mà không cần phụ thuộc vào server hoặc cơ sở dữ liệu quan hệ. Có hai đối tượng Web Storage:

- `sessionStorage`: Lưu dữ liệu trong phiên làm việc, xóa khi đóng tab.
- `localStorage`: Lưu dữ liệu không có thời hạn, tồn tại ngay cả khi đóng trình duyệt.

Dữ liệu trong `localStorage` và `sessionStorage` chỉ giới hạn trong cùng giao thức và nguồn gốc (origin), và các khóa/giá trị luôn là chuỗi.

### sessionStorage

`sessionStorage` chỉ tồn tại trong phiên làm việc của tab hoặc cửa sổ trình duyệt. Dữ liệu bị xóa khi tab đóng.

### localStorage

`localStorage` lưu dữ liệu không có thời hạn, tồn tại qua các phiên trình duyệt, tab và cửa sổ. Dữ liệu chỉ có thể truy cập trong cùng nguồn gốc và không chia sẻ giữa các trình duyệt khác nhau (ví dụ: Firefox và Chrome).

Các phương thức của `localStorage`:

- `setItem(key, value)`: Lưu dữ liệu.
- `getItem(key)`: Lấy dữ liệu.
- `removeItem(key)`: Xóa một mục.
- `clear()`: Xóa toàn bộ dữ liệu.
- `key(index)`: Lấy khóa tại chỉ số.

### Trường hợp sử dụng của Web Storage

- Lưu trữ tạm thời.
- Lưu sản phẩm trong giỏ hàng.
- Lưu dữ liệu giữa các yêu cầu trang, tab, hoặc phiên với `localStorage`.
- Hỗ trợ ứng dụng offline.
- Lưu dữ liệu tĩnh để giảm yêu cầu server (ví dụ: hình ảnh mã hóa Base64).
- Xác thực người dùng.

`sessionStorage` phù hợp khi muốn xóa dữ liệu sau khi đóng tab hoặc tránh can thiệp giữa các tab cùng ứng dụng.

---

## Đối tượng lưu trữ Web HTML5

- `window.localStorage`: Lưu dữ liệu không thời hạn.
- `window.sessionStorage`: Lưu dữ liệu trong một phiên.

### Lưu dữ liệu vào localStorage

Dữ liệu trong `localStorage` được lưu dưới dạng chuỗi. Với mảng hoặc đối tượng, cần chuyển thành chuỗi bằng `JSON.stringify()`.

```js
// Cú pháp
localStorage.setItem('key', 'value')
```

- Lưu chuỗi:

```js
localStorage.setItem('firstName', 'Asabeneh')
console.log(localStorage) // Storage {firstName: 'Asabeneh', length: 1}
```

- Lưu số:

```js
localStorage.setItem('age', 200)
console.log(localStorage) // Storage {firstName: 'Asabeneh', age: '200', length: 2}
```

- Lưu mảng:

```js
const skills = ['HTML', 'CSS', 'JS', 'React']
const skillsJSON = JSON.stringify(skills)
localStorage.setItem('skills', skillsJSON)
console.log(localStorage) // Storage {firstName: 'Asabeneh', age: '200', skills: '["HTML","CSS","JS","React"]', length: 3}
```

- Lưu đối tượng:

```js
const user = {
  firstName: 'Asabeneh',
  age: 250,
  skills: ['HTML', 'CSS', 'JS', 'React']
}
const userText = JSON.stringify(user)
localStorage.setItem('user', userText)
console.log(localStorage) // Storage {firstName: 'Asabeneh', age: '200', skills: '["HTML","CSS","JS","React"]', user: '{"firstName":"Asabeneh","age":250,"skills":["HTML","CSS","JS","React"]}', length: 4}
```

### Lấy dữ liệu từ localStorage

Sử dụng `localStorage.getItem()` để lấy dữ liệu theo khóa.

```js
let firstName = localStorage.getItem('firstName')
let age = localStorage.getItem('age')
let skills = localStorage.getItem('skills')
console.log(firstName, age, skills) // Asabeneh 200 ["HTML","CSS","JS","React"]
```

Chuyển chuỗi JSON thành mảng/đối tượng:

```js
let skillsObj = JSON.parse(localStorage.getItem('skills'))
console.log(skillsObj) // ['HTML', 'CSS', 'JS', 'React']
```

### Xóa localStorage

```js
localStorage.clear() // Xóa toàn bộ dữ liệu trong localStorage
```

---

## Bài tập: Ngày 17

### Bài tập: Cấp độ 1

1. **Lưu thông tin cá nhân vào localStorage**

```js
localStorage.setItem('firstName', 'Asabeneh')
localStorage.setItem('lastName', 'Yetayeh')
localStorage.setItem('age', 250)
localStorage.setItem('country', 'Finland')
localStorage.setItem('city', 'Helsinki')
console.log(localStorage)
/*
Storage {
  firstName: 'Asabeneh',
  lastName: 'Yetayeh',
  age: '250',
  country: 'Finland',
  city: 'Helsinki',
  length: 5
}
*/
```

### Bài tập: Cấp độ 2

1. **Lưu đối tượng student vào localStorage**

```js
const student = {
  firstName: 'Asabeneh',
  lastName: 'Yetayeh',
  age: 250,
  skills: ['HTML', 'CSS', 'JS', 'React', 'Node', 'Python'],
  country: 'Finland',
  enrolled: true
}
localStorage.setItem('student', JSON.stringify(student))
console.log(localStorage)
/*
Storage {
  student: '{"firstName":"Asabeneh","lastName":"Yetayeh","age":250,"skills":["HTML","CSS","JS","React","Node","Python"],"country":"Finland","enrolled":true}',
  length: 1
}
*/
```

### Bài tập: Cấp độ 3

1. **Tạo lớp PersonAccount**

```js
class PersonAccount {
  constructor(firstName, lastName) {
    this.firstName = firstName
    this.lastName = lastName
    this.incomes = []
    this.expenses = []
  }
  totalIncome() {
    return this.incomes.reduce((sum, { amount }) => sum + amount, 0)
  }
  totalExpense() {
    return this.expenses.reduce((sum, { amount }) => sum + amount, 0)
  }
  accountInfo() {
    return `${this.firstName} ${this.lastName} has a balance of ${this.accountBalance()}. Total income: ${this.totalIncome()}, Total expense: ${this.totalExpense()}`
  }
  addIncome(amount, description) {
    this.incomes.push({ amount, description })
  }
  addExpense(amount, description) {
    this.expenses.push({ amount, description })
  }
  accountBalance() {
    return this.totalIncome() - this.totalExpense()
  }
  saveToLocalStorage() {
    const accountData = {
      firstName: this.firstName,
      lastName: this.lastName,
      incomes: this.incomes,
      expenses: this.expenses
    }
    localStorage.setItem('personAccount', JSON.stringify(accountData))
  }
  static loadFromLocalStorage() {
    const data = JSON.parse(localStorage.getItem('personAccount'))
    if (!data) return null
    const account = new PersonAccount(data.firstName, data.lastName)
    account.incomes = data.incomes
    account.expenses = data.expenses
    return account
  }
}

const account = new PersonAccount('Asabeneh', 'Yetayeh')
account.addIncome(1000, 'Salary')
account.addIncome(500, 'Freelance')
account.addExpense(300, 'Rent')
account.saveToLocalStorage()
console.log(account.accountInfo()) // Asabeneh Yetayeh has a balance of 1200. Total income: 1500, Total expense: 300

const loadedAccount = PersonAccount.loadFromLocalStorage()
console.log(loadedAccount.accountInfo()) // Asabeneh Yetayeh has a balance of 1200. Total income: 1500, Total expense: 300
```

---

[<< Ngày 16](./16.JSON.md) | [Ngày 18 >>](./18.Promises.md)