# Ngày 8

## Phạm vi (Scope)

**Phạm vi**: Xác định nơi biến có thể được truy cập. Có hai loại chính:

- **Toàn cục (Global)**: Biến khai báo ngoài hàm, có thể truy cập khắp tệp.
- **Cục bộ (Local)**: Biến khai báo trong hàm hoặc khối, chỉ truy cập được trong phạm vi đó.

### Window Global Object

Biến khai báo không dùng `let`, `var`, `const` sẽ thuộc phạm vi toàn cục và có sẵn trong đối tượng `window`.

```js
a = 'JavaScript' // Biến toàn cục, có trong window
b = 10
function letsLearnScope() {
  console.log(a, b) // JavaScript 10
}
console.log(a, b) // JavaScript 10
```

### Phạm vi toàn cục (Global Scope)

Biến toàn cục có thể truy cập ở mọi nơi trong tệp.

```js
let a = 'JavaScript'
let b = 10
function letsLearnScope() {
  console.log(a, b) // JavaScript 10
  if (true) {
    let a = 'Python'
    let b = 100
    console.log(a, b) // Python 100
  }
  console.log(a, b) // JavaScript 10
}
letsLearnScope()
```

### Phạm vi cục bộ (Local Scope)

Biến cục bộ chỉ truy cập được trong khối hoặc hàm nơi nó được khai báo.

```js
let a = 'JavaScript'
let b = 10
function letsLearnScope() {
  console.log(a, b) // JavaScript 10
  if (true) {
    let a = 'Python'
    let b = 20
    let c = 30
    console.log(a, b, c) // Python 20 30
  }
  console.log(a, b) // JavaScript 10
}
letsLearnScope()
```

- Biến khai báo với `var` chỉ giới hạn trong phạm vi hàm.
- Biến khai báo với `let` hoặc `const` giới hạn trong phạm vi khối (block scope: hàm, if, vòng lặp, v.v.).

```js
if (true) {
  var gravity = 9.81 // var có phạm vi hàm hoặc toàn cục
  console.log(gravity) // 9.81
}
console.log(gravity) // 9.81

if (true) {
  const gravity = 9.81 // const có phạm vi khối
  console.log(gravity) // 9.81
}
// console.log(gravity) // Lỗi: gravity is not defined
```

## Đối tượng (Object)

**Đối tượng**: Tập hợp các cặp khóa-giá trị (key-value pairs). Các khóa không có thứ tự cố định.

### Tạo đối tượng rỗng

```js
const person = {}
```

### Tạo đối tượng với giá trị

```js
const rectangle = {
  length: 20,
  width: 20
}
console.log(rectangle) // {length: 20, width: 20}

const person = {
  firstName: 'Asabeneh',
  lastName: 'Yetayeh',
  age: 250,
  country: 'Finland',
  city: 'Helsinki',
  skills: ['HTML', 'CSS', 'JavaScript'],
  isMarried: true
}
```

### Truy cập giá trị từ đối tượng

- Dùng dấu chấm `.` nếu khóa là một từ.
- Dùng dấu ngoặc vuông `[]` nếu khóa có dấu cách hoặc cần truy cập động.

```js
const person = {
  firstName: 'Asabeneh',
  lastName: 'Yetayeh',
  'phone number': '+3584545454545'
}
console.log(person.firstName) // Asabeneh
console.log(person['lastName']) // Yetayeh
console.log(person['phone number']) // +3584545454545
```

### Tạo phương thức đối tượng

Phương thức là hàm trong đối tượng, sử dụng `this` để truy cập các thuộc tính khác.

```js
const person = {
  firstName: 'Asabeneh',
  lastName: 'Yetayeh',
  getFullName: function () {
    return `${this.firstName} ${this.lastName}`
  }
}
console.log(person.getFullName()) // Asabeneh Yetayeh
```

### Thêm khóa mới cho đối tượng

Đối tượng có thể thay đổi (mutable).

```js
person.nationality = 'Ethiopian'
person.skills.push('Python')
console.log(person.nationality) // Ethiopian
```

### Phương thức đối tượng

1. **Object.assign**: Sao chép đối tượng mà không thay đổi bản gốc.

```js
const copyPerson = Object.assign({}, person)
console.log(copyPerson)
```

2. **Object.keys**: Lấy danh sách các khóa dưới dạng mảng.

```js
console.log(Object.keys(person)) // ['firstName', 'lastName', 'getFullName', 'nationality', 'skills']
```

3. **Object.values**: Lấy danh sách các giá trị dưới dạng mảng.

```js
console.log(Object.values(person))
```

4. **Object.entries**: Lấy danh sách cặp [khóa, giá trị].

```js
console.log(Object.entries(person))
```

5. **hasOwnProperty**: Kiểm tra xem khóa có tồn tại trong đối tượng không.

```js
console.log(person.hasOwnProperty('firstName')) // true
console.log(person.hasOwnProperty('score')) // false
```

---

## Bài tập: Ngày 8

### Bài tập: Cấp độ 1

1. **Tạo đối tượng dog rỗng**

```js
const dog = {}
```

2. **In đối tượng dog**

```js
console.log(dog) // {}
```

3. **Thêm thuộc tính cho dog**

```js
dog.name = 'Buddy'
dog.legs = 4
dog.color = 'Brown'
dog.age = 3
dog.bark = function () {
  return 'woof woof'
}
```

4. **Lấy giá trị từ dog**

```js
console.log(dog.name) // Buddy
console.log(dog.legs) // 4
console.log(dog.color) // Brown
console.log(dog.age) // 3
console.log(dog.bark()) // woof woof
```

5. **Thêm thuộc tính mới cho dog**

```js
dog.breed = 'Husky'
dog.getDogInfo = function () {
  return `${this.name} is a ${this.breed}, ${this.age} years old, with ${this.color} fur.`
}
console.log(dog.getDogInfo()) // Buddy is a Husky, 3 years old, with Brown fur.
```

### Bài tập: Cấp độ 2

```js
const users = {
  Alex: {
    email: 'alex@alex.com',
    skills: ['HTML', 'CSS', 'JavaScript'],
    age: 20,
    isLoggedIn: false,
    points: 30
  },
  Asab: {
    email: 'asab@asab.com',
    skills: ['HTML', 'CSS', 'JavaScript', 'Redux', 'MongoDB', 'Express', 'React', 'Node'],
    age: 25,
    isLoggedIn: false,
    points: 50
  },
  Brook: {
    email: 'daniel@daniel.com',
    skills: ['HTML', 'CSS', 'JavaScript', 'React', 'Redux'],
    age: 30,
    isLoggedIn: true,
    points: 50
  },
  Daniel: {
    email: 'daniel@alex.com',
    skills: ['HTML', 'CSS', 'JavaScript', 'Python'],
    age: 20,
    isLoggedIn: false,
    points: 40
  },
  John: {
    email: 'john@john.com',
    skills: ['HTML', 'CSS', 'JavaScript', 'React', 'Redux', 'Node.js'],
    age: 20,
    isLoggedIn: true,
    points: 50
  },
  Thomas: {
    email: 'thomas@thomas.com',
    skills: ['HTML', 'CSS', 'JavaScript', 'React'],
    age: 20,
    isLoggedIn: false,
    points: 40
  },
  Paul: {
    email: 'paul@paul.com',
    skills: ['HTML', 'CSS', 'JavaScript', 'MongoDB', 'Express', 'React', 'Node'],
    age: 20,
    isLoggedIn: false,
    points: 40
  }
}
```

1. **Tìm người có nhiều kỹ năng nhất**

```js
function findMostSkilledPerson(users) {
  let maxSkills = 0
  let mostSkilled = ''
  for (const user in users) {
    if (users[user].skills.length > maxSkills) {
      maxSkills = users[user].skills.length
      mostSkilled = user
    }
  }
  return mostSkilled
}
console.log(findMostSkilledPerson(users)) // Asab
```

2. **Đếm người dùng đăng nhập và có điểm >= 50**

```js
function countUsers(users) {
  let loggedIn = 0
  let highPoints = 0
  for (const user in users) {
    if (users[user].isLoggedIn) loggedIn++
    if (users[user].points >= 50) highPoints++
  }
  return { loggedIn, highPoints }
}
console.log(countUsers(users)) // { loggedIn: 2, highPoints: 3 }
```

3. **Tìm các nhà phát triển MERN**

```js
function findMernDevelopers(users) {
  const mern = ['MongoDB', 'Express', 'React', 'Node']
  const mernDevs = []
  for (const user in users) {
    if (mern.every(skill => users[user].skills.includes(skill))) {
      mernDevs.push(user)
    }
  }
  return mernDevs
}
console.log(findMernDevelopers(users)) // ['Asab', 'Paul']
```

4. **Thêm tên bạn vào users mà không sửa đổi bản gốc**

```js
const newUsers = Object.assign({}, users, {
  YourName: {
    email: 'yourname@yourname.com',
    skills: ['HTML', 'CSS', 'JavaScript'],
    age: 25,
    isLoggedIn: true,
    points: 60
  }
})
console.log(newUsers.YourName)
```

5. **Lấy tất cả khóa của users**

```js
console.log(Object.keys(users)) // ['Alex', 'Asab', 'Brook', 'Daniel', 'John', 'Thomas', 'Paul']
```

6. **Lấy tất cả giá trị của users**

```js
console.log(Object.values(users))
```

7. **In thông tin quốc gia**

```js
const countries = {
  Finland: { capital: 'Helsinki', population: 5540000, languages: ['Finnish', 'Swedish'] }
}
function printCountryInfo(countryObj, countryName) {
  const { capital, population, languages } = countryObj[countryName]
  return `${countryName}'s capital is ${capital}, population is ${population}, and languages are ${languages.join(', ')}.`
}
console.log(printCountryInfo(countries, 'Finland'))
```

### Bài tập: Cấp độ 3

1. **Tạo đối tượng personAccount**

```js
const personAccount = {
  firstName: 'Asabeneh',
  lastName: 'Yetayeh',
  incomes: [],
  expenses: [],
  totalIncome() {
    return this.incomes.reduce((sum, inc) => sum + inc.amount, 0)
  },
  totalExpense() {
    return this.expenses.reduce((sum, exp) => sum + exp.amount, 0)
  },
  accountInfo() {
    return `${this.firstName} ${this.lastName}, Balance: ${this.accountBalance()}`
  },
  addIncome(amount, description) {
    this.incomes.push({ amount, description })
  },
  addExpense(amount, description) {
    this.expenses.push({ amount, description })
  },
  accountBalance() {
    return this.totalIncome() - this.totalExpense()
  }
}
personAccount.addIncome(1000, 'Salary')
personAccount.addExpense(200, 'Rent')
console.log(personAccount.accountInfo()) // Asabeneh Yetayeh, Balance: 800
```

2. **Hệ thống đăng ký và đăng nhập**

```js
const users = [
  { _id: 'ab12ex', username: 'Alex', email: 'alex@alex.com', password: '123123', createdAt: '08/01/2020 9:00 AM', isLoggedIn: false },
  { _id: 'fg12cy', username: 'Asab', email: 'asab@asab.com', password: '123456', createdAt: '08/01/2020 9:30 AM', isLoggedIn: true }
]

// a. Đăng ký
function signUp(newUser) {
  if (users.some(user => user.email === newUser.email)) {
    return 'User already has an account'
  }
  users.push({ ...newUser, _id: Math.random().toString(36).slice(2, 8), createdAt: new Date().toLocaleString(), isLoggedIn: false })
  return 'User registered successfully'
}
console.log(signUp({ username: 'NewUser', email: 'new@new.com', password: '123456' }))

// b. Đăng nhập
function signIn(email, password) {
  const user = users.find(user => user.email === email && user.password === password)
  if (user) {
    user.isLoggedIn = true
    return 'Login successful'
  }
  return 'Invalid credentials'
}
console.log(signIn('alex@alex.com', '123123')) // Login successful
```

3. **Xếp hạng sản phẩm**

```js
const products = [
  { _id: 'eedfcf', name: 'mobile phone', description: 'Huawei Honor', price: 200, ratings: [{ userId: 'fg12cy', rate: 5 }, { userId: 'zwf8md', rate: 4.5 }], likes: [] },
  { _id: 'aegfal', name: 'Laptop', description: 'MacPro: System Darwin', price: 2500, ratings: [], likes: ['fg12cy'] }
]

// a. Đánh giá sản phẩm
function rateProduct(productId, userId, rate) {
  const product = products.find(p => p._id === productId)
  if (!product) return 'Product not found'
  product.ratings.push({ userId, rate })
  return 'Rating added'
}
console.log(rateProduct('eedfcf', 'ab12ex', 4))

// b. Tính trung bình đánh giá
function averageRating(productId) {
  const product = products.find(p => p._id === productId)
  if (!product || !product.ratings.length) return 0
  return product.ratings.reduce((sum, r) => sum + r.rate, 0) / product.ratings.length
}
console.log(averageRating('eedfcf')) // Ví dụ: 4.5
```

4. **Thích sản phẩm**

```js
function likeProduct(productId, userId) {
  const product = products.find(p => p._id === productId)
  if (!product) return 'Product not found'
  if (product.likes.includes(userId)) {
    product.likes = product.likes.filter(id => id !== userId)
    return 'Like removed'
  }
  product.likes.push(userId)
  return 'Like added'
}
console.log(likeProduct('eedfcf', 'fg12cy')) // Like added
```

---

[<< Ngày 7](./7.Functions.md) | [Ngày 9 >>](./9.Higher_Order_Functions.md)