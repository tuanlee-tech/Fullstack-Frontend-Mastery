

# 🧭 **Nested Routes trong Next.js**

## 🎯 Mục tiêu

Hiểu cách Next.js cho phép ta tạo **route lồng nhau** chỉ bằng cách lồng thư mục,
và **layout cha–con** sẽ tự động bao bọc các trang con tương ứng.

---

## 🧱 1️⃣ Cấu trúc thư mục thể hiện route hierarchy

**Trong App Router, “Nested Routes” = Thư mục lồng nhau.**

Ví dụ:

```
app/
├── dashboard/
│   ├── layout.tsx
│   ├── page.tsx
│   └── analytics/
│       └── page.tsx
```

➡ Kết quả URL:

| URL                    | File                               |
| ---------------------- | ---------------------------------- |
| `/dashboard`           | `app/dashboard/page.tsx`           |
| `/dashboard/analytics` | `app/dashboard/analytics/page.tsx` |

---

## 🧩 2️⃣ **layout.tsx** đóng vai trò *wrapper layout* cho tất cả route con

Nếu bạn có `layout.tsx` trong `dashboard/`,
Next.js sẽ **render layout đó cho cả /dashboard và các route con bên trong**.

```tsx
// app/dashboard/layout.tsx
export default function DashboardLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <section
      style={{
        border: "2px solid #ccc",
        borderRadius: 8,
        padding: "1rem",
        marginTop: "1rem",
      }}
    >
      <h2>📊 Dashboard Layout</h2>
      <nav style={{ display: "flex", gap: "1rem" }}>
        <a href="/dashboard">Overview</a>
        <a href="/dashboard/analytics">Analytics</a>
      </nav>
      <hr />
      {children}
    </section>
  );
}
```

---

## 📄 3️⃣ **Dashboard Page**

```tsx
// app/dashboard/page.tsx
export default function DashboardPage() {
  return (
    <div>
      <h3>Dashboard Overview</h3>
      <p>Welcome to your dashboard summary view.</p>
    </div>
  );
}
```

---

## 📄 4️⃣ **Nested Route Page**

```tsx
// app/dashboard/analytics/page.tsx
export default function AnalyticsPage() {
  return (
    <div>
      <h3>Analytics Section</h3>
      <p>Here you can see user engagement and metrics.</p>
    </div>
  );
}
```

---

## 🧠 5️⃣ **Khi render, Next.js làm gì?**

Khi bạn vào `/dashboard/analytics`:

1. Next.js **render `app/layout.tsx` (root layout)**
2. Rồi render **`app/dashboard/layout.tsx` (nested layout)**
3. Cuối cùng là **`app/dashboard/analytics/page.tsx` (page con)**

🧩 Cấu trúc kết hợp:

```tsx
<html>
  <body>
    {/* Root Layout */}
    <header>...</header>

    {/* Dashboard Layout */}
    <section>
      <h2>Dashboard Layout</h2>
      <nav>...</nav>

      {/* Nested Page */}
      <h3>Analytics Section</h3>
      <p>...</p>
    </section>
  </body>
</html>
```

---

## 💬 6️⃣ **Điều tuyệt vời của Nested Layouts**

* Không cần “props drilling” layout xuống từng component.
* Dễ quản lý vùng giao diện riêng biệt cho từng phần ứng dụng.
* Layout cha được **giữ nguyên state** khi chuyển giữa route con → không bị reload.

---

## 🧩 **Bài tập nhỏ**

> Tạo cấu trúc `/dashboard` gồm:
>
> * `/dashboard` → hiển thị overview.
> * `/dashboard/settings` → hiển thị phần cài đặt.
> * Cả hai dùng chung layout có sidebar và tiêu đề “Dashboard Panel”.
> * Khi chuyển giữa 2 trang, sidebar giữ nguyên (không bị reload).


## 🧱 Cấu trúc thư mục

```
app/
├── layout.tsx
├── page.tsx
└── dashboard/
    ├── layout.tsx        ← layout con cho dashboard
    ├── page.tsx          ← /dashboard
    └── settings/
        └── page.tsx      ← /dashboard/settings
```

---

## `app/dashboard/layout.tsx`

```tsx
"use client"; // cho phép dùng useState để giữ sidebar state

import { useState } from "react";
import Link from "next/link";

export default function DashboardLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  const [collapsed, setCollapsed] = useState(false);

  return (
    <section
      style={{
        display: "flex",
        border: "2px solid #ccc",
        borderRadius: 8,
        marginTop: "1rem",
        minHeight: "60vh",
      }}
    >
      {/* Sidebar */}
      <aside
        style={{
          width: collapsed ? "80px" : "220px",
          transition: "all 0.3s ease",
          background: "#f3f4f6",
          padding: "1rem",
          borderRight: "1px solid #e5e7eb",
        }}
      >
        <button
          onClick={() => setCollapsed(!collapsed)}
          style={{
            background: "#111827",
            color: "white",
            border: "none",
            borderRadius: 4,
            padding: "0.5rem 1rem",
            marginBottom: "1rem",
            cursor: "pointer",
            width: "100%",
          }}
        >
          {collapsed ? "➡️" : "⬅️ Collapse"}
        </button>

        {!collapsed && (
          <nav style={{ display: "flex", flexDirection: "column", gap: 12 }}>
            <Link href="/dashboard">🏠 Overview</Link>
            <Link href="/dashboard/settings">⚙️ Settings</Link>
          </nav>
        )}
      </aside>

      {/* Content area */}
      <div style={{ flex: 1, padding: "1.5rem" }}>
        <h2 style={{ borderBottom: "1px solid #ddd", paddingBottom: "0.5rem" }}>
          📊 Dashboard Panel
        </h2>
        <div style={{ marginTop: "1rem" }}>{children}</div>
      </div>
    </section>
  );
}
```

---

## `app/dashboard/page.tsx`

```tsx
export default function DashboardOverviewPage() {
  return (
    <div>
      <h3>Overview</h3>
      <p>Welcome to your main dashboard. Here’s the summary of your data.</p>
    </div>
  );
}
```

---

## `app/dashboard/settings/page.tsx`

```tsx
export default function DashboardSettingsPage() {
  return (
    <div>
      <h3>Settings</h3>
      <p>Here you can manage your profile and preferences.</p>
    </div>
  );
}
```

---

## ✅ Giải thích

* `layout.tsx` trong `dashboard/` là **nested layout**, sẽ bọc tất cả route con (`/dashboard`, `/dashboard/settings`, …).
* Khi bạn chuyển giữa `/dashboard` và `/dashboard/settings`, Next.js:

  1. Không reload lại `layout.tsx`
  2. Giữ nguyên sidebar & state (`collapsed`)
  3. Chỉ thay đổi phần `{children}` bên phải

=> Đây là cơ chế **Nested Routing + Persistent Layout** — một trong những điểm **Next.js App Router vượt trội hơn Pages Router**.

---
[<< BÀI 04](./04.md) | [BÀI 05 >>](./05.md)