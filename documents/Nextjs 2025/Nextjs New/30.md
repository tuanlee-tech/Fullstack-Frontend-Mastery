
## 🧭 Parallel Intercepting Routes trong Next.js

### 🎯 Mục tiêu

* Hiểu cách **kết hợp Parallel Routes và Intercepting Routes**.
* Render **nhiều “layer” UI song song** trên cùng một layout mà không ảnh hưởng lẫn nhau.
* Ví dụ: mở **modal** hoặc **sidebar** trong khi vẫn hiển thị **content chính**.

---

## 🧱 1️⃣ Cơ chế hoạt động

* Parallel Route: dùng cú pháp `(group)` để **tách các route song song**.
* Intercepting Route: route phụ hiển thị overlay, modal, hoặc sidebar.
* Kết hợp → có thể **render nhiều component “không liên quan” trong cùng layout**.

```txt
app/
├── dashboard/
│   ├── layout.tsx
│   ├── page.tsx
│   ├── (modals)/
│   │   └── new-user/
│   │       └── page.tsx
│   └── (sidebars)/
│       └── quick-settings/
│           └── page.tsx
```

* `/dashboard/(modals)/new-user` → render modal overlay.
* `/dashboard/(sidebars)/quick-settings` → render sidebar.
* Hai route có thể mở **song song** mà layout cha không bị reload.

---

## 🧩 2️⃣ Ví dụ minh họa

```tsx
// app/dashboard/(sidebars)/quick-settings/page.tsx
"use client";
import { useRouter } from "next/navigation";

export default function QuickSettingsSidebar() {
  const router = useRouter();
  return (
    <aside
      style={{
        position: "fixed",
        top: 0,
        right: 0,
        width: "250px",
        height: "100vh",
        background: "#f4f4f4",
        padding: "1rem",
        boxShadow: "-2px 0 5px rgba(0,0,0,0.1)",
      }}
    >
      <h3>Quick Settings</h3>
      <button onClick={() => router.back()}>Đóng</button>
    </aside>
  );
}
```

* Layout cha (`dashboard/layout.tsx`) vẫn hiển thị **content chính**.
* Modal và sidebar có thể **xuất hiện đồng thời** nhờ Parallel Intercepting Routes.

---

## 💡 3️⃣ Lợi ích

* Render **đa lớp UI** mà không làm reload layout.
* Quản lý **state overlay** dễ dàng.
* Giúp xây dựng UI **modular, reusable, production-ready**.
---
Chúng ta sẽ làm một **demo tổng hợp toàn bộ PHẦN 4 – Advanced Routing**: bao gồm **Parallel Routes, Intercepting Routes, Parallel Intercepting Routes** kết hợp với **Nested Layouts** trong dashboard.

Mục tiêu:

* Dashboard có **content chính** (Overview / Analytics)
* Có thể mở **Modal** thêm user
* Có thể mở **Sidebar nhanh** (Quick Settings) song song
* Layout cha **không reload** khi chuyển route phụ
* URL vẫn rõ ràng, modular, production-ready

---

## 1️⃣ Cấu trúc thư mục

```txt
app/
├── dashboard/
│   ├── layout.tsx
│   ├── page.tsx           // Dashboard Overview
│   ├── analytics/
│   │   └── page.tsx
│   ├── (modals)/
│   │   └── new-user/
│   │       └── page.tsx
│   └── (sidebars)/
│       └── quick-settings/
│           └── page.tsx
```

* `(modals)` → Intercepting Route cho modal
* `(sidebars)` → Intercepting Route cho sidebar
* Nested route: `/dashboard/analytics`

---

## 2️⃣ Layout cha

```tsx
// app/dashboard/layout.tsx
import Link from "next/link";

export default function DashboardLayout({ children }: { children: React.ReactNode }) {
  return (
    <div style={{ display: "flex", minHeight: "100vh" }}>
      {/* Sidebar mặc định */}
      <aside
        style={{
          width: "200px",
          background: "#f0f0f0",
          padding: "1rem",
        }}
      >
        <h3>📋 Dashboard Menu</h3>
        <nav style={{ display: "flex", flexDirection: "column", gap: "0.5rem" }}>
          <Link href="/dashboard">Overview</Link>
          <Link href="/dashboard/analytics">Analytics</Link>
          <Link href="/dashboard/(modals)/new-user">Add User Modal</Link>
          <Link href="/dashboard/(sidebars)/quick-settings">Quick Settings Sidebar</Link>
        </nav>
      </aside>

      {/* Content chính */}
      <main style={{ flex: 1, padding: "1rem" }}>{children}</main>
    </div>
  );
}
```

---

## 3️⃣ Pages

### 3.1 Overview

```tsx
// app/dashboard/page.tsx
export default function DashboardOverview() {
  return (
    <div>
      <h2>📊 Dashboard Overview</h2>
      <p>Welcome to your dashboard summary view.</p>
    </div>
  );
}
```

### 3.2 Analytics

```tsx
// app/dashboard/analytics/page.tsx
export default function AnalyticsPage() {
  return (
    <div>
      <h2>📈 Analytics</h2>
      <p>View your user engagement metrics here.</p>
    </div>
  );
}
```

---

## 4️⃣ Modal (Intercepting Route)

```tsx
// app/dashboard/(modals)/new-user/page.tsx
"use client";
import { useRouter } from "next/navigation";

export default function NewUserModal() {
  const router = useRouter();

  return (
    <div
      style={{
        position: "fixed",
        inset: 0,
        background: "rgba(0,0,0,0.5)",
        display: "flex",
        justifyContent: "center",
        alignItems: "center",
      }}
    >
      <div style={{ background: "#fff", padding: "2rem", borderRadius: 8 }}>
        <h2>➕ Add New User</h2>
        <button onClick={() => router.back()}>Close</button>
      </div>
    </div>
  );
}
```

---

## 5️⃣ Quick Settings Sidebar (Parallel Intercepting Route)

```tsx
// app/dashboard/(sidebars)/quick-settings/page.tsx
"use client";
import { useRouter } from "next/navigation";

export default function QuickSettingsSidebar() {
  const router = useRouter();

  return (
    <aside
      style={{
        position: "fixed",
        top: 0,
        right: 0,
        width: "250px",
        height: "100vh",
        background: "#f4f4f4",
        padding: "1rem",
        boxShadow: "-2px 0 5px rgba(0,0,0,0.1)",
      }}
    >
      <h3>⚙ Quick Settings</h3>
      <button onClick={() => router.back()}>Close</button>
    </aside>
  );
}
```

---

## 6️⃣ Cách hoạt động

| URL                                    | Kết quả                                                            |
| -------------------------------------- | ------------------------------------------------------------------ |
| `/dashboard`                           | Hiển thị layout + Overview                                         |
| `/dashboard/analytics`                 | Layout giữ nguyên, chỉ đổi nội dung chính                          |
| `/dashboard/(modals)/new-user`         | Hiển thị modal overlay, layout không reload                        |
| `/dashboard/(sidebars)/quick-settings` | Sidebar mở thêm ở cạnh phải                                        |
| Mở cả hai song song                    | Cả modal và sidebar cùng hiển thị, layout cha vẫn giữ nguyên state |

---

## 💡 Lợi ích

| Ưu điểm             | Mô tả                                                   |
| ------------------- | ------------------------------------------------------- |
| 🧩 Modular UI       | Dễ chia component và route theo layer                   |
| 🚀 Hiệu năng cao    | Không reload layout, giữ nguyên state                   |
| 🪟 UX tốt           | Modal/Sidebar độc lập, điều hướng nhẹ nhàng             |
| 🧱 Production-ready | Dễ scale UI phức tạp, ví dụ: dashboard, CMS, social app |

---

## 🧠 Gợi ý mở rộng

* Dùng `@modal` và `@sidebar` làm **Parallel Slot** để tách render song song rõ ràng hơn.
* Kết hợp `loading.tsx` cho UX mượt mà khi tải modal hoặc sidebar.
* Gắn thêm **error.tsx** riêng cho từng vùng UI để cô lập lỗi.

---

## ⚙️ Tóm tắt cơ chế

| Thành phần              | Nhiệm vụ                                         |
| ----------------------- | ------------------------------------------------ |
| **Parallel Routes**     | Cho phép render nhiều vùng UI song song          |
| **Intercepting Routes** | Hiển thị UI overlay tạm thời trên route hiện tại |
| **Kết hợp cả hai**      | Modal, Sidebar, Drawer cùng tồn tại độc lập      |
| **router.back()**       | Quay về route trước, đóng overlay                |


---
[<< BÀI 29](./29.md) | [BÀI 31 >>](./31.md)