# DOM
<details>
<summary><strong>1. DOM là gì? Tìm hiểu về DOM</strong></summary>

### DOM là gì?

DOM (Document Object Model) là một thành phần cơ bản của JavaScript, biểu diễn cấu trúc dữ liệu của một trang web.

Ví dụ đơn giản:

```html
<!DOCTYPE html>
<html>
  <head>
    <title>My home page</title>
  </head>
  <body>
    <h1>My home page</h1>
    <p>Hello, I am Marijn and this is my home page.</p>
    <p>
      I also wrote a book! Read it
      <a href="https://kungfutech.edu.vn">here</a>.
    </p>
  </body>
</html>
```

Mỗi phần tử trong trang chính là một DOM node.

---

### Cấu trúc biểu diễn DOM

* Trang web được biểu diễn dạng **cây (tree)**, mỗi node tương ứng với một DOM node.
* **nodeType**:

  * `document.ELEMENT_NODE (1)` : node thông thường (html, head, body, title, h1, p,…)
  * `document.TEXT_NODE (3)` : node text
  * `document.COMMENT_NODE (8)` : node comment

---

### Liên kết giữa các DOM node

* `node.parentNode` : trỏ đến node cha. Nếu node không có cha, là `null`.
* `node.childNodes` : danh sách các node con (giống array nhưng không có method slice, forEach).
* `node.firstChild` : node con đầu tiên.
* `node.lastChild` : node con cuối cùng.
* `node.previousSibling` : node liền kề phía trước.
* `node.nextSibling` : node liền kề phía sau.

---

### Một số phương thức phổ biến

* `node.getElementsByTagName('tagName')` : trả về danh sách node con/cháu với tagName.
* `node.getElementsByClassName('className')` : trả về danh sách node con/cháu với class.
* `node.getElementById('id')` : node có id.
* `node.removeChild(child)` : bỏ node child.
* `node.appendChild(child)` : thêm node child cuối danh sách.
* `node.insertBefore(newNode, referenceNode)` : chèn node trước referenceNode.
* `node.replaceChild(newChild, oldChild)` : thay oldChild bằng newChild.
* `document.createTextNode(data)` : tạo node text.
* `document.createElement(tagName)` : tạo node mới.
* `document.querySelector(selectors)` : node đầu tiên thoả selectors.
* `document.querySelectorAll(selectors)` : danh sách node thoả selectors (DFS).

---

### Ví dụ thực hành

Một số bài tập:

* Build a table
* Elements by Tag Name
* The cat's hat

**Tham khảo:** The Document Object Model

</details>
<details>
<summary><strong>2. Một số event trong JavaScript</strong></summary>

### Đăng ký và huỷ đăng ký Event

**Đăng ký Event:**

```js
Node.addEventListener('tên sự kiện', hàm xử lý);
```

* `Node`: phần tử DOM (document, body, h1, p, img, button,…)
* `tên sự kiện`: click, mousedown, mouseup, mousemove, keydown, keyup, keypress,...
* `hàm xử lý`: hàm được gọi khi sự kiện xảy ra.

Ví dụ:

```js
function func1() { console.log("function 1"); }
function func2() { console.log("function 2"); }

addEventListener("click", func1);
addEventListener("click", func2);
```

Hàm đăng ký trước sẽ được gọi trước.

**Huỷ đăng ký Event:**

```js
Node.removeEventListener('tên sự kiện', hàm xử lý);
```

Ví dụ:

```js
removeEventListener("click", func1);
```

Chỉ còn `func2` được gọi khi click.

---

### Đăng ký event cho nhiều node

Sử dụng một lần `addEventListener` và `event.target` để xác định node được click.

```html
<button>A</button>
<button>B</button>
<button>C</button>
<p>Hello</p>
<script>
  document.body.addEventListener("click", function (event) {
    if (event.target.nodeName == "BUTTON")
      console.log("Clicked", event.target.textContent);
    else if (event.target.nodeName == "P")
      console.log("Paragraph clicked", event.target.textContent);
  });
</script>
```

---

### Huỷ hàm mặc định với Event

Sử dụng `preventDefault` để ngăn hành vi mặc định:

```html
<a href="https://developer.mozilla.org/">MDN</a>
<script>
  var link = document.querySelector("a");
  link.addEventListener("click", function (event) {
    console.log("Nope.");
    event.preventDefault();
  });
</script>
```

---

### Một số Event cơ bản

**Key Event**:

* `keydown`: nhấn xuống
* `keyup`: nhả ra
* `keypress`: nhấn giữ

```js
addEventListener("keydown", e => console.log("keydown", e.keyCode));
addEventListener("keyup", e => console.log("keyup", e.keyCode));
addEventListener("keypress", e => console.log("keypress", e.keyCode));
```

Nhấn tổ hợp phím:

```js
if (event.ctrlKey) console.log("ctrl + key");
if (event.shiftKey) console.log("shift + key");
if (event.altKey) console.log("alt + key");
```

**Mouse Event**:

* `click`: nhấn 1 lần
* `dblclick`: nhấn nhanh 2 lần
* `mousedown`: nhấn xuống
* `mouseup`: nhả ra
* `mousemove`: di chuyển chuột
* ... (có thể dùng để xác định vị trí, kéo thả,...)

---

### Kết luận

* `addEventListener` : đăng ký sự kiện
* `removeEventListener` : huỷ sự kiện
* `preventDefault` : bỏ hành vi mặc định
* Key event: `keydown`, `keyup`, `keypress`
* Mouse event: `click`, `dblclick`, `mousedown`, `mouseup`, `mousemove`

**Tham khảo:** Handling Events

</details>
<details>
<summary><strong>3. HTML String sang DOM Node với DOMParser</strong></summary>

### Chuyển HTML String sang DOM Node

**Bước 1: Tạo DOMParser**

```js
let domParser = new DOMParser();
```

**Bước 2: Parse HTML String**

```js
let doc = domParser.parseFromString("<div>Hello</div>", "text/html");
console.log(doc);
```

* `parseFromString(htmlString, type)`:

  * `htmlString`: chuỗi HTML cần chuyển
  * `type`: `"text/html"`, `"application/xml"`, `"image/svg+xml"`
* Kết quả trả về là một `document` với đầy đủ `<html>`, `<head>`, `<body>` và các node từ string.

**Bước 3: Lấy các node mới**

```js
let nodes = doc.body.childNodes;
console.log(nodes); // NodeList [div]
```

* `childNodes` trả về NodeList, có thể dùng để thêm vào DOM thực.

---

### Ví dụ: Chuyển HTML String thành DOM và vẽ lên HTML

**HTML giao diện**

```html
<div id="container"></div>
<button id="btnAdd">Add</button>
<button id="btnRm">Remove</button>
```

**JavaScript**

```js
// Hàm lấy Node từ HTML String
let getNodes = (str) => 
  new DOMParser().parseFromString(str, "text/html").body.childNodes;

// HTML String mẫu
let nodes = getNodes("<div><span>1</span></div><div><span>2</span></div>");

// Thêm Node vào container
btnAdd.addEventListener("click", function () {
  nodes.forEach((node) => container.appendChild(node.cloneNode(true)));
});

// Xóa Node khỏi container
btnRm.addEventListener("click", function () {
  while (container.firstChild) {
    delete container.removeChild(container.firstChild);
  }
});
```

**Giải thích:**

* `node.cloneNode(true)` sao chép node cùng tất cả node con.
* `Node.appendChild()` chèn node vào container.
* Xoá các node bằng `removeChild()` kết hợp `delete` để tránh memory leak.

---

### Kết luận

* DOMParser cho phép chuyển HTML String thành DOM Node một cách đơn giản.
* Nhược điểm: nếu HTML phức tạp, khó quản lý node.
* Bài sau sẽ giới thiệu cách sử dụng `<template>` để xử lý HTML String dễ quản lý hơn.

**Tham khảo:** Convert String to DOM Nodes

</details>
<details>
<summary><strong>4. HTML Template sang DOM</strong></summary>

### HTML Template

* Thẻ `<template>` dùng để chứa HTML nhưng **không render ra trang** khi load.
* Nội dung trong template sẽ được JavaScript render khi cần.

**Ví dụ template**

```html
<template id="my-temp">
  <div>
    <span class="name">a name</span>
  </div>
  <div>
    <span class="comment">a comment</span>
  </div>
</template>
```

* `id="my-temp"` dùng để truy xuất template trong JS.
* Nội dung bên trong mô phỏng các bình luận: `name` và `comment`.

---

### Kiểm tra trình duyệt hỗ trợ Template

```js
if ("content" in document.createElement("template")) {
  console.log("Support Template");
} else {
  console.log("Not Support Template");
}
```

* Thuộc tính `content` của template trả về **DocumentFragment**.
* Nếu trình duyệt không hỗ trợ, `content` sẽ không tồn tại.

---

### Lấy nội dung của HTML Template

```js
let templateFrag = document.querySelector("#my-temp").content;
```

* `content` là **DocumentFragment**: dạng document tối giản, không có parent.
* Có thể trực tiếp thêm vào DOM.

---

### Render HTML Template lên giao diện

**Data mẫu**

```js
let data = [
  { name: "John", comment: "That is great" },
  { name: "Alex", comment: "It's helpful" },
  { name: "David", comment: "Thanks a lot" },
];
```

**JS Render khi nhấn button Add**

```js
btnAdd.addEventListener("click", () => {
  data.forEach((item) => {
    let tmpl = templateFrag.cloneNode(true); // clone template
    tmpl.querySelector(".name").innerText = item.name;       // thay name
    tmpl.querySelector(".comment").innerText = item.comment; // thay comment
    container.appendChild(tmpl);                             // thêm vào container
  });
});
```

**Xóa nội dung khi nhấn button Remove**

```js
btnRm.addEventListener("click", () => {
  while (container.firstChild) {
    delete container.removeChild(container.firstChild); // tránh memory leak
  }
});
```

---

### Ưu điểm

* Dễ quản lý HTML phức tạp.
* Không cần DOMParser.
* Có thể clone và tái sử dụng template nhiều lần.

---

### Kết luận

* HTML template là cách **render HTML động từ JavaScript** hiệu quả.
* Bạn có thể thay đổi nội dung template dựa trên **data từ JS**.
* Phương pháp này giúp code sạch, tránh lỗi memory leak khi dùng `delete removeChild()`.

</details>
<details>
<summary><strong>5. Clipboard với execCommand</strong></summary>

### Giới thiệu

* `document.execCommand()` cho phép giao tiếp với clipboard và thực hiện một số lệnh khác như: copy, cut, paste, bold, italic, createLink, fontName, fontSize…
* Trong bài này tập trung **copy** và **cut**.

> Lưu ý: `paste` hiện tại không được support trên web.

---

### Copy dữ liệu vào Clipboard

**HTML**

```html
<h3>Copy</h3>
<p id="content-copy">This text will be inserted into the clipboard.</p>
<button id="button-copy">Copy Text</button>
```

**JS**

```js
const $ = document.querySelector.bind(document);
const contentCopyElm = $("#content-copy"),
      buttonCopyElm = $("#button-copy");

const isSupported = (cmd) => document.queryCommandSupported(cmd);

buttonCopyElm.addEventListener("click", () => {
  const range = document.createRange(),
        selection = window.getSelection();

  selection.removeAllRanges();          // Xoá vùng chọn cũ
  range.selectNodeContents(contentCopyElm); // Select nội dung
  selection.addRange(range);            // Thêm vào selection

  try {
    if (isSupported("copy")) document.execCommand("copy");
    else alert(`execCommand("copy") is not supported.`);
  } catch (e) {
    console.log(e);
  }

  selection.removeAllRanges();          // Xoá vùng chọn sau khi copy
});
```

* Áp dụng cho các thẻ có text content: `p`, `span`, `div`,…
* Không áp dụng trực tiếp cho `input` hay `textarea`.

---

### Cut dữ liệu vào Clipboard

**HTML**

```html
<h3>Cut</h3>
<input
  id="content-cut"
  type="text"
  value="This text will be cut, then inserted into the clipboard."
/>
<button id="button-cut">Cut Text</button>
```

**JS**

```js
const inputCutElm = $("#content-cut"),
      buttonCutElm = $("#button-cut");

buttonCutElm.addEventListener("click", () => {
  inputCutElm.select();                // Select nội dung input
  try {
    if (isSupported("cut")) document.execCommand("cut");
    else alert(`execCommand("cut") is not supported.`);
  } catch (e) {
    console.log(e);
  }
});
```

* Cut chỉ hỗ trợ các thẻ: `input` (text), `textarea`.
* Phương thức `select()` của input giúp tạo vùng chọn dễ dàng.

---

### Một số chức năng khác với execCommand

* `execCommand` còn hỗ trợ các lệnh chỉnh sửa nội dung: `bold`, `italic`, `underline`, `createLink`, `fontName`, `fontSize`,…
* Có thể dùng để tạo **Text Editor** cơ bản trực tiếp trên trình duyệt.

Demo: [Codepen Example](https://codepen.io/completejavascript/pen/ZmKKwW)

---

### Kết luận

* `execCommand` là cách **copy/cut dữ liệu vào clipboard** đơn giản, không cần thư viện bên ngoài.
* Hạn chế: không hỗ trợ `paste` và một số trình duyệt mới có thể giảm hỗ trợ.
* Thư viện thay thế hiện đại: [clipboard.js](https://clipboardjs.com/) (\~3kb, không Flash, không framework).

</details>
