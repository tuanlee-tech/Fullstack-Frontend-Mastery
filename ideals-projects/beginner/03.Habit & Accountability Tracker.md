# 🚀 **LEVEL 2: INTERMEDIATE**

---

## 📊 **PROJECT 3: Habit & Accountability Tracker**

### 📖 **Project Overview**
Ứng dụng theo dõi thói quen hàng ngày kết hợp yếu tố trách nhiệm xã hội (accountability) giúp người dùng xây dựng thói quen tốt bền vững. Khác biệt: Có bạn bè theo dõi và nhắc nhở nhau, không phải tự động lực một mình. Giải quyết vấn đề: "Tại sao tôi không thể duy trì thói quen tốt?"

### 🎯 **Target Users**
- Người muốn xây dựng thói quen tốt (tập gym, đọc sách, uống nước)
- Người cần động lực bên ngoài để kiên trì
- Nhóm bạn muốn cùng phát triển (study group, gym buddies)
- Người thích gamification (streak, achievements)

### 🚀 **MVP - Week 1-2 (Core Features)**

**User Story 1: Create Habit**
```
AS A user
I WANT TO create a new habit to track
SO THAT I can build positive routines
```
**Acceptance Criteria:**
- ✅ Habit name (e.g., "Drink 2L water")
- ✅ Description (optional motivation)
- ✅ Icon selection (50+ icons: fitness, health, learning, productivity)
- ✅ Color theme (8 colors to choose)
- ✅ Frequency: Daily, Specific weekdays, Custom (every X days)
- ✅ Time of day (Morning, Afternoon, Evening, Anytime)
- ✅ Reminder notification (optional, set time)
- ✅ Target count per day (e.g., "3 times a day")

**User Story 2: Daily Check-in**
```
AS A user
I WANT TO mark habits as complete
SO THAT I track my progress
```
**Acceptance Criteria:**
- ✅ Today's habit list (only habits scheduled for today)
- ✅ Large checkbox (easy to tap on mobile)
- ✅ Satisfying animation on complete (confetti, checkmark)
- ✅ Sound effect (optional, toggle in settings)
- ✅ Increment count if multi-per-day habit
- ✅ Undo check-in (within 5 minutes)
- ✅ Add note to check-in (mood, observation)

**User Story 3: Streak Tracking**
```
AS A user
I WANT TO see my habit streaks
SO THAT I feel motivated to continue
```
**Acceptance Criteria:**
- ✅ Current streak count (days in a row)
- ✅ Longest streak (personal best)
- ✅ Streak badge (fire icon 🔥)
- ✅ Streak milestone notifications (7, 30, 100, 365 days)
- ✅ Streak warning (haven't checked in today)
- ✅ Streak freeze (1 free miss per month - premium feature idea)

**User Story 4: Calendar View**
```
AS A user
I WANT TO see my habit history in a calendar
SO THAT I visualize consistency
```
**Acceptance Criteria:**
- ✅ Heatmap calendar (GitHub-style)
- ✅ Color intensity based on completion rate
- ✅ Tap date to see details
- ✅ Month/Year view toggle
- ✅ Export calendar as image (share on social media)

**User Story 5: Basic Statistics**
```
AS A user
I WANT TO see my habit statistics
SO THAT I understand my progress
```
**Acceptance Criteria:**
- ✅ Completion rate (%) - This week, This month, All time
- ✅ Total check-ins
- ✅ Best day of week (highest completion)
- ✅ Worst day of week
- ✅ Line chart: Completion trend (last 30 days)
- ✅ Comparison: This month vs Last month

**Database Schema (MVP):**
```prisma
model User {
  id            String         @id @default(cuid())
  email         String         @unique
  name          String
  avatar        String?
  timezone      String         @default("UTC")
  habits        Habit[]
  habitLogs     HabitLog[]
  friendships   Friendship[]   @relation("UserFriendships")
  notifications Notification[]
  createdAt     DateTime       @default(now())
}

model Habit {
  id              String       @id @default(cuid())
  userId          String
  name            String
  description     String?
  icon            String
  color           String
  frequency       String       // "daily" | "weekly" | "custom"
  frequencyDays   Int[]        // [1,2,3,4,5] Mon-Fri
  targetCount     Int          @default(1)
  reminderTime    DateTime?
  isPublic        Boolean      @default(false)
  streak          Int          @default(0)
  longestStreak   Int          @default(0)
  totalCompletions Int         @default(0)
  logs            HabitLog[]
  archivedAt      DateTime?
  createdAt       DateTime     @default(now())
}

model HabitLog {
  id        String   @id @default(cuid())
  habitId   String
  userId    String
  date      DateTime
  completed Boolean  @default(true)
  count     Int      @default(1)
  note      String?
  mood      String?  // "great" | "good" | "okay" | "bad"
  createdAt DateTime @default(now())
  
  @@unique([habitId, userId, date])
}

model Friendship {
  id        String   @id @default(cuid())
  userId    String
  ```prisma
  friendId  String
  status    String   // "pending" | "accepted" | "blocked"
  createdAt DateTime @default(now())
  
  @@unique([userId, friendId])
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  type      String   // "reminder" | "friend_request" | "friend_completed" | "milestone"
  title     String
  body      String
  data      Json?
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
}
```

---

### 📈 **Phase 2 - Week 3 (Social & Accountability Features)**

**Feature 1: Friend System**
```
AS A user
I WANT TO connect with friends
SO THAT we can support each other
```
**Acceptance Criteria:**
- ✅ Search users by email/username
- ✅ Send friend request
- ✅ Accept/Decline friend requests
- ✅ Friend list with avatars
- ✅ Remove friend
- ✅ Friend request notifications

**Feature 2: Accountability Partners**
```
AS A user
I WANT TO share specific habits with accountability partners
SO THAT they can keep me accountable
```
**Acceptance Criteria:**
- ✅ Invite friend to be accountability partner for a habit
- ✅ Partner accepts/declines invitation
- ✅ Partner sees your check-ins in real-time
- ✅ Partner can send encouragement ("Keep going!", "You got this!")
- ✅ Partner gets notification if you miss a day
- ✅ Remove partner from habit

**Feature 3: Social Feed**
```
AS A user
I WANT TO see my friends' activity
SO THAT I feel motivated and connected
```
**Acceptance Criteria:**
- ✅ Feed showing: Friend completed habit, Friend reached milestone, Friend created new habit
- ✅ Like/React to friend's achievements
- ✅ Comment on friend's progress
- ✅ Filter feed (All friends, Specific friend, Specific habit type)
- ✅ Refresh to load new activities
- ✅ Privacy: Only see habits marked as "public"

**Feature 4: Poke/Nudge Feature**
```
AS A user
I WANT TO remind my friend to complete their habit
SO THAT I help them stay on track
```
**Acceptance Criteria:**
- ✅ "Poke" button on friend's habit (if they haven't checked in today)
- ✅ Friend receives notification: "[Your name] is reminding you to [habit name]!"
- ✅ Can only poke once per day per habit
- ✅ Option to disable pokes in settings
- ✅ Friendly, encouraging tone (not nagging)

**Feature 5: Group Challenges**
```
AS A user
I WANT TO join challenges with friends
SO THAT we compete and motivate each other
```
**Acceptance Criteria:**
- ✅ Create challenge: Name, Habit, Duration (7 days, 30 days), Participants
- ✅ Invite friends to challenge
- ✅ Leaderboard (sorted by completion rate)
- ✅ Challenge chat (group discussion)
- ✅ Challenge completion certificate (share on social media)
- ✅ Recurring challenges (weekly, monthly)

**Feature 6: Public Habits & Community**
```
AS A user
I WANT TO make my habits public
SO THAT I can inspire others and find accountability in the community
```
**Acceptance Criteria:**
- ✅ Toggle habit visibility (Private, Friends, Public)
- ✅ Public habit feed (discover what others are tracking)
- ✅ Follow other users' public habits
- ✅ Habit templates from community (popular habits to add)
- ✅ Trending habits this week

---

### 🚀 **Phase 3 - Week 4 (Gamification & Advanced Features)**

**Feature 1: Achievement System**
```
AS A user
I WANT TO unlock achievements
SO THAT I feel rewarded for my progress
```
**Achievements to Implement:**
- ✅ **First Step**: Complete first habit check-in
- ✅ **Week Warrior**: 7-day streak
- ✅ **Month Master**: 30-day streak
- ✅ **Century Club**: 100-day streak
- ✅ **Year Champion**: 365-day streak
- ✅ **Early Bird**: Check in before 7 AM (10 times)
- ✅ **Night Owl**: Check in after 10 PM (10 times)
- ✅ **Perfect Week**: 100% completion for a week
- ✅ **Comeback Kid**: Resume habit after 7+ day break
- ✅ **Social Butterfly**: 10 friends added
- ✅ **Habit Collector**: 10 active habits
- ✅ **Motivator**: Poke friends 50 times
- ✅ **Challenger**: Complete 3 group challenges

**Acceptance Criteria:**
- ✅ Achievement notification (pop-up with animation)
- ✅ Achievement gallery (locked/unlocked states)
- ✅ Progress bars for incremental achievements
- ✅ Share achievement on social media
- ✅ Rarity indicator (Common, Rare, Epic, Legendary)

**Feature 2: Streak Freeze & Recovery**
```
AS A user
I WANT TO have flexibility when I miss a day
SO THAT I don't feel demotivated by one mistake
```
**Acceptance Criteria:**
- ✅ **Streak Freeze**: 2 per month (premium feature idea)
- ✅ Use freeze proactively (before missing) or reactively (after missing)
- ✅ Visual indicator (❄️ icon on calendar)
- ✅ **Streak Repair**: Pay with points/coins to restore streak (within 24 hours)
- ✅ Earn freeze tokens by completing challenges

**Feature 3: Points & Rewards System**
```
AS A user
I WANT TO earn points for completing habits
SO THAT I can unlock rewards
```
**Point System:**
- ✅ +10 points per habit check-in
- ✅ +50 points per 7-day streak milestone
- ✅ +200 points per 30-day streak milestone
- ✅ +20 points for encouraging friends
- ✅ Bonus multiplier on weekends (2x points)

**Rewards to Unlock:**
- ✅ Custom themes (colors, icons)
- ✅ Avatar frames
- ✅ Streak freeze tokens
- ✅ Priority support (if premium)
- ✅ Exclusive badges
- ✅ Ad-free experience (if using ads)

**Feature 4: Advanced Analytics**
```
AS A user
I WANT TO see deep insights into my habits
SO THAT I optimize my routine
```
**Acceptance Criteria:**
- ✅ **Best Time Analysis**: When do you complete habits most? (morning/afternoon/evening)
- ✅ **Correlation Insights**: "You complete X more when you also complete Y"
- ✅ **Mood Tracking Integration**: How do habits affect your mood?
- ✅ **Streak Prediction**: AI prediction of streak continuation probability
- ✅ **Habit Stacking**: Recommend habits that pair well together
- ✅ **Energy Level Patterns**: Track when you have most motivation
- ✅ **Export Data**: CSV/JSON for personal analysis

**Feature 5: Smart Reminders**
```
AS A user
I WANT TO receive intelligent reminders
SO THAT I'm nudged at the right time
```
**Acceptance Criteria:**
- ✅ **Adaptive Timing**: Learn when you usually complete habits, remind 30 mins before
- ✅ **Streak Saver**: Extra reminder if you haven't checked in by 8 PM
- ✅ **Weather-Based**: "It's sunny! Perfect day for your outdoor run habit"
- ✅ **Location-Based**: Remind when you arrive at gym (geofencing)
- ✅ **Gentle Escalation**: First reminder gentle, second more urgent if still not done
- ✅ **Snooze**: Snooze reminder for 30 min, 1 hour, 2 hours

**Feature 6: Habit Templates & Categories**
```
AS A user
I WANT TO quickly start popular habits
SO THAT I don't have to configure from scratch
```
**Pre-built Templates:**

**Health & Fitness:**
- 🏃 Morning Run (30 min)
- 💧 Drink 2L Water (8 glasses)
- 🧘 Meditation (10 min)
- 💪 Workout (gym or home)
- 🥗 Eat Healthy Meal
- 😴 Sleep 8 Hours
- 🚶 10,000 Steps

**Productivity:**
- 📚 Read 30 Pages
- ✍️ Journal Entry
- 🎯 Complete To-Do List
- 📧 Inbox Zero
- 🧹 Clean Workspace
- 📱 No Phone 1st Hour After Waking

**Learning:**
- 🗣️ Practice English (30 min)
- 💻 Code for 1 Hour
- 🎨 Creative Practice
- 🎵 Music Practice

**Mindfulness:**
- 🙏 Gratitude Journal (3 things)
- 📿 Meditation
- 🌅 Watch Sunrise/Sunset
- 📵 Digital Detox (1 hour)

**Social:**
- 📞 Call Family
- 💌 Message a Friend
- 🤝 Random Act of Kindness

**Acceptance Criteria:**
- ✅ Template library categorized
- ✅ Preview template before adding
- ✅ Customize template (change name, icon, frequency)
- ✅ Add template to "My Habits" in 1 click
- ✅ Suggest templates based on user's existing habits

---

### 🎨 **UI/UX Requirements**

**Design Principles:**
- **Motivational**: Bright colors, celebratory animations
- **Minimal Friction**: Check-in should take < 3 seconds
- **Visual Progress**: Heavy use of charts, streaks, heatmaps
- **Social Proof**: Show friends' achievements
- **Gamified**: Points, badges, levels

**Key Screens:**
1. **Today** - List of today's habits (primary screen, opens on launch)
2. **Calendar** - Heatmap view of habit history
3. **Habits** - Manage all habits (edit, archive, delete)
4. **Social** - Friends feed, challenges, leaderboards
5. **Profile** - Stats, achievements, settings
6. **Friends** - Friend list, requests, search
7. **Challenges** - Active challenges, create new, browse
8. **Achievements** - Gallery of unlocked achievements
9. **Analytics** - Deep insights, charts, trends

**Animations (Framer Motion):**
- ✅ Confetti explosion on habit completion
- ✅ Checkmark fill animation
- ✅ Streak counter increments with bounce
- ✅ Achievement unlock (scale + fade in)
- ✅ Smooth transitions between screens
- ✅ Swipe gestures (left: edit, right: complete)
- ✅ Pull-to-refresh on feed
- ✅ Skeleton loaders for async data

**Color Scheme (by habit category):**
- Health: Green (#10B981)
- Fitness: Red (#EF4444)
- Productivity: Blue (#3B82F6)
- Learning: Purple (#8B5CF6)
- Mindfulness: Indigo (#6366F1)
- Social: Pink (#EC4899)

---

### 🧪 **Testing Strategy**

**Unit Tests:**
- Streak calculation algorithm (including streak freezes)
- Completion rate calculation
- Point earning logic
- Achievement unlock conditions
- Reminder time calculation (timezones)

**Integration Tests:**
- Real-time notification delivery (Pusher/Ably)
- Friend request flow (send → accept → show in friend list)
- Challenge creation and participation
- Habit check-in with optimistic UI

**E2E Tests:**
```typescript
test('User can create habit, check in, and see streak', async ({ page }) => {
  await page.goto('/habits')
  await page.click('text=Create Habit')
  await page.fill('[name="name"]', 'Morning Jog')
  await page.click('[data-icon="running"]')
  await page.selectOption('[name="frequency"]', 'daily')
  await page.click('text=Save')
  
  // Check in
  await page.goto('/today')
  await page.click('[data-habit="Morning Jog"] .checkbox')
  await expect(page.locator('text=🔥 1')).toBeVisible() // Streak = 1
  
  // Check confetti animation appeared
  await expect(page.locator('.confetti')).toBeVisible()
})

test('User can invite friend to accountability partnership', async ({ page }) => {
  // Login as User A
  await page.goto('/habits')
  await page.click('[data-habit="Morning Jog"]')
  await page.click('text=Add Accountability Partner')
  await page.fill('[name="friendEmail"]', 'friend@example.com')
  await page.click('text=Invite')
  
  // Login as User B (friend)
  // Accept invitation
  // Verify User A's habit appears in User B's accountability feed
})
```

**Performance Tests:**
- Feed load time with 100+ activities (pagination/infinite scroll)
- Calendar rendering (365 days of data)
- Real-time notification latency (should be < 1 second)

---

### 📊 **Success Metrics**

**Technical:**
- Real-time latency < 500ms (habit completion to friend notification)
- App load time < 2s
- Offline functionality (check-in queued, syncs when online)
- Push notification delivery rate > 95%

**User Engagement:**
- Daily Active Users (DAU)
- Habit completion rate (target: > 70%)
- Average check-ins per user per day (target: > 3)
- Streak retention (% users with streak > 7 days)
- Social features adoption (% users with friends)

**Retention:**
- Day 1 retention: > 60%
- Day 7 retention: > 40%
- Day 30 retention: > 30%
- Challenge completion rate: > 50%

---

### 🔔 **Notification Strategy**

**Push Notifications (via OneSignal/Pusher):**

**1. Habit Reminders:**
- Time-based: "Time to [habit name]!" (at scheduled time)
- Streak saver: "Don't break your 🔥 15 streak! Check in before midnight"
- Personalized: "You usually [habit] at 7 AM. Ready?"

**2. Social Notifications:**
- "🎉 [Friend] just completed their 30-day streak for [habit]!"
- "👋 [Friend] is encouraging you to complete [habit]"
- "💪 [Friend] invited you to join the [challenge name] challenge"
- "❤️ [Friend] reacted to your achievement"

**3. Milestone Notifications:**
- "🔥 Amazing! You've hit a 7-day streak for [habit]!"
- "🏆 Achievement Unlocked: Week Warrior"
- "📈 You completed 80% of your habits this week - new record!"

**4. Engagement Notifications:**
- "👀 Your friend [Name] completed [habit]. Go cheer them on!"
- "🎯 You're #2 on the [challenge] leaderboard. One more day to win!"
- "⚡ You have 500 points! Unlock a new theme?"

**Notification Settings (User Control):**
- ✅ Toggle all notifications
- ✅ Per-habit reminders
- ✅ Social activity notifications
- ✅ Milestone celebrations
- ✅ Friend requests
- ✅ Quiet hours (no notifications 10 PM - 8 AM)
- ✅ Notification sound
- ✅ Vibration

---

### 🚀 **Real-time Architecture (Pusher/Ably)**

**Real-time Events:**

**1. Habit Completion:**
```typescript
// When User A completes habit
pusher.trigger(`user-${userId}`, 'habit-completed', {
  habitId: 'habit_123',
  userId: 'user_A',
  habitName: 'Morning Jog',
  streak: 15,
  timestamp: new Date()
})

// All accountability partners of User A subscribe to this channel
// They receive instant notification
```

**2. Friend Activity Feed:**
```typescript
// When any friend completes a habit
pusher.trigger(`feed-${userId}`, 'friend-activity', {
  friendId: 'user_B',
  friendName: 'John',
  activityType: 'habit_completed',
  habitName: 'Meditation',
  timestamp: new Date()
})
```

**3. Challenge Updates:**
```typescript
// Real-time leaderboard updates
pusher.trigger(`challenge-${challengeId}`, 'leaderboard-updated', {
  rankings: [
    { userId: 'user_A', name: 'Alice', completions: 25 },
    { userId: 'user_B', name: 'Bob', completions: 23 },
    // ...
  ]
})
```

**4. Poke/Nudge:**
```typescript
// Instant delivery
pusher.trigger(`user-${friendId}`, 'friend-poke', {
  fromUserId: 'user_A',
  fromUserName: 'Alice',
  habitId: 'habit_123',
  habitName: 'Drink Water',
  message: 'Alice is encouraging you to Drink Water! 💧'
})
```

---

### 📱 **Mobile-Specific Features**

**PWA Features:**
- ✅ Install prompt (Add to Home Screen)
- ✅ Offline check-in (queued, syncs when online)
- ✅ Background sync (Service Worker)
- ✅ Push notifications (even when app closed)
- ✅ Quick actions (long-press app icon → "Check in", "View Stats")

**Mobile Gestures:**
- ✅ Swipe right to complete habit
- ✅ Swipe left to skip/snooze
- ✅ Pull down to refresh feed
- ✅ Long press habit to edit
- ✅ Swipe up on habit for details

**Home Screen Widget (future consideration):**
- Today's habits at a glance
- Check-in directly from widget
- Streak counter visible

---

### 🎮 **Gamification Psychology**

**Motivation Triggers:**

**1. Progress Tracking:**
- Visual streaks (🔥 fire emoji)
- Percentage completion
- "You're 2 days away from your longest streak!"

**2. Social Proof:**
- "85% of users complete habits in the morning"
- "Your friends average 4.2 habits per day"
- Leaderboards

**3. Loss Aversion:**
- "Don't break your 30-day streak!"
- Streak freeze as safety net
- Countdown timer "Check in within 2 hours"

**4. Variable Rewards:**
- Random achievement unlocks
- Surprise bonus points
- "Mystery reward at 100-day streak!"

**5. Commitment & Consistency:**
- Public habits (social pressure)
- Accountability partners
- Written goals/reasons for habits

**6. Social Connection:**
- See friends' progress
- Group challenges
- Encouragement messages
- Celebrate together

---

### 🔒 **Privacy & Data Controls**

**User Privacy Options:**
- ✅ Private habits (only you can see)
- ✅ Friends-only habits (friends can see, but not public)
- ✅ Public habits (community can see)
- ✅ Anonymous mode (hide real name, use username)
- ✅ Disable friend requests
- ✅ Block users
- ✅ Delete all data (GDPR right to erasure)
- ✅ Export data (JSON/CSV)

**Data Security:**
- ✅ End-to-end encryption for private notes
- ✅ Rate limiting (prevent spam pokes)
- ✅ Report inappropriate behavior
- ✅ Moderation queue for public habits

---