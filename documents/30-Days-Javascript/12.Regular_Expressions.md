# Ngày 12

## Biểu thức chính quy (Regular Expressions)

**Biểu thức chính quy (RegExp)**: Là một ngôn ngữ lập trình nhỏ giúp tìm kiếm mẫu trong dữ liệu. Có thể dùng để kiểm tra sự tồn tại của mẫu trong các kiểu dữ liệu khác nhau.

### Tham số của RegExp

RegExp có hai tham số: mẫu tìm kiếm (bắt buộc) và cờ (flag, tùy chọn).

#### Mẫu (Pattern)

Mẫu là một chuỗi hoặc dạng tương tự. Ví dụ: từ "spam" trong email hoặc định dạng số điện thoại.

#### Cờ (Flags)

- `g`: Tìm kiếm trên toàn bộ văn bản (global).
- `i`: Không phân biệt hoa/thường (case-insensitive).
- `m`: Tìm kiếm trên nhiều dòng (multiline).

Ký Tự Đặc Biệt (Metacharacters)
Những ký tự này có ý nghĩa đặc biệt thay vì khớp với chính nó.
 * . (dấu chấm): Khớp với bất kỳ ký tự nào, ngoại trừ ký tự xuống dòng mới (\n).
 * ^: Khớp với vị trí bắt đầu của một chuỗi.
 * $: Khớp với vị trí kết thúc của một chuỗi.
 * |: "HOẶC" (OR). Khớp với một trong các mẫu ở hai bên. Ví dụ: a|b khớp với "a" hoặc "b".
 * (): Nhóm các ký tự lại với nhau. Có thể được sử dụng để áp dụng lượng từ (quantifier) cho cả một nhóm hoặc để trích xuất các khớp con.
Lượng Từ (Quantifiers)
Các ký tự này chỉ định số lần một ký tự hoặc một nhóm ký tự có thể lặp lại.
 * *: Khớp với 0 hoặc nhiều lần của ký tự đứng trước nó.
 * +: Khớp với 1 hoặc nhiều lần của ký tự đứng trước nó.
 * ?: Khớp với 0 hoặc 1 lần của ký tự đứng trước nó.
 * {n}: Khớp chính xác n lần.
 * {n,}: Khớp ít nhất n lần.
 * {n,m}: Khớp từ n đến m lần.
Lớp Ký Tự (Character Classes)
Các lớp này khớp với một tập hợp các ký tự.
 * [abc]: Khớp với bất kỳ ký tự nào trong ngoặc vuông (a, b, hoặc c).
 * [a-z]: Khớp với bất kỳ ký tự nào trong phạm vi từ a đến z.
 * [^abc]: Khớp với bất kỳ ký tự nào KHÔNG nằm trong ngoặc vuông.
Viết Tắt (Shorthand Character Classes)
Đây là những ký tự viết tắt giúp bạn dễ dàng viết biểu thức chính quy hơn.
 * \d: Khớp với một chữ số (tương đương với [0-9]).
 * \D: Khớp với một ký tự không phải chữ số (tương đương với [^0-9]).
 * \s: Khớp với một ký tự khoảng trắng (dấu cách, tab, xuống dòng).
 * \S: Khớp với một ký tự không phải khoảng trắng.
 * \w: Khớp với một ký tự từ (chữ cái, số, _).
 * \W: Khớp với một ký tự không phải từ.
Hiểu được các ký tự này sẽ giúp bạn tạo ra các biểu thức chính quy mạnh mẽ và linh hoạt hơn nhiều.
 

### Tạo mẫu với RegExp Constructor

Tạo RegExp không có cờ:

```js
let pattern = 'love'
let regEx = new RegExp(pattern)
```

Tạo RegExp với cờ `g` và `i`:

```js
let pattern = 'love'
let flag = 'gi'
let regEx = new RegExp(pattern, flag)
```

Hoặc viết trực tiếp:

```js
let regEx = new RegExp('love', 'gi')
```

### Tạo mẫu không dùng RegExp Constructor

```js
let regEx = /love/gi
```

### Phương thức của RegExp

#### Kiểm tra khớp (test)

Phương thức `test()` kiểm tra xem mẫu có trong chuỗi không, trả về `true` hoặc `false`.

```js
const str = 'I love JavaScript'
const pattern = /love/
const result = pattern.test(str)
console.log(result) // true
```

#### Lấy tất cả kết quả khớp (match)

Phương thức `match()` trả về mảng chứa các kết quả khớp hoặc `null` nếu không tìm thấy.

```js
const str = 'I love JavaScript'
const pattern = /love/
const result = str.match(pattern)
console.log(result) // ["love", index: 2, input: "I love JavaScript", groups: undefined]
```

Với cờ `g`:

```js
const pattern = /love/g
const result = str.match(pattern)
console.log(result) // ["love"]
```

#### Tìm vị trí khớp (search)

Phương thức `search()` trả về chỉ số của kết quả khớp đầu tiên hoặc `-1` nếu không tìm thấy.

```js
const str = 'I love JavaScript'
const pattern = /love/g
const result = str.search(pattern)
console.log(result) // 2
```

#### Thay thế chuỗi con (replace)

Phương thức `replace()` thay thế chuỗi khớp bằng chuỗi khác.

```js
const txt = 'Python is the most beautiful language that a human being has ever created. I recommend python for a first programming language'
const matchReplaced = txt.replace(/Python|python/gi, 'JavaScript')
console.log(matchReplaced)
// JavaScript is the most beautiful language that a human being has ever created. I recommend JavaScript for a first programming language
```

### Dấu ngoặc vuông (Square Bracket)

Dùng để chỉ định tập hợp ký tự:

```js
const pattern = /[Aa]pple/g // Tìm Apple hoặc apple
const txt = 'Apple and banana are fruits. An old cliche says an apple a day...'
const matches = txt.match(pattern)
console.log(matches) // ["Apple", "apple"]
```

### Ký tự thoát (Escape character `\`)

Dùng để thoát các ký tự đặc biệt:

```js
const pattern = /\d+/g // Tìm số
const txt = 'This regular expression example was made in January 12, 2020.'
const matches = txt.match(pattern)
console.log(matches) // ["12", "2020"]
```

### Một hoặc nhiều lần (+)

Tìm mẫu xuất hiện một hoặc nhiều lần:

```js
const pattern = /\d+/g
const txt = 'This regular expression example was made in January 12, 2020.'
console.log(txt.match(pattern)) // ["12", "2020"]
```

### Dấu chấm (Period `.`)

Khớp với bất kỳ ký tự nào trừ dấu xuống dòng:

```js
const pattern = /[a].+/g
const txt = 'Apple and banana are fruits'
console.log(txt.match(pattern)) // ['and banana are fruits']
```

### Không hoặc nhiều lần (*)

Tìm mẫu xuất hiện không hoặc nhiều lần:

```js
const pattern = /[a].*/g
const txt = 'Apple and banana are fruits'
console.log(txt.match(pattern)) // ['and banana are fruits']
```

### Không hoặc một lần (?)

Tìm mẫu xuất hiện không hoặc một lần:

```js
const txt = 'I am not sure if there is a convention how to write the word e-mail. Some people write it email others may write it as Email or E-mail.'
const pattern = /[Ee]-?mail/g
console.log(txt.match(pattern)) // ["e-mail", "email", "Email", "E-mail"]
```

### Số lượng cụ thể (Quantifier)

Chỉ định độ dài chuỗi:

```js
const txt = 'This regular expression example was made in December 6, 2019.'
const pattern = /\b\w{4}\b/g // Tìm từ có đúng 4 ký tự
console.log(txt.match(pattern)) // ['This', 'made', '2019']
```

### Dấu mũ (Cart `^`)

- Bắt đầu bằng:

```js
const pattern = /^This/
const txt = 'This regular expression example was made in December 6, 2019.'
console.log(txt.match(pattern)) // ['This']
```

- Phủ định:

```js
const pattern = /[^A-Za-z,. ]+/g // Không phải chữ, dấu phẩy, khoảng trắng
console.log(txt.match(pattern)) // ["6", "2019"]
```

### Khớp chính xác (Exact match)

Sử dụng `^` và `$` để khớp toàn bộ chuỗi:

```js
let pattern = /^[A-Z][a-z]{3,12}$/
let name = 'Asabeneh'
console.log(pattern.test(name)) // true
```

---

## Bài tập: Ngày 12

### Bài tập: Cấp độ 1

1. **Tính tổng thu nhập hàng năm**

```js
const txt = 'He earns 4000 euro from salary per month, 10000 euro annual bonus, 5500 euro online courses per month.'
const pattern = /\d+/g
const numbers = txt.match(pattern).map(Number)
const totalIncome = numbers[0] * 12 + numbers[1] + numbers[2] * 12
console.log(totalIncome) // 4000 * 12 + 10000 + 5500 * 12 = 118000
```

2. **Tìm khoảng cách giữa hai điểm xa nhất**

```js
const points = ['-1', '2', '-4', '-3', '-1', '0', '4', '8']
const sortedPoints = points.map(Number).sort((a, b) => a - b)
const distance = sortedPoints[sortedPoints.length - 1] - sortedPoints[0]
console.log(distance) // 8 - (-4) = 12
```

3. **Kiểm tra tên biến hợp lệ**

```js
function is_valid_variable(name) {
  const pattern = /^[a-zA-Z_][a-zA-Z0-9_]*$/
  return pattern.test(name)
}
console.log(is_valid_variable('first_name')) // true
console.log(is_valid_variable('first-name')) // false
console.log(is_valid_variable('1first_name')) // false
console.log(is_valid_variable('firstname')) // true
```

### Bài tập: Cấp độ 2

1. **Tìm 10 từ xuất hiện nhiều nhất**

```js
function tenMostFrequentWords(paragraph, n = 10) {
  const words = paragraph.toLowerCase().match(/\b\w+\b/g)
  const wordCount = words.reduce((acc, word) => {
    acc[word] = (acc[word] || 0) + 1
    return acc
  }, {})
  return Object.entries(wordCount)
    .map(([word, count]) => ({ word, count }))
    .sort((a, b) => b.count - a.count)
    .slice(0, n)
}
const paragraph = `I love teaching. If you do not love teaching what else can you love. I love Python if you do not love something which can give you all the capabilities to develop an application what else can you love.`
console.log(tenMostFrequentWords(paragraph, 10))
```

### Bài tập: Cấp độ 3

1. **Làm sạch văn bản**

```js
function cleanText(sentence) {
  return sentence.replace(/[%$@&#;.!?]/g, '')
}
const sentence = `%I $am@% a %tea@cher%, &and& I lo%#ve %tea@ching%;. There $is nothing; &as& mo@re rewarding as educa@ting &and& @emp%o@wering peo@ple. ;I found tea@ching m%o@re interesting tha@n any other %jo@bs. %Do@es thi%s mo@tivate yo@u to be a tea@cher!?`
console.log(cleanText(sentence))
// I am a teacher and I love teaching There is nothing as more rewarding as educating and empowering people I found teaching more interesting than any other jobs Does this motivate you to be a teacher
```

2. **Tìm 3 từ xuất hiện nhiều nhất**

```js
function mostFrequentWords(text) {
  const words = text.toLowerCase().match(/\b\w+\b/g)
  const wordCount = words.reduce((acc, word) => {
    acc[word] = (acc[word] || 0) + 1
    return acc
  }, {})
  return Object.entries(wordCount)
    .map(([word, count]) => ({ word, count }))
    .sort((a, b) => b.count - a.count)
    .slice(0, 3)
}
const cleanedText = cleanText(sentence)
console.log(mostFrequentWords(cleanedText)) // [{word: 'i', count: 3}, {word: 'teaching', count: 2}, {word: 'teacher', count: 2}]
```

---

[<< Ngày 11](./11.Destructuring_and_Spreading.md) | [Ngày 13 >>](./13.Console_Object_Methods.md)