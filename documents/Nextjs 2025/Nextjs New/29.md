# ğŸ§­ Intercepting Routes trong Next.js

### ğŸ¯ Má»¥c tiÃªu

* Hiá»ƒu cÆ¡ cháº¿ **Intercepting Routes** â€“ cÃ¡ch má»™t route cÃ³ thá»ƒ **â€œchen vÃ oâ€ route khÃ¡c** mÃ  khÃ´ng thay Ä‘á»•i URL gá»‘c.
* Biáº¿t cÃ¡ch dÃ¹ng Ä‘á»ƒ táº¡o **modal, drawer, overlay, hoáº·c preview page** mÆ°á»£t mÃ .
* Káº¿t há»£p vá»›i **Parallel Routes** Ä‘á»ƒ tÃ¡i sá»­ dá»¥ng layout vÃ  state hiá»‡u quáº£.

---

## ğŸ§± 1ï¸âƒ£ CÆ¡ cháº¿ Intercepting Routes lÃ  gÃ¬?

Trong **App Router**, Next.js cho phÃ©p báº¡n **â€œcháº·nâ€ (intercept)** viá»‡c render route gá»‘c, Ä‘á»ƒ **hiá»ƒn thá»‹ má»™t UI khÃ¡c táº¡m thá»i** (thÆ°á»ng lÃ  modal hoáº·c panel), **nhÆ°ng khÃ´ng rá»i khá»i layout hiá»‡n táº¡i**.

ğŸ‘‰ DÃ¹ng cÃº phÃ¡p **`(.)`, `(..)`, `(...)`** trÆ°á»›c folder route:

| CÃº phÃ¡p     | Ã nghÄ©a                        |
| ----------- | ------------------------------ |
| `(.)slug`   | Intercept **route á»Ÿ cÃ¹ng cáº¥p** |
| `(..)slug`  | Intercept **route á»Ÿ cáº¥p cha**  |
| `(...)slug` | Intercept **route á»Ÿ root app** |

---

## ğŸ§© 2ï¸âƒ£ VÃ­ dá»¥ cÆ¡ báº£n

Cáº¥u trÃºc:

```
app/
â”œâ”€â”€ feed/
â”‚   â”œâ”€â”€ page.tsx
â”‚   â”œâ”€â”€ photo/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ (.)photo/
â”‚   â”‚   â””â”€â”€ page.tsx
```

* Khi user á»Ÿ `/feed` vÃ  click 1 áº£nh â†’ modal hiá»ƒn thá»‹ (`(.)photo/page.tsx`)
* Khi user **refresh hoáº·c truy cáº­p trá»±c tiáº¿p** `/feed/photo` â†’ render full page (`photo/page.tsx`)

```tsx
// app/feed/(.)photo/page.tsx
"use client";
import { useRouter } from "next/navigation";

export default function PhotoModal() {
  const router = useRouter();

  return (
    <div
      style={{
        position: "fixed",
        inset: 0,
        background: "rgba(0,0,0,0.5)",
        display: "flex",
        justifyContent: "center",
        alignItems: "center",
      }}
    >
      <div style={{ background: "#fff", padding: 24, borderRadius: 8 }}>
        <h3>áº¢nh chi tiáº¿t</h3>
        <button onClick={() => router.back()}>ÄÃ³ng</button>
      </div>
    </div>
  );
}
```

ğŸ”¹ Náº¿u user click tá»« `/feed` â†’ hiá»ƒn thá»‹ modal trÃªn layout Feed
ğŸ”¹ Náº¿u user load `/feed/photo` trá»±c tiáº¿p â†’ render **full page** photo (khÃ´ng modal)

---

## ğŸ§© 3ï¸âƒ£ Káº¿t há»£p vá»›i Parallel Routes

Báº¡n cÃ³ thá»ƒ káº¿t há»£p **Intercepting Routes** vá»›i **Parallel Routes** Ä‘á»ƒ hiá»ƒn thá»‹ **2 luá»“ng UI Ä‘á»“ng thá»i** (vÃ­ dá»¥: danh sÃ¡ch + modal).

```
app/
â”œâ”€â”€ @feed/
â”‚   â””â”€â”€ page.tsx
â”œâ”€â”€ @modal/
â”‚   â”œâ”€â”€ default.tsx
â”‚   â””â”€â”€ (.)photo/
â”‚       â””â”€â”€ page.tsx
â”œâ”€â”€ layout.tsx
```

```tsx
// app/layout.tsx
export default function RootLayout({
  feed,
  modal,
}: {
  feed: React.ReactNode;
  modal: React.ReactNode;
}) {
  return (
    <div>
      {feed}
      {modal}
    </div>
  );
}
```

* Khi modal Ä‘Æ°á»£c má»Ÿ, chá»‰ pháº§n `@modal` thay Ä‘á»•i, `@feed` giá»¯ nguyÃªn.
* Táº¡o tráº£i nghiá»‡m **SPA-like** nhÆ°ng váº«n cÃ³ **URL tÃ¡ch biá»‡t** cho tá»«ng modal.

---

## ğŸ’¡ 4ï¸âƒ£ Lá»£i Ã­ch & á»¨ng dá»¥ng thá»±c táº¿

| á»¨ng dá»¥ng             | MÃ´ táº£                                                       |
| -------------------- | ----------------------------------------------------------- |
| ğŸªŸ Modal Intercept   | Xem chi tiáº¿t bÃ i viáº¿t / áº£nh / user mÃ  khÃ´ng rá»i trang chÃ­nh |
| ğŸ§­ Drawer Navigation | Má»Ÿ thanh sidebar chi tiáº¿t mÃ  váº«n giá»¯ nguyÃªn URL parent      |
| ğŸ§© Nested UI Overlay | Táº¡o nhiá»u lá»›p UI Ä‘á»“ng thá»i mÃ  khÃ´ng áº£nh hÆ°á»Ÿng layout cha    |
| âš™ï¸ Parallel State    | Dá»… dÃ ng duy trÃ¬ state khi chuyá»ƒn giá»¯a cÃ¡c modal hoáº·c view   |

---

## âš ï¸ 5ï¸âƒ£ LÆ°u Ã½ quan trá»ng

* Intercepting routes **chá»‰ hoáº¡t Ä‘á»™ng trong App Router (Next.js 13+)**.
* CÃ¡c file intercept (`(.)`, `(..)`, `(...)`) **pháº£i náº±m trong cáº¥u trÃºc song song há»£p lá»‡**.
* KhÃ´ng nÃªn láº¡m dá»¥ng quÃ¡ nhiá»u layer intercept â†’ dá»… gÃ¢y rá»‘i route tree.
* DÃ¹ng `router.back()` hoáº·c `router.push()` Ä‘á»ƒ Ä‘Ã³ng modal Ä‘Ãºng cÃ¡ch.

---

## ğŸ§­ 6ï¸âƒ£ Tá»•ng káº¿t

| KhÃ­a cáº¡nh                | MÃ´ táº£                                               |
| ------------------------ | --------------------------------------------------- |
| **Intercepting Route**   | Cho phÃ©p â€œchenâ€ UI táº¡m thá»i vÃ o route hiá»‡n táº¡i      |
| **CÃº phÃ¡p Ä‘áº·c biá»‡t**     | `(.)`, `(..)`, `(...)`                              |
| **Káº¿t há»£p tá»‘t nháº¥t vá»›i** | Parallel Routes                                     |
| **TÃ¡c dá»¥ng chÃ­nh**       | Modal, Sidebar, Drawer, Preview Page                |
| **Æ¯u Ä‘iá»ƒm**              | UX mÆ°á»£t, khÃ´ng reload layout, state Ä‘Æ°á»£c giá»¯ nguyÃªn |

---


DÆ°á»›i Ä‘Ã¢y lÃ  **demo hoÃ n chá»‰nh** minh há»a cÃ¡ch dÃ¹ng **Intercepting Routes** trong Next.js App Router â€” giá»‘ng nhÆ° Instagram má»Ÿ modal áº£nh mÃ  **váº«n giá»¯ nguyÃªn trang feed**, kÃ¨m cáº£ **fallback full-page** khi user truy cáº­p trá»±c tiáº¿p.

---

# ğŸš€ DEMO: Feed + Photo Modal (Intercepting Routes)

## ğŸ§± Cáº¥u trÃºc thÆ° má»¥c

```
app/
â”œâ”€â”€ layout.tsx
â”œâ”€â”€ page.tsx                â†’ Trang chÃ­nh (redirect /feed)
â”œâ”€â”€ feed/
â”‚   â”œâ”€â”€ page.tsx            â†’ Danh sÃ¡ch áº£nh (Feed)
â”‚   â”œâ”€â”€ photo/
â”‚   â”‚   â””â”€â”€ [id]/page.tsx   â†’ Full page áº£nh (khi vÃ o trá»±c tiáº¿p)
â”‚   â”œâ”€â”€ (.)photo/
â”‚   â”‚   â””â”€â”€ [id]/page.tsx   â†’ Modal áº£nh (Intercepted route)
â””â”€â”€ globals.css
```

---

## ğŸ§© 1ï¸âƒ£ `app/layout.tsx`

```tsx
export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <body style={{ fontFamily: "sans-serif", margin: 0 }}>
        <header style={{ background: "#333", color: "#fff", padding: "1rem" }}>
          <h2>ğŸ“· Photo Feed Demo</h2>
        </header>
        <main>{children}</main>
      </body>
    </html>
  );
}
```

---

## ğŸ§© 2ï¸âƒ£ `app/page.tsx` â€” redirect vá» `/feed`

```tsx
import { redirect } from "next/navigation";

export default function HomePage() {
  redirect("/feed");
}
```

---

## ğŸ§© 3ï¸âƒ£ `app/feed/page.tsx` â€” danh sÃ¡ch áº£nh

```tsx
"use client";
import Link from "next/link";

const photos = [
  { id: 1, title: "Sunset in Bali", url: "/images/pic1.jpg" },
  { id: 2, title: "Mountain View", url: "/images/pic2.jpg" },
  { id: 3, title: "City Lights", url: "/images/pic3.jpg" },
];

export default function FeedPage() {
  return (
    <div style={{ padding: "1rem", display: "grid", gap: 16 }}>
      <h3>Photo Feed</h3>
      <div style={{ display: "flex", gap: 12 }}>
        {photos.map((p) => (
          <Link key={p.id} href={`/feed/photo/${p.id}`}>
            <img
              src={p.url}
              alt={p.title}
              width={150}
              height={150}
              style={{ borderRadius: 8, cursor: "pointer" }}
            />
          </Link>
        ))}
      </div>
    </div>
  );
}
```

---

## ğŸ§© 4ï¸âƒ£ `app/feed/photo/[id]/page.tsx` â€” full page (truy cáº­p trá»±c tiáº¿p)

```tsx
export default function PhotoPage({ params }: { params: { id: string } }) {
  return (
    <div style={{ padding: "2rem", textAlign: "center" }}>
      <h2>áº¢nh #{params.id}</h2>
      <img
        src={`/images/pic${params.id}.jpg`}
        alt={`Photo ${params.id}`}
        style={{ width: "60%", borderRadius: 8 }}
      />
      <p>ÄÃ¢y lÃ  full page khi user load trá»±c tiáº¿p URL.</p>
    </div>
  );
}
```

---

## ğŸ§© 5ï¸âƒ£ `app/feed/(.)photo/[id]/page.tsx` â€” intercept route (modal)

```tsx
"use client";
import { useRouter } from "next/navigation";

export default function PhotoModal({ params }: { params: { id: string } }) {
  const router = useRouter();

  return (
    <div
      style={{
        position: "fixed",
        inset: 0,
        background: "rgba(0,0,0,0.6)",
        display: "flex",
        justifyContent: "center",
        alignItems: "center",
        zIndex: 100,
      }}
      onClick={() => router.back()}
    >
      <div
        style={{
          background: "#fff",
          padding: "1rem",
          borderRadius: 8,
          maxWidth: 500,
          position: "relative",
        }}
        onClick={(e) => e.stopPropagation()}
      >
        <h3>áº¢nh #{params.id}</h3>
        <img
          src={`/images/pic${params.id}.jpg`}
          alt={`Photo ${params.id}`}
          style={{ width: "100%", borderRadius: 8 }}
        />
        <button
          style={{
            position: "absolute",
            top: 8,
            right: 8,
            background: "#333",
            color: "#fff",
            border: "none",
            padding: "4px 8px",
            cursor: "pointer",
          }}
          onClick={() => router.back()}
        >
          âœ•
        </button>
      </div>
    </div>
  );
}
```

---

## ğŸ§± 6ï¸âƒ£ Thá»­ nghiá»‡m

| TÃ¬nh huá»‘ng                   | Káº¿t quáº£                                       |
| ---------------------------- | --------------------------------------------- |
| Click áº£nh trong `/feed`      | Má»Ÿ modal (Intercepting route `(.)photo/[id]`) |
| Reload `/feed/photo/1`       | Render full page (`photo/[id]/page.tsx`)      |
| ÄÃ³ng modal â†’ `router.back()` | Quay láº¡i `/feed`, giá»¯ nguyÃªn state layout     |

---

## ğŸ’¡ Tá»•ng káº¿t kiáº¿n thá»©c

| CÆ¡ cháº¿                          | Má»¥c tiÃªu                                              |
| ------------------------------- | ----------------------------------------------------- |
| **Intercepting Routes (`(.)`)** | Cho phÃ©p route con render â€œchá»“ng lÃªnâ€ layout hiá»‡n táº¡i |
| **Modal UX**                    | Duy trÃ¬ layout cha, khÃ´ng reload                      |
| **Fallback Full Page**          | Render riÃªng khi ngÆ°á»i dÃ¹ng vÃ o trá»±c tiáº¿p URL         |
| **router.back()**               | Quay láº¡i route trÆ°á»›c, Ä‘Ã³ng modal                      |

---


[<< BÃ€I 28](./28.md) | [BÃ€I 30 >>](./30.md)