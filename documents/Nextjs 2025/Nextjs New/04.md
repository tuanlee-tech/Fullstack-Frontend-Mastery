## ğŸ— **Cáº¥u trÃºc thÆ° má»¥c hoÃ n chá»‰nh**

```
app/
â”œâ”€â”€ layout.tsx
â”œâ”€â”€ page.tsx
â”œâ”€â”€ about/
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â””â”€â”€ page.tsx
â””â”€â”€ dashboard/
    â”œâ”€â”€ layout.tsx
    â”œâ”€â”€ page.tsx
    â””â”€â”€ settings/
        â””â”€â”€ page.tsx
```

---

## ğŸ§© **1ï¸âƒ£ app/layout.tsx â€” Root Layout**

```tsx
// app/layout.tsx
import "./globals.css";

export const metadata = {
  title: "Next.js App Router Demo",
  description: "Understanding Layout & Routing Structure",
};

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <body>
        <header style={{ background: "#222", color: "#fff", padding: "1rem" }}>
          ğŸŒ¸ My Global Header
        </header>
        <main style={{ padding: "2rem" }}>{children}</main>
        <footer style={{ background: "#eee", padding: "1rem", marginTop: "2rem" }}>
          Â© 2025 My Company
        </footer>
      </body>
    </html>
  );
}
```

ğŸ§  **Giáº£i thÃ­ch:**
ÄÃ¢y lÃ  **root layout** â€” bao quanh toÃ n bá»™ á»©ng dá»¥ng (global header/footer).
NÃ³ chá»‰ render láº¡i **1 láº§n duy nháº¥t**, khÃ´ng reset khi chuyá»ƒn trang.

---

## ğŸ  **2ï¸âƒ£ app/page.tsx â€” Trang chá»§**

```tsx
// app/page.tsx
export default function HomePage() {
  return (
    <section>
      <h1>ğŸ¡ Welcome to Next.js App Router</h1>
      <p>ÄÃ¢y lÃ  trang chá»§ máº·c Ä‘á»‹nh cá»§a á»©ng dá»¥ng.</p>
    </section>
  );
}
```

---

## ğŸ“˜ **3ï¸âƒ£ app/about/layout.tsx â€” Layout riÃªng cho /about**

```tsx
// app/about/layout.tsx
export default function AboutLayout({ children }: { children: React.ReactNode }) {
  return (
    <section style={{ border: "2px solid blue", padding: "1rem" }}>
      <header style={{ fontWeight: "bold", color: "blue" }}>ğŸ“˜ About Section</header>
      <div>{children}</div>
    </section>
  );
}
```

ğŸ“Œ **Layout nÃ y chá»‰ Ã¡p dá»¥ng cho /about vÃ  cÃ¡c route con cá»§a nÃ³**, khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n cÃ¡c pháº§n khÃ¡c.

---

## ğŸ“„ **4ï¸âƒ£ app/about/page.tsx â€” Trang /about**

```tsx
// app/about/page.tsx
export default function AboutPage() {
  return (
    <article>
      <h2>Giá»›i thiá»‡u vá» Next.js App Router</h2>
      <p>
        App Router lÃ  kiáº¿n trÃºc routing má»›i cá»§a Next.js (v13+), cho phÃ©p tÃ¡ch biá»‡t rÃµ rÃ ng
        giá»¯a <strong>Server Components</strong> vÃ  <strong>Client Components</strong>,
        há»— trá»£ layout lá»“ng nhau, streaming, vÃ  server actions.
      </p>
    </article>
  );
}
```

---

## âš™ï¸ **5ï¸âƒ£ app/dashboard/layout.tsx â€” Layout riÃªng cho /dashboard**

```tsx
// app/dashboard/layout.tsx
export default function DashboardLayout({ children }: { children: React.ReactNode }) {
  return (
    <section style={{ border: "2px solid green", padding: "1rem" }}>
      <header style={{ fontWeight: "bold", color: "green" }}>ğŸ“Š Dashboard Panel</header>
      <div>{children}</div>
    </section>
  );
}
```

---

## ğŸ§­ **6ï¸âƒ£ app/dashboard/page.tsx â€” Trang /dashboard**

```tsx
// app/dashboard/page.tsx
export default function DashboardPage() {
  return (
    <div>
      <h2>ğŸ“ˆ Dashboard</h2>
      <p>ChÃ o má»«ng báº¡n Ä‘áº¿n trang tá»•ng quan ngÆ°á»i dÃ¹ng.</p>
    </div>
  );
}
```

---

## âš™ï¸ **7ï¸âƒ£ app/dashboard/settings/page.tsx â€” Trang /dashboard/settings**

```tsx
// app/dashboard/settings/page.tsx
export default function SettingsPage() {
  return (
    <div>
      <h2>âš™ï¸ Cáº¥u hÃ¬nh ngÆ°á»i dÃ¹ng</h2>
      <p>Táº¡i Ä‘Ã¢y báº¡n cÃ³ thá»ƒ thay Ä‘á»•i thÃ´ng tin cÃ¡ nhÃ¢n, báº£o máº­t, vÃ  tÃ¹y chá»n giao diá»‡n.</p>
    </div>
  );
}
```

---

## âœ… **Káº¿t quáº£ khi cháº¡y**

| URL                   | Káº¿t quáº£                                          |
| --------------------- | ------------------------------------------------ |
| `/`                   | Hiá»ƒn thá»‹ trang chá»§ (Root Layout)                 |
| `/about`              | CÃ³ layout riÃªng mÃ u xanh + ná»™i dung giá»›i thiá»‡u   |
| `/dashboard`          | CÃ³ layout riÃªng mÃ u xanh lÃ¡ + ná»™i dung Dashboard |
| `/dashboard/settings` | DÃ¹ng chung layout Dashboard + ná»™i dung riÃªng     |

---

## ğŸ’¡ **Äiá»u báº¡n nÃªn hiá»ƒu sÃ¢u á»Ÿ bÃ i nÃ y:**

1. **Má»—i folder = 1 route segment.**
2. **Má»—i segment cÃ³ thá»ƒ cÃ³ layout riÃªng.**
3. **Layouts Ä‘Æ°á»£c lá»“ng vÃ o nhau theo cÃ¢y thÆ° má»¥c.**
4. **Chuyá»ƒn trang khÃ´ng reload layout cha.**
5. **CÃ¡c file page.tsx chá»‰ lÃ  pháº§n ná»™i dung â€” layout má»›i lÃ  pháº§n khung.**

---

Há»‡ thá»‘ng App Router cÃ³ **ráº¥t nhiá»u hÃ m vÃ  API Ä‘áº·c trÆ°ng**, giÃºp xá»­ lÃ½:
ğŸ“¦ *rendering, routing, data fetching, metadata, error handling,* vÃ  *navigation*.

---

### ğŸ§­ Tá»•ng há»£p **ToÃ n bá»™ hÃ m vÃ  API cÃ³ sáºµn** trong **Next.js App Router** trÆ°á»›c khi chÃºng ta báº¯t Ä‘áº§u

MÃ¬nh chia ra 8 nhÃ³m chÃ­nh Ä‘á»ƒ báº¡n dá»… tra cá»©u vÃ  há»c theo tá»«ng chá»§ Ä‘á».

---

## **1ï¸âƒ£ â€” Routing Helpers (Client & Server)**

CÃ¡c hÃ m Ä‘iá»u hÆ°á»›ng (navigate, params, pathname, â€¦)

| HÃ m                 | MÃ´i trÆ°á»ng   | MÃ´ táº£                                                                                     |
| ------------------- | ------------ | ----------------------------------------------------------------------------------------- |
| `useRouter()`       | âœ… **Client** | Tráº£ vá» Ä‘á»‘i tÆ°á»£ng `router` vá»›i cÃ¡c method: `push()`, `replace()`, `back()`, `refresh()`, â€¦ |
| `usePathname()`     | âœ… **Client** | Láº¥y Ä‘Æ°á»ng dáº«n hiá»‡n táº¡i (vÃ­ dá»¥: `/blog/react`)                                             |
| `useSearchParams()` | âœ… **Client** | Láº¥y vÃ  xá»­ lÃ½ query params: `?page=2&sort=asc`                                             |
| `redirect()`        | âœ… **Server** | Chuyá»ƒn hÆ°á»›ng trong **server component** (tráº£ vá» HTTP 307)                                 |
| `notFound()`        | âœ… **Server** | Gá»i trang `not-found.tsx` tÆ°Æ¡ng á»©ng vá»›i route hiá»‡n táº¡i                                    |
| `Link` (component)  | âœ… **Client** | DÃ¹ng Ä‘á»ƒ Ä‘iá»u hÆ°á»›ng client-side khÃ´ng reload trang                                         |

---

## **2ï¸âƒ£ â€” Data Fetching & Caching Helpers**

| HÃ m                                  | MÃ´i trÆ°á»ng          | MÃ´ táº£                                                                               |
| ------------------------------------ | ------------------- | ----------------------------------------------------------------------------------- |
| `fetch()` (Ä‘Æ°á»£c má»Ÿ rá»™ng bá»Ÿi Next.js) | âœ… **Server**        | Next.js tá»± Ä‘á»™ng cache & revalidate theo cáº¥u hÃ¬nh                                    |
| `revalidatePath(path)`               | âœ… **Server Action** | LÃ m má»›i (revalidate) cache cá»§a route cá»¥ thá»ƒ                                         |
| `revalidateTag(tag)`                 | âœ… **Server Action** | Revalidate dá»¯ liá»‡u Ä‘Æ°á»£c gáº¯n tag khi fetch (`fetch(url, { next: { tags: [...] } })`) |
| `unstable_noStore()`                 | âœ… **Server**        | Táº¯t cache cho route hiá»‡n táº¡i                                                        |
| `cache(fn)`                          | âœ… **Server**        | Cache káº¿t quáº£ cá»§a má»™t hÃ m server-side                                               |
| `headers()`                          | âœ… **Server**        | Láº¥y toÃ n bá»™ request headers                                                         |
| `cookies()`                          | âœ… **Server**        | Láº¥y vÃ  ghi cookie trong server component hoáº·c server action                         |

---

## **3ï¸âƒ£ â€” File-based Rendering APIs**

CÃ¡c hÃ m Ä‘áº·t trong file `page.tsx`, `layout.tsx`, `error.tsx`, ...

| HÃ m                                  | MÃ´i trÆ°á»ng           | File sá»­ dá»¥ng             | MÃ´ táº£                                            |
| ------------------------------------ | -------------------- | ------------------------ | ------------------------------------------------ |
| `generateStaticParams()`             | **Server**           | `[slug]/page.tsx`        | Khai bÃ¡o cÃ¡c param Ä‘á»ƒ pre-render SSG             |
| `generateMetadata()`                 | **Server**           | `page.tsx`, `layout.tsx` | Sinh metadata Ä‘á»™ng (SEO) theo param hoáº·c dá»¯ liá»‡u |
| `default export function Page()`     | **Server (default)** | `page.tsx`               | Render ná»™i dung trang                            |
| `default export function Layout()`   | **Server**           | `layout.tsx`             | Äá»‹nh nghÄ©a layout bao quanh cÃ¡c route con        |
| `default export function Error()`    | **Client báº¯t buá»™c**  | `error.tsx`              | Xá»­ lÃ½ lá»—i runtime trong layout hoáº·c route        |
| `default export function Loading()`  | **Server**           | `loading.tsx`            | Hiá»ƒn thá»‹ tráº¡ng thÃ¡i khi Ä‘ang fetch dá»¯ liá»‡u       |
| `default export function NotFound()` | **Server**           | `not-found.tsx`          | Hiá»ƒn thá»‹ trang 404 riÃªng cho route               |

---

## **4ï¸âƒ£ â€” Metadata API (SEO & Social)**

Khai bÃ¡o SEO cho tá»«ng route/layout.

| API                                        | File                     | Dáº¡ng            | MÃ´ táº£                                                     |
| ------------------------------------------ | ------------------------ | --------------- | --------------------------------------------------------- |
| `export const metadata = {...}`            | `page.tsx`, `layout.tsx` | Static          | Metadata tÄ©nh (title, description, openGraph, twitter, â€¦) |
| `export async function generateMetadata()` | `page.tsx`               | Dynamic         | Metadata Ä‘á»™ng dá»±a theo param hoáº·c fetch dá»¯ liá»‡u           |
| `Metadata` Type                            | `next`                   | TypeScript type | Äá»‹nh nghÄ©a chuáº©n cho metadata object                      |

VÃ­ dá»¥:

```tsx
export const metadata = {
  title: "Trang chá»§ | MyApp",
  description: "Trang giá»›i thiá»‡u sáº£n pháº©m",
  openGraph: {
    title: "MyApp OG",
    images: ["/og-image.png"],
  },
};
```

---

## **5ï¸âƒ£ â€” Server Actions (Tá»« Next.js 13.4+)**

| HÃ m / Cáº¥u trÃºc                   | MÃ´i trÆ°á»ng    | MÃ´ táº£                                                                    |
| -------------------------------- | ------------- | ------------------------------------------------------------------------ |
| `"use server"`                   | Server        | ÄÃ¡nh dáº¥u 1 hÃ m lÃ  **server action** cÃ³ thá»ƒ gá»i tá»« client form hoáº·c event |
| `export async function action()` | Server        | Xá»­ lÃ½ logic server-side, vÃ­ dá»¥: form submission                          |
| `revalidatePath()`               | Server Action | LÃ m má»›i cache cá»§a route sau khi cáº­p nháº­t dá»¯ liá»‡u                         |
| `revalidateTag()`                | Server Action | LÃ m má»›i cÃ¡c fetch theo tag                                               |
| `redirect()` / `notFound()`      | Server Action | CÃ³ thá»ƒ gá»i trá»±c tiáº¿p sau khi xá»­ lÃ½ form                                  |

VÃ­ dá»¥:

```tsx
"use server";

import { revalidatePath } from "next/cache";

export async function addPost(data: FormData) {
  const title = data.get("title");
  await saveToDB(title);
  revalidatePath("/blog");
}
```

---

## **6ï¸âƒ£ â€” Navigation Components (Client)**

| ThÃ nh pháº§n              | MÃ´ táº£                                          |
| ----------------------- | ---------------------------------------------- |
| `<Link href="/path">`   | Äiá»u hÆ°á»›ng client-side (khÃ´ng reload)          |
| `<Redirect>` (React 19) | DÃ¹ng trong client component                    |
| `<Suspense>`            | Bao quanh component async Ä‘á»ƒ show `loading` UI |
| `<ErrorBoundary>`       | Bao quanh vÃ¹ng cÃ³ thá»ƒ lá»—i                      |

---

## **7ï¸âƒ£ â€” Special File Conventions (HÃ nh vi tá»± Ä‘á»™ng cá»§a App Router)**

| File                      | TÃ¡c dá»¥ng                          |
| ------------------------- | --------------------------------- |
| `page.tsx`                | Ná»™i dung chÃ­nh cá»§a route          |
| `layout.tsx`              | Layout bao quanh cÃ¡c route con    |
| `loading.tsx`             | UI khi Ä‘ang loading               |
| `error.tsx`               | UI khi gáº·p lá»—i                    |
| `not-found.tsx`           | UI cho lá»—i 404                    |
| `route.ts`                | API Route (tÆ°Æ¡ng tá»± `/api/...`)   |
| `template.tsx`            | Layout reset láº¡i khi chuyá»ƒn route |
| `head.tsx` *(deprecated)* | CÅ©, thay báº±ng `metadata`          |

---

## **8ï¸âƒ£ â€” Others (Utility & Context)**

| HÃ m                           | MÃ´i trÆ°á»ng | MÃ´ táº£                                                                      |
| ----------------------------- | ---------- | -------------------------------------------------------------------------- |
| `useServerInsertedHTML()`     | Server     | ChÃ¨n HTML tÃ¹y chá»‰nh trong quÃ¡ trÃ¬nh render                                 |
| `useSelectedLayoutSegments()` | Client     | Láº¥y cÃ¡c segment hiá»‡n táº¡i trong URL (App Router)                            |
| `useParams()` *(Next 15)*     | Client     | Láº¥y trá»±c tiáº¿p params trong Client Component (thay cho `useRouter().query`) |

---

## ğŸ§© **Tá»•ng há»£p ngáº¯n gá»n cho dev nhá»› nhanh**

| NhÃ³m                  | HÃ m / File chÃ­nh                                                                  |
| --------------------- | --------------------------------------------------------------------------------- |
| **Routing**           | `useRouter`, `redirect`, `notFound`                                               |
| **Params & Query**    | `useParams`, `useSearchParams`, `usePathname`                                     |
| **Static Generation** | `generateStaticParams`                                                            |
| **SEO**               | `generateMetadata`, `metadata`                                                    |
| **UI States**         | `loading.tsx`, `error.tsx`, `not-found.tsx`                                       |
| **Server Actions**    | `"use server"`, `revalidatePath`, `redirect`                                      |
| **Cache Control**     | `fetch(..., { next: { revalidate, tags } })`, `revalidateTag`, `unstable_noStore` |
| **API Route**         | `route.ts`                                                                        |


---
[<< BÃ€I 03](./03.md) | [BÃ€I 05 >>](./05.md)