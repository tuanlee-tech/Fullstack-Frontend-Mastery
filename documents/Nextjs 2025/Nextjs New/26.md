## ğŸ§­ PHáº¦N 4 â€“ Advanced Routing trong Next.js

### ğŸ¯ Má»¥c tiÃªu

* Hiá»ƒu cÃ¡c tÃ­nh nÄƒng nÃ¢ng cao cá»§a **App Router**:

  * **Parallel Routes**
  * **Unmatched Routes**
  * **Conditional Routes**
  * **Intercepting Routes**
  * **Parallel Intercepting Routes**
* TÄƒng kháº£ nÄƒng tá»• chá»©c app lá»›n vá»›i nhiá»u route phá»©c táº¡p.

---

## 4.1 â€“ Parallel Routes

* Cho phÃ©p render **nhiá»u outlet song song** trong cÃ¹ng má»™t layout mÃ  khÃ´ng pháº£i nested route.
* Cáº¥u trÃºc thÆ° má»¥c: sá»­ dá»¥ng **`(group)`** Ä‘á»ƒ phÃ¢n tÃ¡ch route mÃ  khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n URL.

```txt
app/
â”œâ”€â”€ dashboard/
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”œâ”€â”€ (overview)/page.tsx
â”‚   â””â”€â”€ (analytics)/page.tsx
```

* `/dashboard` cÃ³ thá»ƒ render **cáº£ overview vÃ  analytics cÃ¹ng lÃºc** trong layout.

---

## 4.2 â€“ Unmatched Routes

* Cho phÃ©p báº¯t cÃ¡c route **khÃ´ng khá»›p vá»›i báº¥t ká»³ page nÃ o**
* DÃ¹ng **`not-found.tsx`** hoáº·c **catch-all dynamic routes**
* ThÆ°á»ng dÃ¹ng cho **404 pages** hoáº·c redirect.

---

## 4.3 â€“ Conditional Routes

* Render má»™t route **dá»±a trÃªn Ä‘iá»u kiá»‡n runtime**, vÃ­ dá»¥:

  * User role
  * Feature flag
* ThÆ°á»ng káº¿t há»£p vá»›i **Server Components + Auth**.

---

## 4.4 â€“ Intercepting Routes

* Cho phÃ©p route **intercept navigation** mÃ  khÃ´ng thay Ä‘á»•i URL.
* VÃ­ dá»¥: modal, drawer, onboarding wizard.

```
app/
â”œâ”€â”€ dashboard/
â”‚   â”œâ”€â”€ page.tsx
â”‚   â””â”€â”€ (modal)/settings/page.tsx
```

* `/dashboard/(modal)/settings` cÃ³ thá»ƒ **hiá»‡n modal trÃªn dashboard** mÃ  URL váº«n lÃ  `/dashboard`.

---

## 4.5 â€“ Parallel Intercepting Routes

* Káº¿t há»£p **Parallel + Intercepting** Ä‘á»ƒ táº¡o cÃ¡c layout complex:

  * Sidebar vÃ  content load song song
  * Modal overlay load song song

* Cáº¥u trÃºc thÆ° má»¥c **sá»­ dá»¥ng cÃ¡c route groups `(group)`** vÃ  intercepting route `(modal)`.

---


# BÃ i Giáº£ng Chi Tiáº¿t: Parallel Routes trong Next.js App Router

## 1. Giá»›i Thiá»‡u vá» Parallel Routes

**Parallel Routes** lÃ  má»™t tÃ­nh nÄƒng máº¡nh máº½ trong Next.js App Router cho phÃ©p báº¡n render Ä‘á»“ng thá»i nhiá»u pages trong cÃ¹ng má»™t layout. Äiá»u nÃ y Ä‘áº·c biá»‡t há»¯u Ã­ch khi báº¡n muá»‘n hiá»ƒn thá»‹ nhiá»u pháº§n ná»™i dung Ä‘á»™c láº­p nhÆ°ng liÃªn quan Ä‘áº¿n nhau trÃªn cÃ¹ng má»™t mÃ n hÃ¬nh.

### Táº¡i sao cáº§n Parallel Routes?

- **Hiá»ƒn thá»‹ nhiá»u view cÃ¹ng lÃºc**: Dashboard vá»›i nhiá»u panels, modal káº¿t há»£p vá»›i content chÃ­nh
- **Navigation Ä‘á»™c láº­p**: Má»—i route cÃ³ thá»ƒ cÃ³ state vÃ  navigation riÃªng
- **Loading vÃ  Error states riÃªng biá»‡t**: Má»—i parallel route cÃ³ thá»ƒ cÃ³ loading.js vÃ  error.js riÃªng
- **Conditional rendering**: Hiá»ƒn thá»‹ hoáº·c áº©n cÃ¡c routes dá»±a trÃªn Ä‘iá»u kiá»‡n

## 2. CÃº PhÃ¡p vÃ  Cáº¥u TrÃºc

### 2.1. Äá»‹nh nghÄ©a Parallel Routes

Parallel Routes Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a báº±ng cÃ¡ch sá»­ dá»¥ng **named slots** vá»›i kÃ½ hiá»‡u `@`:

```
app/
â”œâ”€â”€ @analytics/
â”‚   â”œâ”€â”€ page.tsx
â”‚   â”œâ”€â”€ loading.tsx
â”‚   â””â”€â”€ error.tsx
â”œâ”€â”€ @team/
â”‚   â”œâ”€â”€ page.tsx
â”‚   â””â”€â”€ loading.tsx
â”œâ”€â”€ @revenue/
â”‚   â””â”€â”€ page.tsx
â”œâ”€â”€ layout.tsx
â””â”€â”€ page.tsx
```

### 2.2. Sá»­ dá»¥ng trong Layout

CÃ¡c slots nÃ y Ä‘Æ°á»£c truyá»n vÃ o layout component nhÆ° props:

```tsx
// app/layout.tsx
export default function Layout({
  children,
  analytics,
  team,
  revenue,
}: {
  children: React.ReactNode;
  analytics: React.ReactNode;
  team: React.ReactNode;
  revenue: React.ReactNode;
}) {
  return (
    <div>
      <div>{children}</div>
      <div className="dashboard">
        <div className="analytics-section">{analytics}</div>
        <div className="team-section">{team}</div>
        <div className="revenue-section">{revenue}</div>
      </div>
    </div>
  );
}
```

## 3. CÃ¡c TÃ­nh NÄƒng ChÃ­nh

### 3.1. Independent Navigation

Má»—i parallel route cÃ³ thá»ƒ Ä‘iá»u hÆ°á»›ng Ä‘á»™c láº­p:

```
app/
â”œâ”€â”€ @modal/
â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ signup/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â””â”€â”€ default.tsx
â”œâ”€â”€ layout.tsx
â””â”€â”€ page.tsx
```

```tsx
// app/layout.tsx
export default function Layout({
  children,
  modal,
}: {
  children: React.ReactNode;
  modal: React.ReactNode;
}) {
  return (
    <>
      {children}
      {modal}
    </>
  );
}
```

### 3.2. Default.js - Xá»­ lÃ½ Unmatched Routes

Khi má»™t slot khÃ´ng match vá»›i URL hiá»‡n táº¡i, Next.js sáº½ render `default.js`:

```tsx
// app/@modal/default.tsx
export default function Default() {
  return null; // KhÃ´ng hiá»ƒn thá»‹ gÃ¬ khi khÃ´ng cÃ³ modal
}
```

**LÆ°u Ã½ quan trá»ng**: Náº¿u khÃ´ng cÃ³ `default.js`, Next.js sáº½ render lá»—i 404 cho slot Ä‘Ã³.

### 3.3. Loading vÃ  Error States

Má»—i parallel route cÃ³ thá»ƒ cÃ³ loading vÃ  error states riÃªng:

```tsx
// app/@analytics/loading.tsx
export default function Loading() {
  return <div>Loading analytics...</div>;
}

// app/@analytics/error.tsx
export default function Error({
  error,
  reset,
}: {
  error: Error;
  reset: () => void;
}) {
  return (
    <div>
      <h2>Error loading analytics: {error.message}</h2>
      <button onClick={reset}>Try again</button>
    </div>
  );
}
```

## 4. Use Cases Thá»±c Táº¿

### 4.1. Dashboard vá»›i Multiple Views

```
app/
â”œâ”€â”€ dashboard/
â”‚   â”œâ”€â”€ @analytics/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ @notifications/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ @activity/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â””â”€â”€ page.tsx
```

```tsx
// app/dashboard/layout.tsx
export default function DashboardLayout({
  children,
  analytics,
  notifications,
  activity,
}: {
  children: React.ReactNode;
  analytics: React.ReactNode;
  notifications: React.ReactNode;
  activity: React.ReactNode;
}) {
  return (
    <div className="dashboard-grid">
      <header>{children}</header>
      <aside className="sidebar">{notifications}</aside>
      <main className="main-content">
        <section>{analytics}</section>
        <section>{activity}</section>
      </main>
    </div>
  );
}
```

### 4.2. Modal vá»›i Intercepting Routes

Káº¿t há»£p Parallel Routes vá»›i Intercepting Routes Ä‘á»ƒ táº¡o modal:

```
app/
â”œâ”€â”€ @modal/
â”‚   â”œâ”€â”€ (.)photo/
â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â””â”€â”€ default.tsx
â”œâ”€â”€ photo/
â”‚   â””â”€â”€ [id]/
â”‚       â””â”€â”€ page.tsx
â”œâ”€â”€ layout.tsx
â””â”€â”€ page.tsx
```

```tsx
// app/layout.tsx
export default function RootLayout({
  children,
  modal,
}: {
  children: React.ReactNode;
  modal: React.ReactNode;
}) {
  return (
    <html>
      <body>
        {children}
        {modal}
      </body>
    </html>
  );
}

// app/@modal/(.)photo/[id]/page.tsx
export default function PhotoModal({ params }: { params: { id: string } }) {
  return (
    <div className="modal-overlay">
      <div className="modal-content">
        <img src={`/photos/${params.id}`} alt="Photo" />
      </div>
    </div>
  );
}
```

### 4.3. Conditional Rendering dá»±a trÃªn User Role

```tsx
// app/layout.tsx
import { getServerSession } from 'next-auth';

export default async function Layout({
  children,
  admin,
  user,
}: {
  children: React.ReactNode;
  admin: React.ReactNode;
  user: React.ReactNode;
}) {
  const session = await getServerSession();
  const isAdmin = session?.user?.role === 'admin';

  return (
    <div>
      {children}
      {isAdmin ? admin : user}
    </div>
  );
}
```

## 5. Soft Navigation vÃ  Active State Preservation

Parallel Routes há»— trá»£ **soft navigation** - khi Ä‘iá»u hÆ°á»›ng, cÃ¡c parallel routes khÃ´ng bá»‹ unmount trá»« khi chÃºng khÃ´ng match vá»›i URL má»›i.

### VÃ­ dá»¥:
```
URL hiá»‡n táº¡i: /dashboard
- @analytics/page.tsx (active)
- @team/page.tsx (active)

Äiá»u hÆ°á»›ng Ä‘áº¿n: /dashboard/settings
- @analytics váº«n giá»¯ state náº¿u cÃ³ default.js
- @team váº«n giá»¯ state náº¿u cÃ³ default.js
```

## 6. Best Practices

### 6.1. LuÃ´n táº¡o default.js

```tsx
// app/@modal/default.tsx
export default function Default() {
  return null;
}
```

Äiá»u nÃ y ngÄƒn lá»—i 404 khi route khÃ´ng match.

### 6.2. Äáº·t tÃªn Slots cÃ³ Ã½ nghÄ©a

```
âœ… Good: @sidebar, @modal, @analytics
âŒ Bad: @slot1, @component, @x
```

### 6.3. Sá»­ dá»¥ng TypeScript cho Type Safety

```tsx
type LayoutProps = {
  children: React.ReactNode;
  analytics: React.ReactNode;
  team: React.ReactNode;
};

export default function Layout({ children, analytics, team }: LayoutProps) {
  // ...
}
```

### 6.4. Káº¿t há»£p vá»›i Server Components

```tsx
// app/@analytics/page.tsx
async function getAnalyticsData() {
  const res = await fetch('https://api.example.com/analytics');
  return res.json();
}

export default async function Analytics() {
  const data = await getAnalyticsData();
  
  return (
    <div>
      <h2>Analytics</h2>
      <pre>{JSON.stringify(data, null, 2)}</pre>
    </div>
  );
}
```

## 7. So SÃ¡nh vá»›i CÃ¡c PhÆ°Æ¡ng PhÃ¡p KhÃ¡c

| TÃ­nh nÄƒng | Parallel Routes | Multiple Components | Tab Navigation |
|-----------|----------------|---------------------|----------------|
| Independent URLs | âœ… | âŒ | âš ï¸ |
| Separate Loading States | âœ… | âŒ | âŒ |
| SEO Friendly | âœ… | âœ… | âš ï¸ |
| Server Components | âœ… | âœ… | âœ… |
| State Preservation | âœ… | âš ï¸ | âœ… |

## 8. LÆ°u Ã vÃ  Háº¡n Cháº¿

### 8.1. Matching Behavior

- Parallel routes chá»‰ match khi cÃ³ route tÆ°Æ¡ng á»©ng trong slot
- Cáº§n `default.js` Ä‘á»ƒ xá»­ lÃ½ unmatched cases
- Soft navigation giá»¯ previous state náº¿u cÃ³ default.js

### 8.2. Performance

- Má»—i parallel route lÃ  má»™t separate component tree
- Loading states Ä‘á»™c láº­p giÃºp improve perceived performance
- Server Components cÃ³ thá»ƒ stream independently

### 8.3. Nested Layouts

Parallel routes cÃ³ thá»ƒ nested nhÆ°ng cáº§n cáº©n tháº­n vá»›i complexity:

```
app/
â”œâ”€â”€ @modal/
â”‚   â”œâ”€â”€ @nested/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â””â”€â”€ layout.tsx
â””â”€â”€ layout.tsx
```

## 9. VÃ­ Dá»¥ Tá»•ng Há»£p: E-commerce Dashboard

```
app/
â”œâ”€â”€ dashboard/
â”‚   â”œâ”€â”€ @sales/
â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”œâ”€â”€ loading.tsx
â”‚   â”‚   â””â”€â”€ error.tsx
â”‚   â”œâ”€â”€ @inventory/
â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ loading.tsx
â”‚   â”œâ”€â”€ @customers/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â””â”€â”€ page.tsx
```

```tsx
// app/dashboard/layout.tsx
export default function DashboardLayout({
  children,
  sales,
  inventory,
  customers,
}: {
  children: React.ReactNode;
  sales: React.ReactNode;
  inventory: React.ReactNode;
  customers: React.ReactNode;
}) {
  return (
    <div className="dashboard">
      <header className="dashboard-header">{children}</header>
      <div className="dashboard-grid">
        <section className="sales-panel">
          <h2>Sales Overview</h2>
          {sales}
        </section>
        <section className="inventory-panel">
          <h2>Inventory Status</h2>
          {inventory}
        </section>
        <section className="customers-panel">
          <h2>Customer Insights</h2>
          {customers}
        </section>
      </div>
    </div>
  );
}

// app/dashboard/@sales/page.tsx
async function getSalesData() {
  // Fetch tá»« API hoáº·c database
  const res = await fetch('https://api.example.com/sales', {
    next: { revalidate: 60 }
  });
  return res.json();
}

export default async function SalesPanel() {
  const salesData = await getSalesData();
  
  return (
    <div>
      <p>Total Revenue: ${salesData.totalRevenue}</p>
      <p>Orders Today: {salesData.ordersToday}</p>
    </div>
  );
}

// app/dashboard/@sales/loading.tsx
export default function Loading() {
  return <div className="skeleton">Loading sales data...</div>;
}
```

## 10. Káº¿t Luáº­n

Parallel Routes lÃ  má»™t tÃ­nh nÄƒng powerful trong Next.js App Router giÃºp:

- Táº¡o complex layouts vá»›i multiple independent views
- Improve user experience vá»›i separate loading states
- Maintain better code organization
- Enable advanced patterns nhÆ° modals vÃ  conditional rendering

**Khi nÃ o nÃªn sá»­ dá»¥ng:**
- Dashboards vá»›i multiple data sources
- Modal vÃ  overlay patterns
- Multi-panel layouts
- Conditional views based on user permissions

**Khi nÃ o khÃ´ng nÃªn sá»­ dá»¥ng:**
- Simple layouts vá»›i single content area
- Khi components khÃ´ng cáº§n independent navigation
- Khi complexity khÃ´ng justify the benefits

Parallel Routes má»Ÿ ra nhiá»u kháº£ nÄƒng má»›i cho viá»‡c xÃ¢y dá»±ng á»©ng dá»¥ng Next.js phá»©c táº¡p vÃ  user-friendly!

---
[<< BÃ€I 25](./25.md) | [BÃ€I 27 >>](./27.md)