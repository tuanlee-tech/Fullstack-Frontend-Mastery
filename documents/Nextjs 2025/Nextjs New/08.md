 **PHẦN 8 Nested Dynamic Routes (Định tuyến động lồng nhau)** — phần mở rộng cực kỳ hữu ích khi bạn xây dựng **các trang chi tiết đa cấp**, như:

* `/blog/[slug]/comments/[commentId]`
* `/shop/[category]/[productId]`
* `/users/[id]/posts/[postId]`

---

## 🧭 Nested Dynamic Routes

### 🎯 Mục tiêu

* Hiểu cách **kết hợp nhiều cấp route động**
* Biết cách **truy cập tất cả tham số lồng nhau**
* Ứng dụng để tạo layout dạng **“master-detail”**

---

## 📂 1️⃣ Cấu trúc thư mục ví dụ

```
app/
└── blog/
    └── [slug]/
        ├── page.tsx            → /blog/[slug]
        └── comments/
            └── [commentId]/
                └── page.tsx    → /blog/[slug]/comments/[commentId]
```

---

## 📄 2️⃣ Code mẫu

### ✅ `app/blog/[slug]/comments/[commentId]/page.tsx`

```tsx
interface CommentDetailProps {
  params: {
    slug: string;
    commentId: string;
  };
}

export default function CommentDetailPage({ params }: CommentDetailProps) {
  return (
    <div style={{ padding: "1rem" }}>
      <h2>💬 Bình luận chi tiết</h2>
      <p>
        Bài viết: <strong>{params.slug}</strong>
      </p>
      <p>
        Mã bình luận: <strong>{params.commentId}</strong>
      </p>
    </div>
  );
}
```

Khi truy cập `/blog/nextjs-app-router/comments/42`
➡ Bạn sẽ thấy:

```
Bài viết: nextjs-app-router
Mã bình luận: 42
```

---

## 🧠 3️⃣ Lồng nhiều cấp hơn nữa

Bạn có thể đi xa hơn, ví dụ:

```
/project/[id]/tasks/[taskId]/subtasks/[subId]
```

với code tương tự, Next.js vẫn tự động ánh xạ `params` như:

```tsx
{
  id: 'project1',
  taskId: 'task123',
  subId: 'sub456'
}
```

---

## 🧩 4️⃣ Bài tập nhỏ

> Tạo cấu trúc `/users/[id]/posts/[postId]`, hiển thị:
>
> ```
> User ID: ...
> Post ID: ...
> ```
>
> * Tạo thêm trang `/users/[id]/page.tsx` để hiển thị thông tin người dùng tổng quát.
> * Khi click 1 bài viết trong danh sách, điều hướng đến `/users/[id]/posts/[postId]`.


Giờ ta sẽ làm ví dụ **hoàn chỉnh** cho **Nested Dynamic Routes** với cấu trúc:

```
/users/[id]/posts/[postId]
```

> Mục tiêu: hiển thị danh sách bài viết của 1 user, và khi click vào bài viết → đi đến trang chi tiết bài viết (có cả 2 tham số `id` và `postId`).

---

## 📁 1️⃣ Cấu trúc thư mục

```
app/
└── users/
    └── [id]/
        ├── page.tsx
        └── posts/
            └── [postId]/
                └── page.tsx
```

---

## 📄 2️⃣ `app/users/[id]/page.tsx` – Trang danh sách bài viết của user

```tsx
import Link from "next/link";

interface UserPageProps {
  params: {
    id: string;
  };
}

export default function UserPage({ params }: UserPageProps) {
  const { id } = params;

  // Giả lập danh sách bài viết
  const posts = [
    { id: "p1", title: "Học Next.js App Router" },
    { id: "p2", title: "Hiểu về React Server Components" },
    { id: "p3", title: "Data Fetching trong Next.js" },
  ];

  return (
    <div style={{ padding: "1.5rem" }}>
      <h1>👤 Thông tin người dùng: {id}</h1>
      <h2>📝 Danh sách bài viết</h2>
      <ul>
        {posts.map((post) => (
          <li key={post.id}>
            <Link href={`/users/${id}/posts/${post.id}`}>
              <span style={{ color: "blue", textDecoration: "underline" }}>
                {post.title}
              </span>
            </Link>
          </li>
        ))}
      </ul>
    </div>
  );
}
```

---

## 📄 3️⃣ `app/users/[id]/posts/[postId]/page.tsx` – Trang chi tiết bài viết

```tsx
interface PostDetailPageProps {
  params: {
    id: string;
    postId: string;
  };
}

export default function PostDetailPage({ params }: PostDetailPageProps) {
  const { id, postId } = params;

  return (
    <div style={{ padding: "1.5rem" }}>
      <h1>📄 Chi tiết bài viết</h1>
      <p>
        👤 User ID: <strong>{id}</strong>
      </p>
      <p>
        🧾 Post ID: <strong>{postId}</strong>
      </p>
    </div>
  );
}
```

---

## ⚙️ 4️⃣ Cách hoạt động

1. Khi truy cập `/users/123` → hiển thị danh sách bài viết.
2. Khi click “Học Next.js App Router” → điều hướng tới `/users/123/posts/p1`.
3. `params` tự động chứa cả 2 tham số:

   ```ts
   { id: '123', postId: 'p1' }
   ```
4. Không cần phải định nghĩa thêm router, Next.js tự mapping theo folder.

---

## 💡 5️⃣ Mở rộng

Bạn có thể dùng layout lồng nhau để:

* Chia sẻ UI chung giữa `/users/[id]` và `/users/[id]/posts/[postId]`
* Giữ thanh sidebar người dùng cố định, chỉ thay phần chi tiết bài viết

Ví dụ thêm layout:

```
app/users/[id]/layout.tsx
```


---
[<< BÀI 07](./07.md) | [BÀI 09 >>](./09.md)