# Ngày 14

## Xử lý lỗi (Error Handling)

JavaScript là ngôn ngữ kiểu lỏng (loosely-typed), có thể xảy ra lỗi thời gian chạy khi truy cập biến không xác định hoặc gọi hàm không tồn tại. JavaScript cung cấp cơ chế xử lý lỗi bằng khối `try-catch-finally`.

```js
try {
  // Mã có thể gây lỗi
} catch (err) {
  // Mã xử lý khi lỗi xảy ra
} finally {
  // Mã luôn được thực thi, bất kể có lỗi hay không
}
```

- **try**: Bọc mã nghi ngờ có thể gây lỗi. Khối `try` xác định mã cần kiểm tra lỗi trong khi thực thi.
- **catch**: Xử lý lỗi khi xảy ra, nhận tham số chứa thông tin lỗi (thường là `err` hoặc `error`).
- **finally**: Luôn thực thi, dù có lỗi hay không, dùng để hoàn thành tác vụ hoặc đặt lại biến.

### Ví dụ

```js
try {
  let lastName = 'Yetayeh'
  let fullName = fistName + ' ' + lastName
} catch (err) {
  console.log(err)
}
// ReferenceError: fistName is not defined
```

Sử dụng `console.error` và `finally`:

```js
try {
  let lastName = 'Yetayeh'
  let fullName = fistName + ' ' + lastName
} catch (err) {
  console.error(err)
} finally {
  console.log('In any case I will be executed')
}
// ReferenceError: fistName is not defined
// In any case I will be executed
```

Lấy thông tin lỗi:

```js
try {
  let lastName = 'Yetayeh'
  let fullName = fistName + ' ' + lastName
} catch (err) {
  console.log('Name of the error', err.name)
  console.log('Error message', err.message)
} finally {
  console.log('In any case I will be executed')
}
// Name of the error ReferenceError
// Error message fistName is not defined
// In any case I will be executed
```

### Ném lỗi (throw)

Câu lệnh `throw` cho phép tạo lỗi tùy chỉnh:

```js
throw 'Error2' // Lỗi với giá trị chuỗi
throw 42 // Lỗi với giá trị số
throw true // Lỗi với giá trị boolean
throw new Error('Required') // Lỗi với thông điệp tùy chỉnh
```

Ví dụ sử dụng `throw`:

```js
const throwErrorExampleFun = () => {
  let x = prompt('Enter a number: ')
  try {
    if (x == '') throw 'empty'
    if (isNaN(x)) throw 'not a number'
    x = Number(x)
    if (x < 5) throw 'too low'
    if (x > 10) throw 'too high'
  } catch (err) {
    console.log(err)
  }
}
throwErrorExampleFun()
```

### Các loại lỗi

1. **ReferenceError**: Tham chiếu bất hợp pháp, xảy ra khi sử dụng biến chưa được khai báo.

```js
let firstName = 'Asabeneh'
let fullName = firstName + ' ' + lastName
console.log(fullName)
// Uncaught ReferenceError: lastName is not defined
```

2. **SyntaxError**: Lỗi cú pháp.

```js
let square = 2 x 2
console.log(square)
// Uncaught SyntaxError: Unexpected identifier
```

3. **TypeError**: Lỗi kiểu dữ liệu.

```js
let num = 10
console.log(num.toLowerCase())
// Uncaught TypeError: num.toLowerCase is not a function
```

Hiểu các loại lỗi giúp xác định sai lầm và gỡ lỗi nhanh chóng.

---

## Bài tập: Ngày 14

### Bài tập: Cấp độ 1

1. **Thực hành xử lý lỗi ReferenceError**

```js
try {
  let name = 'Asabeneh'
  let fullName = name + ' ' + lastName
} catch (err) {
  console.error('Error:', err.message) // Error: lastName is not defined
}
```

### Bài tập: Cấp độ 2

1. **Thực hành xử lý lỗi với throw**

```js
function checkAge(age) {
  try {
    if (age < 18) throw new Error('Too young')
    if (age > 100) throw new Error('Too old')
    return 'Age is valid'
  } catch (err) {
    console.error('Error:', err.message)
  }
}
console.log(checkAge(15)) // Error: Too young
console.log(checkAge(120)) // Error: Too old
console.log(checkAge(25)) // Age is valid
```

### Bài tập: Cấp độ 3

1. **Xử lý lỗi trong hàm tính toán**

```js
function divide(a, b) {
  try {
    if (b === 0) throw new Error('Division by zero')
    return a / b
  } catch (err) {
    console.error('Error:', err.message)
    return null
  } finally {
    console.log('Calculation attempted')
  }
}
console.log(divide(10, 2)) // 5, Calculation attempted
console.log(divide(10, 0)) // Error: Division by zero, null, Calculation attempted
```

---

[<< Ngày 13](./13.Console_Object_Methods.md) | [Ngày 15 >>](./15.Classes.md)