# ES6 Modules


## **1. ES Modules là gì?**

* ES Modules (ECMAScript Modules) là cách **chia nhỏ chương trình** ra thành các module, mỗi module có một chức năng riêng.
* Trong một module:

  * Dùng `export` để xuất biến, function, class,...
  * Dùng `import` để sử dụng trong file khác.

**Lợi ích:**

1. Module hoá code → dễ bảo trì, kiểm thử.
2. Hỗ trợ **dynamic import** → tải module khi cần, giảm thời gian load trang.

---

## **2. Sử dụng trên trình duyệt**

* Khai báo file JS là module:

```html
<script type="module" src="main.js"></script>
```

* Trình duyệt cũ (không support module) dùng `nomodule`:

```html
<script type="module" src="main.js"></script>
<script nomodule src="fallback.js"></script>
```

---

## **3. Ví dụ cơ bản**

**lib.js**:

```js
export const repeat = (string) => `${string} ${string}`;
export function shout(string) {
  return `${string.toUpperCase()}!`;
}
```

**main.js**:

```js
import { repeat, shout } from "./lib.js";

console.log(repeat("hello"));          // "hello hello"
console.log(shout("Modules in action"));// "MODULES IN ACTION!"
```

**index.html**:

```html
<script type="module" src="./main.js"></script>
```

---

## **4. Export & Import**

### a) Export/Import theo tên (named)

```js
// lib.js
export let x = 1;
export function add(a,b){ return a+b; }

// main.js
import { x, add } from './lib.js';
console.log(x);     // 1
console.log(add(2,3));// 5
```

* Có thể đổi tên khi import:

```js
import { x as newX } from './lib.js';
console.log(newX); // 1
```

* Hoặc import tất cả vào một object:

```js
import * as myModule from './lib.js';
console.log(myModule.x);
```

---

### b) Export/Import default

* Mỗi module chỉ có 1 `export default`.

```js
// lib.js
export default class Utils {
  print(text) { console.log(text); }
}

// main.js
import Tools from './lib.js';
new Tools().print("hi"); // hi
```

* Có thể kết hợp `default` và named:

```js
// lib.js
export let x=1;
export default class Utils { ... }

// main.js
import Tools, { x } from './lib.js';
```

---

## **5. Dynamic import**

* Chỉ load module khi cần, trả về Promise:

```js
setTimeout(async () => {
  const { x, Utils } = await import('./lib.js');
  console.log(x);
  new Utils().print("hi");
}, 2000);
```

---

## **6. Lưu ý**

1. ES Modules luôn chạy ở **strict mode**.
2. Biến khai báo trong module **không tạo biến global**.
3. `export` và `import` chỉ dùng trong module.
4. Dynamic import → Promise → kết hợp async/await được.

---

**Kết luận:**
ES Modules giúp **module hoá code, dễ bảo trì**, hỗ trợ **dynamic loading**. Trình duyệt hiện đại hỗ trợ trực tiếp, còn trình duyệt cũ dùng fallback với `nomodule`.
