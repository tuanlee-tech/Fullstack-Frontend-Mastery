# ğŸª„ ChÃ o má»«ng Ä‘áº¿n vá»›i tÃ i liá»‡u Next.js!

Pháº§n **Báº¯t Ä‘áº§u nhanh (Getting Started)** nÃ y sáº½ hÆ°á»›ng dáº«n báº¡n **táº¡o á»©ng dá»¥ng Next.js Ä‘áº§u tiÃªn** vÃ  tÃ¬m hiá»ƒu **cÃ¡c tÃ­nh nÄƒng cá»‘t lÃµi** mÃ  báº¡n sáº½ sá»­ dá»¥ng trong má»i dá»± Ã¡n.

---

## ğŸ’¡ Kiáº¿n thá»©c cáº§n cÃ³ trÆ°á»›c

TÃ i liá»‡u nÃ y giáº£ Ä‘á»‹nh ráº±ng báº¡n Ä‘Ã£ cÃ³ **má»™t sá»‘ hiá»ƒu biáº¿t cÆ¡ báº£n vá» phÃ¡t triá»ƒn web**.
TrÆ°á»›c khi báº¯t Ä‘áº§u, báº¡n nÃªn cáº£m tháº¥y thoáº£i mÃ¡i vá»›i cÃ¡c kiáº¿n thá»©c sau:

* **HTML**
* **CSS**
* **JavaScript**
* **React**

Náº¿u báº¡n **má»›i há»c React** hoáº·c cáº§n Ã´n láº¡i, hÃ£y báº¯t Ä‘áº§u vá»›i khÃ³a **React Foundations** (Ná»n táº£ng React),
vÃ  sau Ä‘Ã³ Ä‘áº¿n khÃ³a **Next.js Foundations**, nÆ¡i báº¡n sáº½ **vá»«a há»c vá»«a xÃ¢y dá»±ng má»™t á»©ng dá»¥ng thá»±c táº¿**.

---

## ğŸš€ CÃ¡c bÆ°á»›c tiáº¿p theo

### 1. CÃ i Ä‘áº·t (Installation)

TÃ¬m hiá»ƒu cÃ¡ch táº¡o má»™t á»©ng dá»¥ng Next.js má»›i báº±ng cÃ´ng cá»¥ dÃ²ng lá»‡nh `create-next-app`,
vÃ  thiáº¿t láº­p **TypeScript**, **ESLint**, cÃ¹ng **Module Path Aliases**.

### 2. Cáº¥u trÃºc dá»± Ã¡n (Project Structure)

Hiá»ƒu cÃ¡c **quy Æ°á»›c thÆ° má»¥c vÃ  tá»‡p tin** trong Next.js,
vÃ  cÃ¡ch **tá»• chá»©c dá»± Ã¡n** cá»§a báº¡n má»™t cÃ¡ch há»£p lÃ½.

### 3. Layouts vÃ  Pages

Há»c cÃ¡ch **táº¡o cÃ¡c trang (pages)** vÃ  **bá»‘ cá»¥c (layouts)** Ä‘áº§u tiÃªn,
vÃ  **liÃªn káº¿t giá»¯a chÃºng** báº±ng component `Link`.

### 4. LiÃªn káº¿t & Äiá»u hÆ°á»›ng (Linking and Navigating)

TÃ¬m hiá»ƒu cÃ¡ch **tá»‘i Æ°u hÃ³a Ä‘iá»u hÆ°á»›ng** báº±ng cÃ¡c ká»¹ thuáº­t nhÆ° **prefetching**, **prerendering**,
vÃ  **client-side navigation**, cÅ©ng nhÆ° cÃ¡ch xá»­ lÃ½ Ä‘iá»u hÆ°á»›ng **Ä‘á»™ng** hoáº·c **máº¡ng cháº­m**.

### 5. Server vÃ  Client Components

TÃ¬m hiá»ƒu cÃ¡ch sá»­ dá»¥ng **React Server Components** vÃ  **Client Components**
Ä‘á»ƒ render tá»«ng pháº§n á»©ng dá»¥ng trÃªn **server hoáº·c client** má»™t cÃ¡ch hiá»‡u quáº£.

### 6. Partial Prerendering

KhÃ¡m phÃ¡ **Partial Prerendering** â€“ cÃ¡ch káº¿t há»£p Æ°u Ä‘iá»ƒm cá»§a **render tÄ©nh (static)**
vÃ  **render Ä‘á»™ng (dynamic)** Ä‘á»ƒ tá»‘i Æ°u hiá»‡u nÄƒng.

### 7. Fetching Data

Há»c cÃ¡ch **láº¥y dá»¯ liá»‡u (fetch)** vÃ  **stream ná»™i dung** phá»¥ thuá»™c vÃ o dá»¯ liá»‡u Ä‘Ã³.

### 8. Updating Data

TÃ¬m hiá»ƒu cÃ¡ch **thay Ä‘á»•i dá»¯ liá»‡u** báº±ng **Server Functions**.

### 9. Caching vÃ  Revalidating

Há»c cÃ¡ch **cache dá»¯ liá»‡u** vÃ  **tá»± Ä‘á»™ng lÃ m má»›i (revalidate)** trong á»©ng dá»¥ng Next.js.

### 10. Xá»­ lÃ½ lá»—i (Error Handling)

Há»c cÃ¡ch **hiá»ƒn thá»‹ lá»—i dá»± kiáº¿n** vÃ  **xá»­ lÃ½ lá»—i khÃ´ng mong muá»‘n (uncaught exceptions)**.

### 11. CSS

KhÃ¡m phÃ¡ cÃ¡c cÃ¡ch thÃªm **CSS** vÃ o á»©ng dá»¥ng: **Tailwind CSS**, **CSS Modules**, **Global CSS**, vÃ  hÆ¡n tháº¿ ná»¯a.

### 12. Tá»‘i Æ°u hÃ³a hÃ¬nh áº£nh (Image Optimization)

TÃ¬m hiá»ƒu cÃ¡ch **tá»‘i Æ°u hÃ³a hÃ¬nh áº£nh** trong Next.js Ä‘á»ƒ tÄƒng tá»‘c Ä‘á»™ táº£i trang.

### 13. Tá»‘i Æ°u hÃ³a font (Font Optimization)

Há»c cÃ¡ch **tá»‘i Æ°u hÃ³a phÃ´ng chá»¯** nháº±m cáº£i thiá»‡n tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng.

### 14. Metadata & OG Images

TÃ¬m hiá»ƒu cÃ¡ch **thÃªm metadata** cho cÃ¡c trang vÃ  táº¡o **hÃ¬nh áº£nh chia sáº» Ä‘á»™ng (Open Graph)**.

### 15. Route Handlers & Middleware

Hiá»ƒu cÃ¡ch sá»­ dá»¥ng **Route Handlers** vÃ  **Middleware** Ä‘á»ƒ má»Ÿ rá»™ng kháº£ nÄƒng xá»­ lÃ½ cá»§a á»©ng dá»¥ng.

### 16. Triá»ƒn khai (Deploying)

Há»c cÃ¡ch **triá»ƒn khai á»©ng dá»¥ng Next.js** cá»§a báº¡n lÃªn mÃ´i trÆ°á»ng production.

### 17. NÃ¢ng cáº¥p (Upgrading)

TÃ¬m hiá»ƒu cÃ¡ch **nÃ¢ng cáº¥p** á»©ng dá»¥ng Next.js lÃªn phiÃªn báº£n má»›i nháº¥t hoáº·c **canary build**.

---

âœ… Sau khi hoÃ n thÃ nh pháº§n nÃ y, báº¡n sáº½ náº¯m Ä‘Æ°á»£c:

* Cáº¥u trÃºc cÆ¡ báº£n cá»§a má»™t á»©ng dá»¥ng Next.js
* Quy trÃ¬nh lÃ m viá»‡c tá»« cÃ i Ä‘áº·t â†’ phÃ¡t triá»ƒn â†’ triá»ƒn khai
* VÃ  ná»n táº£ng vá»¯ng cháº¯c Ä‘á»ƒ há»c cÃ¡c pháº§n nÃ¢ng cao hÆ¡n


---


# âš™ï¸ Pháº§n 1: CÃ i Ä‘áº·t (Installation)

## ğŸ§© YÃªu cáº§u há»‡ thá»‘ng (System Requirements)

TrÆ°á»›c khi báº¯t Ä‘áº§u, hÃ£y Ä‘áº£m báº£o há»‡ thá»‘ng cá»§a báº¡n Ä‘Ã¡p á»©ng cÃ¡c yÃªu cáº§u sau:

* **Node.js** phiÃªn báº£n **18.18** hoáº·c má»›i hÆ¡n
* Há»‡ Ä‘iá»u hÃ nh: **macOS**, **Windows** (bao gá»“m **WSL**) hoáº·c **Linux**

---

## âš¡ CÃ i Ä‘áº·t tá»± Ä‘á»™ng (Automatic Installation)

CÃ¡ch nhanh nháº¥t Ä‘á»ƒ khá»Ÿi táº¡o má»™t á»©ng dá»¥ng Next.js má»›i lÃ  dÃ¹ng lá»‡nh `create-next-app`,
nÃ³ sáº½ tá»± Ä‘á»™ng thiáº¿t láº­p má»i thá»© giÃºp báº¡n.

Cháº¡y lá»‡nh sau trong terminal:

```bash
npx create-next-app@latest
```

Khi cháº¡y, báº¡n sáº½ Ä‘Æ°á»£c há»i má»™t sá»‘ cÃ¢u há»i:

```
What is your project named? my-app
Would you like to use TypeScript? No / Yes
Would you like to use ESLint? No / Yes
Would you like to use Tailwind CSS? No / Yes
Would you like your code inside a `src/` directory? No / Yes
Would you like to use App Router? (recommended) No / Yes
Would you like to use Turbopack? (recommended) No / Yes
Would you like to customize the import alias (`@/*` by default)? No / Yes
What import alias would you like configured? @/*
```

Sau khi hoÃ n táº¥t, `create-next-app` sáº½:

* Táº¡o thÆ° má»¥c dá»± Ã¡n theo tÃªn báº¡n nháº­p
* CÃ i Ä‘áº·t cÃ¡c **dependencies cáº§n thiáº¿t**

---

## ğŸ§± CÃ i Ä‘áº·t thá»§ cÃ´ng (Manual Installation)

Náº¿u báº¡n muá»‘n tá»± cáº¥u hÃ¬nh, cÃ i Ä‘áº·t cÃ¡c package cáº§n thiáº¿t:

```bash
pnpm i next@latest react@latest react-dom@latest
```

*(hoáº·c dÃ¹ng npm / yarn / bun tÃ¹y mÃ´i trÆ°á»ng cá»§a báº¡n)*

> ğŸ’¡ **Ghi nhá»›:**
> App Router cá»§a Next.js sá»­ dá»¥ng phiÃªn báº£n **React Canary** â€” bao gá»“m toÃ n bá»™ thay Ä‘á»•i cá»§a React 19 vÃ  cÃ¡c tÃ­nh nÄƒng má»›i Ä‘ang Ä‘Æ°á»£c thá»­ nghiá»‡m.
> Trong khi Ä‘Ã³, **Pages Router** sáº½ dÃ¹ng Ä‘Ãºng phiÃªn báº£n React Ä‘Æ°á»£c khai bÃ¡o trong `package.json`.

---

### ğŸ§¾ ThÃªm script vÃ o `package.json`

```json
{
  "scripts": {
    "dev": "next dev --turbopack",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  }
}
```

Giáº£i thÃ­ch:

| Lá»‡nh                   | Chá»©c nÄƒng                                |
| ---------------------- | ---------------------------------------- |
| `next dev --turbopack` | Cháº¡y server phÃ¡t triá»ƒn vá»›i **Turbopack** |
| `next build`           | Build á»©ng dá»¥ng Ä‘á»ƒ triá»ƒn khai production  |
| `next start`           | Khá»Ÿi Ä‘á»™ng server production              |
| `eslint`               | Cháº¡y kiá»ƒm tra code vá»›i ESLint            |

> âš ï¸ **LÆ°u Ã½:**
> Turbopack hiá»‡n **á»•n Ä‘á»‹nh cho mÃ´i trÆ°á»ng dev**, nhÆ°ng **chá»‰ á»Ÿ tráº¡ng thÃ¡i beta cho production build**.
> Muá»‘n thá»­, cháº¡y:
>
> ```bash
> next build --turbopack
> ```
>
> Xem thÃªm táº¡i tÃ i liá»‡u **Turbopack docs**.

---

## ğŸ“‚ Táº¡o thÆ° má»¥c á»©ng dá»¥ng (Create the app directory)

Next.js sá»­ dá»¥ng **File-System Routing**, nghÄ©a lÃ  **cáº¥u trÃºc thÆ° má»¥c = cáº¥u trÃºc routes**.

1. Táº¡o thÆ° má»¥c `app/`
2. Trong Ä‘Ã³, táº¡o tá»‡p `layout.tsx` â€” **layout gá»‘c (root layout)**, báº¯t buá»™c pháº£i cÃ³
   vÃ  pháº£i chá»©a tháº» `<html>` vÃ  `<body>`.

```tsx
// app/layout.tsx
export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <body>{children}</body>
    </html>
  )
}
```

3. Táº¡o trang chá»§ `app/page.tsx` vá»›i ná»™i dung ban Ä‘áº§u:

```tsx
// app/page.tsx
export default function Page() {
  return <h1>Hello, Next.js!</h1>
}
```

> âœ… Khi ngÆ°á»i dÃ¹ng truy cáº­p `/`, cáº£ **layout.tsx** vÃ  **page.tsx** sáº½ Ä‘Æ°á»£c render.

---

### ğŸ“ Cáº¥u trÃºc thÆ° má»¥c app (App Folder Structure)

> ğŸ”¹ Náº¿u báº¡n quÃªn táº¡o `layout.tsx`, Next.js sáº½ **tá»± Ä‘á»™ng táº¡o file nÃ y** khi cháº¡y `next dev`.
> ğŸ”¹ Báº¡n **cÃ³ thá»ƒ thÃªm thÆ° má»¥c `src/`** á»Ÿ root Ä‘á»ƒ tÃ¡ch riÃªng **mÃ£ nguá»“n á»©ng dá»¥ng** vÃ  **tá»‡p cáº¥u hÃ¬nh**.

---

## ğŸ–¼ï¸ Táº¡o thÆ° má»¥c `public` (tuá»³ chá»n)

Táº¡o thÆ° má»¥c `public/` á»Ÿ gá»‘c dá»± Ã¡n Ä‘á»ƒ lÆ°u cÃ¡c **tÃ i nguyÃªn tÄ©nh (static assets)**
nhÆ° hÃ¬nh áº£nh, font chá»¯, v.v.

CÃ¡c file trong `public/` cÃ³ thá»ƒ Ä‘Æ°á»£c tham chiáº¿u trá»±c tiáº¿p báº±ng Ä‘Æ°á»ng dáº«n `/`.

VÃ­ dá»¥:

```tsx
// app/page.tsx
import Image from 'next/image'

export default function Page() {
  return <Image src="/profile.png" alt="Profile" width={100} height={100} />
}
```

File `public/profile.png` sáº½ Ä‘Æ°á»£c truy cáº­p táº¡i URL:

```
/profile.png
```

---

## ğŸ§  Cháº¡y server phÃ¡t triá»ƒn (Run the development server)

```bash
npm run dev
```

Truy cáº­p ğŸ‘‰ [http://localhost:3000](http://localhost:3000)

Báº¡n cÃ³ thá»ƒ chá»‰nh sá»­a file `app/page.tsx` vÃ  **xem káº¿t quáº£ cáº­p nháº­t ngay láº­p tá»©c** trong trÃ¬nh duyá»‡t.

---

## ğŸ§· CÃ i Ä‘áº·t TypeScript

* **PhiÃªn báº£n tá»‘i thiá»ƒu:** v4.5.2
* Next.js há»— trá»£ TypeScript **máº·c Ä‘á»‹nh**.

CÃ¡ch kÃ­ch hoáº¡t:

1. Äá»•i tÃªn báº¥t ká»³ file `.js` thÃ nh `.ts` hoáº·c `.tsx`
2. Cháº¡y lá»‡nh:

   ```bash
   npm run dev
   ```

   Next.js sáº½ tá»± Ä‘á»™ng:

   * CÃ i Ä‘áº·t dependencies cáº§n thiáº¿t
   * Táº¡o file `tsconfig.json` vá»›i cáº¥u hÃ¬nh khuyáº¿n nghá»‹

### ğŸ’¡ Plugin TypeScript cho IDE

Next.js cÃ³ **plugin TypeScript riÃªng**, giÃºp kiá»ƒm tra kiá»ƒu nÃ¢ng cao vÃ  gá»£i Ã½ code trong VSCode.

KÃ­ch hoáº¡t trong **VSCode**:

1. Má»Ÿ **Command Palette**: `Ctrl/âŒ˜ + Shift + P`
2. TÃ¬m â€œ**TypeScript: Select TypeScript Version**â€
3. Chá»n **Use Workspace Version**

---

## ğŸ§¹ CÃ i Ä‘áº·t ESLint

Next.js tÃ­ch há»£p sáºµn **ESLint**.

Náº¿u báº¡n táº¡o dá»± Ã¡n báº±ng `create-next-app`, ESLint sáº½ Ä‘Æ°á»£c tá»± Ä‘á»™ng thiáº¿t láº­p.
Náº¿u báº¡n **tá»± táº¡o dá»± Ã¡n**, thÃªm script vÃ o `package.json`:

```json
{
  "scripts": {
    "lint": "next lint"
  }
}
```

Cháº¡y lá»‡nh:

```bash
npm run lint
```

Báº¡n sáº½ tháº¥y cÃ¢u há»i cáº¥u hÃ¬nh:

```
? How would you like to configure ESLint?
â¯ Strict (recommended)
  Base
  Cancel
```

### Giáº£i thÃ­ch cÃ¡c lá»±a chá»n:

* **Strict (khuyáº¿n nghá»‹):** Cáº¥u hÃ¬nh chuáº©n Next.js + quy táº¯c nghiÃªm ngáº·t cho **Core Web Vitals**
* **Base:** Cáº¥u hÃ¬nh cÆ¡ báº£n cá»§a Next.js
* **Cancel:** Bá» qua, náº¿u báº¡n muá»‘n tá»± cáº¥u hÃ¬nh thá»§ cÃ´ng

Náº¿u chá»n **Strict** hoáº·c **Base**, Next.js sáº½:

* CÃ i Ä‘áº·t `eslint` vÃ  `eslint-config-next`
* Táº¡o file `.eslintrc.json` trong root project

> ğŸ§  Báº¡n cÃ³ thá»ƒ thay `.eslintrc.json` báº±ng **eslint.config.mjs** (Ä‘á»‹nh dáº¡ng má»›i hÆ¡n).
> Tham kháº£o cáº¥u hÃ¬nh táº¡i trang **ESLint API Reference**.

Sau khi thiáº¿t láº­p, báº¡n cÃ³ thá»ƒ cháº¡y:

```bash
next lint
```

hoáº·c

```bash
next build
```

â†’ ESLint sáº½ tá»± cháº¡y vÃ  **cháº·n build náº¿u cÃ³ lá»—i** (cáº£nh bÃ¡o thÃ¬ khÃ´ng).

---

## ğŸ§­ Cáº¥u hÃ¬nh Absolute Imports & Module Path Aliases

Next.js há»— trá»£ sáºµn tÃ¹y chá»n `"baseUrl"` vÃ  `"paths"` trong `tsconfig.json` hoáº·c `jsconfig.json`.

Nhá» Ä‘Ã³, báº¡n cÃ³ thá»ƒ import file báº±ng **Ä‘Æ°á»ng dáº«n ngáº¯n gá»n** thay vÃ¬ Ä‘i lÃªn nhiá»u cáº¥p thÆ° má»¥c.

**TrÆ°á»›c:**

```tsx
import { Button } from '../../../components/button'
```

**Sau:**

```tsx
import { Button } from '@/components/button'
```

Cáº¥u hÃ¬nh trong `tsconfig.json` hoáº·c `jsconfig.json`:

```json
{
  "compilerOptions": {
    "baseUrl": "src/"
  }
}
```

Hoáº·c thÃªm **alias** báº±ng `paths`:

```json
{
  "compilerOptions": {
    "baseUrl": "src/",
    "paths": {
      "@/styles/*": ["styles/*"],
      "@/components/*": ["components/*"]
    }
  }
}
```

> ğŸ“˜ Má»—i Ä‘Æ°á»ng dáº«n trong `paths` Ä‘á»u **tÆ°Æ¡ng Ä‘á»‘i vá»›i `baseUrl`**.

---

âœ… **Tá»•ng káº¿t pháº§n nÃ y:**

* Biáº¿t cÃ¡ch cÃ i Ä‘áº·t Next.js (tá»± Ä‘á»™ng hoáº·c thá»§ cÃ´ng)
* Cáº¥u trÃºc cÆ¡ báº£n thÆ° má»¥c `app`
* Thiáº¿t láº­p TypeScript, ESLint, vÃ  alias Ä‘Æ°á»ng dáº«n
* Cháº¡y á»©ng dá»¥ng Ä‘áº§u tiÃªn trÃªn `localhost:3000`

---


# ğŸ—ï¸ Pháº§n 2: Cáº¥u trÃºc vÃ  Tá»• chá»©c Dá»± Ã¡n (Project Structure & Organization)

Trang nÃ y cung cáº¥p **tá»•ng quan toÃ n bá»™ quy Æ°á»›c thÆ° má»¥c vÃ  tá»‡p trong Next.js**,
kÃ¨m theo **gá»£i Ã½ cÃ¡ch tá»• chá»©c dá»± Ã¡n** sao cho rÃµ rÃ ng vÃ  dá»… má»Ÿ rá»™ng.

---

## ğŸ“ Quy Æ°á»›c thÆ° má»¥c vÃ  tá»‡p (Folder and File Conventions)

### ğŸ”¹ ThÆ° má»¥c cáº¥p cao nháº¥t (Top-level folders)

| ThÆ° má»¥c  | MÃ´ táº£                                                                       |
| -------- | --------------------------------------------------------------------------- |
| `app`    | **App Router** â€“ nÆ¡i Ä‘á»‹nh nghÄ©a routing theo cáº¥u trÃºc thÆ° má»¥c               |
| `pages`  | **Pages Router** (cÅ©, dÃ nh cho backward compatibility)                      |
| `public` | Chá»©a **tÃ i nguyÃªn tÄ©nh** (áº£nh, font, v.v.)                                  |
| `src`    | (Tuá»³ chá»n) ThÆ° má»¥c chá»©a mÃ£ nguá»“n á»©ng dá»¥ng, giÃºp tÃ¡ch biá»‡t vá»›i file cáº¥u hÃ¬nh |

---

### ğŸ”¹ Tá»‡p cáº¥p cao nháº¥t (Top-level files)

| Tá»‡p                                                         | Chá»©c nÄƒng                                |
| ----------------------------------------------------------- | ---------------------------------------- |
| `next.config.js`                                            | File cáº¥u hÃ¬nh chÃ­nh cá»§a Next.js          |
| `package.json`                                              | Quáº£n lÃ½ dependencies vÃ  script           |
| `instrumentation.ts`                                        | Cáº¥u hÃ¬nh **OpenTelemetry** vÃ  tracking   |
| `middleware.ts`                                             | Äá»‹nh nghÄ©a **middleware** xá»­ lÃ½ request  |
| `.env`, `.env.local`, `.env.development`, `.env.production` | CÃ¡c biáº¿n mÃ´i trÆ°á»ng theo tá»«ng mÃ´i trÆ°á»ng |
| `.eslintrc.json`                                            | Cáº¥u hÃ¬nh **ESLint**                      |
| `.gitignore`                                                | Quy Ä‘á»‹nh file/folder bá»‹ bá» qua bá»Ÿi Git   |
| `next-env.d.ts`                                             | File khai bÃ¡o TypeScript cho Next.js     |
| `tsconfig.json` / `jsconfig.json`                           | Cáº¥u hÃ¬nh TypeScript hoáº·c JavaScript      |

---

## ğŸ§­ Routing Files

| TÃªn file       | Äá»‹nh dáº¡ng             | Chá»©c nÄƒng                            |
| -------------- | --------------------- | ------------------------------------ |
| `layout`       | `.js`, `.jsx`, `.tsx` | Layout cá»§a route                     |
| `page`         | `.js`, `.jsx`, `.tsx` | Trang hiá»ƒn thá»‹                       |
| `loading`      | `.js`, `.jsx`, `.tsx` | UI loading (React Suspense boundary) |
| `not-found`    | `.js`, `.jsx`, `.tsx` | Trang 404                            |
| `error`        | `.js`, `.jsx`, `.tsx` | UI xá»­ lÃ½ lá»—i trong route             |
| `global-error` | `.js`, `.jsx`, `.tsx` | UI xá»­ lÃ½ lá»—i toÃ n cá»¥c                |
| `route`        | `.js`, `.ts`          | Äá»‹nh nghÄ©a API endpoint              |
| `template`     | `.js`, `.jsx`, `.tsx` | Layout cÃ³ thá»ƒ re-render láº¡i          |
| `default`      | `.js`, `.jsx`, `.tsx` | Trang fallback cho parallel routes   |

---

## ğŸ§± Nested Routes (Route Lá»“ng Nhau)

| Cáº¥u trÃºc        | Ã nghÄ©a                        |
| --------------- | ------------------------------ |
| `folder`        | Route segment                  |
| `folder/folder` | Route lá»“ng nhau (nested route) |

---

## ğŸ”¢ Dynamic Routes (Route Ä‘á»™ng)

| Cáº¥u trÃºc        | MÃ´ táº£                                  |
| --------------- | -------------------------------------- |
| `[folder]`      | Route Ä‘á»™ng                             |
| `[...folder]`   | Route Ä‘á»™ng kiá»ƒu **catch-all**          |
| `[[...folder]]` | Route Ä‘á»™ng kiá»ƒu **optional catch-all** |

---

## ğŸ—‚ï¸ Route Groups & Private Folders

| Cáº¥u trÃºc   | Ã nghÄ©a                                              |
| ---------- | ---------------------------------------------------- |
| `(folder)` | NhÃ³m route â€“ **khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n URL**             |
| `_folder`  | ThÆ° má»¥c **riÃªng tÆ°** â€“ bá»‹ loáº¡i khá»i há»‡ thá»‘ng routing |

---

## ğŸ”„ Parallel & Intercepted Routes

| Cáº¥u trÃºc         | MÃ´ táº£                              |
| ---------------- | ---------------------------------- |
| `@folder`        | **Named slot** cho parallel routes |
| `(.)folder`      | Intercept cÃ¹ng cáº¥p                 |
| `(..)folder`     | Intercept má»™t cáº¥p trÃªn             |
| `(..)(..)folder` | Intercept hai cáº¥p trÃªn             |
| `(...)folder`    | Intercept tá»« root                  |

---

## ğŸ–¼ï¸ Quy Æ°á»›c Metadata Files

### ğŸ§© App Icons

| TÃªn          | Äá»‹nh dáº¡ng                                                     | MÃ´ táº£                               |
| ------------ | ------------------------------------------------------------- | ----------------------------------- |
| `favicon`    | `.ico`                                                        | Biá»ƒu tÆ°á»£ng trang web                |
| `icon`       | `.ico`, `.jpg`, `.jpeg`, `.png`, `.svg`, `.js`, `.ts`, `.tsx` | Icon á»©ng dá»¥ng (tÄ©nh hoáº·c sinh Ä‘á»™ng) |
| `apple-icon` | `.jpg`, `.jpeg`, `.png`, `.js`, `.ts`, `.tsx`                 | Icon dÃ nh riÃªng cho thiáº¿t bá»‹ Apple  |

### ğŸŒ Open Graph & Twitter Images

| TÃªn               | Äá»‹nh dáº¡ng                                             | MÃ´ táº£                          |
| ----------------- | ----------------------------------------------------- | ------------------------------ |
| `opengraph-image` | `.jpg`, `.jpeg`, `.png`, `.gif`, `.js`, `.ts`, `.tsx` | áº¢nh OG cho chia sáº» máº¡ng xÃ£ há»™i |
| `twitter-image`   | `.jpg`, `.jpeg`, `.png`, `.gif`, `.js`, `.ts`, `.tsx` | áº¢nh preview trÃªn Twitter/X     |

### ğŸ” SEO

| TÃªn       | Äá»‹nh dáº¡ng            | MÃ´ táº£                               |
| --------- | -------------------- | ----------------------------------- |
| `sitemap` | `.xml`, `.js`, `.ts` | SÆ¡ Ä‘á»“ website                       |
| `robots`  | `.txt`, `.js`, `.ts` | File robots.txt hoáº·c phiÃªn báº£n Ä‘á»™ng |

---

## ğŸ§© CÃ¡ch Tá»• Chá»©c Dá»± Ãn (Organizing Your Project)

Next.js **khÃ´ng Ã¡p Ä‘áº·t** cÃ¡ch tá»• chá»©c thÆ° má»¥c,
nhÆ°ng cung cáº¥p cÃ¡c cÃ´ng cá»¥ giÃºp báº¡n **sáº¯p xáº¿p há»£p lÃ½, dá»… má»Ÿ rá»™ng**.

---

### ğŸ§± Thá»© tá»± hierarchy cá»§a component trong route

Khi Next.js render, cÃ¡c component Ä‘áº·c biá»‡t sáº½ Ä‘Æ°á»£c xáº¿p theo thá»© tá»± sau:

```
layout.js
template.js
error.js (React error boundary)
loading.js (React suspense boundary)
not-found.js (React error boundary)
page.js hoáº·c layout lá»“ng nhau
```

â†’ CÃ¡c route **lá»“ng nhau** sáº½ Ä‘Æ°á»£c **render Ä‘á»‡ quy**,
tá»©c lÃ  layout cá»§a route cha bao ngoÃ i layout cá»§a route con.

---

### ğŸ“¦ Colocation (LÆ°u trá»¯ cá»¥c bá»™ theo route)

Trong thÆ° má»¥c `app`, **má»—i thÆ° má»¥c con lÃ  má»™t route segment**.
Cáº¥u trÃºc folder chÃ­nh lÃ  cáº¥u trÃºc URL.

Tuy nhiÃªn, route **chÆ°a Ä‘Æ°á»£c public** cho Ä‘áº¿n khi cÃ³ file `page.js` hoáº·c `route.js`.

> âœ… CÃ¡c file khÃ¡c (component, utils, lib, v.v.) cÃ³ thá»ƒ **Ä‘áº·t cÃ¹ng** trong route folder mÃ  **khÃ´ng bá»‹ public**.

VÃ­ dá»¥:

```
app/
 â””â”€â”€ dashboard/
      â”œâ”€â”€ page.tsx        âœ… route cÃ´ng khai (/dashboard)
      â”œâ”€â”€ layout.tsx
      â”œâ”€â”€ lib/            ğŸ“¦ chá»©a file ná»™i bá»™
      â””â”€â”€ component.tsx   ğŸ“„ khÃ´ng bá»‹ router xá»­ lÃ½
```

> ğŸ’¡ Báº¡n cÅ©ng cÃ³ thá»ƒ Ä‘áº·t cÃ¡c file nÃ y **ngoÃ i thÆ° má»¥c `app`** náº¿u muá»‘n.

---

### ğŸ”’ Private Folders

Táº¡o thÆ° má»¥c **private** báº±ng cÃ¡ch **Ä‘áº·t dáº¥u gáº¡ch dÆ°á»›i Ä‘áº§u tÃªn**:

```
_folderName/
```

â†’ CÃ¡c thÆ° má»¥c nÃ y **bá»‹ loáº¡i khá»i routing**
â†’ Tá»‘t cho viá»‡c:

* TÃ¡ch **logic ná»™i bá»™** khá»i logic route
* Dá»… quáº£n lÃ½ vÃ  phÃ¢n loáº¡i code trong editor
* TrÃ¡nh xung Ä‘á»™t tÃªn vá»›i quy Æ°á»›c Next.js

> âš ï¸ Náº¿u báº¡n muá»‘n route thá»±c sá»± báº¯t Ä‘áº§u báº±ng `_`,
> hÃ£y Ä‘á»•i thÃ nh `%5FfolderName` (mÃ£ hÃ³a `_` theo URL).

---

### ğŸ—ƒï¸ Route Groups

Táº¡o **route group** báº±ng cÃ¡ch **bá»c thÆ° má»¥c trong dáº¥u ngoáº·c trÃ²n**:

```
(marketing)
(shop)
(admin)
```

â†’ Route group **khÃ´ng xuáº¥t hiá»‡n trong URL**,
nhÆ°ng giÃºp **tá»• chá»©c route logic**.

**VÃ­ dá»¥:**

```
app/
 â”œâ”€â”€ (marketing)/
 â”‚    â”œâ”€â”€ layout.tsx
 â”‚    â””â”€â”€ page.tsx
 â””â”€â”€ (shop)/
      â”œâ”€â”€ layout.tsx
      â””â”€â”€ page.tsx
```

â¡ï¸ `/` váº«n hiá»ƒn thá»‹ nhÆ° cÅ©,
nhÆ°ng má»—i nhÃ³m cÃ³ **layout riÃªng biá»‡t**.

---

### ğŸ§© á»¨ng dá»¥ng nÃ¢ng cao cá»§a Route Groups

#### 1. **Opt-in Layout**

Báº¡n cÃ³ thá»ƒ chá»n chá»‰ Ã¡p dá»¥ng má»™t layout cho má»™t sá»‘ route cá»¥ thá»ƒ:

```
app/
 â”œâ”€â”€ (shop)/
 â”‚    â”œâ”€â”€ account/
 â”‚    â”œâ”€â”€ cart/
 â””â”€â”€ checkout/
```

â†’ `account` vÃ  `cart` dÃ¹ng chung layout `(shop)`,
â†’ `checkout` dÃ¹ng layout máº·c Ä‘á»‹nh.

#### 2. **Loading Skeleton cho route riÃªng**

Táº¡o nhÃ³m `/(overview)` Ä‘á»ƒ Ã¡p dá»¥ng riÃªng `loading.tsx`:

```
app/
 â””â”€â”€ dashboard/
      â””â”€â”€ (overview)/
           â”œâ”€â”€ loading.tsx
           â””â”€â”€ page.tsx
```

â†’ Skeleton loading chá»‰ Ã¡p dá»¥ng cho trang `/dashboard/overview`.

#### 3. **Multiple Root Layouts**

Muá»‘n má»—i pháº§n cá»§a site cÃ³ layout riÃªng biá»‡t?

XÃ³a `app/layout.tsx` gá»‘c vÃ  thÃªm layout trong tá»«ng nhÃ³m:

```
app/
 â”œâ”€â”€ (marketing)/layout.tsx
 â””â”€â”€ (shop)/layout.tsx
```

â†’ Má»—i pháº§n cÃ³ `<html>` vÃ  `<body>` riÃªng â€”
phÃ¹ há»£p khi báº¡n cáº§n **UI hoÃ n toÃ n khÃ¡c nhau** (vÃ­ dá»¥: pháº§n bÃ¡n hÃ ng vÃ  pháº§n landing page).

---

## ğŸ“¦ ThÆ° má»¥c `src` (tuá»³ chá»n)

Báº¡n cÃ³ thá»ƒ Ä‘áº·t toÃ n bá»™ mÃ£ nguá»“n (bao gá»“m `app/`) trong `src/`
Ä‘á»ƒ tÃ¡ch biá»‡t **mÃ£ á»©ng dá»¥ng** vÃ  **file cáº¥u hÃ¬nh á»Ÿ root**.

VÃ­ dá»¥:

```
project/
 â”œâ”€â”€ src/
 â”‚    â”œâ”€â”€ app/
 â”‚    â”œâ”€â”€ components/
 â”‚    â””â”€â”€ lib/
 â”œâ”€â”€ package.json
 â”œâ”€â”€ next.config.js
 â””â”€â”€ tsconfig.json
```

---

## ğŸ’¡ Chiáº¿n lÆ°á»£c tá»• chá»©c dá»± Ã¡n (Examples & Best Practices)

TÃ¹y vÃ o quy mÃ´ vÃ  Ä‘á»™i nhÃ³m, cÃ³ thá»ƒ chá»n 1 trong 3 chiáº¿n lÆ°á»£c sau:

### 1. **LÆ°u file ngoÃ i `app/`**

TÃ¡ch riÃªng code chia sáº» (components, lib, hooks...) á»Ÿ ngoÃ i `app`.

```
project/
 â”œâ”€â”€ app/
 â”œâ”€â”€ components/
 â”œâ”€â”€ lib/
 â”œâ”€â”€ styles/
 â””â”€â”€ utils/
```

### 2. **LÆ°u file trong `app/`**

Äáº·t toÃ n bá»™ code trong `app`, dÃ¹ng nhÆ° monorepo nhá».

```
app/
 â”œâ”€â”€ components/
 â”œâ”€â”€ hooks/
 â”œâ”€â”€ lib/
 â””â”€â”€ (routes)/
```

### 3. **Chia theo tÃ­nh nÄƒng (feature-based)**

Má»—i route cÃ³ thÆ° má»¥c riÃªng chá»©a táº¥t cáº£ logic liÃªn quan.

```
app/
 â”œâ”€â”€ dashboard/
 â”‚    â”œâ”€â”€ page.tsx
 â”‚    â”œâ”€â”€ chart.tsx
 â”‚    â”œâ”€â”€ lib/
 â”‚    â””â”€â”€ hooks/
 â””â”€â”€ settings/
      â”œâ”€â”€ page.tsx
      â””â”€â”€ form.tsx
```

---

âœ… **Tá»•ng káº¿t pháº§n nÃ y:**

* Hiá»ƒu **cáº¥u trÃºc file & thÆ° má»¥c tiÃªu chuáº©n** trong Next.js
* Biáº¿t cÃ¡ch **tá»• chá»©c route, layout, group vÃ  private folders**
* Náº¯m **chiáº¿n lÆ°á»£c tá»• chá»©c dá»± Ã¡n linh hoáº¡t** theo team hoáº·c quy mÃ´ sáº£n pháº©m

---

# ğŸ“¦ Pháº§n 3: Layouts vÃ  Pages



## ğŸ§­ 1. Tá»•ng quan vá» Routing trong Next.js

Next.js sá»­ dá»¥ng **file-system based routing** â€” tá»©c lÃ :

> Cáº¥u trÃºc folder/file trong thÆ° má»¥c `app/` chÃ­nh lÃ  cáº¥u trÃºc URL cá»§a á»©ng dá»¥ng.

VÃ­ dá»¥:

```
app/
 â”£ page.tsx              â†’ route "/"
 â”£ about/
 â”ƒ â”— page.tsx            â†’ route "/about"
 â”£ blog/
 â”ƒ â”£ page.tsx            â†’ route "/blog"
 â”ƒ â”— [slug]/
 â”ƒ   â”— page.tsx          â†’ route "/blog/:slug"
```

---

## ğŸ§© 2. Táº¡o Page cÆ¡ báº£n

ğŸ‘‰ Má»—i file `page.tsx` tÆ°Æ¡ng á»©ng vá»›i **má»™t route**.
Báº¯t buá»™c pháº£i `export default` má»™t React component.

**VÃ­ dá»¥:**

```tsx
// app/page.tsx
export default function Page() {
  return <h1>Hello Next.js!</h1>
}
```

Khi cháº¡y `npm run dev`, báº¡n cÃ³ thá»ƒ truy cáº­p táº¡i `http://localhost:3000`.

---

## ğŸ§± 3. Layout â€“ Giao diá»‡n khung dÃ¹ng chung

**Layout** lÃ  nÆ¡i Ä‘á»‹nh nghÄ©a pháº§n UI Ä‘Æ°á»£c **dÃ¹ng chung giá»¯a nhiá»u trang**, vÃ­ dá»¥: Header, Footer, Sidebar, Navigation, v.v.

### CÃ¡ch táº¡o layout

```tsx
// app/layout.tsx
export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <body>
        <header>My Website</header>
        <main>{children}</main>
        <footer>Â© 2025</footer>
      </body>
    </html>
  )
}
```

* ÄÃ¢y gá»i lÃ  **Root Layout**, báº¯t buá»™c pháº£i cÃ³ `<html>` vÃ  `<body>`.
* Má»i `page.tsx` bÃªn trong `app/` Ä‘á»u náº±m trong `children` cá»§a layout nÃ y.

---

## ğŸ§­ 4. Nested Route (Route lá»“ng nhau)

Äá»ƒ táº¡o route con, chá»‰ cáº§n **táº¡o folder con trong `app/`**.

**VÃ­ dá»¥:**

```
app/
 â”£ layout.tsx
 â”£ blog/
 â”ƒ â”— page.tsx
```

`/blog` sáº½ Ä‘Æ°á»£c render vá»›i UI:

```tsx
<html>
 <body>
   <header>My Website</header>
   <main>
     <ul>Blog content...</ul>
   </main>
   <footer>Â© 2025</footer>
 </body>
</html>
```

> Root layout luÃ´n **bao quanh toÃ n bá»™ route con**.

---

## ğŸ§© 5. Nested Layout (Layout lá»“ng nhau)

Báº¡n cÃ³ thá»ƒ Ä‘áº·t `layout.tsx` trong tá»«ng route Ä‘á»ƒ thÃªm â€œkhung riÃªngâ€ cho tá»«ng pháº§n.

**VÃ­ dá»¥:**

```
app/
 â”£ layout.tsx
 â”£ blog/
 â”ƒ â”£ layout.tsx
 â”ƒ â”— page.tsx
```

```tsx
// app/blog/layout.tsx
export default function BlogLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <section className="blog-section">
      <aside>Blog Sidebar</aside>
      <div>{children}</div>
    </section>
  )
}
```

Khi user vÃ o `/blog`, UI sáº½ lá»“ng nhÆ° sau:

```
RootLayout â†’ BlogLayout â†’ Blog Page
```

---

## ğŸ”„ 6. Dynamic Routes â€“ Route Ä‘á»™ng

Khi báº¡n muá»‘n táº¡o trang theo dá»¯ liá»‡u (vÃ­ dá»¥: `/blog/:slug`), chá»‰ cáº§n **bá»c tÃªn folder trong []**:

```
app/blog/[slug]/page.tsx
```

```tsx
// app/blog/[slug]/page.tsx
export default async function BlogPostPage({
  params,
}: {
  params: Promise<{ slug: string }>
}) {
  const { slug } = await params
  return <h1>Blog Post: {slug}</h1>
}
```

Khi truy cáº­p `/blog/hello-world`, Next.js sáº½ tá»± inject `{ slug: 'hello-world' }` vÃ o `params`.

---

## ğŸ” 7. Search Params (Query String)

Khi cáº§n láº¥y dá»¯ liá»‡u tá»« query string (vÃ­ dá»¥ `/blog?tag=react`):

```tsx
export default async function Page({
  searchParams,
}: {
  searchParams: Promise<{ [key: string]: string | string[] | undefined }>
}) {
  const filters = (await searchParams).filters
}
```

> `searchParams` giÃºp page render **dynamically** (cÃ³ request tháº­t Ä‘á»ƒ láº¥y query).

Náº¿u báº¡n chá»‰ dÃ¹ng query trÃªn client (vÃ­ dá»¥ filter local list), hÃ£y dÃ¹ng hook:

```tsx
import { useSearchParams } from 'next/navigation'

const params = useSearchParams()
const tag = params.get('tag')
```

---

## ğŸ”— 8. LiÃªn káº¿t giá»¯a cÃ¡c trang

DÃ¹ng `<Link>` thay vÃ¬ `<a>` Ä‘á»ƒ cÃ³ **client-side navigation** + **prefetching**.

```tsx
import Link from 'next/link'

export default function PostList({ posts }) {
  return (
    <ul>
      {posts.map((post) => (
        <li key={post.slug}>
          <Link href={`/blog/${post.slug}`}>{post.title}</Link>
        </li>
      ))}
    </ul>
  )
}
```

---

## ğŸ§° 9. Route Props Helpers (Next.js 15+)

Khi cháº¡y `next dev` hoáº·c `next build`, Next.js tá»± sinh **type helpers**:

```tsx
// PageProps<'/blog/[slug]'>
// LayoutProps<'/dashboard'>
```

VÃ­ dá»¥:

```tsx
export default async function Page(props: PageProps<'/blog/[slug]'>) {
  const { slug } = await props.params
  return <h1>Post: {slug}</h1>
}
```

KhÃ´ng cáº§n import â€” Next.js tá»± sinh types toÃ n cá»¥c.

---

## ğŸ“¦ Tá»•ng káº¿t:

| ThÃ nh pháº§n     | Má»¥c Ä‘Ã­ch                        | Ghi nhá»›                                  |
| -------------- | ------------------------------- | ---------------------------------------- |
| `layout.tsx`   | Giao diá»‡n bao quanh nhiá»u trang | Giá»¯ state, khÃ´ng reload khi chuyá»ƒn trang |
| `page.tsx`     | Trang giao diá»‡n thá»±c táº¿         | Má»—i route cÃ³ 1 page                      |
| `[slug]/`      | Route Ä‘á»™ng                      | Táº¡o trang tá»« dá»¯ liá»‡u                     |
| `searchParams` | Query string trong URL          | Tá»± Ä‘á»™ng dynamic render                   |
| `<Link>`       | Navigation client-side          | TÄƒng tá»‘c + prefetch                      |

---
## ğŸ§­ Pháº§n 4: LiÃªn Káº¿t vÃ  Äiá»u HÆ°á»›ng trong Next.js

Trong Next.js, cÃ¡c route Ä‘Æ°á»£c **render trÃªn server theo máº·c Ä‘á»‹nh**. Äiá»u nÃ y cÃ³ nghÄ©a lÃ  client pháº£i chá» pháº£n há»“i tá»« server trÆ°á»›c khi hiá»ƒn thá»‹ route má»›i. Tuy nhiÃªn, Next.js Ä‘Æ°á»£c trang bá»‹ sáºµn cÃ¡c tÃ­nh nÄƒng máº¡nh máº½ nhÆ° **prefetching**, **streaming**, vÃ  **chuyá»ƒn trang phÃ­a client** â€” giÃºp viá»‡c Ä‘iá»u hÆ°á»›ng trá»Ÿ nÃªn nhanh chÃ³ng vÃ  mÆ°á»£t mÃ .

TÃ i liá»‡u nÃ y giáº£i thÃ­ch cÃ¡ch **navigation hoáº¡t Ä‘á»™ng trong Next.js**, vÃ  cÃ¡ch báº¡n cÃ³ thá»ƒ **tá»‘i Æ°u hoÃ¡ tráº£i nghiá»‡m chuyá»ƒn trang**, Ä‘áº·c biá»‡t vá»›i **route Ä‘á»™ng** vÃ  **máº¡ng cháº­m**.

---

### âš™ï¸ CÃ¡ch Hoáº¡t Äá»™ng Cá»§a Navigation

Äá»ƒ hiá»ƒu rÃµ cÆ¡ cháº¿ Ä‘iá»u hÆ°á»›ng trong Next.js, báº¡n cáº§n náº¯m cÃ¡c khÃ¡i niá»‡m sau:

* **Server Rendering**
* **Prefetching**
* **Streaming**
* **Client-side transitions**

---

### ğŸ–¥ï¸ Server Rendering

Trong Next.js, **Layouts** vÃ  **Pages** lÃ  **React Server Components** theo máº·c Ä‘á»‹nh. Khi ngÆ°á»i dÃ¹ng truy cáº­p hoáº·c chuyá»ƒn trang, **Server Component Payload** Ä‘Æ°á»£c táº¡o ra á»Ÿ phÃ­a server rá»“i má»›i gá»­i xuá»‘ng client.

CÃ³ hai loáº¡i render trÃªn server:

1. **Static Rendering (Prerendering)** â€“ thá»±c hiá»‡n táº¡i thá»i Ä‘iá»ƒm build hoáº·c revalidate, vÃ  Ä‘Æ°á»£c cache láº¡i.
2. **Dynamic Rendering** â€“ thá»±c hiá»‡n ngay khi cÃ³ request tá»« client.

NhÆ°á»£c Ä‘iá»ƒm lÃ : client pháº£i **chá» pháº£n há»“i server**, khiáº¿n trang má»›i hiá»ƒn thá»‹ cháº­m.
Next.js kháº¯c phá»¥c báº±ng cÃ¡ch **prefetch trÆ°á»›c cÃ¡c route kháº£ nÄƒng cao sáº½ Ä‘Æ°á»£c truy cáº­p**, vÃ  **thá»±c hiá»‡n chuyá»ƒn trang phÃ­a client**.

> ğŸ’¡ Ghi nhá»›: HTML cÅ©ng Ä‘Æ°á»£c táº¡o ra sáºµn cho láº§n truy cáº­p Ä‘áº§u tiÃªn.

---

### âš¡ Prefetching

**Prefetching** lÃ  quÃ¡ trÃ¬nh **táº£i trÆ°á»›c dá»¯ liá»‡u route trong ná»n** trÆ°á»›c khi ngÆ°á»i dÃ¹ng click vÃ o link.
Khi ngÆ°á»i dÃ¹ng nháº¥n link, dá»¯ liá»‡u Ä‘Ã£ sáºµn sÃ ng â†’ chuyá»ƒn trang gáº§n nhÆ° **tá»©c thÃ¬**.

Next.js tá»± Ä‘á»™ng **prefetch** cÃ¡c route Ä‘Æ°á»£c liÃªn káº¿t báº±ng `<Link>` khi chÃºng **xuáº¥t hiá»‡n trong viewport**.

```tsx
import Link from 'next/link'
 
export default function Layout({ children }: { children: React.ReactNode }) {
  return (
    <html>
      <body>
        <nav>
          {/* Prefetch tá»± Ä‘á»™ng khi link xuáº¥t hiá»‡n hoáº·c Ä‘Æ°á»£c hover */}
          <Link href="/blog">Blog</Link>
          {/* KhÃ´ng prefetch */}
          <a href="/contact">Contact</a>
        </nav>
        {children}
      </body>
    </html>
  )
}
```

**Má»©c Ä‘á»™ prefetch phá»¥ thuá»™c loáº¡i route:**

* ğŸŸ¢ **Static Route** â†’ prefetch toÃ n bá»™.
* ğŸŸ¡ **Dynamic Route** â†’ bá» qua hoáº·c chá»‰ prefetch má»™t pháº§n (náº¿u cÃ³ `loading.tsx`).

Viá»‡c **giá»›i háº¡n prefetch** cho route Ä‘á»™ng giÃºp **giáº£m táº£i server**, nhÆ°ng náº¿u ngÆ°á»i dÃ¹ng pháº£i chá» pháº£n há»“i server â†’ cÃ³ thá»ƒ cáº£m giÃ¡c **á»©ng dá»¥ng bá»‹ Ä‘Æ¡**.

---

### ğŸŒŠ Streaming

**Streaming** cho phÃ©p server **gá»­i tá»«ng pháº§n ná»™i dung** cá»§a route Ä‘á»™ng xuá»‘ng client **ngay khi sáºµn sÃ ng**, thay vÃ¬ chá» render toÃ n bá»™.
Nhá» Ä‘Ã³, ngÆ°á»i dÃ¹ng **nhÃ¬n tháº¥y ná»™i dung sá»›m hÆ¡n**, dÃ¹ má»™t sá»‘ pháº§n váº«n Ä‘ang táº£i.

#### ğŸ“„ VÃ­ dá»¥: sá»­ dá»¥ng `loading.tsx`

Táº¡o file `loading.tsx` trong thÆ° má»¥c route:

```tsx
// app/dashboard/loading.tsx
export default function Loading() {
  return <LoadingSkeleton />
}
```

Next.js sáº½ **tá»± Ä‘á»™ng bao bá»c** ná»™i dung trong `page.tsx` báº±ng `<Suspense>`.
Trong lÃºc táº£i dá»¯ liá»‡u, `LoadingSkeleton` hiá»ƒn thá»‹ táº¡m thá»i, sau Ä‘Ã³ Ä‘Æ°á»£c thay tháº¿ báº±ng ná»™i dung tháº­t.

> ğŸ’¡ Báº¡n cÃ³ thá»ƒ dÃ¹ng `<Suspense>` Ä‘á»ƒ hiá»ƒn thá»‹ UI táº£i cho cáº£ component con.

**Lá»£i Ã­ch cá»§a `loading.tsx`:**

* Äiá»u hÆ°á»›ng **ngay láº­p tá»©c**, hiá»ƒn thá»‹ **pháº£n há»“i trá»±c quan**.
* **Layout chia sáº»** váº«n tÆ°Æ¡ng tÃ¡c Ä‘Æ°á»£c.
* Cáº£i thiá»‡n **Core Web Vitals**: TTFB, FCP, TTI.

---

### ğŸš€ Client-side Transitions

BÃ¬nh thÆ°á»ng, chuyá»ƒn route server-side sáº½ táº£i láº¡i toÃ n bá»™ trang, **máº¥t state**, **reset scroll**, vÃ  **giÃ¡n Ä‘oáº¡n tÆ°Æ¡ng tÃ¡c**.

Next.js kháº¯c phá»¥c Ä‘iá»u nÃ y báº±ng **chuyá»ƒn trang phÃ­a client** thÃ´ng qua `<Link>`:

* Giá»¯ nguyÃªn **layouts** vÃ  **UI chung**.
* Thay ná»™i dung hiá»‡n táº¡i báº±ng **loading state** hoáº·c **trang má»›i Ä‘Ã£ prefetch**.

Káº¿t há»£p **prefetching + streaming + client-side transition**, ta cÃ³ tráº£i nghiá»‡m **mÆ°á»£t nhÆ° á»©ng dá»¥ng client render**.

---

### ğŸ§© CÃ¡c NguyÃªn NhÃ¢n Khiáº¿n Chuyá»ƒn Trang Cháº­m

1. **Route Ä‘á»™ng khÃ´ng cÃ³ `loading.tsx`**
   â†’ Client pháº£i chá» server tráº£ vá» toÃ n bá»™ dá»¯ liá»‡u.
   âœ… Giáº£i phÃ¡p: thÃªm `loading.tsx` Ä‘á»ƒ prefetch má»™t pháº§n vÃ  hiá»ƒn thá»‹ skeleton.

2. **Thiáº¿u `generateStaticParams`**
   â†’ Route Ä‘Ã¡ng ra cÃ³ thá»ƒ prerender nhÆ°ng bá»‹ render Ä‘á»™ng.
   âœ… Giáº£i phÃ¡p: thÃªm `generateStaticParams` Ä‘á»ƒ prerender.

```tsx
export async function generateStaticParams() {
  const posts = await fetch('https://.../posts').then((res) => res.json())
  return posts.map((post) => ({ slug: post.slug }))
}
```

3. **Máº¡ng cháº­m hoáº·c khÃ´ng á»•n Ä‘á»‹nh**
   â†’ Prefetch chÆ°a hoÃ n táº¥t khi ngÆ°á»i dÃ¹ng click.
   âœ… Giáº£i phÃ¡p: thÃªm **loading indicator** báº±ng `useLinkStatus()`.

```tsx
'use client'
import { useLinkStatus } from 'next/link'

export default function LoadingIndicator() {
  const { pending } = useLinkStatus()
  return pending ? <div role="status" aria-label="Loading" className="spinner" /> : null
}
```

4. **Hydration chÆ°a hoÃ n táº¥t**
   â†’ `<Link>` cáº§n Ä‘Æ°á»£c hydrate trÆ°á»›c khi prefetch.
   âœ… Giáº£i phÃ¡p:

   * Giáº£m **bundle size** báº±ng plugin `@next/bundle-analyzer`.
   * Di chuyá»ƒn logic sang server.

---

### ğŸ”§ Táº¯t hoáº·c Giá»›i Háº¡n Prefetch

Táº¯t hoÃ n toÃ n:

```tsx
<Link prefetch={false} href="/blog">
  Blog
</Link>
```

Hoáº·c chá»‰ **prefetch khi hover** Ä‘á»ƒ tiáº¿t kiá»‡m tÃ i nguyÃªn:

```tsx
'use client'
import Link from 'next/link'
import { useState } from 'react'

function HoverPrefetchLink({ href, children }: { href: string; children: React.ReactNode }) {
  const [active, setActive] = useState(false)

  return (
    <Link href={href} prefetch={active ? null : false} onMouseEnter={() => setActive(true)}>
      {children}
    </Link>
  )
}
```

---

### ğŸ§­ Sá»­ Dá»¥ng Native History API

Next.js há»— trá»£ **tÃ­ch há»£p `window.history.pushState` vÃ  `replaceState`** mÃ  khÃ´ng reload trang, Ä‘á»“ng bá»™ vá»›i **Router cá»§a Next.js** (`usePathname`, `useSearchParams`).

#### VÃ­ dá»¥ 1: Sáº¯p xáº¿p sáº£n pháº©m (pushState)

```tsx
'use client'
import { useSearchParams } from 'next/navigation'

export default function SortProducts() {
  const searchParams = useSearchParams()

  function updateSorting(sortOrder: string) {
    const params = new URLSearchParams(searchParams.toString())
    params.set('sort', sortOrder)
    window.history.pushState(null, '', `?${params.toString()}`)
  }

  return (
    <>
      <button onClick={() => updateSorting('asc')}>Sort Ascending</button>
      <button onClick={() => updateSorting('desc')}>Sort Descending</button>
    </>
  )
}
```

#### VÃ­ dá»¥ 2: Äá»•i ngÃ´n ngá»¯ (replaceState)

```tsx
'use client'
import { usePathname } from 'next/navigation'

export function LocaleSwitcher() {
  const pathname = usePathname()

  function switchLocale(locale: string) {
    const newPath = `/${locale}${pathname}`
    window.history.replaceState(null, '', newPath)
  }

  return (
    <>
      <button onClick={() => switchLocale('en')}>English</button>
      <button onClick={() => switchLocale('fr')}>French</button>
    </>
  )
}
```

---

### ğŸ”— BÆ°á»›c Tiáº¿p Theo

* **[Link Component]** â€“ KÃ­ch hoáº¡t Ä‘iá»u hÆ°á»›ng nhanh báº±ng `next/link`.
* **[loading.js API]** â€“ Tham kháº£o chi tiáº¿t cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a `loading.tsx`.
* **[Prefetching Config]** â€“ CÃ¡ch tÃ¹y chá»‰nh cÆ¡ cháº¿ prefetch trong Next.js.

---
### ğŸ§© **Pháº§n 5: Server vÃ  Client Components trong Next.js**

Trong Next.js, **Layouts** vÃ  **Pages** lÃ  **Server Components** máº·c Ä‘á»‹nh. Äiá»u nÃ y cho phÃ©p báº¡n fetch dá»¯ liá»‡u vÃ  render má»™t pháº§n UI **trá»±c tiáº¿p trÃªn server**, cÃ³ thá»ƒ cache káº¿t quáº£ vÃ  stream dáº§n vá» client.
Khi cáº§n tÆ°Æ¡ng tÃ¡c (interactivity) hoáº·c truy cáº­p **browser APIs**, báº¡n sáº½ dÃ¹ng **Client Components** Ä‘á»ƒ thÃªm cÃ¡c chá»©c nÄƒng Ä‘á»™ng.

---

## ğŸ¯ Khi nÃ o dÃ¹ng Server hoáº·c Client Components?

Hai mÃ´i trÆ°á»ng **client** vÃ  **server** cÃ³ kháº£ nÄƒng khÃ¡c nhau. Viá»‡c tÃ¡ch biá»‡t giÃºp báº¡n táº­n dá»¥ng lá»£i tháº¿ tá»«ng bÃªn:

### ğŸ”¹ **DÃ¹ng Client Components khi báº¡n cáº§n:**

* Quáº£n lÃ½ **state** vÃ  **event handlers** nhÆ° `onClick`, `onChange`.
* Sá»­ dá»¥ng **lifecycle hooks** (`useEffect`, `useLayoutEffect`...).
* Gá»i cÃ¡c **browser APIs** nhÆ° `localStorage`, `window`, `Navigator.geolocation`.
* XÃ¢y dá»±ng **custom hooks** cho logic phÃ­a client.

### ğŸ”¹ **DÃ¹ng Server Components khi báº¡n cáº§n:**

* Fetch dá»¯ liá»‡u tá»« database hoáº·c API **gáº§n nguá»“n** hÆ¡n (nhanh, an toÃ n hÆ¡n).
* DÃ¹ng **API keys hoáº·c token bÃ­ máº­t** mÃ  khÃ´ng Ä‘á»ƒ lá»™ ra client.
* **Giáº£m kÃ­ch thÆ°á»›c JS bundle** gá»­i Ä‘áº¿n trÃ¬nh duyá»‡t.
* **TÄƒng tá»‘c Ä‘á»™ hiá»ƒn thá»‹ Ä‘áº§u tiÃªn (FCP)** vÃ  stream ná»™i dung dáº§n ra client.

---

## ğŸ§  VÃ­ dá»¥ tá»•ng quan

```tsx
// app/[id]/page.tsx â€“ Server Component
import LikeButton from '@/app/ui/like-button'
import { getPost } from '@/lib/data'

export default async function Page({ params }: { params: Promise<{ id: string }> }) {
  const { id } = await params
  const post = await getPost(id)

  return (
    <div>
      <main>
        <h1>{post.title}</h1>
        <LikeButton likes={post.likes} />
      </main>
    </div>
  )
}
```

```tsx
// app/ui/like-button.tsx â€“ Client Component
'use client'
import { useState } from 'react'

export default function LikeButton({ likes }: { likes: number }) {
  const [count, setCount] = useState(likes)
  return <button onClick={() => setCount(count + 1)}>ğŸ‘ {count}</button>
}
```

ğŸ“ `Page` (Server Component) fetch dá»¯ liá»‡u bÃ i viáº¿t, sau Ä‘Ã³ truyá»n props cho `LikeButton` (Client Component) â€” giÃºp tÃ¡ch biá»‡t render dá»¯ liá»‡u (server) vÃ  logic tÆ°Æ¡ng tÃ¡c (client).

---

## âš™ï¸ CÆ¡ cháº¿ hoáº¡t Ä‘á»™ng

### ğŸ–¥ï¸ **TrÃªn Server:**

* Next.js sá»­ dá»¥ng **React Server Component APIs** Ä‘á»ƒ tÃ¡ch cÃ´ng viá»‡c render theo tá»«ng **route segment** (layout/page).
* Káº¿t quáº£ render Ä‘Æ°á»£c Ä‘Ã³ng gÃ³i thÃ nh **React Server Component Payload (RSC Payload)** â€” má»™t Ä‘á»‹nh dáº¡ng nhá»‹ phÃ¢n nháº¹ chá»©a:

  * Káº¿t quáº£ cá»§a Server Components.
  * Vá»‹ trÃ­ vÃ  tham chiáº¿u Ä‘áº¿n cÃ¡c Client Components.
  * Props Ä‘Æ°á»£c truyá»n tá»« server â†’ client.

### ğŸŒ **TrÃªn Client (láº§n táº£i Ä‘áº§u):**

* HTML Ä‘Æ°á»£c render sáºµn Ä‘á»ƒ hiá»ƒn thá»‹ nhanh (non-interactive).
* React dÃ¹ng RSC Payload Ä‘á»ƒ **Ä‘á»“ng bá»™ cÃ¢y component** giá»¯a client vÃ  server.
* Sau Ä‘Ã³, **hydration** diá»…n ra â€” gáº¯n cÃ¡c event handlers Ä‘á»ƒ biáº¿n HTML tÄ©nh thÃ nh á»©ng dá»¥ng tÆ°Æ¡ng tÃ¡c.

> ğŸ’¡ **Hydration** = quÃ¡ trÃ¬nh React â€œthá»•i há»“nâ€ vÃ o HTML Ä‘á»ƒ trá»Ÿ nÃªn sá»‘ng Ä‘á»™ng.

---

## ğŸ” **Navigations tiáº¿p theo**

Khi ngÆ°á»i dÃ¹ng Ä‘iá»u hÆ°á»›ng giá»¯a cÃ¡c trang:

* RSC Payload Ä‘Æ°á»£c **prefetch vÃ  cache**, giÃºp Ä‘iá»u hÆ°á»›ng gáº§n nhÆ° tá»©c thÃ¬.
* Client Components Ä‘Æ°á»£c render hoÃ n toÃ n phÃ­a client mÃ  khÃ´ng cáº§n server HTML.

---

## ğŸ§© **Táº¡o Client Component**

Äáº·t dÃ²ng `'use client'` á»Ÿ Ä‘áº§u file Ä‘á»ƒ Ä‘Ã¡nh dáº¥u Ä‘Ã¢y lÃ  component cháº¡y phÃ­a client.

```tsx
// app/ui/counter.tsx
'use client'
import { useState } from 'react'

export default function Counter() {
  const [count, setCount] = useState(0)
  return (
    <div>
      <p>{count} likes</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  )
}
```

Má»i component con cá»§a file cÃ³ `'use client'` cÅ©ng tá»± Ä‘á»™ng lÃ  **Client Component**, khÃ´ng cáº§n khai bÃ¡o láº¡i.

---

## ğŸ“‰ **Giáº£m kÃ­ch thÆ°á»›c JS bundle**

HÃ£y chá»‰ dÃ¹ng `'use client'` cho **thÃ nh pháº§n tháº­t sá»± cáº§n tÆ°Æ¡ng tÃ¡c**.

VÃ­ dá»¥:

```tsx
// app/layout.tsx
import Search from './search'   // Client
import Logo from './logo'       // Server

export default function Layout({ children }: { children: React.ReactNode }) {
  return (
    <nav>
      <Logo />
      <Search />
    </nav>
  )
}
```

---

## ğŸ”— **Truyá»n dá»¯ liá»‡u giá»¯a Server â†’ Client**

Props Ä‘Æ°á»£c truyá»n nhÆ° bÃ¬nh thÆ°á»ng:

```tsx
// Server
return <LikeButton likes={post.likes} />
```

Props pháº£i **serializable** (cÃ³ thá»ƒ Ä‘Æ°á»£c React chuyá»ƒn hÃ³a thÃ nh JSON).

---

## ğŸ§± **Káº¿t há»£p Server vÃ  Client Components**

Báº¡n cÃ³ thá»ƒ lá»“ng Server Component vÃ o Client Component thÃ´ng qua `children`:

```tsx
// app/ui/modal.tsx
'use client'
export default function Modal({ children }: { children: React.ReactNode }) {
  return <div className="modal">{children}</div>
}
```

```tsx
// app/page.tsx
import Modal from './ui/modal'
import Cart from './ui/cart'

export default function Page() {
  return (
    <Modal>
      <Cart /> {/* Server Component */}
    </Modal>
  )
}
```

---

## ğŸŒˆ **React Context trong Client Components**

Server Components khÃ´ng há»— trá»£ React Context.
Báº¡n cáº§n bá»c nÃ³ trong má»™t Client Component:

```tsx
// app/theme-provider.tsx
'use client'
import { createContext } from 'react'
export const ThemeContext = createContext({})

export default function ThemeProvider({ children }: { children: React.ReactNode }) {
  return <ThemeContext.Provider value="dark">{children}</ThemeContext.Provider>
}
```

```tsx
// app/layout.tsx
import ThemeProvider from './theme-provider'

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html>
      <body>
        <ThemeProvider>{children}</ThemeProvider>
      </body>
    </html>
  )
}
```

ğŸ“Œ *LÆ°u Ã½:* NÃªn Ä‘áº·t Provider **cÃ ng sÃ¢u cÃ ng tá»‘t**, chá»‰ bao quanh pháº§n cáº§n thiáº¿t Ä‘á»ƒ tá»‘i Æ°u hiá»‡u suáº¥t.

---

## ğŸ§± **Third-party Components**

Náº¿u má»™t thÆ° viá»‡n UI (nhÆ° carousel, map, chart, v.v.) yÃªu cáº§u logic client mÃ  khÃ´ng khai bÃ¡o `'use client'`, hÃ£y **bá»c nÃ³** trong má»™t component riÃªng:

```tsx
// app/carousel.tsx
'use client'
import { Carousel } from 'acme-carousel'
export default Carousel
```

Giá» cÃ³ thá»ƒ dÃ¹ng trá»±c tiáº¿p trong Server Component mÃ  khÃ´ng lá»—i.

---

## ğŸ›¡ï¸ **TrÃ¡nh rÃ² rá»‰ biáº¿n mÃ´i trÆ°á»ng (Environment Poisoning)**

HÃ m cÃ³ chá»©a API_KEY hoáº·c token **chá»‰ nÃªn dÃ¹ng trÃªn server**:

```tsx
// lib/data.ts
import 'server-only'

export async function getData() {
  const res = await fetch('https://external-service.com/data', {
    headers: { authorization: process.env.API_KEY },
  })
  return res.json()
}
```

Náº¿u báº¡n cá»‘ import vÃ o Client Component, **Next.js sáº½ cáº£nh bÃ¡o build-time error**.
Chá»‰ biáº¿n mÃ´i trÆ°á»ng cÃ³ prefix `NEXT_PUBLIC_` má»›i Ä‘Æ°á»£c phÃ©p xuáº¥t hiá»‡n á»Ÿ client.

CÃ i Ä‘áº·t gÃ³i há»— trá»£:

```bash
pnpm add server-only
```

---

## ğŸš€ **Tá»•ng káº¿t**

| TÃ¬nh huá»‘ng                     | Component nÃªn dÃ¹ng   |
| ------------------------------ | -------------------- |
| Fetch API, DB, dÃ¹ng secrets    | **Server Component** |
| onClick, useEffect, window API | **Client Component** |
| Tá»‘i Æ°u tá»‘c Ä‘á»™ táº£i Ä‘áº§u          | **Server Component** |
| TÆ°Æ¡ng tÃ¡c ngÆ°á»i dÃ¹ng           | **Client Component** |

---

## ğŸ”œ **BÆ°á»›c tiáº¿p theo**

* ğŸ” [use client](https://nextjs.org/docs/app/building-your-application/rendering/client-components) â€” cÃ¡ch dÃ¹ng chá»‰ thá»‹ `use client` trong Next.js.
* ğŸ“˜ [Server Components](https://nextjs.org/docs/app/building-your-application/rendering/server-components) â€” hiá»ƒu sÃ¢u vá» cÃ¡ch render vÃ  stream trÃªn server.
* ğŸ§  [Hybrid Rendering Patterns] â€” káº¿t há»£p tá»‘i Æ°u giá»¯a hai loáº¡i component.

---
## ğŸ§© Pháº§n 6: **Partial Prerendering (PPR)**

> âš ï¸ **TÃ­nh nÄƒng thá»­ nghiá»‡m (experimental)**: Partial Prerendering hiá»‡n váº«n Ä‘ang trong giai Ä‘oáº¡n thá»­ nghiá»‡m vÃ  cÃ³ thá»ƒ thay Ä‘á»•i. **KhÃ´ng khuyáº¿n khÃ­ch** sá»­ dá»¥ng cho mÃ´i trÆ°á»ng production. Tuy nhiÃªn, báº¡n cÃ³ thá»ƒ thá»­ nghiá»‡m vÃ  Ä‘Ã³ng gÃ³p Ã½ kiáº¿n trÃªn GitHub cá»§a Next.js.

---

### ğŸ” KhÃ¡i niá»‡m

**Partial Prerendering (PPR)** lÃ  **chiáº¿n lÆ°á»£c káº¿t há»£p giá»¯a Static Rendering vÃ  Dynamic Rendering** trong cÃ¹ng má»™t route.
Äiá»u nÃ y giÃºp **tÄƒng tá»‘c Ä‘á»™ hiá»ƒn thá»‹ ban Ä‘áº§u (initial load)** cá»§a trang nhá» pháº§n ná»™i dung tÄ©nh Ä‘Æ°á»£c prerender sáºµn, trong khi váº«n há»— trá»£ **dá»¯ liá»‡u Ä‘á»™ng, cÃ¡ nhÃ¢n hoÃ¡** cho ngÆ°á»i dÃ¹ng.

VÃ­ dá»¥:
Má»™t trang sáº£n pháº©m cÃ³ thá»ƒ prerender **pháº§n thÃ´ng tin sáº£n pháº©m vÃ  thanh Ä‘iá»u hÆ°á»›ng** (static), cÃ²n **giá» hÃ ng vÃ  sáº£n pháº©m gá»£i Ã½** sáº½ Ä‘Æ°á»£c táº£i Ä‘á»™ng (dynamic) sau khi ngÆ°á»i dÃ¹ng má»Ÿ trang.

---

### âš™ï¸ CÃ¡ch hoáº¡t Ä‘á»™ng cá»§a PPR

Khi ngÆ°á»i dÃ¹ng truy cáº­p má»™t route:

1. **Server gá»­i xuá»‘ng má»™t â€œshellâ€ tÄ©nh** (layout, khung trang, ná»™i dung khÃ´ng phá»¥ thuá»™c request).
2. **Shell nÃ y cÃ³ cÃ¡c â€œlá»— trá»‘ngâ€ (holes)** â€” lÃ  nÆ¡i chá»©a ná»™i dung Ä‘á»™ng chÆ°a táº£i.
3. **Pháº§n ná»™i dung Ä‘á»™ng** sáº½ Ä‘Æ°á»£c **stream (truyá»n)** song song vÃ  **hiá»ƒn thá»‹ dáº§n** khi sáºµn sÃ ng.

Káº¿t quáº£: NgÆ°á»i dÃ¹ng tháº¥y pháº§n tÄ©nh gáº§n nhÆ° **ngay láº­p tá»©c**, trong khi dá»¯ liá»‡u Ä‘á»™ng váº«n **cáº­p nháº­t mÆ°á»£t mÃ ** phÃ­a sau.

---

### ğŸ§± So sÃ¡nh vá»›i cÃ¡c chiáº¿n lÆ°á»£c render khÃ¡c

#### ğŸ§Š Static Rendering

* HTML Ä‘Æ°á»£c **táº¡o sáºµn tá»« trÆ°á»›c** (build time hoáº·c revalidation).
* Dá»¯ liá»‡u khÃ´ng thay Ä‘á»•i theo request.
* Káº¿t quáº£ Ä‘Æ°á»£c **cache vÃ  chia sáº»** cho nhiá»u ngÆ°á»i dÃ¹ng.

â¡ï¸ Trong PPR: pháº§n tÄ©nh (layout, UI chung, header...) sáº½ Ä‘Æ°á»£c prerender theo cÆ¡ cháº¿ nÃ y.

#### ğŸ”¥ Dynamic Rendering

* HTML Ä‘Æ°á»£c **táº¡o má»—i láº§n request**, phá»¥c vá»¥ **ná»™i dung Ä‘á»™ng hoáº·c cÃ¡ nhÃ¢n hÃ³a**.
* Component sáº½ bá»‹ coi lÃ  â€œdynamicâ€ náº¿u sá»­ dá»¥ng:

  * `cookies`
  * `headers`
  * `connection`
  * `draftMode`
  * `searchParams`
  * `unstable_noStore`
  * `fetch({ cache: 'no-store' })`

â¡ï¸ Náº¿u component sá»­ dá»¥ng nhá»¯ng API nÃ y, Next.js sáº½ bÃ¡o lá»—i táº¡i build-time, trá»« khi báº¡n **bá»c nÃ³ báº±ng `<Suspense>`** Ä‘á»ƒ defer (hoÃ£n render) Ä‘áº¿n runtime.

---

### â³ **Suspense** trong Partial Prerendering

`React.Suspense` giÃºp **hoÃ£n render** má»™t pháº§n UI cho Ä‘áº¿n khi Ä‘iá»u kiá»‡n nÃ o Ä‘Ã³ thoáº£ mÃ£n (vÃ­ dá»¥: dá»¯ liá»‡u táº£i xong).
Trong PPR, Suspense Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ **Ä‘Ã¡nh dáº¥u ranh giá»›i Ä‘á»™ng** trong cÃ¢y component.

VÃ­ dá»¥:

```tsx
import { Suspense } from 'react'
import StaticComponent from './StaticComponent'
import DynamicComponent from './DynamicComponent'
import Fallback from './Fallback'

export const experimental_ppr = true

export default function Page() {
  return (
    <>
      <StaticComponent />
      <Suspense fallback={<Fallback />}>
        <DynamicComponent />
      </Suspense>
    </>
  )
}
```

ğŸ§  **Giáº£i thÃ­ch:**

* `StaticComponent`: Ä‘Æ°á»£c prerender tÄ©nh.
* `DynamicComponent`: sáº½ chá»‰ Ä‘Æ°á»£c render khi runtime (request-time).
* `Fallback`: giao diá»‡n táº¡m hiá»ƒn thá»‹ trong lÃºc `DynamicComponent` Ä‘ang táº£i.

---

### ğŸŒŠ **Streaming**

Streaming cho phÃ©p **chia nhá»** ná»™i dung route thÃ nh nhiá»u pháº§n vÃ  **truyá»n dáº§n vá» client** khi sáºµn sÃ ng, giÃºp ngÆ°á»i dÃ¹ng **tháº¥y trang nhanh hÆ¡n**.

PPR táº­n dá»¥ng cÆ¡ cháº¿ nÃ y Ä‘á»ƒ **stream cÃ¡c pháº§n Ä‘á»™ng trong `<Suspense>` song song**, trong khi pháº§n tÄ©nh Ä‘Ã£ cÃ³ sáºµn.
Táº¥t cáº£ Ä‘Æ°á»£c gÃ³i trong **má»™t yÃªu cáº§u HTTP duy nháº¥t**, giÃºp:
âœ… Giáº£m Ä‘á»™ trá»… máº¡ng
âœ… Cáº£i thiá»‡n hiá»‡u suáº¥t tá»•ng thá»ƒ

---

### ğŸ”§ **KÃ­ch hoáº¡t Partial Prerendering**

Trong `next.config.ts`, thÃªm cáº¥u hÃ¬nh:

```ts
import type { NextConfig } from 'next'

const nextConfig: NextConfig = {
  experimental: {
    ppr: 'incremental',
  },
}

export default nextConfig
```

* `'incremental'`: cho phÃ©p báº¡n báº­t PPR **tá»«ng route cá»¥ thá»ƒ**.

VÃ­ dá»¥ trong `/app/dashboard/layout.tsx`:

```tsx
export const experimental_ppr = true

export default function Layout({ children }: { children: React.ReactNode }) {
  return <>{children}</>
}
```

> ğŸ’¡ Ghi nhá»›:
>
> * `experimental_ppr` Ã¡p dá»¥ng cho **táº¥t cáº£ cÃ¡c layout vÃ  page con** bÃªn trong route Ä‘Ã³.
> * Náº¿u muá»‘n **táº¯t PPR cho má»™t pháº§n con**, Ä‘áº·t `experimental_ppr = false`.

---

### ğŸ§© **VÃ­ dá»¥ thá»±c táº¿**

#### 1. Dynamic APIs

Component sá»­ dá»¥ng API Ä‘á»™ng (vÃ­ dá»¥ `cookies`) sáº½ **bá»‹ render Ä‘á»™ng**, trong khi cÃ¡c pháº§n khÃ¡c váº«n prerender.

```tsx
// app/user.tsx
import { cookies } from 'next/headers'

export async function User() {
  const session = (await cookies()).get('session')?.value
  return '...'
}
```

```tsx
// app/page.tsx
import { Suspense } from 'react'
import { User, AvatarSkeleton } from './user'

export const experimental_ppr = true

export default function Page() {
  return (
    <section>
      <h1>This will be prerendered</h1>
      <Suspense fallback={<AvatarSkeleton />}>
        <User />
      </Suspense>
    </section>
  )
}
```

---

#### 2. Passing dynamic props

Má»™t component chá»‰ trá»Ÿ nÃªn â€œdynamicâ€ khi giÃ¡ trá»‹ **Ä‘Æ°á»£c truy cáº­p**, chá»© khÃ´ng pháº£i khi **Ä‘Æ°á»£c truyá»n vÃ o**.

```tsx
// app/page.tsx
import { Table, TableSkeleton } from './table'
import { Suspense } from 'react'

export default function Page({ searchParams }: { searchParams: Promise<{ sort: string }> }) {
  return (
    <section>
      <h1>This will be prerendered</h1>
      <Suspense fallback={<TableSkeleton />}>
        <Table searchParams={searchParams} />
      </Suspense>
    </section>
  )
}
```

```tsx
// app/table.tsx
export async function Table({ searchParams }: { searchParams: Promise<{ sort: string }> }) {
  const sort = (await searchParams).sort === 'true'
  return '...'
}
```

â¡ï¸ á» Ä‘Ã¢y, `<Page>` váº«n prerender tÄ©nh, cÃ²n `<Table>` trá»Ÿ thÃ nh Ä‘á»™ng khi `searchParams` Ä‘Æ°á»£c truy cáº­p.

---

### ğŸ“˜ **TÃ³m táº¯t lá»£i Ã­ch cá»§a Partial Prerendering**

âœ… Káº¿t há»£p **hiá»‡u suáº¥t cao cá»§a static rendering** vÃ  **tÃ­nh linh hoáº¡t cá»§a dynamic rendering**
âœ… GiÃºp **First Contentful Paint (FCP)** nhanh hÆ¡n
âœ… **Giáº£m thá»i gian chá» táº£i toÃ n trang**
âœ… Cho phÃ©p **stream ná»™i dung Ä‘á»™ng song song**
âœ… Há»— trá»£ tá»‘t hÆ¡n cho cÃ¡c trang cÃ³ pháº§n dá»¯ liá»‡u cÃ¡ nhÃ¢n hÃ³a

---

### ğŸš€ **BÆ°á»›c tiáº¿p theo**

TÃ¬m hiá»ƒu thÃªm:

* ğŸ”§ [`ppr`](https://nextjs.org/docs/app/api-reference/next-config-js/ppr): Cáº¥u hÃ¬nh báº­t Partial Prerendering trong Next.js
* ğŸ“º Xem video giá»›i thiá»‡u: **"Why PPR and how it works" (10 phÃºt trÃªn YouTube)**

---

## ğŸ§© **Pháº§n 7: Fetching Data (Láº¥y dá»¯ liá»‡u trong Next.js)**

Trang nÃ y sáº½ hÆ°á»›ng dáº«n báº¡n cÃ¡ch **láº¥y dá»¯ liá»‡u trong Server Components vÃ  Client Components**, cÅ©ng nhÆ° **stream** (truyá»n dá»¯ liá»‡u theo luá»“ng) cÃ¡c component phá»¥ thuá»™c vÃ o dá»¯ liá»‡u Ä‘Ã³.

---

### ğŸ”¹ 1. Fetching data trong Server Components

Trong Server Components, báº¡n cÃ³ thá»ƒ láº¥y dá»¯ liá»‡u báº±ng:

* **Fetch API**
* **ORM hoáº·c Database Client (vÃ­ dá»¥: Prisma, Drizzle, Knex, v.v.)**

---

#### ğŸ§  **Vá»›i Fetch API**

Khi dÃ¹ng Fetch API, hÃ£y biáº¿n component thÃ nh **hÃ m async** vÃ  dÃ¹ng `await fetch()` Ä‘á»ƒ gá»i dá»¯ liá»‡u.

**VÃ­ dá»¥:**

```tsx
// app/blog/page.tsx

export default async function Page() {
  const data = await fetch('https://api.vercel.app/blog')
  const posts = await data.json()

  return (
    <ul>
      {posts.map((post) => (
        <li key={post.id}>{post.title}</li>
      ))}
    </ul>
  )
}
```

**LÆ°u Ã½:**

* Káº¿t quáº£ cá»§a `fetch()` **khÃ´ng Ä‘Æ°á»£c cache máº·c Ä‘á»‹nh**.
  Tuy nhiÃªn, Next.js sáº½ **prerender route** vÃ  lÆ°u káº¿t quáº£ Ä‘á»ƒ tÄƒng hiá»‡u suáº¥t.
  Náº¿u báº¡n muá»‘n **táº¯t cache**, dÃ¹ng:

  ```js
  fetch(url, { cache: 'no-store' })
  ```
* Trong mÃ´i trÆ°á»ng dev, báº¡n cÃ³ thá»ƒ **log cÃ¡c lá»‡nh fetch** Ä‘á»ƒ debug dá»… hÆ¡n.

---

#### ğŸ§  **Vá»›i ORM hoáº·c Database**

VÃ¬ Server Components cháº¡y trÃªn **server**, báº¡n cÃ³ thá»ƒ gá»i trá»±c tiáº¿p **database** hoáº·c **ORM** má»™t cÃ¡ch an toÃ n.

**VÃ­ dá»¥:**

```tsx
// app/blog/page.tsx

import { db, posts } from '@/lib/db'

export default async function Page() {
  const allPosts = await db.select().from(posts)
  
  return (
    <ul>
      {allPosts.map((post) => (
        <li key={post.id}>{post.title}</li>
      ))}
    </ul>
  )
}
```

---

### ğŸ”¹ 2. Fetching data trong Client Components

CÃ³ hai cÃ¡ch chÃ­nh Ä‘á»ƒ láº¥y dá»¯ liá»‡u trong Client Components:

1. **DÃ¹ng Reactâ€™s `use()` hook** (React 19+)
2. **DÃ¹ng thÆ° viá»‡n bÃªn ngoÃ i** nhÆ° **SWR** hoáº·c **React Query**

---

#### ğŸ§  **Streaming vá»›i Reactâ€™s `use()` hook**

Báº¡n cÃ³ thá»ƒ stream dá»¯ liá»‡u tá»« server sang client báº±ng cÃ¡ch:

1. Gá»i dá»¯ liá»‡u **á»Ÿ Server Component**
2. Truyá»n **Promise** Ä‘Ã³ xuá»‘ng Client Component lÃ m prop

**VÃ­ dá»¥:**

```tsx
// app/blog/page.tsx

import Posts from '@/app/ui/posts'
import { Suspense } from 'react'

export default function Page() {
  const posts = getPosts() // khÃ´ng await á»Ÿ Ä‘Ã¢y

  return (
    <Suspense fallback={<div>Loading...</div>}>
      <Posts posts={posts} />
    </Suspense>
  )
}
```

Client Component:

```tsx
// app/ui/posts.tsx

'use client'
import { use } from 'react'

export default function Posts({ posts }: { posts: Promise<{ id: string; title: string }[]> }) {
  const allPosts = use(posts)

  return (
    <ul>
      {allPosts.map((post) => (
        <li key={post.id}>{post.title}</li>
      ))}
    </ul>
  )
}
```

**Giáº£i thÃ­ch:**

* `<Suspense>` hiá»ƒn thá»‹ UI fallback (â€œLoadingâ€¦â€) trong khi promise Ä‘ang chá».
* Khi dá»¯ liá»‡u sáºµn sÃ ng, component tháº­t sáº½ Ä‘Æ°á»£c hiá»ƒn thá»‹.

---

#### ğŸ§  **DÃ¹ng thÆ° viá»‡n bÃªn ngoÃ i (SWR / React Query)**

VÃ­ dá»¥ vá»›i **SWR**:

```tsx
'use client'
import useSWR from 'swr'

const fetcher = (url) => fetch(url).then((r) => r.json())

export default function BlogPage() {
  const { data, error, isLoading } = useSWR('https://api.vercel.app/blog', fetcher)

  if (isLoading) return <div>Loading...</div>
  if (error) return <div>Error: {error.message}</div>

  return (
    <ul>
      {data.map((post: { id: string; title: string }) => (
        <li key={post.id}>{post.title}</li>
      ))}
    </ul>
  )
}
```

SWR vÃ  React Query há»— trá»£:

* Caching dá»¯ liá»‡u
* Revalidation (cáº­p nháº­t láº¡i dá»¯ liá»‡u)
* Streaming

---

### ğŸ”¹ 3. Deduplicate requests & Cache dá»¯ liá»‡u

Äá»ƒ trÃ¡nh **gá»­i trÃ¹ng nhiá»u request fetch**, Next.js há»— trá»£ **request memoization**:

* CÃ¡c request `GET` hoáº·c `HEAD` cÃ³ **URL vÃ  option giá»‘ng nhau** sáº½ tá»± Ä‘á»™ng Ä‘Æ°á»£c gá»™p.
* Náº¿u khÃ´ng muá»‘n gá»™p, truyá»n vÃ o **AbortSignal**.

Hoáº·c báº¡n cÃ³ thá»ƒ dÃ¹ng **Data Cache** cá»§a Next.js:

```js
fetch(url, { cache: 'force-cache' })
```

Náº¿u báº¡n khÃ´ng dÃ¹ng `fetch()` mÃ  truy váº¥n database trá»±c tiáº¿p, báº¡n cÃ³ thá»ƒ **cache function** báº±ng React:

```ts
// app/lib/data.ts
import { cache } from 'react'
import { db, posts, eq } from '@/lib/db'

export const getPost = cache(async (id: string) => {
  const post = await db.query.posts.findFirst({
    where: eq(posts.id, parseInt(id)),
  })
})
```

---

### ğŸ”¹ 4. Streaming dá»¯ liá»‡u (Luá»“ng hoÃ¡ khi render)

Khi báº¡n dÃ¹ng `async/await` trong Server Components, Next.js sáº½ **render Ä‘á»™ng** cho má»—i request ngÆ°á»i dÃ¹ng.
Náº¿u dá»¯ liá»‡u bá»‹ cháº­m â†’ cáº£ trang bá»‹ block.

Giáº£i phÃ¡p: **Streaming HTML tá»«ng pháº§n** giÃºp:

* Cáº£i thiá»‡n thá»i gian load ban Ä‘áº§u.
* TÄƒng UX báº±ng cÃ¡ch hiá»ƒn thá»‹ ná»™i dung dáº§n.

#### âœ… CÃ³ 2 cÃ¡ch triá»ƒn khai:

1. **Táº¡o `loading.js` trong thÆ° má»¥c page**

```tsx
// app/blog/loading.tsx
export default function Loading() {
  return <div>Loading...</div>
}
```

Trang sáº½ hiá»ƒn thá»‹ layout + loading state trÆ°á»›c, sau Ä‘Ã³ má»›i render ná»™i dung tháº­t.

2. **DÃ¹ng `<Suspense>` thá»§ cÃ´ng**

```tsx
import { Suspense } from 'react'
import BlogList from '@/components/BlogList'
import BlogListSkeleton from '@/components/BlogListSkeleton'

export default function BlogPage() {
  return (
    <div>
      <header>
        <h1>Welcome to the Blog</h1>
        <p>Read the latest posts below.</p>
      </header>

      <main>
        <Suspense fallback={<BlogListSkeleton />}>
          <BlogList />
        </Suspense>
      </main>
    </div>
  )
}
```

ğŸ’¡ **Tip:**
Thiáº¿t káº¿ `Loading UI` sao cho **cÃ³ Ã½ nghÄ©a**, giÃºp ngÆ°á»i dÃ¹ng hiá»ƒu á»©ng dá»¥ng Ä‘ang pháº£n há»“i.
VÃ­ dá»¥: dÃ¹ng **skeleton**, **spinner**, hoáº·c **áº£nh bÃ¬a/tÃªn bÃ i viáº¿t máº«u**.

---

### ğŸ”¹ 5. Sequential & Parallel Fetching

#### â³ **Sequential fetching** (tuáº§n tá»±)

CÃ¡c request phá»¥ thuá»™c láº«n nhau, gá»i ná»‘i tiáº¿p (cháº­m hÆ¡n).

```tsx
const artist = await getArtist(username)
const playlists = await getArtistPlaylists(artist.id)
```

NÃªn bá»c `<Suspense>` Ä‘á»ƒ khÃ´ng block toÃ n route.

#### âš¡ **Parallel fetching** (song song)

CÃ¡c request Ä‘Æ°á»£c khá»Ÿi táº¡o cÃ¹ng lÃºc â†’ nhanh hÆ¡n.

```tsx
const artistData = getArtist(username)
const albumsData = getAlbums(username)

const [artist, albums] = await Promise.all([artistData, albumsData])
```

Náº¿u má»™t request lá»—i, toÃ n bá»™ `Promise.all` sáº½ fail â†’ dÃ¹ng `Promise.allSettled` náº¿u cáº§n trÃ¡nh crash.

---

### ğŸ”¹ 6. Preloading Data (Táº£i trÆ°á»›c dá»¯ liá»‡u)

Báº¡n cÃ³ thá»ƒ preload dá»¯ liá»‡u báº±ng cÃ¡ch gá»i hÃ m trÆ°á»›c khi component render.

```tsx
export const preload = (id: string) => {
  void getItem(id)
}
```

Hoáº·c cache utility báº±ng React:

```tsx
import { cache } from 'react'
import 'server-only'
import { getItem } from '@/lib/data'

export const getItemCached = cache(async (id: string) => {
  return await getItem(id)
})
```

---

### ğŸ“š **TÃ i liá»‡u liÃªn quan**

* [fetch() API Reference](https://nextjs.org/docs/app/api-reference/functions/fetch)
* [loading.js Reference](https://nextjs.org/docs/app/api-reference/file-conventions/loading)
* [Logging & Debugging Fetch Calls](https://nextjs.org/docs/app/api-reference/next-config-js/logging)
* [Data Security & Best Practices](https://nextjs.org/docs/app/building-your-application/data-fetching/data-security)

---

ğŸ‘‰ **Káº¿t luáº­n:**
Pháº§n *Fetching Data* lÃ  ná»n táº£ng cá»§a Next.js App Router.
NÃ³ giÃºp báº¡n:

* Káº¿t há»£p sá»©c máº¡nh **Server Rendering + Client Hydration**
* Tá»‘i Æ°u **hiá»‡u suáº¥t vÃ  UX**
* Dá»… dÃ ng quáº£n lÃ½ dá»¯ liá»‡u vá»›i **Streaming, Suspense, Cache, Preload**

---
## ğŸ§© Pháº§n 8: **Updating Data**
Pháº§n nÃ y ráº¥t quan trá»ng, vÃ¬ nÃ³ trÃ¬nh bÃ y **cÃ¡ch cáº­p nháº­t dá»¯ liá»‡u trong Next.js báº±ng Server Actions** â€” cÆ¡ cháº¿ thay tháº¿ cho API Routes hoáº·c client-side mutation truyá»n thá»‘ng. DÆ°á»›i Ä‘Ã¢y lÃ  báº£n tá»•ng há»£p chi tiáº¿t, chia thÃ nh **kiáº¿n thá»©c â€“ cÆ¡ cháº¿ hoáº¡t Ä‘á»™ng â€“ vÃ­ dá»¥ thá»±c táº¿ â€“ best practices**.

---


## ğŸ“š Tham kháº£o API (API Reference)

TÃ¬m hiá»ƒu thÃªm vá» cÃ¡c tÃ­nh nÄƒng Ä‘Æ°á»£c nháº¯c Ä‘áº¿n trong pháº§n nÃ y báº±ng cÃ¡ch Ä‘á»c tÃ i liá»‡u chi tiáº¿t cá»§a tá»«ng hÃ m dÆ°á»›i Ä‘Ã¢y.

---

### ğŸŒ€ `revalidatePath(path, type?)`

**ğŸ‘‰ Má»¥c Ä‘Ã­ch:**
Buá»™c Next.js **tÃ¡i táº¡o láº¡i (revalidate)** cache cá»§a má»™t route cá»¥ thá»ƒ, giÃºp dá»¯ liá»‡u hiá»ƒn thá»‹ luÃ´n má»›i nháº¥t sau khi báº¡n cáº­p nháº­t (táº¡o, xoÃ¡, chá»‰nh sá»­a).

**CÃº phÃ¡p:**

```ts
import { revalidatePath } from 'next/cache'

revalidatePath('/dashboard')
```

**Giáº£i thÃ­ch:**

* Khi gá»i, táº¥t cáº£ dá»¯ liá»‡u hoáº·c component trong route `/dashboard` sáº½ Ä‘Æ°á»£c render láº¡i láº§n káº¿ tiáº¿p ngÆ°á»i dÃ¹ng truy cáº­p.
* DÃ¹ng trong **Server Actions** hoáº·c **Route Handlers**.
* Tuá»³ chá»n `type` cÃ³ thá»ƒ lÃ  `'page'` hoáº·c `'layout'`, máº·c Ä‘á»‹nh lÃ  `'page'`.

**VÃ­ dá»¥:**

```ts
'use server'

import { revalidatePath } from 'next/cache'

export async function addUser(formData: FormData) {
  const name = formData.get('name')
  await db.user.create({ data: { name } })
  revalidatePath('/users') // lÃ m má»›i dá»¯ liá»‡u danh sÃ¡ch user
}
```

---

### ğŸ·ï¸ `revalidateTag(tag)`

**ğŸ‘‰ Má»¥c Ä‘Ã­ch:**
GiÃºp **tÃ¡i táº¡o cache dá»±a theo â€œtagâ€** (tháº»), thay vÃ¬ theo Ä‘Æ°á»ng dáº«n cá»¥ thá»ƒ.
Äiá»u nÃ y cho phÃ©p **revalidate nhiá»u route cÃ¹ng lÃºc**, náº¿u chÃºng cÃ³ cÃ¹ng tag cache.

**CÃº phÃ¡p:**

```ts
import { revalidateTag } from 'next/cache'

revalidateTag('posts')
```

**CÃ¡ch hoáº¡t Ä‘á»™ng:**

1. Khi báº¡n fetch dá»¯ liá»‡u, báº¡n cÃ³ thá»ƒ gáº¯n tag:

   ```ts
   fetch('https://api.example.com/posts', { next: { tags: ['posts'] } })
   ```
2. Sau Ä‘Ã³, náº¿u báº¡n cáº­p nháº­t dá»¯ liá»‡u bÃ i viáº¿t, chá»‰ cáº§n gá»i:

   ```ts
   revalidateTag('posts')
   ```

   â†’ ToÃ n bá»™ cÃ¡c component hoáº·c route nÃ o cache báº±ng tag `'posts'` sáº½ Ä‘Æ°á»£c render láº¡i vá»›i dá»¯ liá»‡u má»›i.

**VÃ­ dá»¥ thá»±c táº¿:**

```ts
'use server'
import { revalidateTag } from 'next/cache'

export async function createPost(formData: FormData) {
  await db.post.create({ data: { title: formData.get('title') } })
  revalidateTag('posts') // cáº­p nháº­t táº¥t cáº£ nÆ¡i hiá»ƒn thá»‹ danh sÃ¡ch bÃ i viáº¿t
}
```

---

### ğŸ” `redirect(url)`

**ğŸ‘‰ Má»¥c Ä‘Ã­ch:**
Chuyá»ƒn hÆ°á»›ng ngÆ°á»i dÃ¹ng Ä‘áº¿n má»™t Ä‘Æ°á»ng dáº«n khÃ¡c tá»« **Server Action** hoáº·c **Route Handler**.

**CÃº phÃ¡p:**

```ts
import { redirect } from 'next/navigation'

redirect('/dashboard')
```

**Giáº£i thÃ­ch:**

* `redirect()` lÃ  **control flow function** â€” nghÄ©a lÃ  khi Ä‘Æ°á»£c gá»i, nÃ³ sáº½ **ngá»«ng toÃ n bá»™ code phÃ­a sau**.
* DÃ¹ng Ä‘á»ƒ chuyá»ƒn hÆ°á»›ng sau khi thao tÃ¡c xong (vÃ­ dá»¥: táº¡o user, lÆ°u form, Ä‘Äƒng nháº­p thÃ nh cÃ´ng).
* Hoáº¡t Ä‘á»™ng tÆ°Æ¡ng tá»± `return redirect('/path')` trong framework khÃ¡c, nhÆ°ng á»Ÿ Ä‘Ã¢y lÃ  hÃ m Ä‘áº·c biá»‡t cá»§a Next.js.

**VÃ­ dá»¥:**

```ts
'use server'
import { redirect } from 'next/navigation'
import { revalidatePath } from 'next/cache'

export async function updateProfile(formData: FormData) {
  const username = formData.get('username')
  await db.user.update({ where: { id: 1 }, data: { username } })
  revalidatePath('/profile')
  redirect('/profile/success') // chuyá»ƒn hÆ°á»›ng Ä‘áº¿n trang thÃ´ng bÃ¡o
}
```

---

### ğŸ§  TÃ³m táº¯t nhanh:

| HÃ m                       | Má»¥c Ä‘Ã­ch                                   | Khi sá»­ dá»¥ng                                             | VÃ­ dá»¥                                          |
| ------------------------- | ------------------------------------------ | ------------------------------------------------------- | ---------------------------------------------- |
| `revalidatePath('/path')` | LÃ m má»›i cache cá»§a má»™t route cá»¥ thá»ƒ         | Khi cáº­p nháº­t dá»¯ liá»‡u áº£nh hÆ°á»Ÿng Ä‘áº¿n 1 trang              | Sau khi thÃªm user â†’ `revalidatePath('/users')` |
| `revalidateTag('tag')`    | LÃ m má»›i cache cá»§a nhiá»u route gáº¯n cÃ¹ng tag | Khi muá»‘n refresh dá»¯ liá»‡u toÃ n cá»¥c (vd: táº¥t cáº£ bÃ i viáº¿t) | Sau khi Ä‘Äƒng bÃ i â†’ `revalidateTag('posts')`    |
| `redirect('/url')`        | Chuyá»ƒn hÆ°á»›ng ngÆ°á»i dÃ¹ng sau thao tÃ¡c       | Sau khi form submit hoáº·c login                          | `redirect('/dashboard')`                       |

---

## ğŸ§­ I. KhÃ¡i niá»‡m cá»‘t lÃµi: Server Functions / Server Actions

**Server Function** lÃ  hÃ m cháº¡y **trÃªn server**, khÃ´ng bao giá» cháº¡y trÃªn client.
NÃ³ lÃ  **hÃ m async** (báº¥t Ä‘á»“ng bá»™), vÃ  chá»‰ cÃ³ thá»ƒ Ä‘Æ°á»£c gá»i qua **POST request**.

â¡ï¸ Khi dÃ¹ng Ä‘á»ƒ **thay Ä‘á»•i dá»¯ liá»‡u (update, create, delete)**, ta gá»i nÃ³ lÃ  **Server Action**.

**CÃº phÃ¡p Ä‘á»‹nh nghÄ©a:**

```ts
'use server'

export async function createPost(formData: FormData) {
  const title = formData.get('title')
  const content = formData.get('content')
  // 1ï¸âƒ£ Cáº­p nháº­t DB hoáº·c gá»i API
  // 2ï¸âƒ£ Gá»i revalidatePath('/posts') náº¿u cáº§n refresh dá»¯ liá»‡u cache
}
```

---

## ğŸ§© II. CÃ¡ch Ä‘á»‹nh nghÄ©a Server Function

### 1. Trong file riÃªng (best practice)

```ts
// app/lib/actions.ts
'use server'

export async function createPost(formData: FormData) {
  const title = formData.get('title')
  const content = formData.get('content')
  // update DB
}
```

### 2. Inline trong Server Component

```ts
export default function Page() {
  async function createPost(formData: FormData) {
    'use server'
    // update DB
  }

  return <form action={createPost}>...</form>
}
```

ğŸ‘‰ CÃ¡ch nÃ y tiá»‡n cho demo, nhÆ°ng thá»±c táº¿ **nÃªn tÃ¡ch riÃªng file `actions.ts`** Ä‘á»ƒ tÃ¡i sá»­ dá»¥ng vÃ  dá»… test.

---

## ğŸ’¡ III. Gá»i Server Function tá»« Client

### 1. Qua `<form>` hoáº·c `<button>`

```tsx
// app/ui/form.tsx
import { createPost } from '@/app/lib/actions'

export function Form() {
  return (
    <form action={createPost}>
      <input name="title" />
      <input name="content" />
      <button type="submit">Create</button>
    </form>
  )
}
```

* Khi submit, Next.js tá»± Ä‘á»™ng gá»­i POST request Ä‘áº¿n server function.
* `formData` Ä‘Æ°á»£c truyá»n vÃ o Server Function.

### 2. Gá»i tá»« event handler

```tsx
'use client'
import { incrementLike } from '@/app/lib/actions'
import { useState } from 'react'

export default function LikeButton({ initialLikes }) {
  const [likes, setLikes] = useState(initialLikes)

  return (
    <button
      onClick={async () => {
        const newLikes = await incrementLike()
        setLikes(newLikes)
      }}
    >
      Like ({likes})
    </button>
  )
}
```

---

## ğŸš€ IV. Quáº£n lÃ½ tráº¡ng thÃ¡i táº£i & pháº£n há»“i

### 1. Hiá»ƒn thá»‹ loading/pending state

DÃ¹ng **`useActionState` + startTransition**:

```tsx
'use client'
import { useActionState, startTransition } from 'react'
import { createPost } from '@/app/lib/actions'
import { LoadingSpinner } from './LoadingSpinner'

export function Button() {
  const [state, action, pending] = useActionState(createPost, false)

  return (
    <button onClick={() => startTransition(action)}>
      {pending ? <LoadingSpinner /> : 'Create Post'}
    </button>
  )
}
```

### 2. Cáº­p nháº­t cache & UI sau mutation

```ts
'use server'
import { revalidatePath } from 'next/cache'

export async function createPost(formData: FormData) {
  // update DB
  revalidatePath('/posts') // refresh láº¡i route /posts
}
```

---

## ğŸ”€ V. Redirect sau khi cáº­p nháº­t dá»¯ liá»‡u

Sau khi lÆ°u xong, cÃ³ thá»ƒ **chuyá»ƒn hÆ°á»›ng ngÆ°á»i dÃ¹ng**:

```ts
'use server'
import { revalidatePath } from 'next/cache'
import { redirect } from 'next/navigation'

export async function createPost(formData: FormData) {
  // update DB
  revalidatePath('/posts')
  redirect('/posts')
}
```

â¡ï¸ LÆ°u Ã½: `redirect()` nÃ©m ra má»™t control-flow exception â†’ code sau Ä‘Ã³ **khÃ´ng cháº¡y tiáº¿p**.

---

## ğŸª VI. LÃ m viá»‡c vá»›i Cookies trong Server Actions

```ts
'use server'
import { cookies } from 'next/headers'

export async function exampleAction() {
  const cookieStore = await cookies()

  // Ä‘á»c
  const user = cookieStore.get('user')?.value

  // set
  cookieStore.set('user', 'Tuan')

  // xÃ³a
  cookieStore.delete('user')
}
```

Má»—i khi cookie thay Ä‘á»•i, **Next.js sáº½ tá»± Ä‘á»™ng re-render** láº¡i trang hiá»‡n táº¡i vÃ  layout liÃªn quan â†’ Ä‘áº£m báº£o UI pháº£n Ã¡nh dá»¯ liá»‡u má»›i.

---

## âš™ï¸ VII. Tá»± Ä‘á»™ng gá»i Server Action trong useEffect

```tsx
'use client'
import { incrementViews } from './actions'
import { useEffect, useState, useTransition } from 'react'

export default function ViewCount({ initialViews }) {
  const [views, setViews] = useState(initialViews)
  const [isPending, startTransition] = useTransition()

  useEffect(() => {
    startTransition(async () => {
      const updated = await incrementViews()
      setViews(updated)
    })
  }, [])

  return <p>Total Views: {views}</p>
}
```

â†’ Há»¯u Ã­ch cho auto-tracking: Ä‘áº¿m lÆ°á»£t xem, analytics, cáº­p nháº­t tráº¡ng thÃ¡i khi component mount.

---

## ğŸ§  VIII. Best Practices

| TÃ¬nh huá»‘ng                   | Giáº£i phÃ¡p khuyáº¿n nghá»‹                                                  |
| ---------------------------- | ---------------------------------------------------------------------- |
| Táº¡o / xÃ³a / cáº­p nháº­t dá»¯ liá»‡u | DÃ¹ng Server Action (`'use server'`)                                    |
| Cáº­p nháº­t sau hÃ nh Ä‘á»™ng       | Gá»i `revalidatePath` hoáº·c `revalidateTag`                              |
| Cáº§n Ä‘iá»u hÆ°á»›ng               | Gá»i `redirect('/path')`                                                |
| Cáº­p nháº­t cookie / session    | DÃ¹ng API `cookies()`                                                   |
| Gá»i tá»« Client Component      | Import Server Action vÃ  gÃ¡n vÃ o `formAction`, hoáº·c gá»i trong `onClick` |
| Theo dÃµi loading             | DÃ¹ng `useActionState` hoáº·c `useTransition`                             |

---

## ğŸ§© IX. TÃ³m táº¯t luá»“ng hoáº¡t Ä‘á»™ng

```
Client click â†’ POST request Ä‘áº¿n Server Action
          â†“
Server cháº¡y hÃ m async â†’ cáº­p nháº­t DB
          â†“
Gá»i revalidate / redirect / cookies
          â†“
Next.js render láº¡i route â†’ UI cáº­p nháº­t tá»©c thÃ¬
```

---

## ğŸ§  Pháº§n 9: Caching vÃ  Revalidating

### 1ï¸âƒ£ KhÃ¡i niá»‡m tá»•ng quan

**Caching (Bá»™ nhá»› Ä‘á»‡m)** lÃ  ká»¹ thuáº­t lÆ°u trá»¯ káº¿t quáº£ cá»§a viá»‡c **fetch dá»¯ liá»‡u hoáº·c cÃ¡c tÃ­nh toÃ¡n phá»©c táº¡p** Ä‘á»ƒ nhá»¯ng láº§n gá»i tiáº¿p theo cÃ³ thá»ƒ **pháº£n há»“i nhanh hÆ¡n**, khÃ´ng cáº§n thá»±c hiá»‡n láº¡i tá»« Ä‘áº§u.

**Revalidating (TÃ¡i xÃ¡c thá»±c / LÃ m má»›i cache)** cho phÃ©p **cáº­p nháº­t dá»¯ liá»‡u Ä‘Ã£ cache** mÃ  **khÃ´ng cáº§n rebuild toÃ n bá»™ á»©ng dá»¥ng**.

Next.js cung cáº¥p má»™t bá»™ API máº¡nh máº½ Ä‘á»ƒ quáº£n lÃ½ **cache vÃ  revalidate**, bao gá»“m:

* `fetch` (má»Ÿ rá»™ng cá»§a trÃ¬nh duyá»‡t, há»— trá»£ caching)
* `unstable_cache`
* `revalidatePath`
* `revalidateTag`

---

### 2ï¸âƒ£ `fetch`

### ğŸ“¦ Caching trong `fetch`

Máº·c Ä‘á»‹nh, **fetch** trong Next.js **khÃ´ng cache dá»¯ liá»‡u**.
Náº¿u báº¡n muá»‘n cache káº¿t quáº£, hÃ£y thÃªm option:

```ts
const data = await fetch('https://...', { cache: 'force-cache' })
```

Äiá»u nÃ y giÃºp dá»¯ liá»‡u Ä‘Æ°á»£c lÆ°u láº¡i Ä‘á»ƒ tÃ¡i sá»­ dá»¥ng cho cÃ¡c request sau â†’ **hiá»‡u suáº¥t tá»‘t hÆ¡n**.

> ğŸ§© LÆ°u Ã½:
> DÃ¹ `fetch` máº·c Ä‘á»‹nh khÃ´ng cache dá»¯ liá»‡u, Next.js **váº«n prerender vÃ  cache HTML** cá»§a route Ä‘Ã³.
> Náº¿u báº¡n muá»‘n route luÃ´n Ä‘Æ°á»£c render Ä‘á»™ng, hÃ£y dÃ¹ng **`connection()` API** Ä‘á»ƒ buá»™c dynamic behavior.

---

### ğŸ” Revalidate dá»¯ liá»‡u fetch

Báº¡n cÃ³ thá»ƒ thiáº¿t láº­p **thá»i gian tá»± lÃ m má»›i cache** báº±ng option `next.revalidate`:

```ts
const data = await fetch('https://...', { next: { revalidate: 3600 } })
```

â†’ Dá»¯ liá»‡u sáº½ Ä‘Æ°á»£c **lÃ m má»›i sau má»—i 3600 giÃ¢y (1 giá»)**, thay vÃ¬ cá»‘ Ä‘á»‹nh.

---

ğŸ“˜ **Xem thÃªm:** [API Reference - fetch](#api-reference)

---

### 3ï¸âƒ£ `unstable_cache`

### ğŸ’¡ CÃ´ng dá»¥ng

`unstable_cache` cho phÃ©p báº¡n **cache káº¿t quáº£ cá»§a báº¥t ká»³ async function nÃ o**, vÃ­ dá»¥ nhÆ°:

* Truy váº¥n database
* Gá»i API tá»‘n chi phÃ­
* TÃ­nh toÃ¡n phá»©c táº¡p

### ğŸ§± CÃ¡ch sá»­ dá»¥ng

Giáº£ sá»­ báº¡n cÃ³ function query dá»¯ liá»‡u ngÆ°á»i dÃ¹ng:

```ts
import { db } from '@/lib/db'

export async function getUserById(id: string) {
  return db.select().from(users).where(eq(users.id, id)).then(res => res[0])
}
```

Báº¡n cÃ³ thá»ƒ **cache** káº¿t quáº£ báº±ng `unstable_cache`:

```ts
import { unstable_cache } from 'next/cache'
import { getUserById } from '@/app/lib/data'

export default async function Page({ params }: { params: Promise<{ userId: string }> }) {
  const { userId } = await params

  const getCachedUser = unstable_cache(
    async () => getUserById(userId),
    [userId] // key cache duy nháº¥t
  )

  const user = await getCachedUser()
}
```

---

### âš™ï¸ Tuá»³ chá»n nÃ¢ng cao

`unstable_cache` cháº¥p nháº­n **tham sá»‘ thá»© ba** â€” cáº¥u hÃ¬nh cache:

```ts
const getCachedUser = unstable_cache(
  async () => getUserById(userId),
  [userId],
  {
    tags: ['user'],
    revalidate: 3600, // sau 1 tiáº¿ng revalidate láº¡i cache
  }
)
```

â†’ Báº¡n cÃ³ thá»ƒ **Ä‘á»‹nh danh cache báº±ng tag** Ä‘á»ƒ revalidate dá»… dÃ ng.

ğŸ“˜ **Xem thÃªm:** [API Reference - unstable_cache](#api-reference)

---

### 4ï¸âƒ£ `revalidateTag`

### ğŸ·ï¸ Má»¥c Ä‘Ã­ch

`revalidateTag` giÃºp **lÃ m má»›i toÃ n bá»™ cache cÃ³ cÃ¹ng tag**, thÆ°á»ng dÃ¹ng **sau khi cáº­p nháº­t dá»¯ liá»‡u**.

### ğŸ”§ CÃ¡ch dÃ¹ng vá»›i `fetch`

Khi fetch, báº¡n cÃ³ thá»ƒ gáº¯n tag:

```ts
export async function getUserById(id: string) {
  const data = await fetch(`https://...`, {
    next: { tags: ['user'] },
  })
}
```

Hoáº·c khi cache database query báº±ng `unstable_cache`:

```ts
export const getUserById = unstable_cache(
  async (id: string) => db.query.users.findFirst({ where: eq(users.id, id) }),
  ['user'],
  { tags: ['user'] }
)
```

### ğŸ”„ LÃ m má»›i cache theo tag

Sau khi cáº­p nháº­t dá»¯ liá»‡u, gá»i:

```ts
import { revalidateTag } from 'next/cache'

export async function updateUser(id: string) {
  // Cáº­p nháº­t dá»¯ liá»‡u
  revalidateTag('user') // lÃ m má»›i toÃ n bá»™ cache gáº¯n tag 'user'
}
```

âœ… Æ¯u Ä‘iá»ƒm:

* Chá»‰ cáº§n gá»i 1 láº§n â†’ lÃ m má»›i táº¥t cáº£ nÆ¡i cÃ³ `tag = 'user'`.
* KhÃ´ng cáº§n chá»‰ rÃµ route.

ğŸ“˜ **Xem thÃªm:** [API Reference - revalidateTag](#api-reference)

---

### 5ï¸âƒ£ `revalidatePath`

### ğŸ“ Má»¥c Ä‘Ã­ch

`revalidatePath` giÃºp **lÃ m má»›i cache cá»§a má»™t route cá»¥ thá»ƒ** sau khi cÃ³ thay Ä‘á»•i dá»¯ liá»‡u.

### ğŸ“¦ VÃ­ dá»¥

```ts
import { revalidatePath } from 'next/cache'

export async function updateUser(id: string) {
  // Cáº­p nháº­t dá»¯ liá»‡u
  revalidatePath('/profile') // lÃ m má»›i route /profile
}
```

ğŸ“˜ **Xem thÃªm:** [API Reference - revalidatePath](#api-reference)

---

### 6ï¸âƒ£ ğŸ§­ Tá»•ng káº¿t so sÃ¡nh

| API                                    | Má»¥c Ä‘Ã­ch                      | Pháº¡m vi áº£nh hÆ°á»Ÿng          | Khi dÃ¹ng                         |
| -------------------------------------- | ----------------------------- | -------------------------- | -------------------------------- |
| `fetch(..., { next: { revalidate } })` | Revalidate tá»± Ä‘á»™ng sau X giÃ¢y | Má»™t request cá»¥ thá»ƒ         | DÃ¹ng khi fetch API               |
| `unstable_cache()`                     | Cache káº¿t quáº£ function        | Theo key hoáº·c tag          | Khi truy váº¥n DB hoáº·c logic náº·ng  |
| `revalidateTag('tag')`                 | LÃ m má»›i cache theo tag        | Nhiá»u route dÃ¹ng chung tag | Sau khi cáº­p nháº­t dá»¯ liá»‡u         |
| `revalidatePath('/path')`              | LÃ m má»›i cache 1 route cá»¥ thá»ƒ  | Má»™t route tÄ©nh             | Sau khi mutate data cá»§a route Ä‘Ã³ |

---

### 7ï¸âƒ£ ğŸ“˜ API Reference (Tham kháº£o API)

TÃ¬m hiá»ƒu chi tiáº¿t hÆ¡n vá» cÃ¡c API Ä‘Æ°á»£c nháº¯c Ä‘áº¿n trong chÆ°Æ¡ng nÃ y:

| API                                                                                    | MÃ´ táº£                                                                           |
| -------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------- |
| [`fetch`](https://nextjs.org/docs/app/api-reference/functions/fetch)                   | TÃ i liá»‡u má»Ÿ rá»™ng cho hÃ m fetch trong Next.js, bao gá»“m cache, revalidate, vÃ  tag |
| [`unstable_cache`](https://nextjs.org/docs/app/api-reference/functions/unstable_cache) | CÃ¡ch cache káº¿t quáº£ function, Ä‘á»‹nh nghÄ©a tag, vÃ  revalidate thá»§ cÃ´ng             |
| [`revalidatePath`](https://nextjs.org/docs/app/api-reference/functions/revalidatePath) | LÃ m má»›i cache cá»§a route cá»¥ thá»ƒ                                                  |
| [`revalidateTag`](https://nextjs.org/docs/app/api-reference/functions/revalidateTag)   | LÃ m má»›i cache cá»§a toÃ n bá»™ route/fetch cÃ³ cÃ¹ng tag                               |

---
## Pháº§n 10. Xá»­ lÃ½ Lá»—i (Error Handling)

Trong Next.js, lá»—i Ä‘Æ°á»£c chia thÃ nh **hai loáº¡i chÃ­nh**:

1. **Expected Errors (Lá»—i dá»± kiáº¿n)** â€“ nhá»¯ng lá»—i cÃ³ thá»ƒ xáº£y ra trong quÃ¡ trÃ¬nh váº­n hÃ nh bÃ¬nh thÆ°á»ng.
2. **Uncaught Exceptions (Lá»—i khÃ´ng báº¯t Ä‘Æ°á»£c)** â€“ nhá»¯ng lá»—i báº¥t ngá», thÆ°á»ng do bug trong á»©ng dá»¥ng.

Pháº§n nÃ y hÆ°á»›ng dáº«n cÃ¡ch xá»­ lÃ½ tá»«ng loáº¡i lá»—i Ä‘Ãºng chuáº©n trong á»©ng dá»¥ng Next.js.

---

## ğŸ§© 1. Handling Expected Errors (Xá»­ lÃ½ lá»—i dá»± kiáº¿n)

ÄÃ¢y lÃ  nhá»¯ng lá»—i cÃ³ thá»ƒ **dá»± Ä‘oÃ¡n vÃ  xá»­ lÃ½ rÃµ rÃ ng**, cháº³ng háº¡n:

* Lá»—i form validation phÃ­a server.
* Request tháº¥t báº¡i do dá»¯ liá»‡u sai hoáº·c khÃ´ng Ä‘á»§ quyá»n.

CÃ¡c lá»—i nÃ y **khÃ´ng nÃªn throw error**, mÃ  nÃªn **tráº£ vá» giÃ¡ trá»‹ pháº£n há»“i** chá»©a thÃ´ng tin lá»—i.

### ğŸ§  Trong Server Functions

DÃ¹ng hook `useActionState` Ä‘á»ƒ xá»­ lÃ½ lá»—i dá»± kiáº¿n mÃ  khÃ´ng cáº§n `try/catch`.

**VÃ­ dá»¥:**

```tsx
'use server'

export async function createPost(prevState: any, formData: FormData) {
  const title = formData.get('title')
  const content = formData.get('content')

  const res = await fetch('https://api.vercel.app/posts', {
    method: 'POST',
    body: { title, content },
  })
  const json = await res.json()

  if (!res.ok) {
    return { message: 'Failed to create post' }
  }
}
```

**á» phÃ­a Client:**

```tsx
'use client'

import { useActionState } from 'react'
import { createPost } from '@/app/actions'

const initialState = { message: '' }

export function Form() {
  const [state, formAction, pending] = useActionState(createPost, initialState)

  return (
    <form action={formAction}>
      <label htmlFor="title">Title</label>
      <input type="text" id="title" name="title" required />

      <label htmlFor="content">Content</label>
      <textarea id="content" name="content" required />

      {state?.message && <p aria-live="polite">{state.message}</p>}
      <button disabled={pending}>Create Post</button>
    </form>
  )
}
```

---

### ğŸ§± Trong Server Components

Khi gá»i `fetch`, báº¡n cÃ³ thá»ƒ xá»­ lÃ½ lá»—i trá»±c tiáº¿p trong component:

```tsx
export default async function Page() {
  const res = await fetch(`https://...`)
  const data = await res.json()

  if (!res.ok) {
    return 'There was an error.'
  }

  return '...'
}
```

---

### ğŸš« Not Found Pages

Khi dá»¯ liá»‡u khÃ´ng tá»“n táº¡i, dÃ¹ng `notFound()` Ä‘á»ƒ chuyá»ƒn Ä‘áº¿n UI 404 tÃ¹y chá»‰nh.

**VÃ­ dá»¥:**

```tsx
import { getPostBySlug } from '@/lib/posts'

export default async function Page({ params }: { params: { slug: string } }) {
  const { slug } = await params
  const post = getPostBySlug(slug)

  if (!post) notFound()

  return <div>{post.title}</div>
}
```

**File `app/blog/[slug]/not-found.tsx`:**

```tsx
export default function NotFound() {
  return <div>404 - Page Not Found</div>
}
```

---

## âš ï¸ 2. Handling Uncaught Exceptions (Xá»­ lÃ½ lá»—i khÃ´ng báº¯t Ä‘Æ°á»£c)

ÄÃ¢y lÃ  lá»—i **khÃ´ng mong Ä‘á»£i**, thÆ°á»ng do bug trong code.
Next.js xá»­ lÃ½ chÃºng báº±ng **Error Boundaries** â€” UI fallback cho pháº§n bá»‹ crash.

### ğŸ§© Nested Error Boundaries

Táº¡o file `error.tsx` trong báº¥t ká»³ segment nÃ o Ä‘á»ƒ Ä‘á»‹nh nghÄ©a error boundary cho segment Ä‘Ã³.

```tsx
'use client'

import { useEffect } from 'react'

export default function Error({
  error,
  reset,
}: {
  error: Error & { digest?: string }
  reset: () => void
}) {
  useEffect(() => {
    console.error(error)
  }, [error])

  return (
    <div>
      <h2>Something went wrong!</h2>
      <button onClick={() => reset()}>Try again</button>
    </div>
  )
}
```

ğŸ“˜ **LÆ°u Ã½:**

* Lá»—i sáº½ **bong bÃ³ng lÃªn (bubble up)** Ä‘áº¿n error boundary gáº§n nháº¥t.
* CÃ³ thá»ƒ Ä‘áº·t nhiá»u error boundaries cho tá»«ng pháº§n cá»§a cÃ¢y component.

---

### âš¡ Lá»—i trong Event Handlers

Error boundaries **khÃ´ng báº¯t lá»—i trong event handlers hoáº·c async code**, vÃ¬ chÃºng xáº£y ra sau khi render.

Cáº§n **tá»± báº¯t lá»—i báº±ng `try/catch`** vÃ  lÆ°u vÃ o `useState` hoáº·c `useReducer`.

```tsx
'use client'
import { useState } from 'react'

export function Button() {
  const [error, setError] = useState<Error | null>(null)

  const handleClick = () => {
    try {
      throw new Error('Exception')
    } catch (reason) {
      setError(reason as Error)
    }
  }

  if (error) {
    return <p>{error.message}</p>
  }

  return <button type="button" onClick={handleClick}>Click me</button>
}
```

---

### ğŸŒ€ Lá»—i trong `useTransition`

CÃ¡c lá»—i trong `startTransition` **sáº½ tá»± Ä‘á»™ng bubble lÃªn error boundary gáº§n nháº¥t**.

```tsx
'use client'
import { useTransition } from 'react'

export function Button() {
  const [pending, startTransition] = useTransition()

  const handleClick = () =>
    startTransition(() => {
      throw new Error('Exception')
    })

  return <button onClick={handleClick}>Click me</button>
}
```

---

## ğŸŒ 3. Global Errors (Lá»—i ToÃ n Cá»¥c)

Náº¿u lá»—i xáº£y ra á»Ÿ cáº¥p root (ngoÃ i má»i segment), hÃ£y xá»­ lÃ½ báº±ng `app/global-error.tsx`.

**LÆ°u Ã½:** File nÃ y **pháº£i chá»©a cáº£ `<html>` vÃ  `<body>`** vÃ¬ nÃ³ thay tháº¿ layout gá»‘c.

```tsx
'use client'

export default function GlobalError({
  error,
  reset,
}: {
  error: Error & { digest?: string }
  reset: () => void
}) {
  return (
    <html>
      <body>
        <h2>Something went wrong!</h2>
        <button onClick={() => reset()}>Try again</button>
      </body>
    </html>
  )
}
```

---

## ğŸ“š API Reference

TÃ¬m hiá»ƒu thÃªm vá» cÃ¡c thÃ nh pháº§n Ä‘Æ°á»£c nháº¯c trong pháº§n nÃ y táº¡i API Reference:

| API              | MÃ´ táº£                                          |
| ---------------- | ---------------------------------------------- |
| **redirect**     | API Reference cho hÃ m `redirect()`             |
| **error.js**     | API Reference cho file Ä‘áº·c biá»‡t `error.js`     |
| **notFound**     | API Reference cho hÃ m `notFound()`             |
| **not-found.js** | API Reference cho file Ä‘áº·c biá»‡t `not-found.js` |

---

ğŸ‘‰ **TÃ³m táº¯t ngáº¯n:**

| Loáº¡i lá»—i            | CÃ¡ch xá»­ lÃ½                                |
| ------------------- | ----------------------------------------- |
| Expected Errors     | Tráº£ vá» giÃ¡ trá»‹ lá»—i (khÃ´ng throw)          |
| Uncaught Exceptions | DÃ¹ng `error.tsx` lÃ m error boundary       |
| 404                 | DÃ¹ng `notFound()` vÃ  file `not-found.tsx` |
| Global Errors       | DÃ¹ng `global-error.tsx` á»Ÿ root app        |

---
## Pháº§n 11. CSS trong Next.js

Next.js há»— trá»£ nhiá»u cÃ¡ch Ä‘á»ƒ báº¡n **táº¡o vÃ  quáº£n lÃ½ style** cho á»©ng dá»¥ng â€” tá»« Tailwind Ä‘áº¿n CSS Modules, Global CSS, Sass, hay CSS-in-JS. DÆ°á»›i Ä‘Ã¢y lÃ  hÆ°á»›ng dáº«n chi tiáº¿t tá»«ng phÆ°Æ¡ng phÃ¡p.

---

## ğŸŒˆ 1. Tailwind CSS

**Tailwind CSS** lÃ  framework CSS "utility-first", cung cáº¥p hÃ ng nghÃ¬n class nhá» giÃºp báº¡n **xÃ¢y dá»±ng giao diá»‡n nhanh, tÃ¹y chá»‰nh linh hoáº¡t** mÃ  khÃ´ng cáº§n viáº¿t CSS thá»§ cÃ´ng.

### ğŸš€ CÃ i Ä‘áº·t

```bash
pnpm add -D tailwindcss @tailwindcss/postcss
```

### âš™ï¸ Cáº¥u hÃ¬nh PostCSS

**postcss.config.mjs**

```js
export default {
  plugins: {
    '@tailwindcss/postcss': {},
  },
}
```

### ğŸ“¥ Import Tailwind vÃ o global CSS

**app/globals.css**

```css
@import 'tailwindcss';
```

### ğŸ§© Import vÃ o Root Layout

**app/layout.tsx**

```tsx
import './globals.css'

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <body>{children}</body>
    </html>
  )
}
```

### âœ¨ Sá»­ dá»¥ng class Tailwind

**app/page.tsx**

```tsx
export default function Page() {
  return (
    <main className="flex min-h-screen flex-col items-center justify-between p-24">
      <h1 className="text-4xl font-bold">Welcome to Next.js!</h1>
    </main>
  )
}
```

> ğŸ’¡ **LÆ°u Ã½:** Náº¿u cáº§n há»— trá»£ trÃ¬nh duyá»‡t cÅ© hÆ¡n, hÃ£y xem hÆ°á»›ng dáº«n cÃ i Tailwind CSS v3.

---

## ğŸ§© 2. CSS Modules

**CSS Modules** cho phÃ©p báº¡n viáº¿t CSS cÃ³ pháº¡m vi **cá»¥c bá»™** cho tá»«ng component.
Next.js sáº½ **tá»± Ä‘á»™ng táº¡o tÃªn class duy nháº¥t**, trÃ¡nh trÃ¹ng láº·p giá»¯a cÃ¡c file.

### VÃ­ dá»¥

**app/blog/blog.module.css**

```css
.blog {
  padding: 24px;
}
```

**app/blog/page.tsx**

```tsx
import styles from './blog.module.css'

export default function Page() {
  return <main className={styles.blog}></main>
}
```

---

## ğŸŒ 3. Global CSS

DÃ¹ng Global CSS cho cÃ¡c style **Ã¡p dá»¥ng toÃ n bá»™ á»©ng dá»¥ng** (nhÆ° reset, layout tá»•ng thá»ƒâ€¦).

### VÃ­ dá»¥

**app/global.css**

```css
body {
  padding: 20px 20px 60px;
  max-width: 680px;
  margin: 0 auto;
}
```

**app/layout.tsx**

```tsx
import './global.css'

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <body>{children}</body>
    </html>
  )
}
```

> ğŸ’¡ **Khuyáº¿n nghá»‹:**
>
> * Chá»‰ nÃªn dÃ¹ng Global CSS cho style tháº­t sá»± toÃ n cá»¥c (reset, typographyâ€¦).
> * DÃ¹ng **Tailwind** cho háº§u háº¿t nhu cáº§u giao diá»‡n.
> * DÃ¹ng **CSS Modules** khi cáº§n style riÃªng cho component.

---

## ğŸ“¦ 4. External Stylesheets

Báº¡n cÃ³ thá»ƒ import CSS tá»« cÃ¡c package ngoÃ i (nhÆ° Bootstrap, Ant Design, v.v.) ngay trong `app`:

**app/layout.tsx**

```tsx
import 'bootstrap/dist/css/bootstrap.css'

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <body className="container">{children}</body>
    </html>
  )
}
```

> ğŸ’¡ Trong React 19, báº¡n cÅ©ng cÃ³ thá»ƒ dÃ¹ng tháº» `<link rel="stylesheet" href="...">`.

---

## ğŸ”€ 5. Ordering & Merging CSS

Next.js tá»± Ä‘á»™ng **tá»‘i Æ°u CSS trong production build**:

* Há»£p nháº¥t vÃ  chia nhá» CSS theo route.
* Thá»© tá»± import trong file quyáº¿t Ä‘á»‹nh thá»© tá»± Ã¡p dá»¥ng style.

**VÃ­ dá»¥:**

```tsx
// page.tsx
import { BaseButton } from './base-button'
import styles from './page.module.css'

export default function Page() {
  return <BaseButton className={styles.primary} />
}
```

```tsx
// base-button.tsx
import styles from './base-button.module.css'

export function BaseButton() {
  return <button className={styles.primary} />
}
```

â†’ `base-button.module.css` sáº½ Ä‘Æ°á»£c load **trÆ°á»›c** `page.module.css`.

---

## âœ… 6. Best Practices

| Khuyáº¿n nghá»‹                                              | Giáº£i thÃ­ch                  |
| -------------------------------------------------------- | --------------------------- |
| ğŸ’¡ Import global styles vÃ  Tailwind á»Ÿ root layout        | Äáº£m báº£o load nháº¥t quÃ¡n      |
| ğŸ§± DÃ¹ng Tailwind cho háº§u háº¿t nhu cáº§u                     | Tiá»‡n, gá»n, responsive       |
| ğŸ¯ CSS Modules cho component riÃªng biá»‡t                  | TrÃ¡nh trÃ¹ng láº·p class       |
| ğŸ§© DÃ¹ng quy táº¯c Ä‘áº·t tÃªn thá»‘ng nháº¥t (`<name>.module.css`) | Dá»… tÃ¬m vÃ  báº£o trÃ¬           |
| â™»ï¸ Gom style dÃ¹ng chung thÃ nh component                  | TrÃ¡nh import trÃ¹ng láº·p      |
| ğŸš« Táº¯t linter tá»± sáº¯p xáº¿p import                          | Äá»ƒ giá»¯ thá»© tá»± CSS chÃ­nh xÃ¡c |
| âš™ï¸ DÃ¹ng `cssChunking` trong `next.config.js` náº¿u cáº§n     | Kiá»ƒm soÃ¡t cÃ¡ch tÃ¡ch CSS     |

---

## ğŸ§ª 7. Development vs Production

| MÃ´i trÆ°á»ng                    | Äáº·c Ä‘iá»ƒm                                                       |
| ----------------------------- | -------------------------------------------------------------- |
| **Development (`next dev`)**  | Fast Refresh cáº­p nháº­t CSS tá»©c thÃ¬                              |
| **Production (`next build`)** | Tá»± Ä‘á»™ng minify, code-split vÃ  chá»‰ load CSS cáº§n thiáº¿t cho route |
| **CSS hoáº¡t Ä‘á»™ng khi JS táº¯t**  | âœ… CÃ³ trong production, âŒ KhÃ´ng trong dev                       |
| **KhÃ¡c biá»‡t thá»© tá»± CSS**      | CÃ³ thá»ƒ khÃ¡c giá»¯a dev vÃ  build â€” luÃ´n test láº¡i vá»›i `next build` |

---

## ğŸ”— 8. Next Steps (BÆ°á»›c tiáº¿p theo)

| Chá»§ Ä‘á»              | MÃ´ táº£                                 |
| ------------------- | ------------------------------------- |
| **Tailwind CSS v3** | DÃ nh cho trÃ¬nh duyá»‡t cÅ© hÆ¡n           |
| **Sass**            | Viáº¿t style nÃ¢ng cao vá»›i biáº¿n, mixin   |
| **CSS-in-JS**       | DÃ¹ng styled-components, Emotion, v.v. |

---

## ğŸ§­ Pháº§n 12: Image Optimization trong Next.js

Image Optimization lÃ  **tÃ­nh nÄƒng tá»‘i Æ°u hÃ³a hÃ¬nh áº£nh tá»± Ä‘á»™ng** cá»§a Next.js thÃ´ng qua component `<Image>` â€” giÃºp website cá»§a báº¡n **táº£i nhanh hÆ¡n, á»•n Ä‘á»‹nh hÆ¡n vÃ  dÃ¹ng Ã­t bÄƒng thÃ´ng hÆ¡n**.

---

## ğŸš€ 1. Tá»•ng quan

Component `<Image>` má»Ÿ rá»™ng tháº» HTML `<img>` truyá»n thá»‘ng vá»›i cÃ¡c lá»£i Ã­ch:

| Lá»£i Ã­ch                  | MÃ´ táº£                                                                                                                          |
| ------------------------ | ------------------------------------------------------------------------------------------------------------------------------ |
| ğŸª„ **Size optimization** | Tá»± Ä‘á»™ng cung cáº¥p hÃ¬nh áº£nh Ä‘Ãºng kÃ­ch thÆ°á»›c cho tá»«ng thiáº¿t bá»‹ (desktop, tablet, mobile) vÃ  dÃ¹ng Ä‘á»‹nh dáº¡ng hiá»‡n Ä‘áº¡i nhÆ° **WebP**. |
| âš–ï¸ **Visual stability**  | Tá»± Ä‘á»™ng ngÄƒn â€œlayout shiftâ€ (dá»‹ch chuyá»ƒn bá»‘ cá»¥c khi hÃ¬nh áº£nh táº£i).                                                             |
| âš¡ **Faster loading**     | Há»— trá»£ **lazy loading** (chá»‰ táº£i áº£nh khi ngÆ°á»i dÃ¹ng cuá»™n tá»›i).                                                                 |
| ğŸ§© **Asset flexibility** | CÃ³ thá»ƒ resize áº£nh tá»« **local hoáº·c remote server** (VD: S3, CDN).                                                               |

---

## ğŸ’» 2. CÃ¡ch sá»­ dá»¥ng cÆ¡ báº£n

```tsx
import Image from 'next/image'

export default function Page() {
  return <Image src="/profile.png" alt="Avatar" width={500} height={500} />
}
```

> âœ… Má»i hÃ¬nh áº£nh **pháº£i cÃ³ `alt`**, vÃ  **cáº§n chá»‰ rÃµ `width`, `height`** (trá»« khi dÃ¹ng `fill`).

---

## ğŸ—‚ï¸ 3. Local Images

Táº¥t cáº£ hÃ¬nh áº£nh tÄ©nh (static) nÃªn lÆ°u trong thÆ° má»¥c `/public`.

**Cáº¥u trÃºc thÆ° má»¥c:**

```
project-root/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ page.tsx
â””â”€â”€ public/
    â””â”€â”€ profile.png
```

**VÃ­ dá»¥:**

```tsx
import Image from 'next/image'

export default function Page() {
  return (
    <Image
      src="/profile.png"
      alt="Picture of the author"
      width={500}
      height={500}
    />
  )
}
```

---

## ğŸ§  4. Static Import (tá»± Ä‘á»™ng nháº­n kÃ­ch thÆ°á»›c vÃ  placeholder)

Náº¿u báº¡n `import` áº£nh trá»±c tiáº¿p, Next.js sáº½ **tá»± xÃ¡c Ä‘á»‹nh width, height, vÃ  blurDataURL**.

```tsx
import Image from 'next/image'
import ProfileImage from './profile.png'

export default function Page() {
  return (
    <Image
      src={ProfileImage}
      alt="Picture of the author"
      placeholder="blur" // tÃ¹y chá»n: hiá»ƒn thá»‹ hiá»‡u á»©ng má» trong khi táº£i
    />
  )
}
```

> LÃºc nÃ y báº¡n **khÃ´ng cáº§n chá»‰ rÃµ width/height**, vÃ¬ Next.js tá»± xá»­ lÃ½.

---

## ğŸŒ 5. Remote Images

Khi áº£nh náº±m á»Ÿ **mÃ¡y chá»§ bÃªn ngoÃ i** (VD: S3, Cloudinary...), báº¡n chá»‰ cáº§n dÃ¹ng URL:

```tsx
import Image from 'next/image'

export default function Page() {
  return (
    <Image
      src="https://s3.amazonaws.com/my-bucket/profile.png"
      alt="Picture of the author"
      width={500}
      height={500}
    />
  )
}
```

âš ï¸ **ChÃº Ã½:**

* Pháº£i chá»‰ Ä‘á»‹nh `width` vÃ  `height` vÃ¬ Next.js **khÃ´ng thá»ƒ biáº¿t kÃ­ch thÆ°á»›c trÆ°á»›c**.
* Hoáº·c dÃ¹ng `fill` Ä‘á»ƒ áº£nh tá»± chiáº¿m toÃ n bá»™ khung cha:

  ```tsx
  <div className="relative w-64 h-64">
    <Image src="..." alt="..." fill style={{ objectFit: 'cover' }} />
  </div>
  ```

---

## ğŸ”’ 6. Cáº¥u hÃ¬nh cho áº£nh tá»« server ngoÃ i (`next.config.ts`)

Äá»ƒ báº£o máº­t, báº¡n cáº§n **khai bÃ¡o rÃµ domain nÃ o Ä‘Æ°á»£c phÃ©p load áº£nh**:

```ts
import type { NextConfig } from 'next'

const config: NextConfig = {
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: 's3.amazonaws.com',
        port: '',
        pathname: '/my-bucket/**',
      },
    ],
  },
}

export default config
```

> ğŸ” Äiá»u nÃ y giÃºp trÃ¡nh bá»‹ láº¡m dá»¥ng (vÃ­ dá»¥ attacker chÃ¨n link áº£nh Ä‘á»™c háº¡i).

---

## ğŸ“¸ 7. Tá»•ng káº¿t best practices

âœ… **LuÃ´n cung cáº¥p `alt`** (há»— trá»£ SEO & Accessibility).
âœ… **DÃ¹ng `placeholder="blur"`** Ä‘á»ƒ cáº£i thiá»‡n UX.
âœ… **Äáº·t áº£nh trong `/public` hoáº·c dÃ¹ng CDN an toÃ n.**
âœ… **TrÃ¡nh áº£nh quÃ¡ lá»›n** â€“ resize vá» kÃ­ch thÆ°á»›c phÃ¹ há»£p trÆ°á»›c khi deploy.
âœ… **Káº¿t há»£p vá»›i `fill` + Tailwind hoáº·c CSS Ä‘á»ƒ responsive.**

---

## ğŸ§© 8. Demo nÃ¢ng cao â€” Responsive Image Gallery

```tsx
import Image from 'next/image'

const images = [
  '/gallery1.jpg',
  '/gallery2.jpg',
  '/gallery3.jpg',
  '/gallery4.jpg',
]

export default function Gallery() {
  return (
    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 p-6">
      {images.map((src, i) => (
        <div key={i} className="relative w-full aspect-square">
          <Image
            src={src}
            alt={`Gallery image ${i + 1}`}
            fill
            className="rounded-xl object-cover"
            placeholder="blur"
            blurDataURL="/blur-placeholder.png"
          />
        </div>
      ))}
    </div>
  )
}
```

> ğŸ”¥ áº¢nh tá»± tá»‘i Æ°u theo kÃ­ch thÆ°á»›c thiáº¿t bá»‹, táº£i má» trÆ°á»›c khi rÃµ nÃ©t, khÃ´ng gÃ¢y nháº£y layout.

---

## ğŸ“š API References

* [Image Component Docs](https://nextjs.org/docs/app/api-reference/components/image)
* [next.config.js: images](https://nextjs.org/docs/app/api-reference/next-config-js/images)

---

## ğŸ§­ Pháº§n 13: Font Optimization trong Next.js

Tá»‘i Æ°u font lÃ  **bÆ°á»›c quan trá»ng Ä‘á»ƒ cáº£i thiá»‡n tá»‘c Ä‘á»™ táº£i trang, trÃ¡nh layout shift, vÃ  tÄƒng Ä‘iá»ƒm hiá»‡u nÄƒng Lighthouse**.
Next.js há»— trá»£ Ä‘iá»u nÃ y **tá»± Ä‘á»™ng** thÃ´ng qua module `next/font` â€“ giÃºp **tá»± host font**, **loáº¡i bá» request ra ngoÃ i (Google Fonts)** vÃ  **giáº£m layout shift (FOUT/FOIT)**.

---

## âš™ï¸ 1. CÆ¡ cháº¿ hoáº¡t Ä‘á»™ng

Khi báº¡n dÃ¹ng `next/font`, Next.js sáº½:

* **Tá»± táº£i vÃ  host font** (Google Font hoáº·c local font) trong chÃ­nh project.
* **ChÃ¨n font-face CSS tá»± Ä‘á»™ng**, khÃ´ng cáº§n import file `.woff2` thá»§ cÃ´ng.
* **Tá»‘i Æ°u preload, subset, vÃ  display swap** Ä‘á»ƒ táº£i nhanh vÃ  khÃ´ng nhÃ¡y chá»¯.
* **KhÃ´ng gá»­i request Ä‘áº¿n Google** â†’ tÄƒng tÃ­nh riÃªng tÆ° (privacy).

---

## ğŸš€ 2. Sá»­ dá»¥ng Google Fonts

Import font trá»±c tiáº¿p tá»« `next/font/google`:

```tsx
import { Geist } from 'next/font/google'

const geist = Geist({
  subsets: ['latin'], // chá»n táº­p kÃ½ tá»± cáº§n dÃ¹ng (latin, vietnamese,...)
})

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en" className={geist.className}>
      <body>{children}</body>
    </html>
  )
}
```

âœ… **Giáº£i thÃ­ch:**

* `subsets`: Giá»›i háº¡n bá»™ kÃ½ tá»± (giÃºp giáº£m dung lÆ°á»£ng táº£i).
* `geist.className`: Tá»± Ä‘á»™ng sinh CSS class gáº¯n font vÃ o `<html>` hoáº·c `<body>`.
* Font Ä‘Æ°á»£c lÆ°u trong build â†’ khÃ´ng cÃ²n request Ä‘áº¿n fonts.googleapis.com.

---

## ğŸ’ª 3. DÃ¹ng variable fonts (khuyáº¿n nghá»‹)

Variable font cho phÃ©p **nhiá»u Ä‘á»™ Ä‘áº­m (weight)** vÃ  **kiá»ƒu dÃ¡ng (style)** trong 1 file duy nháº¥t â†’ nháº¹ hÆ¡n, linh hoáº¡t hÆ¡n.

VÃ­ dá»¥ vá»›i Roboto variable font:

```tsx
import { Roboto_Flex } from 'next/font/google'

const roboto = Roboto_Flex({
  subsets: ['latin'],
})

export default function Layout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en" className={roboto.className}>
      <body>{children}</body>
    </html>
  )
}
```

Náº¿u font khÃ´ng há»— trá»£ variable, báº¡n cáº§n chá»‰ rÃµ `weight`:

```tsx
import { Roboto } from 'next/font/google'

const roboto = Roboto({
  weight: '400',
  subsets: ['latin'],
})
```

---

## ğŸ  4. DÃ¹ng Local Fonts (font tá»± lÆ°u trong project)

Khi báº¡n cÃ³ file `.woff2`, `.ttf`â€¦ riÃªng (vÃ­ dá»¥ táº£i tá»« Fontshare, Typekit, hay custom font), dÃ¹ng `next/font/local`:

```tsx
import localFont from 'next/font/local'

const myFont = localFont({
  src: './my-font.woff2', // Ä‘Æ°á»ng dáº«n tÆ°Æ¡ng Ä‘á»‘i trong app/
})

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en" className={myFont.className}>
      <body>{children}</body>
    </html>
  )
}
```

---

## ğŸ§© 5. Sá»­ dá»¥ng nhiá»u biáº¿n thá»ƒ (multi-weight & style)

Náº¿u báº¡n cÃ³ nhiá»u file cho cÃ¹ng 1 font family:

```tsx
const roboto = localFont({
  src: [
    { path: './Roboto-Regular.woff2', weight: '400', style: 'normal' },
    { path: './Roboto-Italic.woff2', weight: '400', style: 'italic' },
    { path: './Roboto-Bold.woff2', weight: '700', style: 'normal' },
    { path: './Roboto-BoldItalic.woff2', weight: '700', style: 'italic' },
  ],
})
```

> ğŸ”¥ LÃºc build, Next.js sáº½ **tá»± generate `@font-face`** vÃ  preload há»£p lÃ½ cho tá»«ng biáº¿n thá»ƒ.

---

## ğŸ¨ 6. Sá»­ dá»¥ng trong component riÃªng láº»

Font Ä‘Æ°á»£c **scoped theo component**, nÃªn báº¡n cÃ³ thá»ƒ Ã¡p dá»¥ng font riÃªng cho tá»«ng pháº§n UI:

```tsx
import { Inter, Playfair_Display } from 'next/font/google'

const inter = Inter({ subsets: ['latin'] })
const playfair = Playfair_Display({ subsets: ['latin'] })

export default function Page() {
  return (
    <main className={inter.className}>
      <h1 className={playfair.className}>Welcome</h1>
      <p>This paragraph uses Inter font.</p>
    </main>
  )
}
```

> âœ… Dá»… dÃ ng dÃ¹ng nhiá»u font mÃ  khÃ´ng áº£nh hÆ°á»Ÿng toÃ n bá»™ trang.

---

## ğŸ§  7. So sÃ¡nh hiá»‡u nÄƒng

| CÃ¡ch dÃ¹ng                   | Æ¯u Ä‘iá»ƒm                           | NhÆ°á»£c Ä‘iá»ƒm                                |
| --------------------------- | --------------------------------- | ----------------------------------------- |
| Import CSS Google Fonts     | Dá»… dÃ¹ng                           | CÃ³ request ra ngoÃ i â†’ cháº­m, thiáº¿u báº£o máº­t |
| DÃ¹ng file `.woff2` thá»§ cÃ´ng | Kiá»ƒm soÃ¡t tá»‘t                     | Cáº§n tá»± config preload vÃ  font-face        |
| **âœ… `next/font` (tá»± host)** | Hiá»‡u nÄƒng cao, tá»± tá»‘i Æ°u, private | Cáº§n build láº¡i Ä‘á»ƒ thÃªm font má»›i            |

---

## ğŸ’¡ 8. Best Practices

âœ… DÃ¹ng **variable fonts** náº¿u cÃ³ thá»ƒ (VD: Inter Variable, Roboto Flex).
âœ… Giá»›i háº¡n `subsets` Ä‘á»ƒ giáº£m dung lÆ°á»£ng táº£i.
âœ… Äáº·t font táº¡i **Root Layout** náº¿u muá»‘n Ã¡p dá»¥ng toÃ n app.
âœ… Vá»›i ngÃ´n ngá»¯ cÃ³ kÃ½ tá»± Ä‘áº·c biá»‡t (VD: tiáº¿ng Viá»‡t), nÃªn thÃªm `subsets: ['latin', 'vietnamese']`.
âœ… Khi dÃ¹ng local font, Æ°u tiÃªn Ä‘á»‹nh dáº¡ng `.woff2` (nháº¹, Ä‘Æ°á»£c há»— trá»£ tá»‘t nháº¥t).

---

## ğŸ“š 9. TÃ i liá»‡u tham kháº£o

* [Next.js Font Optimization Docs](https://nextjs.org/docs/app/building-your-application/optimizing/fonts)
* [next/font/google API Reference](https://nextjs.org/docs/app/api-reference/next-font-google)
* [next/font/local API Reference](https://nextjs.org/docs/app/api-reference/next-font-local)

---

## ğŸ§­ Pháº§n 14: Metadata vÃ  áº¢nh OG trong Next.js

Next.js cung cáº¥p **Metadata API** Ä‘á»ƒ giÃºp báº¡n Ä‘á»‹nh nghÄ©a **thÃ´ng tin SEO**, **chia sáº» máº¡ng xÃ£ há»™i (Open Graph, Twitter Cards)**, vÃ  **favicon/sitemap/robots.txt** má»™t cÃ¡ch dá»… dÃ ng, cÃ³ thá»ƒ **tÄ©nh hoáº·c Ä‘á»™ng**.
Táº¥t cáº£ Ä‘Æ°á»£c tá»± Ä‘á»™ng chuyá»ƒn thÃ nh cÃ¡c tháº» `<head>` tÆ°Æ¡ng á»©ng trong HTML cá»§a má»—i trang.

---

## ğŸ§© 1. Tá»•ng quan Metadata API

Next.js há»— trá»£ ba cÃ¡ch Ä‘á»ƒ khai bÃ¡o metadata:

1. **Äá»‘i tÆ°á»£ng tÄ©nh `metadata`** â€” dÃ¹ng cho metadata cá»‘ Ä‘á»‹nh.
2. **HÃ m Ä‘á»™ng `generateMetadata()`** â€” cho metadata phá»¥ thuá»™c vÃ o dá»¯ liá»‡u.
3. **CÃ¡c file Ä‘áº·c biá»‡t (special files)** â€” nhÆ° `favicon.ico`, `opengraph-image.png`, `sitemap.xml`, v.v.

> âš™ï¸ CÃ¡c API nÃ y **chá»‰ hoáº¡t Ä‘á»™ng trong Server Components** (khÃ´ng dÃ¹ng trong Client Components).

---

## ğŸ§± 2. Tháº» meta máº·c Ä‘á»‹nh

Ngay cáº£ khi báº¡n khÃ´ng Ä‘á»‹nh nghÄ©a gÃ¬, Next.js váº«n luÃ´n thÃªm 2 tháº» cÆ¡ báº£n:

```html
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
```

CÃ¡c tháº» khÃ¡c (title, description, og:image, ...) sáº½ Ä‘Æ°á»£c sinh ra dá»±a trÃªn `metadata` hoáº·c `generateMetadata`.

---

## ğŸ—‚ï¸ 3. Static Metadata (TÄ©nh)

DÃ¹ng khi thÃ´ng tin cá»‘ Ä‘á»‹nh (vd: tiÃªu Ä‘á», mÃ´ táº£ blog chung).

**VÃ­ dá»¥:**

```tsx
// app/blog/layout.tsx
import type { Metadata } from 'next'

export const metadata: Metadata = {
  title: 'My Blog',
  description: 'Chia sáº» bÃ i viáº¿t vá» cÃ´ng nghá»‡ vÃ  láº­p trÃ¬nh.',
}

export default function Layout({ children }: { children: React.ReactNode }) {
  return <section>{children}</section>
}
```

âœ… Khi build, Next.js sáº½ tá»± Ä‘á»™ng thÃªm `<title>` vÃ  `<meta name="description">` vÃ o `<head>`.

---

## âš¡ 4. Dynamic Metadata (Äá»™ng)

DÃ¹ng khi metadata phá»¥ thuá»™c dá»¯ liá»‡u (VD: má»—i bÃ i viáº¿t cÃ³ title/description riÃªng).

```tsx
// app/blog/[slug]/page.tsx
import type { Metadata } from 'next'

export async function generateMetadata({ params }: { params: { slug: string } }): Promise<Metadata> {
  const post = await fetch(`https://api.vercel.app/blog/${params.slug}`).then(res => res.json())

  return {
    title: post.title,
    description: post.description,
  }
}

export default function Page({ params }: { params: { slug: string } }) {
  return <div>{params.slug}</div>
}
```

> ğŸ§  LÆ°u Ã½: `generateMetadata()` cháº¡y **trÃªn server**.
> Metadata Ä‘Æ°á»£c stream riÃªng náº¿u trang render Ä‘á»™ng (giÃºp táº£i nhanh hÆ¡n).

---

## ğŸ” 5. Streaming Metadata

Khi `generateMetadata()` máº¥t thá»i gian (do fetch dá»¯ liá»‡u), Next.js **stream metadata riÃªng** vÃ  chÃ¨n vÃ o HTML ngay khi sáºµn sÃ ng â€” khÃ´ng cháº·n viá»‡c render giao diá»‡n.

Static pages thÃ¬ metadata Ä‘Æ°á»£c build sáºµn nÃªn khÃ´ng dÃ¹ng cÆ¡ cháº¿ nÃ y.

---

## ğŸ§  6. Tá»‘i Æ°u request báº±ng `cache()`

Náº¿u báº¡n fetch cÃ¹ng 1 dá»¯ liá»‡u cho **metadata** vÃ  **page content**, hÃ£y cache láº¡i Ä‘á»ƒ khÃ´ng fetch 2 láº§n:

```tsx
// app/lib/data.ts
import { cache } from 'react'
import { db } from '@/app/lib/db'

export const getPost = cache(async (slug: string) => {
  return await db.query.posts.findFirst({ where: { slug } })
})
```

```tsx
// app/blog/[slug]/page.tsx
import { getPost } from '@/app/lib/data'

export async function generateMetadata({ params }: { params: { slug: string } }) {
  const post = await getPost(params.slug)
  return { title: post.title, description: post.description }
}

export default async function Page({ params }: { params: { slug: string } }) {
  const post = await getPost(params.slug)
  return <div>{post.title}</div>
}
```

---

## ğŸ“ 7. File-based Metadata (Metadata qua file Ä‘áº·c biá»‡t)

| File                                        | Má»¥c Ä‘Ã­ch                |
| ------------------------------------------- | ----------------------- |
| `favicon.ico`, `icon.jpg`, `apple-icon.jpg` | Biá»ƒu tÆ°á»£ng trang        |
| `opengraph-image.jpg`, `twitter-image.jpg`  | áº¢nh preview khi chia sáº» |
| `robots.txt`                                | Quy Ä‘á»‹nh crawler (SEO)  |
| `sitemap.xml`                               | SÆ¡ Ä‘á»“ trang (SEO)       |

> Báº¡n cÃ³ thá»ƒ táº¡o tÄ©nh hoáº·c **generate báº±ng code** (VD: sitemap Ä‘á»™ng).

---

## ğŸ§¿ 8. Favicons

Táº¡o file `favicon.ico` táº¡i **thÆ° má»¥c gá»‘c cá»§a app/**.

```
app/
â”œâ”€â”€ favicon.ico
â”œâ”€â”€ layout.tsx
â””â”€â”€ page.tsx
```

Hoáº·c generate báº±ng code (xem thÃªm pháº§n [Favicon Docs](https://nextjs.org/docs/app/api-reference/file-conventions/metadata/app-icons)).

---

## ğŸŒ„ 9. Static OG Images

OG (Open Graph) images hiá»ƒn thá»‹ khi báº¡n chia sáº» link trÃªn máº¡ng xÃ£ há»™i (Facebook, Zalo, Twitter...).

Táº¡o file:

```
app/opengraph-image.png
```

â†’ Ã¡p dá»¥ng cho toÃ n site.

Hoáº·c:

```
app/blog/opengraph-image.jpg
```

â†’ chá»‰ Ã¡p dá»¥ng cho route `/blog`.

> ğŸ“¸ Há»— trá»£ Ä‘á»‹nh dáº¡ng `.jpg`, `.jpeg`, `.png`, `.gif`.

---

## ğŸ§¬ 10. Dynamic OG Images

DÃ¹ng **ImageResponse** Ä‘á»ƒ sinh OG image Ä‘á»™ng (theo dá»¯ liá»‡u tá»«ng trang):

```tsx
// app/blog/[slug]/opengraph-image.ts
import { ImageResponse } from 'next/og'
import { getPost } from '@/app/lib/data'

export const size = { width: 1200, height: 630 }
export const contentType = 'image/png'

export default async function Image({ params }: { params: { slug: string } }) {
  const post = await getPost(params.slug)

  return new ImageResponse(
    (
      <div
        style={{
          fontSize: 128,
          background: 'white',
          width: '100%',
          height: '100%',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
        }}
      >
        {post.title}
      </div>
    )
  )
}
```

âœ… Há»— trá»£ CSS cÆ¡ báº£n: `flexbox`, `absolute`, `text-align`, `background`, `font`.
âŒ KhÃ´ng há»— trá»£ layout nÃ¢ng cao (nhÆ° `grid`).

> Tham kháº£o thá»­ nghiá»‡m trá»±c tiáº¿p táº¡i [Vercel OG Playground](https://og-playground.vercel.app/).

---

## âš™ï¸ 11. API Reference

| API                                                                                         | MÃ´ táº£                                                              |
| ------------------------------------------------------------------------------------------- | ------------------------------------------------------------------ |
| [`generateMetadata`](https://nextjs.org/docs/app/api-reference/functions/generate-metadata) | ThÃªm metadata Ä‘á»™ng (SEO, chia sáº» máº¡ng xÃ£ há»™i)                      |
| [`generateViewport`](https://nextjs.org/docs/app/api-reference/functions/generate-viewport) | Sinh viewport meta tag Ä‘á»™ng                                        |
| [`ImageResponse`](https://nextjs.org/docs/app/api-reference/functions/image-response)       | Sinh áº£nh OG Ä‘á»™ng tá»« JSX                                            |
| **Metadata Files**                                                                          | Quy táº¯c file Ä‘áº·c biá»‡t (favicon, OG image, robots.txt, sitemap.xml) |
| `favicon`, `apple-icon`, `icon`                                                             | Biá»ƒu tÆ°á»£ng website                                                 |
| `opengraph-image`, `twitter-image`                                                          | áº¢nh chia sáº» máº¡ng xÃ£ há»™i                                            |
| `robots.txt`                                                                                | Äiá»u hÆ°á»›ng crawler                                                 |
| `sitemap.xml`                                                                               | Liá»‡t kÃª cáº¥u trÃºc trang web cho SEO                                 |

---

## ğŸ§­ TÃ³m táº¯t nhanh

âœ… DÃ¹ng `metadata` (tÄ©nh) cho layout vÃ  page cÆ¡ báº£n.
âœ… DÃ¹ng `generateMetadata()` khi cáº§n fetch dá»¯ liá»‡u.
âœ… DÃ¹ng file-based metadata (`opengraph-image.png`, `favicon.ico`) cho OG image & biá»ƒu tÆ°á»£ng.
âœ… DÃ¹ng `ImageResponse` Ä‘á»ƒ táº¡o OG image Ä‘á»™ng.
âœ… Tá»‘i Æ°u SEO vÃ  chia sáº» máº¡ng xÃ£ há»™i dá»… dÃ ng mÃ  khÃ´ng cáº§n thá»§ cÃ´ng chá»‰nh `<head>`.

---

## ğŸ§© Pháº§n 15: Route Handlers vÃ  Middleware

### 1. Route Handlers

**Route Handlers** cho phÃ©p báº¡n táº¡o cÃ¡c **custom request handlers** (trÃ¬nh xá»­ lÃ½ yÃªu cáº§u tuá»³ chá»‰nh) cho tá»«ng route, sá»­ dá»¥ng **Web Request vÃ  Response API** tiÃªu chuáº©n.

---

#### ğŸ—‚ Route.js â€” File Ä‘áº·c biá»‡t

> ğŸ’¡ **Ghi nhá»›:** Route Handlers **chá»‰ kháº£ dá»¥ng trong thÆ° má»¥c `app/`**.
> ChÃºng tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i **API Routes** trong thÆ° má»¥c `pages/`, nghÄ©a lÃ  báº¡n **khÃ´ng cáº§n dÃ¹ng API Routes vÃ  Route Handlers cÃ¹ng lÃºc.**

---

### ğŸ§­ Quy Æ°á»›c sá»­ dá»¥ng

CÃ¡c Route Handler Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong file `route.js` hoáº·c `route.ts` bÃªn trong thÆ° má»¥c `app/`:

```tsx
// app/api/route.ts
export async function GET(request: Request) {}
```

Route Handlers cÃ³ thá»ƒ Ä‘Æ°á»£c Ä‘áº·t lá»“ng sÃ¢u trong báº¥t ká»³ thÆ° má»¥c con nÃ o cá»§a `app/`, tÆ°Æ¡ng tá»± nhÆ° `page.js` vÃ  `layout.js`.

> âš ï¸ Tuy nhiÃªn, **khÃ´ng thá»ƒ cÃ³** file `route.js` cÃ¹ng cáº¥p vá»›i `page.js`.

---

### âš™ï¸ CÃ¡c phÆ°Æ¡ng thá»©c HTTP Ä‘Æ°á»£c há»— trá»£

CÃ¡c phÆ°Æ¡ng thá»©c HTTP mÃ  Next.js há»— trá»£ gá»“m:

```
GET, POST, PUT, PATCH, DELETE, HEAD, OPTIONS
```

Náº¿u gá»i phÆ°Æ¡ng thá»©c khÃ´ng Ä‘Æ°á»£c há»— trá»£, Next.js sáº½ tráº£ vá» **405 Method Not Allowed**.

---

### ğŸ§° Má»Ÿ rá»™ng NextRequest vÃ  NextResponse

NgoÃ i viá»‡c há»— trá»£ **Request** vÃ  **Response** máº·c Ä‘á»‹nh cá»§a Web API,
Next.js cÃ²n má»Ÿ rá»™ng thÃªm cÃ¡c lá»›p **NextRequest** vÃ  **NextResponse** Ä‘á»ƒ cung cáº¥p thÃªm nhiá»u **helper** há»¯u Ã­ch cho cÃ¡c trÆ°á»ng há»£p nÃ¢ng cao.

---

### ğŸ§  Caching (Bá»™ nhá»› Ä‘á»‡m)

Máº·c Ä‘á»‹nh, **Route Handlers khÃ´ng Ä‘Æ°á»£c cache.**
Báº¡n cÃ³ thá»ƒ **báº­t cache cho cÃ¡c phÆ°Æ¡ng thá»©c GET**, nhÆ°ng **cÃ¡c phÆ°Æ¡ng thá»©c khÃ¡c sáº½ khÃ´ng Ä‘Æ°á»£c cache.**

Äá»ƒ cache GET, báº¡n thÃªm cáº¥u hÃ¬nh sau:

```tsx
// app/items/route.ts
export const dynamic = 'force-static'

export async function GET() {
  const res = await fetch('https://data.mongodb-api.com/...', {
    headers: {
      'Content-Type': 'application/json',
      'API-Key': process.env.DATA_API_KEY,
    },
  })
  const data = await res.json()
  return Response.json({ data })
}
```

> ğŸ’¡ CÃ¡c phÆ°Æ¡ng thá»©c khÃ¡c (POST, PUT, v.v.) sáº½ **khÃ´ng bá»‹ áº£nh hÆ°á»Ÿng bá»Ÿi cache** dÃ¹ cÃ¹ng file vá»›i GET.

---

### ğŸ§¾ CÃ¡c Route Handler Ä‘áº·c biá»‡t

CÃ¡c file Ä‘áº·c biá»‡t nhÆ°:

* `sitemap.ts`
* `opengraph-image.tsx`
* `icon.tsx`
* vÃ  cÃ¡c file metadata khÃ¡c

â†’ sáº½ **máº·c Ä‘á»‹nh lÃ  static**, trá»« khi báº¡n báº­t **Dynamic APIs** hoáº·c config `dynamic`.

---

### ğŸ§© CÃ¡ch phÃ¢n giáº£i Route

Má»™t â€œrouteâ€ lÃ  **Ä‘Æ¡n vá»‹ routing tháº¥p nháº¥t** trong Next.js.

* Route **khÃ´ng tham gia layout** hay **navigation client-side** nhÆ° `page`.
* KhÃ´ng thá»ƒ cÃ³ `page.js` vÃ  `route.js` cÃ¹ng cáº¥p.

| Page               | Route            | Káº¿t quáº£    |
| ------------------ | ---------------- | ---------- |
| app/page.js        | app/route.js     | âŒ Conflict |
| app/page.js        | app/api/route.js | âœ… Há»£p lá»‡   |
| app/[user]/page.js | app/api/route.js | âœ… Há»£p lá»‡   |

ğŸ‘‰ Má»—i `page.js` hoáº·c `route.js` chá»‹u trÃ¡ch nhiá»‡m cho **táº¥t cáº£ cÃ¡c HTTP verb** á»Ÿ route Ä‘Ã³.

VÃ­ dá»¥ conflict:

```tsx
// app/page.ts
export default function Page() {
  return <h1>Hello, Next.js!</h1>
}

// âŒ Conflict
// app/route.ts
export async function POST(request: Request) {}
```

---

### ğŸ§© Route Context Helper (TypeScript)

Khi dÃ¹ng TypeScript, báº¡n cÃ³ thá»ƒ gÃ¡n kiá»ƒu cho `context` báº±ng **RouteContext**:

```tsx
import type { NextRequest } from 'next/server'

export async function GET(_req: NextRequest, ctx: RouteContext<'/users/[id]'>) {
  const { id } = await ctx.params
  return Response.json({ id })
}
```

> ğŸ’¡ CÃ¡c kiá»ƒu nÃ y Ä‘Æ°á»£c **tá»± Ä‘á»™ng sinh ra** trong quÃ¡ trÃ¬nh cháº¡y `next dev`, `next build`, hoáº·c `next typegen`.

---

## 2. Middleware

**Middleware** cho phÃ©p báº¡n cháº¡y code **trÆ°á»›c khi request hoÃ n táº¥t**.
Tá»« Ä‘Ã³, báº¡n cÃ³ thá»ƒ **chuyá»ƒn hÆ°á»›ng (redirect)**, **ghi Ä‘Ã¨ (rewrite)**, **chá»‰nh header**, hoáº·c **pháº£n há»“i ngay láº­p tá»©c**.

---

### ğŸ’¡ TrÆ°á»ng há»£p nÃªn dÃ¹ng Middleware

âœ… CÃ¡c use case phá»• biáº¿n:

* Redirect nhanh dá»±a trÃªn request (vÃ­ dá»¥: user chÆ°a login)
* A/B testing â€” chuyá»ƒn hÆ°á»›ng giá»¯a 2 phiÃªn báº£n page
* ThÃªm header cho táº¥t cáº£ hoáº·c má»™t sá»‘ route

âŒ KhÃ´ng nÃªn dÃ¹ng cho:

* CÃ¡c tÃ¡c vá»¥ cáº§n **fetch dá»¯ liá»‡u cháº­m**
* Quáº£n lÃ½ **session hoáº·c authentication phá»©c táº¡p**
* Gá»i `fetch` vá»›i `options.cache`, `options.next.revalidate`, hoáº·c `options.next.tags` (chÃºng khÃ´ng hoáº¡t Ä‘á»™ng trong Middleware)

---

### ğŸ“‚ Cáº¥u trÃºc vÃ  vá»‹ trÃ­ file

Táº¡o file `middleware.ts` (hoáº·c `.js`) **á»Ÿ root project**,
hoáº·c bÃªn trong thÆ° má»¥c `src/` (náº¿u cÃ³).

> âš ï¸ **Chá»‰ 1 file `middleware.ts` Ä‘Æ°á»£c há»— trá»£ cho toÃ n project.**

Náº¿u muá»‘n chia nhá» logic, báº¡n cÃ³ thá»ƒ:

* TÃ¡ch logic middleware thÃ nh nhiá»u module nhá»
* Import chÃºng vÃ o file `middleware.ts` chÃ­nh Ä‘á»ƒ quáº£n lÃ½ táº­p trung

Äiá»u nÃ y giÃºp trÃ¡nh conflict vÃ  tÄƒng hiá»‡u suáº¥t.

---

### ğŸ§± VÃ­ dá»¥:

```tsx
// middleware.ts
import { NextResponse } from 'next/server'
import type { NextRequest } from 'next/server'

export function middleware(request: NextRequest) {
  return NextResponse.redirect(new URL('/home', request.url))
}

// Cáº¥u hÃ¬nh matcher Ä‘á»ƒ Ã¡p dá»¥ng cho cÃ¡c route cá»¥ thá»ƒ
export const config = {
  matcher: '/about/:path*',
}
```

---

## ğŸ“˜ API Reference

TÃ¬m hiá»ƒu chi tiáº¿t hÆ¡n trong pháº§n API Reference:

| Má»¥c                            | MÃ´ táº£                                               |
| ------------------------------ | --------------------------------------------------- |
| **route.js**                   | API Reference cho file `route.js` Ä‘áº·c biá»‡t          |
| **middleware.js**              | API Reference cho file `middleware.js`              |
| **Backend for Frontend (BFF)** | HÆ°á»›ng dáº«n sá»­ dá»¥ng Next.js nhÆ° **backend framework** |

---


## ğŸš€ Pháº§n 16: Deploying (Triá»ƒn khai Next.js)

Next.js cÃ³ thá»ƒ Ä‘Æ°á»£c triá»ƒn khai theo nhiá»u cÃ¡ch khÃ¡c nhau:

| HÃ¬nh thá»©c triá»ƒn khai | Má»©c Ä‘á»™ há»— trá»£ tÃ­nh nÄƒng         |
| -------------------- | ------------------------------- |
| **Node.js server**   | âœ… Há»— trá»£ **toÃ n bá»™ tÃ­nh nÄƒng**  |
| **Docker container** | âœ… Há»— trá»£ **toÃ n bá»™ tÃ­nh nÄƒng**  |
| **Static export**    | âš ï¸ Há»— trá»£ **giá»›i háº¡n**          |
| **Adapters**         | âš™ï¸ TÃ¹y theo **ná»n táº£ng cá»¥ thá»ƒ** |

---

## ğŸ§© 1. Node.js Server

Báº¡n cÃ³ thá»ƒ triá»ƒn khai á»©ng dá»¥ng Next.js trÃªn **báº¥t ká»³ nhÃ  cung cáº¥p nÃ o há»— trá»£ Node.js** (nhÆ° Vercel, Render, Railway, DigitalOcean, AWS EC2, v.v.).

### ğŸ”§ Cáº¥u hÃ¬nh báº¯t buá»™c trong `package.json`

```json
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start"
  }
}
```

### âš™ï¸ Quy trÃ¬nh build & run

1. **Build á»©ng dá»¥ng:**

   ```bash
   npm run build
   ```
2. **Khá»Ÿi Ä‘á»™ng server Node.js:**

   ```bash
   npm run start
   ```

Server nÃ y há»— trá»£ **toÃ n bá»™ tÃ­nh nÄƒng cá»§a Next.js**, bao gá»“m:

* SSR (Server-Side Rendering)
* ISR (Incremental Static Regeneration)
* API Routes / Route Handlers
* Middleware
* Streaming vÃ  Dynamic Rendering

Náº¿u cáº§n kiá»ƒm soÃ¡t chi tiáº¿t hÆ¡n, báº¡n cÃ³ thá»ƒ **eject sang custom server** (vÃ­ dá»¥: Express.js, Fastify).

ğŸ‘‰ Tham kháº£o thÃªm cÃ¡ch **cáº¥u hÃ¬nh Node.js deployment** theo cÆ¡ sá»Ÿ háº¡ táº§ng cá»§a báº¡n.

### ğŸ“¦ Template triá»ƒn khai gá»£i Ã½

* [Flightcontrol](https://flightcontrol.dev)
* [Railway](https://railway.app)
* [Replit](https://replit.com)

---

## ğŸ³ 2. Docker Container

Next.js cÃ³ thá»ƒ cháº¡y trong **Docker container**, cho phÃ©p báº¡n triá»ƒn khai lÃªn:

* Kubernetes
* AWS ECS / Fargate
* Google Cloud Run
* Render, DigitalOcean App Platform, v.v.

### ğŸ” Æ¯u Ä‘iá»ƒm:

* **CÃ´ láº­p mÃ´i trÆ°á»ng**
* **Dá»… nhÃ¢n báº£n, di chuyá»ƒn vÃ  má»Ÿ rá»™ng**
* **Há»— trá»£ toÃ n bá»™ tÃ­nh nÄƒng Next.js**

### âš ï¸ LÆ°u Ã½ khi phÃ¡t triá»ƒn cá»¥c bá»™:

Máº·c dÃ¹ Docker ráº¥t tá»‘t cho **production**,
nhÆ°ng trong quÃ¡ trÃ¬nh **phÃ¡t triá»ƒn (development)** â€” Ä‘áº·c biá»‡t trÃªn **Mac hoáº·c Windows**,
báº¡n nÃªn cháº¡y báº±ng:

```bash
npm run dev
```

thay vÃ¬ dÃ¹ng Docker Ä‘á»ƒ Ä‘áº¡t hiá»‡u nÄƒng cao hÆ¡n.

ğŸ‘‰ Xem thÃªm tÃ i liá»‡u vá» **tá»‘i Æ°u hoÃ¡ hiá»‡u suáº¥t khi phÃ¡t triá»ƒn cá»¥c bá»™**.

### ğŸ§± Template gá»£i Ã½:

* Docker cÆ¡ báº£n
* Docker Multi-Environment
* DigitalOcean
* Fly.io
* Google Cloud Run
* Render
* SST

---

## ğŸª¶ 3. Static Export

Next.js há»— trá»£ **xuáº¥t tÄ©nh (Static Export)** â€” tá»©c lÃ  báº¡n cÃ³ thá»ƒ **build site thÃ nh HTML/CSS/JS thuáº§n tÃºy**,
sau Ä‘Ã³ **triá»ƒn khai trÃªn báº¥t ká»³ web server nÃ o** (AWS S3, Nginx, Apache, GitHub Pages,...).

### ğŸ”§ Lá»‡nh xuáº¥t tÄ©nh:

```bash
next build && next export
```

á»¨ng dá»¥ng lÃºc nÃ y hoáº¡t Ä‘á»™ng nhÆ° má»™t **Static Site** hoáº·c **Single-Page Application (SPA)**.

### âš ï¸ Giá»›i háº¡n:

Static Export **khÃ´ng há»— trá»£** cÃ¡c tÃ­nh nÄƒng cáº§n server nhÆ°:

* SSR
* API Routes
* Middleware
* Dynamic Rendering
* Revalidation (ISR)

ğŸ‘‰ Náº¿u báº¡n báº¯t Ä‘áº§u vá»›i **Static Site**, báº¡n váº«n cÃ³ thá»ƒ **nÃ¢ng cáº¥p dáº§n lÃªn SSR hoáº·c Full-stack** sau nÃ y mÃ  khÃ´ng cáº§n viáº¿t láº¡i toÃ n bá»™.

### ğŸ§± Template gá»£i Ã½:

* GitHub Pages

---

## âš™ï¸ 4. Adapters (Bá»™ chuyá»ƒn Ä‘á»•i ná»n táº£ng)

Next.js cÃ³ thá»ƒ **tá»± Ä‘á»™ng thÃ­ch á»©ng vá»›i nhiá»u ná»n táº£ng khÃ¡c nhau**,
thÃ´ng qua cÃ¡c **Deployment Adapters**, Ä‘á»ƒ táº­n dá»¥ng **háº¡ táº§ng Ä‘áº·c trÆ°ng** cá»§a tá»«ng ná»n táº£ng.

### ğŸŒ CÃ¡c ná»n táº£ng há»— trá»£:

| Ná»n táº£ng                | Ghi chÃº                                                |
| ----------------------- | ------------------------------------------------------ |
| **AWS Amplify Hosting** | Há»— trá»£ build & deploy Next.js toÃ n pháº§n                |
| **Cloudflare**          | Triá»ƒn khai dÆ°á»›i dáº¡ng Edge Functions (ráº¥t nhanh)        |
| **Deno Deploy**         | Cháº¡y serverless trÃªn Deno runtime                      |
| **Netlify**             | Tá»± Ä‘á»™ng nháº­n diá»‡n Next.js                              |
| **Vercel**              | Ná»n táº£ng do Ä‘á»™i ngÅ© Next.js phÃ¡t triá»ƒn â€“ há»— trá»£ Ä‘áº§y Ä‘á»§ |

> ğŸ§  **LÆ°u Ã½:**
> Äá»™i ngÅ© Next.js Ä‘ang phÃ¡t triá»ƒn **Deployment Adapters API** giÃºp cá»™ng Ä‘á»“ng cÃ³ thá»ƒ viáº¿t adapter cho **má»i ná»n táº£ng khÃ¡c**.
> Khi hoÃ n thiá»‡n, tÃ i liá»‡u hÆ°á»›ng dáº«n chi tiáº¿t cÃ¡ch **tá»± viáº¿t adapter cá»§a riÃªng báº¡n** sáº½ Ä‘Æ°á»£c bá»• sung.

---

## âœ… Tá»•ng káº¿t pháº§n 16

| HÃ¬nh thá»©c          | Khi nÃªn dÃ¹ng                                                   | Æ¯u Ä‘iá»ƒm                | NhÆ°á»£c Ä‘iá»ƒm             |
| ------------------ | -------------------------------------------------------------- | ---------------------- | ---------------------- |
| **Node.js Server** | á»¨ng dá»¥ng full-stack (SSR, API Routes)                          | Há»— trá»£ Ä‘áº§y Ä‘á»§          | Cáº§n quáº£n lÃ½ server     |
| **Docker**         | Triá»ƒn khai production, CI/CD                                   | Linh hoáº¡t, portable    | Thiáº¿t láº­p phá»©c táº¡p hÆ¡n |
| **Static Export**  | Blog, landing page, SPA                                        | ÄÆ¡n giáº£n, chi phÃ­ tháº¥p | KhÃ´ng há»— trá»£ SSR       |
| **Adapters**       | Khi deploy trÃªn platform Ä‘áº·c thÃ¹ (Vercel, Netlify, Cloudflare) | Tá»± Ä‘á»™ng tá»‘i Æ°u         | Phá»¥ thuá»™c háº¡ táº§ng      |

---
## ğŸ§± Pháº§n 17: NÃ¢ng cáº¥p (Upgrading)

### ğŸ”¹ PhiÃªn báº£n má»›i nháº¥t

Äá»ƒ cáº­p nháº­t **Next.js** lÃªn phiÃªn báº£n má»›i nháº¥t, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng **upgrade codemod** Ä‘Æ°á»£c cung cáº¥p sáºµn:

```bash
npx @next/codemod@latest upgrade latest
```

Náº¿u báº¡n muá»‘n nÃ¢ng cáº¥p **thá»§ cÃ´ng**, hÃ£y cÃ i Ä‘áº·t láº¡i phiÃªn báº£n má»›i nháº¥t cá»§a **Next.js** vÃ  **React** (kÃ¨m `eslint-config-next`):

#### CÃ i Ä‘áº·t báº±ng cÃ¡c trÃ¬nh quáº£n lÃ½ gÃ³i:

| CÃ´ng cá»¥  | Lá»‡nh                                                                           |
| -------- | ------------------------------------------------------------------------------ |
| **pnpm** | `pnpm i next@latest react@latest react-dom@latest eslint-config-next@latest`   |
| **npm**  | `npm i next@latest react@latest react-dom@latest eslint-config-next@latest`    |
| **yarn** | `yarn add next@latest react@latest react-dom@latest eslint-config-next@latest` |
| **bun**  | `bun add next@latest react@latest react-dom@latest eslint-config-next@latest`  |

---

### ğŸ”¹ PhiÃªn báº£n Canary (báº£n thá»­ nghiá»‡m)

Náº¿u báº¡n muá»‘n dÃ¹ng **phiÃªn báº£n thá»­ nghiá»‡m (canary)** â€” nÆ¡i cÃ¡c tÃ­nh nÄƒng má»›i nháº¥t Ä‘Æ°á»£c cáº­p nháº­t sá»›m â€” trÆ°á»›c tiÃªn hÃ£y Ä‘áº£m báº£o ráº±ng báº¡n Ä‘Ã£ á»Ÿ trÃªn báº£n á»•n Ä‘á»‹nh má»›i nháº¥t vÃ  dá»± Ã¡n hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng.
Sau Ä‘Ã³, cháº¡y lá»‡nh sau Ä‘á»ƒ nÃ¢ng cáº¥p:

```bash
npm i next@canary
```

---

### ğŸ”¹ CÃ¡c tÃ­nh nÄƒng hiá»‡n cÃ³ trong phiÃªn báº£n Canary

#### ğŸ§  Caching (Bá»™ nhá»› Ä‘á»‡m)

PhiÃªn báº£n canary hiá»‡n há»— trá»£ cÃ¡c API vÃ  directive má»›i:

* `"use cache"` â€” chá»‰ thá»‹ kÃ­ch hoáº¡t cÆ¡ cháº¿ cache cho component hoáº·c hÃ m.
* `cacheLife` â€” kiá»ƒm soÃ¡t thá»i gian sá»‘ng cá»§a cache.
* `cacheTag` â€” Ä‘Ã¡nh dáº¥u cache báº±ng tag, giÃºp dá»… dÃ ng revalidate.
* `cacheComponents` â€” tá»‘i Æ°u hoÃ¡ vÃ  cache cÃ¡c React component.

#### ğŸ” Authentication (XÃ¡c thá»±c)

Cáº£i thiá»‡n kháº£ nÄƒng xÃ¡c thá»±c ngÆ°á»i dÃ¹ng vá»›i cÃ¡c tÃ­nh nÄƒng má»›i:

* `forbidden` â€” xá»­ lÃ½ khi ngÆ°á»i dÃ¹ng bá»‹ cáº¥m truy cáº­p.
* `unauthorized` â€” xá»­ lÃ½ khi ngÆ°á»i dÃ¹ng chÆ°a Ä‘Äƒng nháº­p.
* `forbidden.js` / `unauthorized.js` â€” trang lá»—i tuá»³ chá»‰nh cho hai tráº¡ng thÃ¡i trÃªn.
* `authInterrupts` â€” ngáº¯t hoáº·c chuyá»ƒn hÆ°á»›ng khi ngÆ°á»i dÃ¹ng khÃ´ng Ä‘á»§ quyá»n truy cáº­p.

---

### ğŸ”¹ HÆ°á»›ng dáº«n nÃ¢ng cáº¥p theo phiÃªn báº£n

| PhiÃªn báº£n      | Ná»™i dung                                                   |
| -------------- | ---------------------------------------------------------- |
| **Version 15** | HÆ°á»›ng dáº«n nÃ¢ng cáº¥p á»©ng dá»¥ng Next.js tá»« **Version 14 â†’ 15** |
| **Version 14** | HÆ°á»›ng dáº«n nÃ¢ng cáº¥p á»©ng dá»¥ng Next.js tá»« **Version 13 â†’ 14** |

---

âœ… **TÃ³m táº¯t:**

* Sá»­ dá»¥ng `@next/codemod` Ä‘á»ƒ nÃ¢ng cáº¥p nhanh chÃ³ng vÃ  tá»± Ä‘á»™ng.
* Náº¿u cáº§n kiá»ƒm soÃ¡t chi tiáº¿t hÆ¡n, hÃ£y nÃ¢ng cáº¥p thá»§ cÃ´ng báº±ng `pnpm`, `npm`, `yarn`, hoáº·c `bun`.
* PhiÃªn báº£n **canary** dÃ nh cho láº­p trÃ¬nh viÃªn muá»‘n tráº£i nghiá»‡m sá»›m cÃ¡c tÃ­nh nÄƒng má»›i nhÆ° **cache directives** vÃ  **authentication handlers**.
* Khi nÃ¢ng cáº¥p giá»¯a cÃ¡c major version (13 â†’ 14, 14 â†’ 15), hÃ£y Ä‘á»c **Version Guides** Ä‘á»ƒ trÃ¡nh lá»—i khÃ´ng tÆ°Æ¡ng thÃ­ch.

---
