# ğŸ¯ **Linking & Navigation trong Next.js App Router**


## ğŸ§© 1. `Link` Component â€“ Äiá»u hÆ°á»›ng ná»™i bá»™

Trong App Router, `next/link` lÃ  cÃ¡ch **chÃ­nh thá»‘ng** Ä‘á»ƒ chuyá»ƒn trang giá»¯a cÃ¡c route ná»™i bá»™ mÃ  **khÃ´ng reload toÃ n bá»™ trang**.

### âœ… CÃº phÃ¡p cÆ¡ báº£n

```tsx
import Link from "next/link";

export default function Home() {
  return (
    <div>
      <h1>Trang chá»§</h1>
      <Link href="/about">Äáº¿n trang giá»›i thiá»‡u</Link>
    </div>
  );
}
```

ğŸ§  Khi báº¥m vÃ o `<Link>`, Next.js:

* **KhÃ´ng reload trang** (client-side navigation)
* **Prefetch** dá»¯ liá»‡u cá»§a trang `/about` khi link hiá»ƒn thá»‹ trong viewport
  â†’ GiÃºp trang load **tá»©c thÃ¬** khi ngÆ°á»i dÃ¹ng click.

---

## âš™ï¸ 2. Thuá»™c tÃ­nh cá»§a `<Link>`

| Thuá»™c tÃ­nh | MÃ´ táº£                                                                                 |
| ---------- | ------------------------------------------------------------------------------------- |
| `href`     | ÄÆ°á»ng dáº«n cáº§n Ä‘iá»u hÆ°á»›ng                                                              |
| `prefetch` | Tá»± Ä‘á»™ng prefetch khi link xuáº¥t hiá»‡n trong viewport (máº·c Ä‘á»‹nh: `true` trÃªn production) |
| `replace`  | Thay vÃ¬ `push` vÃ o history, dÃ¹ng `replace` Ä‘á»ƒ khÃ´ng táº¡o báº£n ghi má»›i                   |
| `scroll`   | Cuá»™n lÃªn Ä‘áº§u trang sau khi Ä‘iá»u hÆ°á»›ng (máº·c Ä‘á»‹nh: `true`)                              |

### VÃ­ dá»¥ nÃ¢ng cao

```tsx
<Link href="/dashboard" prefetch={false} replace scroll={false}>
  Má»Ÿ Dashboard (khÃ´ng prefetch, khÃ´ng scroll)
</Link>
```

---

## ğŸ§  3. Prefetch hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o?

Next.js sáº½ **tá»± Ä‘á»™ng preload** dá»¯ liá»‡u (HTML + JS) cho trang Ä‘Æ°á»£c liÃªn káº¿t **khi link hiá»ƒn thá»‹ trong viewport**.

VÃ­ dá»¥:
Khi báº¡n cuá»™n xuá»‘ng vÃ  tháº¥y `<Link href="/about" />` â†’ Next.js táº£i ngáº§m trÆ°á»›c `/about` â†’ Click vÃ o lÃ  má»Ÿ tá»©c thÃ¬ âš¡

Náº¿u báº¡n Ä‘ang phÃ¡t triá»ƒn (`next dev`), prefetch sáº½ **táº¯t máº·c Ä‘á»‹nh** Ä‘á»ƒ trÃ¡nh log rÃ¡c.

---

## ğŸ§­ 4. `useRouter` Hook â€“ Äiá»u hÆ°á»›ng báº±ng code

Khi cáº§n **Ä‘iá»u hÆ°á»›ng báº±ng hÃ nh Ä‘á»™ng logic** (sau form, nÃºt báº¥m...), ta dÃ¹ng `useRouter` tá»« `next/navigation`.

```tsx
"use client";

import { useRouter } from "next/navigation";

export default function LoginButton() {
  const router = useRouter();

  const handleLogin = async () => {
    await fakeLogin();
    router.push("/dashboard");
  };

  return <button onClick={handleLogin}>ÄÄƒng nháº­p</button>;
};
```

### CÃ¡c hÃ m Ä‘iá»u hÆ°á»›ng phá»• biáº¿n

| HÃ m                   | MÃ´ táº£                                                       |
| --------------------- | ----------------------------------------------------------- |
| `router.push(url)`    | Chuyá»ƒn sang trang má»›i, thÃªm vÃ o history                     |
| `router.replace(url)` | Chuyá»ƒn sang trang má»›i, khÃ´ng thÃªm vÃ o history               |
| `router.back()`       | Quay láº¡i trang trÆ°á»›c                                        |
| `router.forward()`    | Tiáº¿n tá»›i trang tiáº¿p theo                                    |
| `router.refresh()`    | LÃ m má»›i dá»¯ liá»‡u server (fetch láº¡i nhÆ°ng khÃ´ng reload trang) |

---

## ğŸš¦ 5. Link vÃ  Navigation trong Server Components

* `<Link>` cÃ³ thá»ƒ dÃ¹ng trong **Server Component**
* NhÆ°ng `useRouter()` chá»‰ dÃ¹ng Ä‘Æ°á»£c trong **Client Component**

ğŸ‘‰ Náº¿u báº¡n cáº§n Ä‘iá»u hÆ°á»›ng báº±ng code, hÃ£y thÃªm `"use client"` trÃªn Ä‘áº§u file.

---

## ğŸ§± 6. Code máº«u hoÃ n chá»‰nh

**ğŸ“ app/page.tsx**

```tsx
import Link from "next/link";

export default function HomePage() {
  return (
    <main className="p-8">
      <h1 className="text-2xl font-bold mb-4">Trang chá»§</h1>
      <ul className="space-y-2">
        <li>
          <Link href="/about" className="text-blue-600 hover:underline">
            Giá»›i thiá»‡u
          </Link>
        </li>
        <li>
          <Link href="/blog" prefetch={false}>
            Blog (khÃ´ng prefetch)
          </Link>
        </li>
      </ul>
    </main>
  );
}
```

**ğŸ“ app/about/page.tsx**

```tsx
export default function AboutPage() {
  return (
    <div className="p-8">
      <h1 className="text-xl font-semibold">Vá» chÃºng tÃ´i</h1>
      <p>ÄÃ¢y lÃ  trang giá»›i thiá»‡u trong Next.js App Router.</p>
    </div>
  );
}
```

**ğŸ“ app/login/page.tsx (client)**

```tsx
"use client";

import { useRouter } from "next/navigation";

export default function LoginPage() {
  const router = useRouter();

  const handleSubmit = () => {
    // Xá»­ lÃ½ login giáº£ láº­p
    setTimeout(() => {
      router.push("/dashboard");
    }, 1000);
  };

  return (
    <div className="p-8">
      <button
        onClick={handleSubmit}
        className="px-4 py-2 bg-green-600 text-white rounded-md"
      >
        ÄÄƒng nháº­p
      </button>
    </div>
  );
}
```

---

## ğŸ’¡ Tá»•ng káº¿t

| TÃ­nh nÄƒng   | MÃ´ táº£                                        | DÃ¹ng á»Ÿ Ä‘Ã¢u              |
| ----------- | -------------------------------------------- | ----------------------- |
| `<Link>`    | Äiá»u hÆ°á»›ng client-side (prefetch tá»± Ä‘á»™ng)    | Server/Client Component |
| `useRouter` | Äiá»u hÆ°á»›ng qua code (push, replace, refresh) | Chá»‰ Client Component    |
| `prefetch`  | Táº£i sáºµn trang khi link xuáº¥t hiá»‡n             | TÄƒng tá»‘c Ä‘iá»u hÆ°á»›ng     |
| `scroll`    | Kiá»ƒm soÃ¡t cuá»™n sau khi navigate              | Máº·c Ä‘á»‹nh: true          |

---

# âš¡ Bonus: Prefetch & router.refresh trong App Router



## ğŸ§  1ï¸âƒ£ Prefetch lÃ  gÃ¬?

> Prefetch = Next.js **táº£i sáºµn** code vÃ  dá»¯ liá»‡u cá»§a trang **trÆ°á»›c khi ngÆ°á»i dÃ¹ng click** vÃ o link.

ğŸ“¦ Khi `<Link>` náº±m trong viewport â†’ Next.js ngáº§m gá»i:

* táº£i trÆ°á»›c JS chunk cá»§a page
* táº£i trÆ°á»›c `layout`, `page`, vÃ  `loading` tÆ°Æ¡ng á»©ng
* cache sáºµn káº¿t quáº£

ğŸ‘‰ Nhá» váº­y, khi click vÃ o â†’ **trang má»Ÿ gáº§n nhÆ° tá»©c thÃ¬** (SPA cáº£m giÃ¡c mÆ°á»£t mÃ  nhÆ° native app)

---

### âœ³ï¸ Khi nÃ o prefetch hoáº¡t Ä‘á»™ng?

| MÃ´i trÆ°á»ng                  | Tráº¡ng thÃ¡i       | Máº·c Ä‘á»‹nh       |
| --------------------------- | ---------------- | -------------- |
| `next dev`                  | KhÃ´ng prefetch   | âŒ Táº¯t Ä‘á»ƒ debug |
| `next build` + `next start` | Prefetch tá»± Ä‘á»™ng | âœ… Báº­t          |

---

### âœ³ï¸ Táº¯t thá»§ cÃ´ng khi cáº§n

VÃ­ dá»¥ khi cÃ³ quÃ¡ nhiá»u link (menu lá»›n â†’ tá»‘n bÄƒng thÃ´ng):

```tsx
<Link href="/about" prefetch={false}>
  Giá»›i thiá»‡u
</Link>
```

---

## ğŸ”„ 2ï¸âƒ£ `router.refresh()` lÃ  gÃ¬?

Trong App Router, `router.refresh()` cho phÃ©p báº¡n **táº£i láº¡i dá»¯ liá»‡u server** mÃ  **khÃ´ng reload toÃ n bá»™ trang**.

### ğŸ“VÃ­ dá»¥:

```tsx
"use client";

import { useRouter } from "next/navigation";

export default function RefreshButton() {
  const router = useRouter();

  return (
    <button
      onClick={() => router.refresh()}
      className="px-4 py-2 bg-blue-600 text-white rounded"
    >
      ğŸ”„ LÃ m má»›i dá»¯ liá»‡u
    </button>
  );
}
```

Khi báº¥m:

* Component server (fetch data) sáº½ **render láº¡i**
* NhÆ°ng **state client** khÃ´ng bá»‹ máº¥t (khÃ´ng reload toÃ n trang)
* Ráº¥t há»¯u Ã­ch sau khi update/delete dá»¯ liá»‡u trong CRUD

---

### ğŸ§© Khi nÃ o nÃªn dÃ¹ng `router.refresh()`

| TÃ¬nh huá»‘ng                                      | Giáº£i thÃ­ch                                  |
| ----------------------------------------------- | ------------------------------------------- |
| Sau khi gá»­i form (server action)                | Muá»‘n cáº­p nháº­t láº¡i danh sÃ¡ch mÃ  khÃ´ng reload |
| Sau khi xoÃ¡ hoáº·c thÃªm record                    | Muá»‘n re-fetch láº¡i dá»¯ liá»‡u server            |
| Khi gá»i API khÃ´ng náº±m trong React query hay SWR | Muá»‘n trigger láº¡i render server component    |

---

### ğŸ§  VÃ­ dá»¥ káº¿t há»£p:

```tsx
"use client";
import { useRouter } from "next/navigation";

export default function DeletePostButton({ id }: { id: string }) {
  const router = useRouter();

  const handleDelete = async () => {
    await fetch(`/api/posts/${id}`, { method: "DELETE" });
    router.refresh(); // âš¡ cáº­p nháº­t láº¡i danh sÃ¡ch
  };

  return (
    <button
      onClick={handleDelete}
      className="px-3 py-1 bg-red-600 text-white rounded"
    >
      ğŸ—‘ï¸ XoÃ¡ bÃ i
    </button>
  );
}
```

---

## âœ… Tá»•ng káº¿t nhanh

| TÃ­nh nÄƒng          | Má»¥c Ä‘Ã­ch                               | DÃ¹ng á»Ÿ Ä‘Ã¢u                 | Ghi nhá»›             |
| ------------------ | -------------------------------------- | -------------------------- | ------------------- |
| `prefetch`         | Táº£i sáºµn trang Ä‘á»ƒ tÄƒng tá»‘c              | `<Link>`                   | Máº·c Ä‘á»‹nh báº­t (prod) |
| `router.refresh()` | LÃ m má»›i dá»¯ liá»‡u server (re-render RSC) | `useRouter()` trong client | KhÃ´ng reload trang  |

---
[<< BÃ€I 18](./18.md) | [BÃ€I 20 >>](./20.md)