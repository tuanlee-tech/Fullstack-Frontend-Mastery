
## ğŸ§­ Loading UI trong Next.js

### ğŸ¯ Má»¥c tiÃªu

* Hiá»ƒu cÃ¡ch hiá»ƒn thá»‹ **giao diá»‡n loading** khi page hoáº·c route Ä‘ang load dá»¯ liá»‡u.
* Biáº¿t sá»­ dá»¥ng **`loading.tsx` trong App Router** Ä‘á»ƒ cáº£i thiá»‡n UX.

---

## ğŸ§± 1ï¸âƒ£ CÆ¡ cháº¿

* Next.js App Router há»— trá»£ **file `loading.tsx` trong tá»«ng thÆ° má»¥c route**.
* Khi ngÆ°á»i dÃ¹ng truy cáº­p route Ä‘Ã³, **Next.js tá»± Ä‘á»™ng render file `loading.tsx`** cho Ä‘áº¿n khi page thá»±c sá»± sáºµn sÃ ng.
* Há»— trá»£ **nested layouts**, má»—i layout cÃ³ thá»ƒ cÃ³ loading riÃªng.

---

## ğŸ§© 2ï¸âƒ£ VÃ­ dá»¥ cÆ¡ báº£n

```
app/
â”œâ”€â”€ dashboard/
â”‚   â”œâ”€â”€ loading.tsx
â”‚   â””â”€â”€ page.tsx
```

```tsx
// app/dashboard/loading.tsx
export default function DashboardLoading() {
  return (
    <div style={{ padding: "2rem", textAlign: "center" }}>
      <p>Loading dashboard...</p>
    </div>
  );
}
```

* Khi vÃ o `/dashboard`, Next.js sáº½ **show loading component** trÆ°á»›c khi page chÃ­nh `/dashboard/page.tsx` render xong.

---

## ğŸ§± 3ï¸âƒ£ Nested Loading UI

```
app/
â”œâ”€â”€ dashboard/
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”œâ”€â”€ loading.tsx
â”‚   â””â”€â”€ analytics/
â”‚       â”œâ”€â”€ page.tsx
â”‚       â””â”€â”€ loading.tsx
```

* `/dashboard/analytics` sáº½ render:

  1. Root layout â†’ dashboard layout
  2. Dashboard `loading.tsx` â†’ Analytics `loading.tsx` (nested)
  3. Page chÃ­nh khi dá»¯ liá»‡u sáºµn sÃ ng

---

## ğŸ’¡ 4ï¸âƒ£ LÆ°u Ã½

* `loading.tsx` **chá»‰ dÃ¹ng trong App Router**
* Chá»‰ nÃªn dÃ¹ng **giao diá»‡n nháº¹**, trÃ¡nh logic náº·ng
* Káº¿t há»£p tá»‘t vá»›i **Suspense + Server Components** Ä‘á»ƒ tráº£i nghiá»‡m mÆ°á»£t mÃ 


---

### âš¡ï¸ `loading.tsx` trong Next.js App Router


`loading.tsx` lÃ  **file Ä‘áº·c biá»‡t** trong Next.js, Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ **hiá»ƒn thá»‹ tráº¡ng thÃ¡i táº£i (loading state)** khi **cÃ¡c segment con** hoáº·c **dá»¯ liá»‡u Ä‘ang fetch** trong route Ä‘Ã³ **chÆ°a sáºµn sÃ ng**.

NÃ³ hoáº¡t Ä‘á»™ng dá»±a trÃªn **React Suspense** â€” nghÄ©a lÃ  báº¥t cá»© khi nÃ o component con bá»‹ â€œchá» dá»¯ liá»‡uâ€, Next.js sáº½ **táº¡m render `loading.tsx`** cho Ä‘áº¿n khi pháº§n Ä‘Ã³ táº£i xong.

---

## ğŸ“ **2. Cáº¥u trÃºc thÆ° má»¥c**

Giáº£ sá»­ cÃ³ cáº¥u trÃºc App Router:

```
app/
 â”œâ”€ layout.tsx
 â”œâ”€ dashboard/
 â”‚   â”œâ”€ page.tsx
 â”‚   â”œâ”€ loading.tsx
 â”‚   â”œâ”€ settings/
 â”‚   â”‚   â”œâ”€ page.tsx
 â”‚   â”‚   â””â”€ loading.tsx
```

ğŸ‘‰ Khi báº¡n truy cáº­p `/dashboard` hoáº·c `/dashboard/settings`, Next.js sáº½ **tá»± Ä‘á»™ng hiá»ƒn thá»‹ `loading.tsx`** tÆ°Æ¡ng á»©ng khi dá»¯ liá»‡u chÆ°a load xong.

---

## âš™ï¸ **3. CÃ¡ch hoáº¡t Ä‘á»™ng**

| HÃ nh vi           | MÃ´ táº£                                                                 |
| ----------------- | --------------------------------------------------------------------- |
| Tá»± Ä‘á»™ng kÃ­ch hoáº¡t | Khi route Ä‘ang load (server component, data fetching, dynamic import) |
| CÆ¡ cháº¿            | Dá»±a trÃªn `React.Suspense`                                             |
| Tá»± Ä‘á»™ng dá»«ng      | Khi dá»¯ liá»‡u hoáº·c component render hoÃ n táº¥t                            |
| Pháº¡m vi           | Ãp dá»¥ng cho **segment hiá»‡n táº¡i vÃ  con cá»§a nÃ³**                        |
| KhÃ´ng cáº§n import  | Chá»‰ cáº§n cÃ³ file `loading.tsx` lÃ  Next.js tá»± hiá»ƒu                      |

---

## ğŸ§  **4. VÃ­ dá»¥ thá»±c táº¿**

### ğŸ“„ `/app/dashboard/page.tsx`

```tsx
export default async function DashboardPage() {
  const data = await fetch("https://jsonplaceholder.typicode.com/posts/1");
  const post = await data.json();

  await new Promise((resolve) => setTimeout(resolve, 2000)); // Giáº£ láº­p delay

  return (
    <div>
      <h1>Dashboard</h1>
      <p>{post.title}</p>
    </div>
  );
}
```

### âš™ï¸ `/app/dashboard/loading.tsx`

```tsx
export default function Loading() {
  return (
    <div className="flex justify-center items-center h-screen text-gray-600">
      <p>â³ Äang táº£i dá»¯ liá»‡u Dashboard...</p>
    </div>
  );
}
```

### ğŸ” Khi cháº¡y:

* LÃºc Ä‘áº§u â†’ Next.js render `loading.tsx`
* Sau 2 giÃ¢y â†’ thay báº±ng ná»™i dung trong `page.tsx`

---

## ğŸ§© **5. CÃ¡ch káº¿t há»£p nhiá»u cáº¥p (nested loading)**

Báº¡n cÃ³ thá»ƒ Ä‘áº·t nhiá»u `loading.tsx` trong nhiá»u folder:

```
app/
 â”œâ”€ loading.tsx               â†’ loading chung cho toÃ n site
 â”œâ”€ dashboard/
 â”‚   â”œâ”€ loading.tsx           â†’ loading riÃªng cho dashboard
 â”‚   â”œâ”€ settings/
 â”‚   â”‚   â”œâ”€ loading.tsx       â†’ loading riÃªng cho settings
```

Khi `/dashboard/settings` Ä‘ang load:

* Náº¿u `settings/loading.tsx` tá»“n táº¡i â†’ render cÃ¡i nÃ y
* Náº¿u khÃ´ng â†’ render `dashboard/loading.tsx`
* Náº¿u váº«n khÃ´ng â†’ render `app/loading.tsx`

âœ… Æ¯u tiÃªn theo cáº¥p gáº§n nháº¥t (closest segment).

---

## ğŸ§­ **6. á»¨ng dá»¥ng thá»±c táº¿**

| TÃ¬nh huá»‘ng                             | CÃ¡ch dÃ¹ng                                |
| -------------------------------------- | ---------------------------------------- |
| Trang dashboard táº£i dá»¯ liá»‡u lá»›n        | `dashboard/loading.tsx`                  |
| Component con cÃ³ dynamic import (lazy) | Next.js tá»± Suspense render `loading.tsx` |
| ToÃ n site cáº§n fallback khi Ä‘á»•i route   | `app/loading.tsx`                        |
| Má»—i nhÃ³m route cÃ³ UI loading khÃ¡c nhau | Táº¡o `loading.tsx` riÃªng trong tá»«ng group |

---

## ğŸ¨ **7. Máº«u code UI Ä‘áº¹p**

```tsx
export default function Loading() {
  return (
    <div className="flex flex-col justify-center items-center h-screen bg-gray-50">
      <div className="animate-spin rounded-full h-12 w-12 border-4 border-blue-500 border-t-transparent"></div>
      <p className="mt-4 text-gray-600">Äang táº£i dá»¯ liá»‡u, vui lÃ²ng chá»...</p>
    </div>
  );
}
```

> ğŸ‘‰ CÃ³ thá»ƒ thay spinner báº±ng `next/image`, `skeleton`, hoáº·c `framer-motion` animation.

---

## ğŸ§© **8. Tips nÃ¢ng cao**

| Tip                                | MÃ´ táº£                                                                                         |
| ---------------------------------- | --------------------------------------------------------------------------------------------- |
| ğŸ’¡ Äáº·t á»Ÿ Ä‘Ãºng cáº¥p route            | Náº¿u báº¡n chá»‰ muá»‘n loading cho `/blog`, Ä‘áº·t trong `/app/blog/loading.tsx`                       |
| âš™ï¸ Tá»± custom duration              | CÃ³ thá»ƒ thÃªm fake delay Ä‘á»ƒ UX mÆ°á»£t hÆ¡n                                                         |
| ğŸ”„ DÃ¹ng chung layout               | Layout **váº«n render** trong khi `loading.tsx` hiá»ƒn thá»‹ (loading chá»‰ thay pháº§n `children`)     |
| â›” KhÃ´ng dÃ¹ng hook                  | `loading.tsx` lÃ  **Server Component** (máº·c Ä‘á»‹nh), khÃ´ng Ä‘Æ°á»£c dÃ¹ng hook client nhÆ° `useEffect` |
| ğŸ§  Muá»‘n dÃ¹ng animation client-side | ThÃªm `"use client"` á»Ÿ Ä‘áº§u file `loading.tsx`                                                  |

---

## ğŸ§© **9. Demo tree (render logic)**

```
Root Layout
 â”œâ”€â”€ Navbar
 â”œâ”€â”€ <Suspense fallback={<loading.tsx>}>
 â”‚     â””â”€â”€ Page content (fetching)
 â””â”€â”€ Footer
```

â†’ Khi page chÆ°a sáºµn sÃ ng, Next.js tá»± fallback sang `loading.tsx`.

---

## âœ… **TÃ³m láº¡i**

| Má»¥c Ä‘Ã­ch                        | File                        | Ghi chÃº           |
| ------------------------------- | --------------------------- | ----------------- |
| Loading state khi fetch dá»¯ liá»‡u | `loading.tsx`               | Tá»± Ä‘á»™ng triggered |
| Giá»¯ layout cá»‘ Ä‘á»‹nh khi loading  | CÃ³ â€” layout khÃ´ng re-render |                   |
| Cáº¥p Ä‘á»™ Ã¡p dá»¥ng                  | Má»—i route hoáº·c toÃ n app     |                   |
| DÃ¹ng cho animation / skeleton   | Ráº¥t phÃ¹ há»£p                 |                   |

---



1ï¸âƒ£ TrÆ°á»ng há»£p **`loading.tsx` tá»± Ä‘á»™ng hoáº¡t Ä‘á»™ng** (khÃ´ng cáº§n Suspense thá»§ cÃ´ng)


2ï¸âƒ£ TrÆ°á»ng há»£p **tá»± dÃ¹ng `<Suspense>` Ä‘á»ƒ kiá»ƒm soÃ¡t pháº¡m vi loading nhá» hÆ¡n**

---

## ğŸ§© **1ï¸âƒ£ CÃ¡ch xÃ i cÆ¡ báº£n â€“ KHÃ”NG cáº§n Suspense**

> âœ… ÄÃ¢y lÃ  cÃ¡ch phá»• biáº¿n nháº¥t â€” Next.js tá»± Suspense hÃ³a page cho báº¡n.

### ğŸ“ Cáº¥u trÃºc:

```
app/
 â”œâ”€ layout.tsx
 â”œâ”€ dashboard/
 â”‚   â”œâ”€ page.tsx
 â”‚   â””â”€ loading.tsx
```

### ğŸ“„ `app/dashboard/page.tsx`

```tsx
// ÄÃ¢y lÃ  1 Server Component
export default async function DashboardPage() {
  // Giáº£ láº­p gá»i API cháº­m
  const res = await fetch("https://jsonplaceholder.typicode.com/posts/1", {
    cache: "no-store",
  });

  const data = await res.json();
  await new Promise((r) => setTimeout(r, 2000)); // delay 2s

  return (
    <div className="p-6">
      <h1 className="text-2xl font-bold mb-2">Dashboard Page</h1>
      <p className="text-gray-700">{data.title}</p>
    </div>
  );
}
```

### âš™ï¸ `app/dashboard/loading.tsx`

```tsx
export default function Loading() {
  return (
    <div className="flex flex-col items-center justify-center h-60">
      <div className="animate-spin rounded-full h-10 w-10 border-4 border-blue-500 border-t-transparent"></div>
      <p className="mt-3 text-gray-500">Äang táº£i dá»¯ liá»‡u Dashboard...</p>
    </div>
  );
}
```

> ğŸ‘‰ Khi báº¡n truy cáº­p `/dashboard`,
> Next.js sáº½ tá»± Ä‘á»™ng hiá»ƒn thá»‹ `loading.tsx` trong lÃºc `page.tsx` Ä‘ang fetch dá»¯ liá»‡u.
> **KhÃ´ng cáº§n Suspense thá»§ cÃ´ng.**

---

## ğŸ§© **2ï¸âƒ£ Khi báº¡n muá»‘n chá»§ Ä‘á»™ng dÃ¹ng `<Suspense>`**

> DÃ¹ng khi báº¡n chá»‰ muá»‘n loading **má»™t pháº§n nhá»** trong trang (VD: sidebar, báº£ng dá»¯ liá»‡u,...)

### ğŸ“ Cáº¥u trÃºc:

```
app/
 â”œâ”€ dashboard/
 â”‚   â”œâ”€ page.tsx
 â”‚   â””â”€ UserList.tsx
```

### ğŸ“„ `app/dashboard/UserList.tsx`

```tsx
export default async function UserList() {
  const res = await fetch("https://jsonplaceholder.typicode.com/users", {
    cache: "no-store",
  });
  const users = await res.json();

  await new Promise((r) => setTimeout(r, 1500)); // giáº£ láº­p cháº­m

  return (
    <ul className="mt-2 space-y-1">
      {users.map((u: any) => (
        <li key={u.id} className="border-b py-1">
          {u.name}
        </li>
      ))}
    </ul>
  );
}
```

### âš™ï¸ `app/dashboard/page.tsx`

```tsx
import { Suspense } from "react";
import UserList from "./UserList";

export default function DashboardPage() {
  return (
    <div className="p-6">
      <h1 className="text-2xl font-bold">User Dashboard</h1>

      <Suspense fallback={<p className="text-gray-500 mt-4">Äang táº£i danh sÃ¡ch ngÆ°á»i dÃ¹ng...</p>}>
        <UserList />
      </Suspense>
    </div>
  );
}
```

### ğŸ” CÃ¡ch hiá»ƒu:

* Cáº£ trang `/dashboard` load ngay láº­p tá»©c.
* Chá»‰ pháº§n `<UserList />` bá»‹ â€œdelayâ€ â†’ trong thá»i gian chá», fallback Ä‘Æ°á»£c hiá»ƒn thá»‹.
* KhÃ´ng áº£nh hÆ°á»Ÿng tá»›i layout hay header.

> ğŸ”¥ DÃ¹ng kiá»ƒu nÃ y cá»±c há»¯u Ã­ch trong dashboard lá»›n, Ä‘á»ƒ page render nhanh cÃ²n data load dáº§n.

---

## ğŸ§  **So sÃ¡nh 2 cÃ¡ch**

| TiÃªu chÃ­                | `loading.tsx` (tá»± Ä‘á»™ng)                 | `<Suspense>` (thá»§ cÃ´ng)          |
| ----------------------- | --------------------------------------- | -------------------------------- |
| Pháº¡m vi loading         | ToÃ n bá»™ segment route                   | Chá»‰ má»™t pháº§n cá»¥ thá»ƒ              |
| Cáº¥u hÃ¬nh                | File `loading.tsx`                      | JSX `<Suspense fallback={...}>`  |
| Khi trigger             | Khi page/server component Ä‘ang chá» data | Khi component con Ä‘ang chá» data  |
| Layout cÃ³ render khÃ´ng? | âœ… CÃ³ â€” layout render trÆ°á»›c              | âœ… CÃ³                             |
| DÃ¹ng khi nÃ o            | Má»—i route riÃªng                         | Nhiá»u pháº§n async trong cÃ¹ng page |
| CÃ³ thá»ƒ káº¿t há»£p?         | âœ… HoÃ n toÃ n cÃ³ thá»ƒ                      | âœ… HoÃ n toÃ n cÃ³ thá»ƒ               |

---

## ğŸ§© **3ï¸âƒ£ Káº¿t há»£p cáº£ 2 â€” Best Practice**

> Khi báº¡n cÃ³ trang vá»«a fetch tá»•ng thá»ƒ, vá»«a fetch tá»«ng pháº§n nhá».

### VÃ­ dá»¥:

```
app/
 â”œâ”€ dashboard/
 â”‚   â”œâ”€ page.tsx
 â”‚   â”œâ”€ loading.tsx
 â”‚   â”œâ”€ Summary.tsx
 â”‚   â””â”€ ActivityFeed.tsx
```

* `loading.tsx`: fallback khi **toÃ n bá»™ trang** Ä‘ang táº£i.
* `<Suspense>`: fallback khi **má»™t pháº§n trong trang** (VD: `ActivityFeed`) Ä‘ang fetch thÃªm.

---

## âœ… **TÃ³m táº¯t dá»… nhá»›**

| Má»¥c Ä‘Ã­ch                                   | DÃ¹ng gÃ¬                                                                                  |
| ------------------------------------------ | ---------------------------------------------------------------------------------------- |
| Hiá»ƒn thá»‹ khi **toÃ n page** Ä‘ang load       | `loading.tsx`                                                                            |
| Hiá»ƒn thá»‹ khi **1 component con** Ä‘ang load | `<Suspense fallback={...}>`                                                              |
| Káº¿t há»£p tá»‘t nháº¥t                           | DÃ¹ng `loading.tsx` cho route chÃ­nh, vÃ  `<Suspense>` cho pháº§n ná»™i dung chi tiáº¿t bÃªn trong |




---
[<< BÃ€I 23](./23.md) | [BÃ€I 25 >>](./25.md)