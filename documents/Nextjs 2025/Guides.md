
Ph·∫ßn n√†y l√† **m·ª•c l·ª•c t·ªïng quan c·ªßa chuy√™n m·ª•c ‚ÄúGuides‚Äù** ‚Äî n√≥ t∆∞∆°ng ƒë∆∞∆°ng v·ªõi ‚ÄúS·ªï tay h∆∞·ªõng d·∫´n chuy√™n s√¢u‚Äù, m·ªü r·ªông t·ª´ ph·∫ßn *Getting Started*.
D∆∞·ªõi ƒë√¢y l√† b·∫£n d·ªãch ti·∫øng Vi·ªát chu·∫©n, r√µ r√†ng, th·ªëng nh·∫•t v·ªÅ thu·∫≠t ng·ªØ v√† phong c√°ch v·ªõi 17 ph·∫ßn tr∆∞·ªõc:

---

# üìò **Guides ‚Äî H∆∞·ªõng d·∫´n chuy√™n s√¢u**

Ph·∫ßn **Guides** cung c·∫•p c√°c h∆∞·ªõng d·∫´n chi ti·∫øt ƒë·ªÉ gi√∫p b·∫°n **v·∫≠n h√†nh, t·ªëi ∆∞u v√† m·ªü r·ªông** ·ª©ng d·ª•ng Next.js trong m√¥i tr∆∞·ªùng th·ª±c t·∫ø.
N·∫øu ph·∫ßn **Getting Started** gi√∫p b·∫°n b·∫Øt ƒë·∫ßu, th√¨ **Guides** s·∫Ω gi√∫p b·∫°n l√†m ch·ªß to√†n b·ªô h·ªá sinh th√°i Next.js.

---

### üîπ **Danh m·ª•c t·ªïng quan**

| Ch·ªß ƒë·ªÅ                                    | M√¥ t·∫£                                                                                                  |
| ----------------------------------------- | ------------------------------------------------------------------------------------------------------ |
| **1. Analytics**                             | ƒêo l∆∞·ªùng v√† theo d√µi hi·ªáu su·∫•t trang b·∫±ng **Next.js Speed Insights**.                                  |
| **2. Authentication**                        | T√¨m hi·ªÉu c√°ch tri·ªÉn khai **x√°c th·ª±c ng∆∞·ªùi d√πng** trong ·ª©ng d·ª•ng Next.js.                               |
| **3. Backend for Frontend**                  | H·ªçc c√°ch s·ª≠ d·ª•ng Next.js nh∆∞ m·ªôt **framework backend**.                                                |
| **4. Caching**                               | T·ªïng quan v·ªÅ **c∆° ch·∫ø b·ªô nh·ªõ ƒë·ªám (cache)** trong Next.js.                                              |
| **5. CI Build Caching**                      | C·∫•u h√¨nh **h·ªá th·ªëng CI** ƒë·ªÉ l∆∞u tr·ªØ v√† t√°i s·ª≠ d·ª•ng cache build c·ªßa Next.js.                            |
| **6. Content Security Policy (CSP)**         | Thi·∫øt l·∫≠p **Ch√≠nh s√°ch b·∫£o m·∫≠t n·ªôi dung (CSP)** cho ·ª©ng d·ª•ng Next.js.                                  |
| **7. CSS-in-JS**                             | S·ª≠ d·ª•ng c√°c th∆∞ vi·ªán **CSS-in-JS** c√πng Next.js.                                                       |
| **8. Custom Server**                         | Kh·ªüi ch·∫°y ·ª©ng d·ª•ng Next.js **b·∫±ng server t√πy ch·ªânh** (custom server).                                  |
| **9. Data Security**                         | T√¨m hi·ªÉu c√°c **t√≠nh nƒÉng b·∫£o m·∫≠t d·ªØ li·ªáu** t√≠ch h·ª£p trong Next.js v√† c√°ch b·∫£o v·ªá d·ªØ li·ªáu ·ª©ng d·ª•ng.     |
| **10. Debugging**                             | H·ªçc c√°ch **debug ·ª©ng d·ª•ng Next.js** b·∫±ng VS Code, Chrome DevTools ho·∫∑c Firefox DevTools.               |
| **11. Draft Mode**                            | S·ª≠ d·ª•ng **draft mode** ƒë·ªÉ chuy·ªÉn ƒë·ªïi gi·ªØa **trang tƒ©nh v√† trang ƒë·ªông** trong App Router.               |
| **12. Environment Variables**                 | Th√™m v√† truy c·∫≠p **bi·∫øn m√¥i tr∆∞·ªùng** trong ·ª©ng d·ª•ng Next.js.                                           |
| **13. Forms**                                 | T·∫°o **bi·ªÉu m·∫´u (forms)** v·ªõi **React Server Actions**.                                                 |
| **14. ISR (Incremental Static Regeneration)** | T·∫°o ho·∫∑c c·∫≠p nh·∫≠t **trang tƒ©nh ƒë·ªông (ISR)** ngay trong runtime.                                        |
| **15. Instrumentation**                       | Ch·∫°y **ƒëo l∆∞·ªùng v√† logic kh·ªüi ƒë·ªông server** b·∫±ng instrumentation hooks trong Next.js.                  |
| **16. Internationalization (i18n)**           | Th√™m **ƒëa ng√¥n ng·ªØ** v√† **ƒë·ªãnh tuy·∫øn qu·ªëc t·∫ø h√≥a** cho ·ª©ng d·ª•ng.                                       |
| **17. JSON-LD**                               | Th√™m **d·ªØ li·ªáu c√≥ c·∫•u tr√∫c (JSON-LD)** ƒë·ªÉ gi√∫p c√¥ng c·ª• t√¨m ki·∫øm v√† AI hi·ªÉu n·ªôi dung trang.             |
| **18. Lazy Loading**                          | T·ªëi ∆∞u hi·ªáu su·∫•t b·∫±ng c√°ch **t·∫£i ch·∫≠m (lazy load)** th∆∞ vi·ªán v√† component React.                       |
| **19. Development Environment**               | T·ªëi ∆∞u **m√¥i tr∆∞·ªùng ph√°t tri·ªÉn c·ª•c b·ªô** cho Next.js.                                                   |
| **20. MDX**                                   | C·∫•u h√¨nh v√† s·ª≠ d·ª•ng **MDX** trong ·ª©ng d·ª•ng Next.js.                                                    |
| **21. Memory Usage**                          | T·ªëi ∆∞u **b·ªô nh·ªõ** trong qu√° tr√¨nh ph√°t tri·ªÉn v√† s·∫£n xu·∫•t.                                              |
| **22. Migrating**                             | H∆∞·ªõng d·∫´n **chuy·ªÉn ƒë·ªïi (migrate)** t·ª´ framework kh√°c sang Next.js.                                     |
| **23. Multi-tenant**                          | X√¢y d·ª±ng **·ª©ng d·ª•ng ƒëa tenant (nhi·ªÅu kh√¥ng gian ng∆∞·ªùi d√πng)** v·ªõi App Router.                          |
| **24. Multi-zones**                           | X√¢y d·ª±ng **micro-frontend** b·∫±ng **Multi-Zones**, cho ph√©p deploy nhi·ªÅu app Next.js tr√™n c√πng domain.  |
| **25. OpenTelemetry**                         | T√≠ch h·ª£p **OpenTelemetry** ƒë·ªÉ theo d√µi, ƒëo l∆∞·ªùng v√† quan s√°t ·ª©ng d·ª•ng Next.js.                         |
| **26. Package Bundling**                      | T·ªëi ∆∞u **bundle server v√† client** ƒë·ªÉ gi·∫£m k√≠ch th∆∞·ªõc v√† tƒÉng hi·ªáu su·∫•t.                               |
| **27. Prefetching**                           | C·∫•u h√¨nh **prefetching** trong Next.js ƒë·ªÉ tƒÉng t·ªëc ƒëi·ªÅu h∆∞·ªõng trang.                                   |
| **28. Production**                            | C√°c khuy·∫øn ngh·ªã ƒë·ªÉ ƒë·∫°t **hi·ªáu su·∫•t v√† tr·∫£i nghi·ªám ng∆∞·ªùi d√πng t·ªët nh·∫•t** khi ƒë∆∞a ·ª©ng d·ª•ng v√†o s·∫£n xu·∫•t. |
| **29. PWAs**                                  | X√¢y d·ª±ng **Progressive Web App (PWA)** v·ªõi Next.js.                                                    |
| **30. Redirecting**                           | C√°c c√°ch kh√°c nhau ƒë·ªÉ **x·ª≠ l√Ω chuy·ªÉn h∆∞·ªõng (redirect)** trong Next.js.                                 |
| **31. Sass**                                  | D√πng **Sass/SCSS** ƒë·ªÉ t·∫°o style cho ·ª©ng d·ª•ng.                                                          |
| **32. Scripts**                               | T·ªëi ∆∞u **script b√™n th·ª© ba (3rd-party)** b·∫±ng component t√≠ch h·ª£p `next/script`.                        |
| **33. Self-Hosting**                          | H·ªçc c√°ch **t·ª± host** ·ª©ng d·ª•ng Next.js tr√™n Node.js, Docker ho·∫∑c static HTML.                           |
| **34. SPAs**                                  | T√¨m hi·ªÉu c√°ch Next.js h·ªó tr·ª£ x√¢y d·ª±ng **Single-Page Application (SPA)** ƒë·∫ßy ƒë·ªß.                        |
| **35. Static Exports**                        | B·∫Øt ƒë·∫ßu nh∆∞ **website tƒ©nh ho·∫∑c SPA**, sau ƒë√≥ n√¢ng c·∫•p ƒë·ªÉ d√πng c√°c t√≠nh nƒÉng server.                   |
| **36. Tailwind CSS v3**                       | S·ª≠ d·ª•ng **Tailwind CSS v3** ƒë·ªÉ style ·ª©ng d·ª•ng v·ªõi ƒë·ªô t∆∞∆°ng th√≠ch tr√¨nh duy·ªát cao h∆°n.                  |
| **37. Testing**                               | Thi·∫øt l·∫≠p **ki·ªÉm th·ª≠ (testing)** v·ªõi **Cypress, Playwright, Vitest, Jest**.                            |
| **38. Third Party Libraries**                 | T·ªëi ∆∞u hi·ªáu su·∫•t **th∆∞ vi·ªán b√™n th·ª© ba** b·∫±ng package `@next/third-parties`.                           |
| **39. Upgrading**                             | C·∫≠p nh·∫≠t l√™n **phi√™n b·∫£n Next.js m·ªõi nh·∫•t**.                                                           |
| **40. Videos**                                | H∆∞·ªõng d·∫´n **t·ªëi ∆∞u video** trong ·ª©ng d·ª•ng Next.js.                                                     |

---

‚úÖ **T√≥m t·∫Øt:**

* ‚ÄúGuides‚Äù l√† t√†i li·ªáu chuy√™n s√¢u ‚Äî n∆°i b·∫°n h·ªçc **c√°ch tri·ªÉn khai v√† v·∫≠n h√†nh ·ª©ng d·ª•ng Next.js trong m√¥i tr∆∞·ªùng th·ª±c t·∫ø**.
* Bao qu√°t t·ª´ **b·∫£o m·∫≠t, hi·ªáu su·∫•t, ki·ªÉm th·ª≠, deployment, i18n, caching, authentication**, ƒë·∫øn **PWA, CI/CD v√† debugging**.
* M·ªói m·ª•c s·∫Ω ƒë∆∞·ª£c tr√¨nh b√†y chi ti·∫øt trong c√°c ph·∫ßn ti·∫øp theo.

---

# **Ph·∫ßn 1: Analytics ‚Äî Th√™m ph√¢n t√≠ch hi·ªáu su·∫•t cho ·ª©ng d·ª•ng Next.js**

## üéØ **C√°ch th√™m ph√¢n t√≠ch (Analytics) v√†o ·ª©ng d·ª•ng Next.js**

Next.js c√≥ **h·ªó tr·ª£ t√≠ch h·ª£p s·∫µn** cho vi·ªác **ƒëo l∆∞·ªùng v√† b√°o c√°o c√°c ch·ªâ s·ªë hi·ªáu su·∫•t (performance metrics)**.
B·∫°n c√≥ hai l·ª±a ch·ªçn ch√≠nh:

1. **T·ª± qu·∫£n l√Ω vi·ªác b√°o c√°o** b·∫±ng hook `useReportWebVitals`.
2. **S·ª≠ d·ª•ng d·ªãch v·ª• qu·∫£n l√Ω t·ª± ƒë·ªông c·ªßa Vercel**, cho ph√©p **thu th·∫≠p v√† hi·ªÉn th·ªã bi·ªÉu ƒë·ªì hi·ªáu su·∫•t** m√† kh√¥ng c·∫ßn c√†i ƒë·∫∑t th·ªß c√¥ng.

---

## ‚öôÔ∏è **Client Instrumentation**

ƒê·ªëi v·ªõi c√°c nhu c·∫ßu ph√¢n t√≠ch v√† gi√°m s√°t n√¢ng cao h∆°n (advanced analytics & monitoring),
Next.js cung c·∫•p file ƒë·∫∑c bi·ªát **`instrumentation-client.js` | `instrumentation-client.ts`** ‚Äî
file n√†y **ch·∫°y tr∆∞·ªõc khi m√£ frontend c·ªßa ·ª©ng d·ª•ng kh·ªüi ƒë·ªông**.

ƒêi·ªÅu n√†y **l√Ω t∆∞·ªüng ƒë·ªÉ thi·∫øt l·∫≠p c√°c c√¥ng c·ª• to√†n c·ª•c (global tools)** nh∆∞:

* Theo d√µi l·ªói (error tracking)
* Gi√°m s√°t hi·ªáu su·∫•t (performance monitoring)
* Kh·ªüi t·∫°o d·ªãch v·ª• ph√¢n t√≠ch (analytics SDK)

### üîß C√°ch s·ª≠ d·ª•ng:

T·∫°o file `instrumentation-client.js` ho·∫∑c `instrumentation-client.ts` ·ªü th∆∞ m·ª•c g·ªëc c·ªßa ·ª©ng d·ª•ng:

```js
// instrumentation-client.js

// Kh·ªüi t·∫°o analytics tr∆∞·ªõc khi app b·∫Øt ƒë·∫ßu
console.log('Analytics initialized')

// Thi·∫øt l·∫≠p theo d√µi l·ªói to√†n c·ª•c
window.addEventListener('error', (event) => {
  // G·ª≠i l·ªói ƒë·∫øn h·ªá th·ªëng gi√°m s√°t c·ªßa b·∫°n
  reportError(event.error)
})
```

---

## üß± **T·ª± x√¢y d·ª±ng Web Vitals Tracking (Build Your Own)**

B·∫°n c√≥ th·ªÉ t·ª± vi·∫øt component nh·ªè ƒë·ªÉ theo d√µi c√°c ch·ªâ s·ªë **Web Vitals** b·∫±ng hook `useReportWebVitals`.

```js
// app/_components/web-vitals.js

'use client'

import { useReportWebVitals } from 'next/web-vitals'

export function WebVitals() {
  useReportWebVitals((metric) => {
    console.log(metric)
  })
}
```

V√† import component n√†y v√†o layout g·ªëc:

```js
// app/layout.js

import { WebVitals } from './_components/web-vitals'

export default function Layout({ children }) {
  return (
    <html>
      <body>
        <WebVitals />
        {children}
      </body>
    </html>
  )
}
```

### üí° L∆∞u √Ω quan tr·ªçng:

V√¨ `useReportWebVitals` y√™u c·∫ßu **directive `'use client'`**,
n√™n **t·ªët nh·∫•t l√† t·∫°o component ri√™ng bi·ªát** (v√≠ d·ª• `WebVitals`)
v√† ch·ªâ import component ƒë√≥ trong layout g·ªëc.
ƒêi·ªÅu n√†y gi√∫p **gi·ªõi h·∫°n ph·∫°m vi client-side** ch·ªâ ·ªü WebVitals component ‚Üí c·∫£i thi·ªán hi·ªáu su·∫•t render.

---

## üìä **Web Vitals l√† g√¨?**

**Web Vitals** l√† t·∫≠p h·ª£p c√°c ch·ªâ s·ªë ƒëo **tr·∫£i nghi·ªám ng∆∞·ªùi d√πng th·ª±c t·∫ø tr√™n trang web**.
Next.js cung c·∫•p s·∫µn c√°c ch·ªâ s·ªë sau:

| T√™n                                 | √ù nghƒ©a                                                                              |
| ----------------------------------- | ------------------------------------------------------------------------------------ |
| **TTFB** (Time to First Byte)       | Th·ªùi gian t·ª´ khi ng∆∞·ªùi d√πng g·ª≠i request ƒë·∫øn khi nh·∫≠n byte ƒë·∫ßu ti√™n t·ª´ server.        |
| **FCP** (First Contentful Paint)    | Th·ªùi ƒëi·ªÉm ph·∫ßn t·ª≠ n·ªôi dung ƒë·∫ßu ti√™n ƒë∆∞·ª£c hi·ªÉn th·ªã.                                   |
| **LCP** (Largest Contentful Paint)  | Th·ªùi ƒëi·ªÉm ph·∫ßn t·ª≠ n·ªôi dung l·ªõn nh·∫•t hi·ªÉn th·ªã ho√†n ch·ªânh.                             |
| **FID** (First Input Delay)         | ƒê·ªô tr·ªÖ gi·ªØa l·∫ßn t∆∞∆°ng t√°c ƒë·∫ßu ti√™n c·ªßa ng∆∞·ªùi d√πng v√† khi tr√¨nh duy·ªát ph·∫£n h·ªìi.       |
| **CLS** (Cumulative Layout Shift)   | ƒêo ƒë·ªô ‚Äúx√™ d·ªãch layout‚Äù trong khi t·∫£i trang.                                          |
| **INP** (Interaction to Next Paint) | Th·ªùi gian t·ª´ khi ng∆∞·ªùi d√πng t∆∞∆°ng t√°c ƒë·∫øn khi giao di·ªán ph·∫£n h·ªìi b·∫±ng paint k·∫ø ti·∫øp. |

B·∫°n c√≥ th·ªÉ x·ª≠ l√Ω t·ª´ng ch·ªâ s·ªë d·ª±a v√†o thu·ªôc t√≠nh `metric.name`.

```tsx
// app/_components/web-vitals.tsx

'use client'

import { useReportWebVitals } from 'next/web-vitals'

export function WebVitals() {
  useReportWebVitals((metric) => {
    switch (metric.name) {
      case 'FCP': {
        // X·ª≠ l√Ω k·∫øt qu·∫£ FCP
        break
      }
      case 'LCP': {
        // X·ª≠ l√Ω k·∫øt qu·∫£ LCP
        break
      }
      // ...
    }
  })
}
```

---

## üåê **G·ª≠i k·∫øt qu·∫£ ƒë·∫øn h·ªá th·ªëng b√™n ngo√†i**

B·∫°n c√≥ th·ªÉ **g·ª≠i d·ªØ li·ªáu Web Vitals ƒë·∫øn b·∫•t k·ª≥ endpoint n√†o** ƒë·ªÉ l∆∞u tr·ªØ v√† ph√¢n t√≠ch hi·ªáu su·∫•t ng∆∞·ªùi d√πng th·ª±c.

V√≠ d·ª•:

```js
useReportWebVitals((metric) => {
  const body = JSON.stringify(metric)
  const url = 'https://example.com/analytics'

  // ∆Øu ti√™n s·ª≠ d·ª•ng navigator.sendBeacon() n·∫øu c√≥, fallback sang fetch()
  if (navigator.sendBeacon) {
    navigator.sendBeacon(url, body)
  } else {
    fetch(url, { body, method: 'POST', keepalive: true })
  }
})
```

### üí° L∆∞u √Ω:

N·∫øu b·∫°n d√πng **Google Analytics (GA)**, c√≥ th·ªÉ t·∫≠n d·ª•ng `metric.id`
ƒë·ªÉ x√¢y d·ª±ng **ph√¢n ph·ªëi th·ªëng k√™ (distribution)**, v√≠ d·ª• ƒë·ªÉ t√≠nh percentile (90th, 95th...).

V√≠ d·ª• g·ª≠i d·ªØ li·ªáu Web Vitals ƒë·∫øn **Google Analytics**:

```js
useReportWebVitals((metric) => {
  // S·ª≠ d·ª•ng window.gtag n·∫øu b·∫°n ƒë√£ kh·ªüi t·∫°o GA nh∆∞ v√≠ d·ª• ch√≠nh th·ª©c:
  // https://github.com/vercel/next.js/blob/canary/examples/with-google-analytics
  window.gtag('event', metric.name, {
    value: Math.round(metric.name === 'CLS' ? metric.value * 1000 : metric.value),
    event_label: metric.id,      // ID duy nh·∫•t cho m·ªói l·∫ßn t·∫£i trang
    non_interaction: true,       // Kh√¥ng ·∫£nh h∆∞·ªüng ƒë·∫øn bounce rate
  })
})
```

üìò Tham kh·∫£o th√™m: [Sending results to Google Analytics](https://github.com/vercel/next.js/tree/canary/examples/with-google-analytics)

---

## üìö **API Reference**

* [`useReportWebVitals`](https://nextjs.org/docs/app/api-reference/functions/use-report-web-vitals)
* [`instrumentation-client.js`](https://nextjs.org/docs/app/api-reference/file-conventions/instrumentation-client)

---

## ‚úÖ **T√≥m t·∫Øt nhanh**

| N·ªôi dung                        | M√¥ t·∫£                                                                            |
| ------------------------------- | -------------------------------------------------------------------------------- |
| **`useReportWebVitals`**        | Hook ƒë·ªÉ thu th·∫≠p v√† g·ª≠i c√°c ch·ªâ s·ªë Web Vitals.                                   |
| **`instrumentation-client.js`** | File ƒë·∫∑c bi·ªát kh·ªüi ch·∫°y **tr∆∞·ªõc m√£ frontend**, d√πng ƒë·ªÉ c√†i ƒë·∫∑t c√¥ng c·ª• gi√°m s√°t. |
| **Web Vitals**                  | B·ªô ch·ªâ s·ªë ƒë√°nh gi√° tr·∫£i nghi·ªám th·ª±c t·∫ø c·ªßa ng∆∞·ªùi d√πng.                           |
| **K·∫øt n·ªëi h·ªá th·ªëng ngo√†i**      | G·ª≠i d·ªØ li·ªáu ƒë·∫øn endpoint ho·∫∑c Google Analytics ƒë·ªÉ theo d√µi hi·ªáu su·∫•t th·ª±c t·∫ø.    |

---
## Ph·∫ßn 2: X√°c th·ª±c (Authentication)

C√°ch tri·ªÉn khai x√°c th·ª±c trong Next.js
Hi·ªÉu r√µ c∆° ch·∫ø x√°c th·ª±c l√† ƒëi·ªÅu c·ªët l√µi ƒë·ªÉ b·∫£o v·ªá d·ªØ li·ªáu c·ªßa ·ª©ng d·ª•ng. Ph·∫ßn n√†y h∆∞·ªõng d·∫´n c√°ch s·ª≠ d·ª•ng c√°c t√≠nh nƒÉng c·ªßa React v√† Next.js ƒë·ªÉ tri·ªÉn khai h·ªá th·ªëng x√°c th·ª±c.

Tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu, ta chia qu√° tr√¨nh n√†y th√†nh 3 kh√°i ni·ªám:

* **Authentication (X√°c th·ª±c):** X√°c minh ng∆∞·ªùi d√πng c√≥ ƒë√∫ng l√† h·ªç n√≥i hay kh√¥ng. Y√™u c·∫ßu h·ªç ch·ª©ng minh danh t√≠nh b·∫±ng th·ª© g√¨ ƒë√≥ h·ªç c√≥, nh∆∞ t√™n ƒëƒÉng nh·∫≠p v√† m·∫≠t kh·∫©u.
* **Session Management (Qu·∫£n l√Ω phi√™n):** Theo d√µi tr·∫°ng th√°i ƒëƒÉng nh·∫≠p c·ªßa ng∆∞·ªùi d√πng gi·ªØa c√°c request.
* **Authorization (Ph√¢n quy·ªÅn):** Quy·∫øt ƒë·ªãnh ng∆∞·ªùi d√πng ƒë∆∞·ª£c ph√©p truy c·∫≠p route ho·∫∑c d·ªØ li·ªáu n√†o.

S∆° ƒë·ªì d∆∞·ªõi minh h·ªça lu·ªìng x√°c th·ª±c s·ª≠ d·ª•ng c√°c t√≠nh nƒÉng c·ªßa React v√† Next.js.

C√°c v√≠ d·ª• trong t√†i li·ªáu n√†y minh h·ªça qu√° tr√¨nh x√°c th·ª±c c∆° b·∫£n b·∫±ng t√™n ng∆∞·ªùi d√πng v√† m·∫≠t kh·∫©u. M·∫∑c d√π b·∫°n c√≥ th·ªÉ t·ª± tri·ªÉn khai h·ªá th·ªëng x√°c th·ª±c, nh∆∞ng ƒë·ªÉ tƒÉng b·∫£o m·∫≠t v√† ƒë∆°n gi·∫£n h√≥a, n√™n d√πng **th∆∞ vi·ªán x√°c th·ª±c (Auth Library)**. C√°c th∆∞ vi·ªán n√†y cung c·∫•p s·∫µn ch·ª©c nƒÉng x√°c th·ª±c, qu·∫£n l√Ω phi√™n, ph√¢n quy·ªÅn, ƒëƒÉng nh·∫≠p m·∫°ng x√£ h·ªôi, x√°c th·ª±c ƒëa y·∫øu t·ªë (MFA), v√† ki·ªÉm so√°t truy c·∫≠p theo vai tr√≤ (RBAC). Danh s√°ch ƒë∆∞·ª£c li·ªát k√™ trong ph·∫ßn **Auth Libraries**.

---

### Authentication

#### ƒêƒÉng k√Ω v√† ƒëƒÉng nh·∫≠p

B·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng th·∫ª `<form>` k·∫øt h·ª£p v·ªõi **Server Actions** v√† **useActionState** trong React ƒë·ªÉ l·∫•y th√¥ng tin ng∆∞·ªùi d√πng, ki·ªÉm tra h·ª£p l·ªá, v√† g·ªçi API ho·∫∑c database c·ªßa nh√† cung c·∫•p x√°c th·ª±c.

V√¨ **Server Actions** lu√¥n ch·∫°y tr√™n server n√™n ƒë√¢y l√† m√¥i tr∆∞·ªùng an to√†n ƒë·ªÉ x·ª≠ l√Ω logic x√°c th·ª±c.

**C√°c b∆∞·ªõc th·ª±c hi·ªán:**

**1. Thu th·∫≠p th√¥ng tin ng∆∞·ªùi d√πng:**
T·∫°o form g·ªçi Server Action khi submit. V√≠ d·ª• form ƒëƒÉng k√Ω nh·∫≠n t√™n, email v√† m·∫≠t kh·∫©u:
*(code gi·ªØ nguy√™n nh∆∞ b·∫£n g·ªëc)*

**2. X√°c th·ª±c d·ªØ li·ªáu tr√™n server:**
D√πng Server Action ƒë·ªÉ ki·ªÉm tra h·ª£p l·ªá. N·∫øu nh√† cung c·∫•p ch∆∞a h·ªó tr·ª£, c√≥ th·ªÉ d√πng th∆∞ vi·ªán nh∆∞ **Zod** ho·∫∑c **Yup** ƒë·ªÉ ki·ªÉm tra schema.
*(code gi·ªØ nguy√™n nh∆∞ b·∫£n g·ªëc)*

N·∫øu d·ªØ li·ªáu kh√¥ng h·ª£p l·ªá, return s·ªõm ƒë·ªÉ tr√°nh g·ªçi API ho·∫∑c database kh√¥ng c·∫ßn thi·∫øt.
*(code gi·ªØ nguy√™n nh∆∞ b·∫£n g·ªëc)*

Trong component `<SignupForm />`, d√πng `useActionState` ƒë·ªÉ hi·ªÉn th·ªã l·ªói khi form ƒëang submit.
*(code gi·ªØ nguy√™n nh∆∞ b·∫£n g·ªëc)*

**L∆∞u √Ω:**

* Trong React 19, `useFormStatus` c√≥ th√™m nhi·ªÅu thu·ªôc t√≠nh nh∆∞ `data`, `method`, `action`. N·∫øu kh√¥ng d√πng React 19, ch·ªâ c√≥ `pending`.
* Tr∆∞·ªõc khi thay ƒë·ªïi d·ªØ li·ªáu, lu√¥n ƒë·∫£m b·∫£o ng∆∞·ªùi d√πng c√≥ quy·ªÅn th·ª±c hi·ªán h√†nh ƒë·ªông ƒë√≥ (Authorization).

**3. T·∫°o t√†i kho·∫£n ho·∫∑c ki·ªÉm tra th√¥ng tin ƒëƒÉng nh·∫≠p:**
Sau khi ki·ªÉm tra h·ª£p l·ªá, t·∫°o t√†i kho·∫£n ho·∫∑c x√°c minh ng∆∞·ªùi d√πng qua API ho·∫∑c database.
*(code gi·ªØ nguy√™n nh∆∞ b·∫£n g·ªëc)*

Khi t·∫°o t√†i kho·∫£n th√†nh c√¥ng ho·∫∑c x√°c th·ª±c th√†nh c√¥ng, t·∫°o **session** ƒë·ªÉ qu·∫£n l√Ω tr·∫°ng th√°i ƒëƒÉng nh·∫≠p. Session c√≥ th·ªÉ l∆∞u trong cookie, database ho·∫∑c c·∫£ hai (chi ti·∫øt ·ªü ph·∫ßn Session Management).

**M·∫πo:**

* ƒêo·∫°n v√≠ d·ª• d√†i d√≤ng ƒë·ªÉ gi·∫£i th√≠ch chi ti·∫øt t·ª´ng b∆∞·ªõc, gi√∫p b·∫°n th·∫•y r√µ vi·ªác t·ª± x√¢y d·ª±ng h·ªá th·ªëng x√°c th·ª±c an to√†n ph·ª©c t·∫°p ra sao.
* N√™n d√πng **Auth Library** ƒë·ªÉ gi·∫£m c√¥ng s·ª©c.
* C√≥ th·ªÉ ki·ªÉm tra tr√πng email ho·∫∑c username s·ªõm h∆°n trong qu√° tr√¨nh nh·∫≠p b·∫±ng debounce (v√≠ d·ª• v·ªõi `use-debounce`) ƒë·ªÉ tr√°nh submit form kh√¥ng c·∫ßn thi·∫øt.

---

### Session Management

Qu·∫£n l√Ω phi√™n ƒë·∫£m b·∫£o tr·∫°ng th√°i ƒëƒÉng nh·∫≠p c·ªßa ng∆∞·ªùi d√πng ƒë∆∞·ª£c duy tr√¨ gi·ªØa c√°c request. Bao g·ªìm t·∫°o, l∆∞u tr·ªØ, l√†m m·ªõi v√† x√≥a session/token.

**Hai lo·∫°i session ch√≠nh:**

* **Stateless:** D·ªØ li·ªáu l∆∞u tr·ª±c ti·∫øp trong cookie, ƒë∆∞·ª£c g·ª≠i ƒëi trong m·ªói request. D·ªÖ tri·ªÉn khai nh∆∞ng k√©m an to√†n n·∫øu l√†m sai.
* **Database:** L∆∞u d·ªØ li·ªáu phi√™n trong database, c√≤n tr√¨nh duy·ªát ch·ªâ gi·ªØ ID m√£ h√≥a. An to√†n h∆°n, nh∆∞ng ph·ª©c t·∫°p v√† t·ªën t√†i nguy√™n h∆°n.

Khuy·∫øn ngh·ªã: s·ª≠ d·ª•ng th∆∞ vi·ªán nh∆∞ **iron-session** ho·∫∑c **jose**.

---

### Stateless Sessions

**B∆∞·ªõc 1:** T·∫°o secret key
D√πng l·ªánh:

```bash
openssl rand -base64 32
```

L∆∞u v√†o file `.env`:

```
SESSION_SECRET=your_secret_key
```

**B∆∞·ªõc 2:** M√£ h√≥a / Gi·∫£i m√£ session
D√πng th∆∞ vi·ªán **Jose** ƒë·ªÉ m√£ h√≥a JWT session.
*(code gi·ªØ nguy√™n nh∆∞ b·∫£n g·ªëc)*

**L∆∞u √Ω:** Payload ch·ªâ n√™n ch·ª©a d·ªØ li·ªáu t·ªëi thi·ªÉu nh∆∞ userId, role,... Kh√¥ng n√™n ch·ª©a th√¥ng tin nh·∫°y c·∫£m (email, password, th·∫ª t√≠n d·ª•ng,...).

**B∆∞·ªõc 3:** L∆∞u session trong cookie
D√πng API `cookies` c·ªßa Next.js. N√™n c·∫•u h√¨nh cookie v·ªõi:

* `HttpOnly: true`
* `Secure: true`
* `SameSite: 'lax'`
* `Expires` ho·∫∑c `Max-Age`
  *(code gi·ªØ nguy√™n nh∆∞ b·∫£n g·ªëc)*

Sau ƒë√≥ g·ªçi `createSession()` trong Server Action v√† d√πng `redirect()` ƒë·ªÉ ƒëi·ªÅu h∆∞·ªõng.
*(code gi·ªØ nguy√™n nh∆∞ b·∫£n g·ªëc)*

**M·∫πo:**
Cookie n√™n ƒë∆∞·ª£c set ·ªü server ƒë·ªÉ tr√°nh b·ªã s·ª≠a ƒë·ªïi t·ª´ client.

---

### L√†m m·ªõi (refresh) session

C√≥ th·ªÉ gia h·∫°n th·ªùi gian h·∫øt h·∫°n c·ªßa session khi ng∆∞·ªùi d√πng quay l·∫°i app.
*(code gi·ªØ nguy√™n nh∆∞ b·∫£n g·ªëc)*

---

### X√≥a session

D√πng `cookies().delete('session')` ƒë·ªÉ x√≥a cookie khi logout.
*(code gi·ªØ nguy√™n nh∆∞ b·∫£n g·ªëc)*

---

### Database Sessions

T·∫°o b·∫£ng l∆∞u session, th√™m logic th√™m/x√≥a/c·∫≠p nh·∫≠t.
M√£ h√≥a session ID tr∆∞·ªõc khi l∆∞u v√†o cookie.
*(code gi·ªØ nguy√™n nh∆∞ b·∫£n g·ªëc)*

**M·∫πo:**

* C√≥ th·ªÉ cache session trong memory ƒë·ªÉ gi·∫£m truy v·∫•n.
* D√πng database sessions ƒë·ªÉ qu·∫£n l√Ω thi·∫øt b·ªã ƒëƒÉng nh·∫≠p ho·∫∑c cho ph√©p ng∆∞·ªùi d√πng logout kh·ªèi t·∫•t c·∫£ thi·∫øt b·ªã.

---

### Authorization

Sau khi x√°c th·ª±c v√† t·∫°o session, c·∫ßn ki·ªÉm so√°t quy·ªÅn truy c·∫≠p.

**Hai lo·∫°i ki·ªÉm tra:**

* **Optimistic:** D·ª±a v√†o session trong cookie, nhanh nh∆∞ng √≠t an to√†n.
* **Secure:** Ki·ªÉm tra session trong database, an to√†n h∆°n cho d·ªØ li·ªáu nh·∫°y c·∫£m.

---

### Ki·ªÉm tra Optimistic v·ªõi Middleware

D√πng Middleware ƒë·ªÉ ch·∫∑n ho·∫∑c redirect ng∆∞·ªùi d√πng d·ª±a theo session.
*(code gi·ªØ nguy√™n nh∆∞ b·∫£n g·ªëc)*

**L∆∞u √Ω:**
Middleware ch·ªâ n√™n ƒë·ªçc session t·ª´ cookie, tr√°nh truy v·∫•n database ƒë·ªÉ kh√¥ng ·∫£nh h∆∞·ªüng hi·ªáu su·∫•t.

---

### T·∫ßng Truy c·∫≠p D·ªØ li·ªáu (DAL - Data Access Layer)

DAL gi√∫p gom logic ki·ªÉm tra quy·ªÅn truy c·∫≠p v√† truy v·∫•n d·ªØ li·ªáu.
T·∫°o h√†m `verifySession()` ƒë·ªÉ x√°c minh session, tr·∫£ v·ªÅ userId h·ª£p l·ªá ho·∫∑c redirect `/login`.
*(code gi·ªØ nguy√™n nh∆∞ b·∫£n g·ªëc)*

---

### DTO (Data Transfer Object)

Khi tr·∫£ d·ªØ li·ªáu, ch·ªâ tr·∫£ ph·∫ßn c·∫ßn thi·∫øt (id, name, role,...) ƒë·ªÉ tr√°nh l·ªô th√¥ng tin nh·∫°y c·∫£m.
*(code gi·ªØ nguy√™n nh∆∞ b·∫£n g·ªëc)*

---

### Server Components

D√πng x√°c th·ª±c trong Server Components ƒë·ªÉ hi·ªÉn th·ªã giao di·ªán theo vai tr√≤ ng∆∞·ªùi d√πng (admin/user).
*(code gi·ªØ nguy√™n nh∆∞ b·∫£n g·ªëc)*

---

### Layouts v√† ki·ªÉm tra x√°c th·ª±c

Kh√¥ng n√™n ki·ªÉm tra trong Layout v√¨ ch√∫ng kh√¥ng re-render khi ƒëi·ªÅu h∆∞·ªõng. Thay v√†o ƒë√≥, ki·ªÉm tra ·ªü DAL g·∫ßn ngu·ªìn d·ªØ li·ªáu.
*(code gi·ªØ nguy√™n nh∆∞ b·∫£n g·ªëc)*

---

### Server Actions v√† Route Handlers

ƒê·ªëi x·ª≠ v·ªõi Server Actions v√† API Routes nh∆∞ endpoint c√¥ng khai ‚Äì lu√¥n x√°c minh quy·ªÅn tr∆∞·ªõc khi x·ª≠ l√Ω.
*(code gi·ªØ nguy√™n nh∆∞ b·∫£n g·ªëc)*

---

### Context Providers

Auth context ch·ªâ ho·∫°t ƒë·ªông trong Client Components. N·∫øu c·∫ßn session trong Client, d√πng `taintUniqueValue` ƒë·ªÉ tr√°nh l·ªô d·ªØ li·ªáu nh·∫°y c·∫£m.
*(code gi·ªØ nguy√™n nh∆∞ b·∫£n g·ªëc)*

---

### T√†i nguy√™n

**Auth Libraries:**
Auth0, Better Auth, Clerk, Kinde, Logto, NextAuth.js, Ory, Stack Auth, Supabase, Stytch, WorkOS

**Session Management Libraries:**
Iron Session, Jose

**T√†i li·ªáu ƒë·ªçc th√™m:**

* Security trong Next.js
* XSS Attacks
* CSRF Attacks
* The Copenhagen Book
---
## Ph·∫ßn 3. **Backend for Frontend (BFF) v·ªõi Next.js**

Next.js h·ªó tr·ª£ m√¥ h√¨nh **Backend for Frontend**, cho ph√©p t·∫°o c√°c **public endpoints** ƒë·ªÉ x·ª≠ l√Ω HTTP request v√† tr·∫£ v·ªÅ m·ªçi lo·∫°i content‚Äînot ch·ªâ HTML. Ngo√†i ra, b·∫°n c√≥ th·ªÉ truy c·∫≠p nhi·ªÅu ngu·ªìn d·ªØ li·ªáu v√† th·ª±c hi·ªán side effects nh∆∞ c·∫≠p nh·∫≠t d·ªØ li·ªáu t·ª´ remote API.

N·∫øu b·∫Øt ƒë·∫ßu d·ª± √°n m·ªõi, d√πng:

```bash
npx create-next-app@latest --api
```

* T√πy ch·ªçn `--api` t·ª± ƒë·ªông t·∫°o v√≠ d·ª• `route.ts` trong folder `app/` minh h·ªça c√°ch t·∫°o API endpoint.
* L∆∞u √Ω: Next.js **kh√¥ng thay th·∫ø ho√†n to√†n backend**, n√≥ ch·ªâ cung c·∫•p layer API:

  * Truy c·∫≠p c√¥ng khai
  * X·ª≠ l√Ω m·ªçi HTTP request
  * Tr·∫£ v·ªÅ b·∫•t k·ª≥ content type n√†o

---

### 1. Route Handlers

* **Route Handlers** l√† public HTTP endpoints, client n√†o c≈©ng g·ªçi ƒë∆∞·ª£c.
* T·∫°o file `route.ts` ho·∫∑c `route.js` trong `app/api/`:

```ts
// /app/api/route.ts
export function GET(request: Request) {}
```

* V·ªõi POST ho·∫∑c c√°c thao t√°c c√≥ th·ªÉ throw exception, d√πng `try/catch`:

```ts
import { submit } from '@/lib/submit'

export async function POST(request: Request) {
  try {
    await submit(request)
    return new Response(null, { status: 204 })
  } catch (reason) {
    const message = reason instanceof Error ? reason.message : 'Unexpected error'
    return new Response(message, { status: 500 })
  }
}
```

* **Kh√¥ng ti·∫øt l·ªô th√¥ng tin nh·∫°y c·∫£m trong l·ªói.**
* H·∫°n ch·∫ø truy c·∫≠p: k·∫øt h·ª£p v·ªõi authentication & authorization.

---

### 2. Content Types & Custom Endpoints

* Route Handlers tr·∫£ JSON, XML, h√¨nh ·∫£nh, file, text.
* File conventions: `sitemap.xml`, `favicon.ico`, `manifest.json`, `robots.txt`
* Custom endpoints: `rss.xml`, `llms.txt`, `.well-known`

V√≠ d·ª• RSS feed:

```ts
// /app/rss.xml/route.ts
export async function GET(request: Request) {
  const rssResponse = await fetch('/* rss endpoint */')
  const rssData = await rssResponse.json()

  const rssFeed = `<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0">
<channel>
 <title>${rssData.title}</title>
 <description>${rssData.description}</description>
 <link>${rssData.link}</link>
 <copyright>${rssData.copyright}</copyright>
 ${rssData.items.map(item => `<item>
    <title>${item.title}</title>
    <description>${item.description}</description>
    <link>${item.link}</link>
    <pubDate>${item.publishDate}</pubDate>
    <guid isPermaLink="false">${item.guid}</guid>
 </item>`)}
</channel>
</rss>`

  const headers = new Headers({ 'content-type': 'application/xml' })
  return new Response(rssFeed, { headers })
}
```

* **Sanitize m·ªçi input** tr∆∞·ªõc khi t·∫°o markup.

---

### 3. Consuming Request Payloads

* D√πng `.json()`, `.formData()`, `.text()` ƒë·ªÉ ƒë·ªçc request body. GET/HEAD kh√¥ng c√≥ body.

```ts
// /app/api/echo-body/route.ts
export async function POST(request: Request) {
  const res = await request.json()
  return Response.json({ res })
}
```

* Validate d·ªØ li·ªáu tr∆∞·ªõc khi g·ª≠i ƒë·∫øn h·ªá th·ªëng kh√°c.

```ts
// /app/api/send-email/route.ts
import { sendMail, validateInputs } from '@/lib/email-transporter'

export async function POST(request: Request) {
  const formData = await request.formData()
  const email = formData.get('email')
  const contents = formData.get('contents')

  try {
    await validateInputs({ email, contents })
    const info = await sendMail({ email, contents })
    return Response.json({ messageId: info.messageId })
  } catch (reason) {
    const message = reason instanceof Error ? reason.message : 'Unexpected exception'
    return new Response(message, { status: 500 })
  }
}
```

* **Request body ch·ªâ ƒë·ªçc 1 l·∫ßn**, clone n·∫øu c·∫ßn:

```ts
const clonedRequest = request.clone()
await request.body()
await clonedRequest.body()
```

---

### 4. Manipulating Data

* Transform, filter, aggregate d·ªØ li·ªáu t·ª´ nhi·ªÅu ngu·ªìn.
* Offload t√≠nh to√°n n·∫∑ng v·ªÅ server ƒë·ªÉ gi·∫£m t·∫£i client.

```ts
import { parseWeatherData } from '@/lib/weather'

export async function POST(request: Request) {
  const body = await request.json()
  const searchParams = new URLSearchParams({ lat: body.lat, lng: body.lng })

  try {
    const weatherResponse = await fetch(`${weatherEndpoint}?${searchParams}`)
    const weatherData = await weatherResponse.text()
    const payload = parseWeatherData.asJSON(weatherData)
    return new Response(payload, { status: 200 })
  } catch (reason) {
    const message = reason instanceof Error ? reason.message : 'Unexpected exception'
    return new Response(message, { status: 500 })
  }
}
```

* POST t·ªët h∆°n GET khi ch·ª©a d·ªØ li·ªáu nh·∫°y c·∫£m (v√≠ d·ª• geo-location).

---

### 5. Proxying & Rewrites

* Route Handler c√≥ th·ªÉ proxy ƒë·∫øn backend kh√°c, k√®m validation:

```ts
import { isValidRequest } from '@/lib/utils'

export async function POST(request: Request, { params }) {
  const clonedRequest = request.clone()
  if (!(await isValidRequest(clonedRequest))) {
    return new Response(null, { status: 400, statusText: 'Bad Request' })
  }

  const { slug } = await params
  const pathname = slug.join('/')
  const proxyURL = new URL(pathname, 'https://nextjs.org')
  return fetch(new Request(proxyURL, request))
}
```

* Ho·∫∑c d√πng middleware / rewrites trong `next.config.js`.

---

### 6. NextRequest & NextResponse

* **NextRequest**: m·ªü r·ªông Request, truy c·∫≠p `nextUrl`.
* **NextResponse**: helper `json()`, `redirect()`, `rewrite()`, cookie manipulation.

```ts
import { NextResponse, type NextRequest } from 'next/server'

export async function GET(request: NextRequest) {
  const nextUrl = request.nextUrl
  if (nextUrl.searchParams.get('redirect')) return NextResponse.redirect(new URL('/', request.url))
  if (nextUrl.searchParams.get('rewrite')) return NextResponse.rewrite(new URL('/', request.url))
  return NextResponse.json({ pathname: nextUrl.pathname })
}
```

---

### 7. Webhooks & Callback URLs

* Nh·∫≠n event t·ª´ 3rd-party ho·∫∑c CMS:

```ts
export async function GET(request: NextRequest) {
  const token = request.nextUrl.searchParams.get('token')
  if (token !== process.env.REVALIDATE_SECRET_TOKEN) return NextResponse.json({ success: false }, { status: 401 })

  const tag = request.nextUrl.searchParams.get('tag')
  if (!tag) return NextResponse.json({ success: false }, { status: 400 })

  revalidateTag(tag)
  return NextResponse.json({ success: true })
}
```

* Callback URL: verify response, redirect client:

```ts
export async function GET(request: NextRequest) {
  const token = request.nextUrl.searchParams.get('session_token')
  const redirectUrl = request.nextUrl.searchParams.get('redirect_url')

  const response = NextResponse.redirect(new URL(redirectUrl, request.url))
  response.cookies.set({ name: '_token', value: token, path: '/', secure: true, httpOnly: true })
  return response
}
```

---

### 8. Redirects

```ts
import { redirect } from 'next/navigation'

export async function GET(request: Request) {
  redirect('https://nextjs.org/')
}
```

---

### 9. Middleware

* M·ªôt file middleware duy nh·∫•t/project, target path v·ªõi `config.matcher`.
* Middleware c√≥ th·ªÉ check auth, rewrite, redirect, proxy:

```ts
import { NextResponse } from 'next/server'

export const config = { matcher: '/api/:function*' }
export function middleware(request: Request) {
  if (!isAuthenticated(request)) return Response.json({ success: false }, { status: 401 })
}
```

* Redirect & proxy:

```ts
if (request.nextUrl.pathname === '/v1/docs') {
  request.nextUrl.pathname = '/v2/docs'
  return NextResponse.redirect(request.nextUrl)
}
```

---

### 10. Security & Best Practices

* Ki·ªÉm so√°t headers, kh√¥ng truy·ªÅn tr·ª±c ti·∫øp request headers ra client.
* Rate limiting: code-level + host-level.
* Validate payload, ch·ªëng XSS, timeout ƒë·ªÉ b·∫£o v·ªá server.
* Store static assets ·ªü d·ªãch v·ª• chuy√™n d·ª•ng, upload t·ª´ client n·∫øu c√≥ th·ªÉ.
* X√°c th·ª±c tr∆∞·ªõc khi c·∫•p quy·ªÅn, rotate credentials/API keys.
* Preflight (OPTIONS) & CORS: Next.js t·ª± set header d·ª±a tr√™n method.

---

### 11. Library Patterns

* Factory pattern cho Route Handlers:

```ts
import { createHandler } from 'third-party-library'
const handler = createHandler({ /* options */ })
export const GET = handler
export { handler as POST }
```

* Middleware factory:

```ts
import { createMiddleware } from 'third-party-library'
export default createMiddleware()
```

---

### 12. Caveats

* **Server Components** fetch data tr·ª±c ti·∫øp, kh√¥ng qua Route Handler build-time.

  * Pre-rendered Server Components t·∫°i build time: Route Handlers s·∫Ω fail v√¨ l√∫c build kh√¥ng c√≥ server.
  *


  Server Components render on-demand: fetching qua Route Handlers ch·∫≠m h∆°n do HTTP round trip.

  * Fetch server-side c·∫ßn **absolute URLs**, dev server ƒë√≥ng vai tr√≤ external server. Build time kh√¥ng c√≥ server, runtime d√πng domain public.

  Server Components ƒë√°p ·ª©ng h·∫ßu h·∫øt nhu c·∫ßu fetch d·ªØ li·ªáu. **Client-side fetch** ch·ªâ c·∫ßn khi:

  * Data ph·ª• thu·ªôc Web APIs client-only: Geo-location, Storage, Audio, File
  * Data c·∫ßn poll th∆∞·ªùng xuy√™n

  D√πng library nh∆∞ **swr** ho·∫∑c **react-query** cho c√°c tr∆∞·ªùng h·ª£p n√†y.

* **Server Actions** mutate data client-side, queued execution.
  * Ch·∫°y server-side code t·ª´ client.
  * M·ª•c ƒë√≠ch ch√≠nh: mutate data t·ª´ frontend.
  * Server Actions **queue**, d√πng ƒë·ªÉ fetch d·ªØ li·ªáu c√≥ th·ªÉ g√¢y sequential execution.
* **Export mode**: ch·ªâ GET Route Handlers, static HTML/JSON/TXT.
  * Xu·∫•t static site, kh√¥ng runtime server.
  * Ch·ªâ h·ªó tr·ª£ **GET Route Handlers** v·ªõi `dynamic = 'force-static'`.
  * T·∫°o HTML/JSON/TXT ho·∫∑c file kh√°c.

  ```ts
  // app/hello-world/route.ts
  export const dynamic = 'force-static'

  export function GET() {
    return new Response('Hello World', { status: 200 })
  }
  ```
* M·ªôt s·ªë host deploy Route Handlers `Lambda hosts`:
  * Kh√¥ng share data gi·ªØa requests
  * Gi·ªõi h·∫°n file system
  * Long-running handler b·ªã terminate do timeout
  * WebSocket kh√¥ng ho·∫°t ƒë·ªông
###  API Reference

* [Route Handlers](https://nextjs.org/docs/app/building-your-application/routing/route-handlers)
* [Middleware](https://nextjs.org/docs/app/building-your-application/routing/middleware)
* `route.js`: API reference file ƒë·∫∑c bi·ªát
* `middleware.js`: API reference middleware
---

Next.js BFF ph√π h·ª£p khi mu·ªën:

* ·∫®n API n·ªôi b·ªô
* X·ª≠ l√Ω logic/validation/server-side tracking
* T√≠ch h·ª£p nhi·ªÅu backend / d·ªãch v·ª• 3rd-party
* Proxy request, x·ª≠ l√Ω d·ªØ li·ªáu tr∆∞·ªõc client
