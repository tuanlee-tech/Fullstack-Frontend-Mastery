# Kiểm thử và đảm bảo chất lượng code

<details>
<summary><strong>1. Debug JavaScript: Dễ hay khó?</strong></summary>

---

## **1. Bug và Debug**

* **Bug**: lỗi trong chương trình.

  * **Lỗi ngữ pháp (syntax error)**: sai cú pháp, kiểu dữ liệu, chính tả.
    → Trong C/C++ hay Java, IDE/trình biên dịch báo ngay.
    → JavaScript: báo lỗi chỉ khi chạy đến đoạn đó.
  * **Lỗi ngữ nghĩa (logic error)**: sai thuật toán, logic, tương tác hệ thống.
    → Khó phát hiện, phải kiểm tra từng phần code.

* **Debug**: quá trình tìm và sửa bug.

> **Châm ngôn**: Debugging khó gấp 2 lần viết code – Brian Kernighan & P.J. Plauger

---

## **2. Strict mode trong JavaScript**

* Kích hoạt strict mode: `"use strict";`
* Giúp JavaScript nghiêm ngặt hơn, tránh nhiều lỗi phổ biến.

**Ví dụ:**

Không dùng strict mode:

```js
x = 10;
var Infinity = 10;
delete Object.prototype;
```

Dùng strict mode:

```js
"use strict";
x = 10; // ReferenceError: x is not defined
var Infinity = 10; // TypeError: Cannot assign to read only property
delete Object.prototype; // TypeError
```

**→ Lợi ích:** giảm thiểu lỗi không mong muốn, code an toàn hơn.

---

## **3. Testing trước khi debug**

* Viết **unit test** kiểm tra từng module/function.

```js
function Vector(x, y) {
  this.x = x;
  this.y = y;
}
Vector.prototype.plus = function(other) {
  return new Vector(this.x + other.x, this.y + other.y);
};

function testVector() {
  var p1 = new Vector(10, 20);
  var p2 = new Vector(-10, 5);
  var p3 = p1.plus(p2);

  if (p1.x !== 10) return "fail: x property";
  if (p1.y !== 20) return "fail: y property";
  if (p2.x !== -10) return "fail: negative x property";
  if (p3.x !== 0) return "fail: x from plus";
  if (p3.y !== 25) return "fail: y from plus";
  return "everything ok";
}

console.log(testVector()); // everything ok
```

* Framework testing chuyên nghiệp: **Jest, Mocha, Jasmine...**

---

## **4. Debugging thực tế**

**Ví dụ:** chuyển số `n` sang string theo cơ số `base`

```js
function numberToString(n, base) {
  var result = "", sign = "";
  if (n < 0) { sign = "-"; n = -n; }
  do {
    result = String(n % base) + result;
    n /= base;
  } while (n > 0);
  return sign + result;
}

console.log(numberToString(13, 10)); // Kết quả sai
```

**Cách debug: thêm log từng bước**

```js
do {
  result = String(n % base) + result;
  console.log("result:", result);
  n /= base;
  console.log("n:", n);
} while (n > 0);
```

**Phát hiện lỗi:**

* `n /= base` tạo số thập phân → JavaScript khác C/C++: `13/10 = 1.3`
* Sửa bằng `Math.floor(n/base)`

```js
n = Math.floor(n / base);
```

**Kết quả đúng:**

```js
console.log(numberToString(13, 10)); // 13
```

* Ngoài log, có thể **set breakpoint** trong DevTools như debug IDE.

---

## **5. Tóm tắt chiến lược debug JS**

1. **Strict mode**: giảm lỗi không mong muốn.
2. **Testing/Unit test**: kiểm tra từng thành phần code.
3. **Debug**: log từng bước, set breakpoint để xác định lỗi chính xác.

**→ Kết luận:** Debug JS không khó hơn các ngôn ngữ khác nếu bạn áp dụng chiến lược đúng.

</details>
<details>
<summary><strong>2. Một số lỗi phổ biến khi sử dụng Strict mode trong JavaScript</strong></summary>

---

## **1. Sử dụng biến không khai báo**

Bình thường:

```js
x = 10;
console.log(window.x); // 10
```

Strict mode:

```js
"use strict";
x = 10; 
// ReferenceError: x is not defined
```

> **Lưu ý:** Strict mode yêu cầu bạn phải khai báo biến bằng `var`, `let` hoặc `const`.

---

## **2. Gán giá trị cho biến global, thuộc tính chỉ đọc hoặc getter**

Bình thường: gán cho `Infinity`, `NaN` hay thuộc tính chỉ đọc không báo lỗi.
Strict mode: sẽ báo **TypeError**.

```js
"use strict";
Infinity = 10; // TypeError
```

---

## **3. Xoá thuộc tính của đối tượng global**

Bình thường: không thể xoá, nhưng không báo lỗi.
Strict mode: báo lỗi ngay.

```js
"use strict";
delete Object.prototype;
// TypeError: Cannot delete property 'prototype' of function Object() { [native code] }
```

---

## **4. Tên tham số trùng nhau trong hàm**

Strict mode yêu cầu các tham số phải khác tên nhau:

```js
"use strict";
function sum(a, a, c) {
  return a + b + c;
}
// SyntaxError: Duplicate parameter name not allowed
```

---

## **5. Thêm thuộc tính cho giá trị nguyên thuỷ**

Strict mode cấm thêm thuộc tính cho `number`, `string`, `boolean`:

```js
"use strict";

false.true = false;
// TypeError: Cannot create property 'true' on boolean 'false'

(14).sailing = "home";
// TypeError: Cannot create property 'sailing' on number '14'

"with".you = "far away";
// TypeError: Cannot create property 'you' on string 'with'
```

---

## **6. Xoá biến thông thường**

Strict mode cấm xoá tên biến:

```js
"use strict";
var x = 10;
delete x;
// SyntaxError: Delete of an unqualified identifier in strict mode
```

---

## **7. Đặt tên biến trùng với từ khoá dự trữ**

Những từ dự trữ trong JavaScript như: `implements`, `interface`, `let`, `package`, `private`, `protected`, `public`, `static`, `yield`... Strict mode không cho phép dùng làm tên biến:

```js
"use strict";
var implements = 10;
// SyntaxError: Unexpected strict mode reserved word
```

---

## **Kết luận**

* Strict mode **giúp phát hiện sớm lỗi**, tránh xung đột với các phiên bản JavaScript mới.
* Không nên tránh strict mode, ngược lại nên **luôn sử dụng** để viết code an toàn, rõ ràng và ít lỗi hơn.

</details>
<details>
<summary><strong>3. Thủ thuật sử dụng console.log hiệu quả trong JavaScript</strong></summary>

---

## **1. Cú pháp cơ bản của console.log**

### Cách 1: Liệt kê các giá trị

```js
const foo = 1;
const bar = "bar";
const baz = { name: "John", age: "30", gender: "male" };

console.log(foo, bar, baz);
// => 1 "bar" {name: "John", age: "30", gender: "male"}
```

### Cách 2: Sử dụng string format (giống printf trong C)

```js
console.log("Log: %d, %s and %o", foo, bar, baz);
// => Log: 1, bar and {name: "John", age: "30", gender: "male"}
```

**Ký tự định dạng thông dụng:**

* `%o` hoặc `%O`: object
* `%d` hoặc `%i`: số nguyên
* `%f`: số thực
* `%s`: string

> Lưu ý: Sử dụng sai ký tự định dạng sẽ hiển thị không đúng, ví dụ `%s` cho object sẽ chỉ ra `"Object"`.

---

## **2. Hiển thị biến với chú thích để dễ đọc**

### Giải pháp 1: Viết kèm nhãn

```js
console.log("foo", foo);
console.log("bar", bar);
console.log("baz", baz);
```

### Giải pháp 2: Đóng gói các biến vào object (ES6)

```js
console.log({ foo, bar, baz });
/*
{
  foo: {...},
  bar: {...},
  baz: {...}
}
*/
```

> Cách này ngắn gọn, dễ đọc và hiển thị rõ tên biến.

---

## **3. Sử dụng console.table để hiển thị dạng bảng**

```js
const foo = { name: "Alex", age: "26", gender: "male" };
const bar = { name: "Jenifer", age: "18", gender: "female" };
const baz = { name: "John", age: "30", gender: "male" };

console.table([foo, bar, baz]);
```

**Kết quả:**

```
┌─────────┬──────────┬─────┬─────────┐
│ (index) │  name    │ age │ gender  │
├─────────┼──────────┼─────┼─────────┤
│    0    │ 'Alex'   │ '26'│ 'male' │
│    1    │ 'Jenifer'│ '18'│'female'│
│    2    │ 'John'   │ '30'│ 'male' │
└─────────┴──────────┴─────┴─────────┘
```

---

## **4. Đo thời gian thực thi code với console.time và console.timeEnd**

```js
console.time("looper");

let i = 0;
while (i < 1000000) {
  i++;
}

console.timeEnd("looper");
// => looper: 5.14501953125ms
```

> Thay vì dùng `performance.now()`, console.time giúp đo thời gian nhanh gọn và trực quan hơn.

---

## **Kết luận**

* Sử dụng nhãn hoặc đóng gói biến vào object giúp log dễ đọc.
* `console.table` hiển thị dữ liệu dạng bảng trực quan.
* `console.time`/`console.timeEnd` đo thời gian thực thi code nhanh chóng.
* Nắm vững các ký tự định dạng `%d, %s, %o` giúp log chuẩn xác hơn.

> Những thủ thuật này giúp việc debug và kiểm tra code JavaScript hiệu quả và tiết kiệm thời gian hơn.

</details>
