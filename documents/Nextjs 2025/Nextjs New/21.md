## ğŸ§­ **Params & searchParams trong Next.js App Router**

### ğŸ¯ Má»¥c tiÃªu

* Hiá»ƒu rÃµ **sá»± khÃ¡c biá»‡t giá»¯a params vÃ  searchParams**
* Biáº¿t cÃ¡ch **truy xuáº¥t dá»¯ liá»‡u URL** trong Server Component vÃ  Client Component
* Ãp dá»¥ng params vÃ o **Dynamic Routes** (vÃ­ dá»¥: `/blog/[slug]`)
* Ãp dá»¥ng searchParams vÃ o **lá»c, phÃ¢n trang, tÃ¬m kiáº¿m**

---

## ğŸ§± 1ï¸âƒ£ `params` â€“ Dynamic Segments

**Cáº¥u trÃºc:**

```
app/
â””â”€â”€ blog/
    â””â”€â”€ [slug]/
        â””â”€â”€ page.tsx
```

**URL:**

```
/blog/nextjs-tutorial
```

**Code vÃ­ dá»¥:**

```tsx
// app/blog/[slug]/page.tsx

export default function BlogPost({
  params,
}: {
  params: { slug: string };
}) {
  return (
    <article>
      <h1>ğŸ“ Blog: {params.slug}</h1>
      <p>This is the content of post "{params.slug}".</p>
    </article>
  );
}
```

â¡ Káº¿t quáº£:
`/blog/nextjs-tutorial` â†’ Hiá»ƒn thá»‹ â€œBlog: nextjs-tutorialâ€.

---

## ğŸ§© 2ï¸âƒ£ `searchParams` â€“ Query String trong URL

**URL:**

```
/products?page=2&category=shoes
```

**Cáº¥u trÃºc file:**

```
app/products/page.tsx
```

**Code vÃ­ dá»¥:**

```tsx
// app/products/page.tsx

export default function ProductList({
  searchParams,
}: {
  searchParams: { page?: string; category?: string };
}) {
  const page = searchParams.page ?? "1";
  const category = searchParams.category ?? "all";

  return (
    <section>
      <h2>ğŸ›ï¸ Product List</h2>
      <p>
        Category: <strong>{category}</strong>
      </p>
      <p>
        Page: <strong>{page}</strong>
      </p>
    </section>
  );
}
```

â¡ Truy cáº­p:
`/products?page=2&category=shoes`
â†’ Next.js tá»± parse `searchParams` cho báº¡n.

---

## âš™ï¸ 3ï¸âƒ£ Khi nÃ o nÃªn dÃ¹ng?

| Loáº¡i           | Khi nÃ o dÃ¹ng                       | VÃ­ dá»¥                         |
| -------------- | ---------------------------------- | ----------------------------- |
| `params`       | Khi Ä‘Æ°á»ng dáº«n xÃ¡c Ä‘á»‹nh ná»™i dung    | `/blog/[slug]`                |
| `searchParams` | Khi cáº§n lá»c / sáº¯p xáº¿p / phÃ¢n trang | `/products?page=2&sort=price` |

---

## ğŸ§  4ï¸âƒ£ DÃ¹ng trong Client Component

Náº¿u báº¡n cáº§n truy cáº­p URL params trong **Client Component**, hÃ£y dÃ¹ng:

```tsx
"use client";

import { useParams, useSearchParams } from "next/navigation";

export default function ClientDemo() {
  const params = useParams();
  const searchParams = useSearchParams();

  return (
    <div>
      <p>Slug: {params.slug}</p>
      <p>Query: {searchParams.get("category")}</p>
    </div>
  );
}
```

---

## ğŸ’¬ 5ï¸âƒ£ BÃ i táº­p nhá»

> Táº¡o trang `/blog/[slug]` hiá»ƒn thá»‹ ná»™i dung dá»±a vÃ o params.
> Khi thÃªm query `?author=John` thÃ¬ hiá»ƒn thá»‹ thÃªm dÃ²ng â€œWritten by Johnâ€.

---
DÆ°á»›i Ä‘Ã¢y lÃ  **code máº«u hoÃ n chá»‰nh** cho bÃ i *â€œParams & searchParamsâ€* â€” káº¿t há»£p **Server Component + Client Component** Ä‘á»ƒ báº¡n tháº¥y toÃ n bá»™ cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a Next.js App Router.

---

## ğŸ“‚ **Cáº¥u trÃºc thÆ° má»¥c**

```
app/
â”œâ”€â”€ blog/
â”‚   â””â”€â”€ [slug]/
â”‚       â”œâ”€â”€ page.tsx          â† Server Component
â”‚       â””â”€â”€ ClientInfo.tsx    â† Client Component (Ä‘á»c URL runtime)
```

---

## ğŸ“„ **1ï¸âƒ£ Server Component â€“ page.tsx**

```tsx
// app/blog/[slug]/page.tsx
import ClientInfo from "./ClientInfo";

export default function BlogPost({
  params,
  searchParams,
}: {
  params: { slug: string };
  searchParams?: { author?: string };
}) {
  const { slug } = params;
  const author = searchParams?.author;

  return (
    <article style={{ padding: "2rem", border: "1px solid #ddd", borderRadius: 8 }}>
      <h1>ğŸ“ Blog Post: {slug}</h1>
      <p>
        This is the content for the blog post <strong>{slug}</strong>.
      </p>

      {author && (
        <p style={{ color: "gray" }}>
          âœï¸ Written by <strong>{author}</strong>
        </p>
      )}

      <hr style={{ margin: "1rem 0" }} />

      {/* Client Component Ä‘á»c runtime URL */}
      <ClientInfo />
    </article>
  );
}
```

---

## ğŸ“„ **2ï¸âƒ£ Client Component â€“ ClientInfo.tsx**

```tsx
// app/blog/[slug]/ClientInfo.tsx
"use client";

import { useParams, useSearchParams } from "next/navigation";

export default function ClientInfo() {
  const params = useParams();
  const searchParams = useSearchParams();

  const slug = params.slug;
  const author = searchParams.get("author");

  return (
    <section
      style={{
        marginTop: "1rem",
        padding: "1rem",
        border: "1px dashed #ccc",
        borderRadius: 6,
        background: "#fafafa",
      }}
    >
      <h4>ğŸ§­ Client-side URL Info</h4>
      <p>
        <strong>Slug:</strong> {slug}
      </p>
      <p>
        <strong>Author:</strong> {author || "(none)"}
      </p>
    </section>
  );
}
```

---

## ğŸ§  **3ï¸âƒ£ Giáº£i thÃ­ch hoáº¡t Ä‘á»™ng**

| ThÃ nh pháº§n                          | Vai trÃ²                                                             | Thá»i Ä‘iá»ƒm render |
| ----------------------------------- | ------------------------------------------------------------------- | ---------------- |
| `page.tsx` (Server Component)       | Nháº­n `params` & `searchParams` trá»±c tiáº¿p tá»« Next.js                 | Server-side      |
| `ClientInfo.tsx` (Client Component) | DÃ¹ng hooks `useParams` & `useSearchParams` Ä‘á»ƒ Ä‘á»c URL **á»Ÿ runtime** | Browser-side     |

---

## ğŸ§© **4ï¸âƒ£ Káº¿t quáº£ cháº¡y**

| URL                                | Káº¿t quáº£                                            |
| ---------------------------------- | -------------------------------------------------- |
| `/blog/nextjs-routing`             | Hiá»ƒn thá»‹ `Blog Post: nextjs-routing`               |
| `/blog/nextjs-routing?author=John` | Hiá»ƒn thá»‹ thÃªm `Written by John` + client-side info |

---

## ğŸ’¬ **5ï¸âƒ£ BÃ i táº­p má»Ÿ rá»™ng**

> ThÃªm vÃ o pháº§n Client Component má»™t nÃºt `Next Post`, khi click sáº½ Ä‘á»•i sang `/blog/nextjs-hydration?author=Alice` báº±ng `router.push()` (dÃ¹ng hook `useRouter()` cá»§a Next.js).
>
> â†’ Má»¥c tiÃªu: luyá»‡n táº­p chuyá»ƒn route Ä‘á»™ng vÃ  cáº­p nháº­t searchParams client-side.

---
DÆ°á»›i Ä‘Ã¢y lÃ  **phiÃªn báº£n má»Ÿ rá»™ng** cá»§a vÃ­ dá»¥ `params & searchParams` â€” cÃ³ thÃªm **nÃºt Ä‘iá»u hÆ°á»›ng client-side** dÃ¹ng `useRouter()`, giÃºp báº¡n tháº¥y rÃµ cÆ¡ cháº¿ **hydration + re-render** khi thay Ä‘á»•i URL ngay trÃªn browser.

---

## ğŸ“‚ **Cáº¥u trÃºc thÆ° má»¥c**

```
app/
â”œâ”€â”€ blog/
â”‚   â””â”€â”€ [slug]/
â”‚       â”œâ”€â”€ page.tsx
â”‚       â””â”€â”€ ClientInfo.tsx
```

---

## ğŸ“„ **1ï¸âƒ£ Server Component â€“ page.tsx**

```tsx
// app/blog/[slug]/page.tsx
import ClientInfo from "./ClientInfo";

export default function BlogPost({
  params,
  searchParams,
}: {
  params: { slug: string };
  searchParams?: { author?: string };
}) {
  const { slug } = params;
  const author = searchParams?.author;

  return (
    <article style={{ padding: "2rem", border: "1px solid #ddd", borderRadius: 8 }}>
      <h1>ğŸ“ Blog Post: {slug}</h1>
      <p>
        This is the content for the blog post <strong>{slug}</strong>.
      </p>

      {author && (
        <p style={{ color: "gray" }}>
          âœï¸ Written by <strong>{author}</strong>
        </p>
      )}

      <hr style={{ margin: "1rem 0" }} />

      {/* Client Component */}
      <ClientInfo />
    </article>
  );
}
```

---

## ğŸ“„ **2ï¸âƒ£ Client Component â€“ ClientInfo.tsx**

```tsx
// app/blog/[slug]/ClientInfo.tsx
"use client";

import { useParams, useSearchParams, useRouter } from "next/navigation";

export default function ClientInfo() {
  const params = useParams();
  const searchParams = useSearchParams();
  const router = useRouter();

  const slug = params.slug;
  const author = searchParams.get("author");

  const handleNextPost = () => {
    const nextSlug =
      slug === "nextjs-routing" ? "nextjs-hydration" : "nextjs-routing";
    router.push(`/blog/${nextSlug}?author=Alice`);
  };

  return (
    <section
      style={{
        marginTop: "1rem",
        padding: "1rem",
        border: "1px dashed #ccc",
        borderRadius: 6,
        background: "#fafafa",
      }}
    >
      <h4>ğŸ§­ Client-side Info</h4>
      <p>
        <strong>Slug:</strong> {slug}
      </p>
      <p>
        <strong>Author:</strong> {author || "(none)"}
      </p>

      <button
        onClick={handleNextPost}
        style={{
          marginTop: "1rem",
          padding: "0.5rem 1rem",
          backgroundColor: "#0070f3",
          color: "white",
          border: "none",
          borderRadius: "6px",
          cursor: "pointer",
        }}
      >
        ğŸ”„ Next Post
      </button>
    </section>
  );
}
```

---

## ğŸ” **3ï¸âƒ£ Giáº£i thÃ­ch cÆ¡ cháº¿ hoáº¡t Ä‘á»™ng**

| HÃ nh Ä‘á»™ng                                           | Diá»…n giáº£i                                                                                       |
| --------------------------------------------------- | ----------------------------------------------------------------------------------------------- |
| Láº§n Ä‘áº§u truy cáº­p `/blog/nextjs-routing?author=John` | Server render ra HTML + dá»¯ liá»‡u. Sau Ä‘Ã³ client sáº½ **hydrate** component.                        |
| Khi báº¥m nÃºt â€œNext Postâ€                             | `router.push()` â†’ Ä‘á»•i URL sang `/blog/nextjs-hydration?author=Alice` mÃ  **khÃ´ng reload trang**. |
| Next.js                                             | Tá»± Ä‘á»™ng render láº¡i `page.tsx` vÃ  `ClientInfo.tsx` (client-side re-render).                      |
| Káº¿t quáº£                                             | Báº¡n tháº¥y ná»™i dung thay Ä‘á»•i tá»©c thÃ¬, nhÆ°ng hydration khÃ´ng bá»‹ máº¥t (state client váº«n giá»¯).        |

---

## ğŸ§  **4ï¸âƒ£ Kiáº¿n thá»©c rÃºt ra**

1. `params` vÃ  `searchParams` trong Server Component Ä‘Æ°á»£c Next.js inject sáºµn.
2. Trong Client Component, ta Ä‘á»c láº¡i báº±ng `useParams()` & `useSearchParams()` â†’ luÃ´n cáº­p nháº­t theo URL.
3. `useRouter().push()` cho phÃ©p Ä‘iá»u hÆ°á»›ng *SPA-style* â†’ khÃ´ng reload â†’ giá»¯ hydration.
4. ÄÃ¢y lÃ  ná»n táº£ng cho **dynamic routing, filters, pagination, search query...** trong Next.js App Router.
---
> Äá»ƒ demo **dynamic UI dá»±a trÃªn route segment**, chÃºng ta sáº½ dÃ¹ng hook `useSelectedLayoutSegment()` cá»§a Next.js. ÄÃ¢y lÃ  hook **client-side** giÃºp biáº¿t **segment hiá»‡n táº¡i cá»§a route Ä‘ang active** trong **layout** hoáº·c **nested route**, ráº¥t há»¯u Ã­ch cho **highlight menu, breadcrumbs, tab navigation**.

MÃ¬nh sáº½ viáº¿t vÃ­ dá»¥ **dá»±a trÃªn dashboard/analytics/settings** Ä‘á»ƒ minh há»a.

---

## ğŸ“‚ **Cáº¥u trÃºc thÆ° má»¥c**

```
app/
â”œâ”€â”€ dashboard/
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”œâ”€â”€ page.tsx
â”‚   â”œâ”€â”€ analytics/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â””â”€â”€ settings/
â”‚       â””â”€â”€ page.tsx
```

---

## ğŸ“„ **layout.tsx vá»›i useSelectedLayoutSegment**

```tsx
"use client"; // layout muá»‘n sá»­ dá»¥ng hook client-side

import { useSelectedLayoutSegment } from "next/navigation";

export default function DashboardLayout({ children }: { children: React.ReactNode }) {
  const segment = useSelectedLayoutSegment(); // láº¥y segment hiá»‡n táº¡i

  return (
    <div style={{ display: "flex", minHeight: "100vh" }}>
      <aside style={{ width: 200, background: "#f0f0f0", padding: 16 }}>
        <h3>ğŸ“‹ Dashboard</h3>
        <ul>
          <li style={{ fontWeight: segment === null ? "bold" : "normal" }}>
            <a href="/dashboard">Overview</a>
          </li>
          <li style={{ fontWeight: segment === "analytics" ? "bold" : "normal" }}>
            <a href="/dashboard/analytics">Analytics</a>
          </li>
          <li style={{ fontWeight: segment === "settings" ? "bold" : "normal" }}>
            <a href="/dashboard/settings">Settings</a>
          </li>
        </ul>
      </aside>

      <main style={{ flex: 1, padding: 16 }}>{children}</main>
    </div>
  );
}
```

---

## ğŸ“„ **page.tsx Ä‘Æ¡n giáº£n cho cÃ¡c route con**

```tsx
// app/dashboard/page.tsx
export default function OverviewPage() {
  return <h2>Dashboard Overview</h2>;
}

// app/dashboard/analytics/page.tsx
export default function AnalyticsPage() {
  return <h2>Analytics Section</h2>;
}

// app/dashboard/settings/page.tsx
export default function SettingsPage() {
  return <h2>Settings Section</h2>;
}
```

---

## ğŸ§  **CÆ¡ cháº¿ hoáº¡t Ä‘á»™ng**

1. `useSelectedLayoutSegment()` tráº£ vá» **tÃªn segment hiá»‡n táº¡i** tÆ°Æ¡ng á»©ng vá»›i folder con Ä‘ang active.

   * `/dashboard` â†’ `null` (segment root)
   * `/dashboard/analytics` â†’ `"analytics"`
   * `/dashboard/settings` â†’ `"settings"`

2. Khi báº¡n click menu, component **Client Layout** tá»± re-render â†’ **bold item tÆ°Æ¡ng á»©ng**.

3. KhÃ´ng cáº§n dÃ¹ng state thá»§ cÃ´ng hay props drilling â†’ ráº¥t tiá»‡n cho **menu, breadcrumb, tab navigation** trong nested route.
---
MÃ¬nh sáº½ viáº¿t **demo production-ready** cho **Dashboard Layout** káº¿t há»£p:

* Nested Layout (`dashboard/`)
* Sidebar
* Highlight menu dynamic báº±ng `useSelectedLayoutSegment()`
* Hydration hoáº¡t Ä‘á»™ng Ä‘Ãºng khi chuyá»ƒn giá»¯a cÃ¡c route con

---

## ğŸ“‚ **Cáº¥u trÃºc thÆ° má»¥c**

```
app/
â”œâ”€â”€ dashboard/
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”œâ”€â”€ page.tsx
â”‚   â”œâ”€â”€ analytics/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â””â”€â”€ settings/
â”‚       â””â”€â”€ page.tsx
```

---

## ğŸ“„ **1ï¸âƒ£ Dashboard Layout**

```tsx
"use client"; // Layout dÃ¹ng hook client-side

import { ReactNode } from "react";
import { useSelectedLayoutSegment } from "next/navigation";

export default function DashboardLayout({ children }: { children: ReactNode }) {
  const segment = useSelectedLayoutSegment();

  return (
    <div style={{ display: "flex", minHeight: "100vh" }}>
      {/* Sidebar */}
      <aside
        style={{
          width: 220,
          background: "#f0f0f0",
          padding: 20,
          display: "flex",
          flexDirection: "column",
          gap: 10,
        }}
      >
        <h3>ğŸ“‹ Dashboard</h3>
        <ul style={{ listStyle: "none", padding: 0, margin: 0 }}>
          <li style={{ fontWeight: segment === null ? "bold" : "normal" }}>
            <a href="/dashboard">Overview</a>
          </li>
          <li style={{ fontWeight: segment === "analytics" ? "bold" : "normal" }}>
            <a href="/dashboard/analytics">Analytics</a>
          </li>
          <li style={{ fontWeight: segment === "settings" ? "bold" : "normal" }}>
            <a href="/dashboard/settings">Settings</a>
          </li>
        </ul>
      </aside>

      {/* Main content */}
      <main style={{ flex: 1, padding: 24 }}>{children}</main>
    </div>
  );
}
```

---

## ğŸ“„ **2ï¸âƒ£ Overview Page**

```tsx
// app/dashboard/page.tsx
export default function OverviewPage() {
  return (
    <div>
      <h2>ğŸ  Dashboard Overview</h2>
      <p>Welcome to your dashboard summary.</p>
    </div>
  );
}
```

---

## ğŸ“„ **3ï¸âƒ£ Analytics Page**

```tsx
// app/dashboard/analytics/page.tsx
export default function AnalyticsPage() {
  return (
    <div>
      <h2>ğŸ“Š Analytics Section</h2>
      <p>Here you can track metrics and user engagement.</p>
    </div>
  );
}
```

---

## ğŸ“„ **4ï¸âƒ£ Settings Page**

```tsx
// app/dashboard/settings/page.tsx
export default function SettingsPage() {
  return (
    <div>
      <h2>âš™ï¸ Settings Section</h2>
      <p>Manage your dashboard preferences here.</p>
    </div>
  );
}
```

---

## ğŸ§  **5ï¸âƒ£ CÆ¡ cháº¿ hoáº¡t Ä‘á»™ng**

1. **Nested Layout**: `dashboard/layout.tsx` bao quanh táº¥t cáº£ cÃ¡c route con (`/dashboard`, `/dashboard/analytics`, `/dashboard/settings`) â†’ sidebar chá»‰ render 1 láº§n, giá»¯ nguyÃªn state khi chuyá»ƒn trang.
2. **useSelectedLayoutSegment()**: tráº£ vá» segment hiá»‡n táº¡i Ä‘á»ƒ highlight menu chÃ­nh xÃ¡c.
3. **Hydration SPA-style**: khi click link, Next.js **chá»‰ render page má»›i** mÃ  **layout khÃ´ng reload**, giá»¯ sidebar vÃ  cÃ¡c component client-state.
4. CÃ³ thá»ƒ má»Ÿ rá»™ng thÃªm breadcrumbs, tab navigation, hoáº·c preserve scroll position dá»… dÃ ng.

---
MÃ¬nh sáº½ viáº¿t **phiÃªn báº£n nÃ¢ng cao Dashboard Layout** gáº§n production-ready, bao gá»“m:

* Sidebar **collapsible**
* Dynamic **breadcrumbs** theo nested route
* Nested Layout sÃ¢u (3 level)
* Highlight menu tá»± Ä‘á»™ng theo route segment
* Hydration & state giá»¯ nguyÃªn khi chuyá»ƒn page

---

## ğŸ“‚ **Cáº¥u trÃºc thÆ° má»¥c**

```
app/
â”œâ”€â”€ layout.tsx            // Root layout
â”œâ”€â”€ dashboard/
â”‚   â”œâ”€â”€ layout.tsx        // Dashboard nested layout
â”‚   â”œâ”€â”€ page.tsx          // /dashboard
â”‚   â”œâ”€â”€ analytics/
â”‚   â”‚   â”œâ”€â”€ layout.tsx    // Nested layout cho analytics (optional)
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â””â”€â”€ settings/
â”‚       â””â”€â”€ page.tsx
```

---

## ğŸ“„ **1ï¸âƒ£ Root Layout**

```tsx
// app/layout.tsx
import { ReactNode } from "react";

export default function RootLayout({ children }: { children: ReactNode }) {
  return (
    <html lang="en">
      <body style={{ fontFamily: "sans-serif", margin: 0 }}>
        {children}
      </body>
    </html>
  );
}
```

---

## ğŸ“„ **2ï¸âƒ£ Dashboard Layout vá»›i Sidebar Collapsible + Breadcrumbs**

```tsx
"use client";

import { ReactNode, useState } from "react";
import { useSelectedLayoutSegment, usePathname } from "next/navigation";
import Link from "next/link";

export default function DashboardLayout({ children }: { children: ReactNode }) {
  const segment = useSelectedLayoutSegment();
  const pathname = usePathname();
  const [collapsed, setCollapsed] = useState(false);

  const breadcrumbs = pathname
    .split("/")
    .filter(Boolean)
    .map((seg, idx, arr) => ({
      name: seg,
      href: "/" + arr.slice(0, idx + 1).join("/"),
    }));

  return (
    <div style={{ display: "flex", minHeight: "100vh" }}>
      {/* Sidebar */}
      <aside
        style={{
          width: collapsed ? 60 : 220,
          background: "#f0f0f0",
          padding: 20,
          transition: "width 0.2s",
        }}
      >
        <button
          onClick={() => setCollapsed(!collapsed)}
          style={{ marginBottom: 20 }}
        >
          {collapsed ? "â¡ï¸" : "â¬…ï¸"}
        </button>
        <ul style={{ listStyle: "none", padding: 0, margin: 0 }}>
          <li style={{ fontWeight: segment === null ? "bold" : "normal" }}>
            <Link href="/dashboard">Overview</Link>
          </li>
          <li style={{ fontWeight: segment === "analytics" ? "bold" : "normal" }}>
            <Link href="/dashboard/analytics">Analytics</Link>
          </li>
          <li style={{ fontWeight: segment === "settings" ? "bold" : "normal" }}>
            <Link href="/dashboard/settings">Settings</Link>
          </li>
        </ul>
      </aside>

      {/* Main Content */}
      <main style={{ flex: 1, padding: 24 }}>
        {/* Breadcrumbs */}
        <nav style={{ marginBottom: 16 }}>
          {breadcrumbs.map((crumb, idx) => (
            <span key={idx}>
              <Link href={crumb.href}>{crumb.name}</Link>
              {idx < breadcrumbs.length - 1 && " / "}
            </span>
          ))}
        </nav>

        {/* Page Content */}
        {children}
      </main>
    </div>
  );
}
```

---

## ğŸ“„ **3ï¸âƒ£ Page Examples**

```tsx
// app/dashboard/page.tsx
export default function OverviewPage() {
  return <h2>ğŸ  Dashboard Overview</h2>;
}

// app/dashboard/analytics/page.tsx
export default function AnalyticsPage() {
  return <h2>ğŸ“Š Analytics Section</h2>;
}

// app/dashboard/settings/page.tsx
export default function SettingsPage() {
  return <h2>âš™ï¸ Settings Section</h2>;
}
```

---

## ğŸ§  **4ï¸âƒ£ Æ¯u Ä‘iá»ƒm cá»§a phiÃªn báº£n nÃ¢ng cao**

1. **Sidebar Collapsible**: ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ thu gá»n/ má»Ÿ rá»™ng, state Ä‘Æ°á»£c giá»¯ nguyÃªn khi chuyá»ƒn page nhá» layout khÃ´ng reload.
2. **Dynamic Breadcrumbs**: hiá»ƒn thá»‹ Ä‘Æ°á»ng dáº«n theo URL hiá»‡n táº¡i.
3. **Nested Layout Support**: dá»… má»Ÿ rá»™ng thÃªm `/dashboard/analytics/reports` vá»›i layout riÃªng.
4. **Highlight Active Menu**: `useSelectedLayoutSegment()` tá»± Ä‘á»™ng bold item tÆ°Æ¡ng á»©ng.
5. **SPA-style Hydration**: layout giá»¯ nguyÃªn, page re-render, tráº£i nghiá»‡m mÆ°á»£t mÃ .

---
BÃ¢y giá» mÃ¬nh sáº½ viáº¿t **Dashboard Layout káº¿t há»£p Server Components + Client Components**, production-ready, vá»›i cÃ¡c tÃ­nh nÄƒng:

* **Sidebar client-side**: giá»¯ state khi chuyá»ƒn page, collapsible
* **Page content server-side**: fetch dá»¯ liá»‡u trá»±c tiáº¿p tá»« server/database
* **Nested Layouts**: há»— trá»£ route sÃ¢u
* **Highlight menu active**: `useSelectedLayoutSegment()`
* **Dynamic Breadcrumbs**
* **SPA-style hydration**: layout khÃ´ng reload khi chuyá»ƒn page

---

## ğŸ“‚ **Cáº¥u trÃºc thÆ° má»¥c**

```
app/
â”œâ”€â”€ layout.tsx                  // Root layout
â”œâ”€â”€ dashboard/
â”‚   â”œâ”€â”€ layout.tsx              // Dashboard nested layout
â”‚   â”œâ”€â”€ page.tsx                // Overview (Server Component)
â”‚   â”œâ”€â”€ analytics/
â”‚   â”‚   â””â”€â”€ page.tsx            // Analytics (Server Component)
â”‚   â””â”€â”€ settings/
â”‚       â””â”€â”€ page.tsx            // Settings (Server Component)
â”œâ”€â”€ _components/
â”‚   â””â”€â”€ Sidebar.tsx             // Client Component
```

---

## ğŸ“„ **1ï¸âƒ£ Sidebar Client Component**

```tsx
// app/_components/Sidebar.tsx
"use client";

import { useState } from "react";
import { useSelectedLayoutSegment } from "next/navigation";
import Link from "next/link";

export default function Sidebar() {
  const segment = useSelectedLayoutSegment();
  const [collapsed, setCollapsed] = useState(false);

  return (
    <aside
      style={{
        width: collapsed ? 60 : 220,
        background: "#f0f0f0",
        padding: 20,
        transition: "width 0.2s",
      }}
    >
      <button onClick={() => setCollapsed(!collapsed)} style={{ marginBottom: 20 }}>
        {collapsed ? "â¡ï¸" : "â¬…ï¸"}
      </button>
      <ul style={{ listStyle: "none", padding: 0, margin: 0 }}>
        <li style={{ fontWeight: segment === null ? "bold" : "normal" }}>
          <Link href="/dashboard">Overview</Link>
        </li>
        <li style={{ fontWeight: segment === "analytics" ? "bold" : "normal" }}>
          <Link href="/dashboard/analytics">Analytics</Link>
        </li>
        <li style={{ fontWeight: segment === "settings" ? "bold" : "normal" }}>
          <Link href="/dashboard/settings">Settings</Link>
        </li>
      </ul>
    </aside>
  );
}
```

---

## ğŸ“„ **2ï¸âƒ£ Dashboard Layout (Server Component)**

```tsx
// app/dashboard/layout.tsx
import { ReactNode } from "react";
import Sidebar from "../_components/Sidebar";

export default function DashboardLayout({ children }: { children: ReactNode }) {
  return (
    <div style={{ display: "flex", minHeight: "100vh" }}>
      {/* Sidebar Client Component */}
      <Sidebar />

      {/* Main content (Server Component) */}
      <main style={{ flex: 1, padding: 24 }}>{children}</main>
    </div>
  );
}
```

âœ… LÆ°u Ã½: `DashboardLayout` lÃ  **Server Component** theo máº·c Ä‘á»‹nh (khÃ´ng `"use client"`), cÃ²n `Sidebar` lÃ  **Client Component**, dÃ¹ng hook, state.

---

## ğŸ“„ **3ï¸âƒ£ Overview Page (Server Component)**

```tsx
// app/dashboard/page.tsx
async function fetchDashboardData() {
  // giáº£ láº­p fetch dá»¯ liá»‡u tá»« database/server
  return { users: 120, sales: 3400 };
}

export default async function OverviewPage() {
  const data = await fetchDashboardData();

  return (
    <div>
      <h2>ğŸ  Dashboard Overview</h2>
      <p>Total Users: {data.users}</p>
      <p>Total Sales: ${data.sales}</p>
    </div>
  );
}
```

---

## ğŸ“„ **4ï¸âƒ£ Analytics Page (Server Component)**

```tsx
// app/dashboard/analytics/page.tsx
async function fetchAnalytics() {
  return { visits: 5600, bounceRate: "34%" };
}

export default async function AnalyticsPage() {
  const stats = await fetchAnalytics();

  return (
    <div>
      <h2>ğŸ“Š Analytics Section</h2>
      <p>Visits: {stats.visits}</p>
      <p>Bounce Rate: {stats.bounceRate}</p>
    </div>
  );
}
```

---

## ğŸ“„ **5ï¸âƒ£ Settings Page (Server Component)**

```tsx
// app/dashboard/settings/page.tsx
export default function SettingsPage() {
  return (
    <div>
      <h2>âš™ï¸ Settings</h2>
      <p>Manage your dashboard preferences here.</p>
    </div>
  );
}
```

---

## ğŸ§  **6ï¸âƒ£ CÆ¡ cháº¿**

1. **Server Components**: `DashboardLayout` + page fetch dá»¯ liá»‡u trá»±c tiáº¿p server-side â†’ tá»‘i Æ°u performance.
2. **Client Components**: `Sidebar` giá»¯ state collapsible, highlight active menu â†’ SPA-style khÃ´ng reload layout.
3. **Nested Layout**: dá»… má»Ÿ rá»™ng vá»›i `/dashboard/analytics/reports` hoáº·c `/dashboard/settings/profile`.
4. **Hydration mÆ°á»£t mÃ **: chá»‰ page re-render, layout + sidebar giá»¯ nguyÃªn state.

---

ğŸ’¡ **Tip**: Báº¡n cÃ³ thá»ƒ thÃªm **dynamic breadcrumbs** trong `DashboardLayout` báº±ng `usePathname()` cá»§a `next/navigation`, káº¿t há»£p vá»›i segment Ä‘á»ƒ táº¡o Ä‘Æ°á»ng dáº«n hiá»‡n táº¡i.

---
MÃ¬nh sáº½ viáº¿t **Dashboard Layout nÃ¢ng cao full version** gáº§n production-ready, bao gá»“m:

* **Sidebar collapsible** vá»›i highlight active menu
* **Dynamic breadcrumbs**
* **Preserve scroll position** khi chuyá»ƒn page
* **Nested Layouts sÃ¢u** (cÃ³ thá»ƒ 3â€“4 level)
* **Server Components + Client Components** káº¿t há»£p
* **Hydration mÆ°á»£t mÃ **

---

## ğŸ“‚ **Cáº¥u trÃºc thÆ° má»¥c**

```
app/
â”œâ”€â”€ layout.tsx                  // Root layout
â”œâ”€â”€ dashboard/
â”‚   â”œâ”€â”€ layout.tsx              // Dashboard nested layout
â”‚   â”œâ”€â”€ page.tsx                // Overview
â”‚   â”œâ”€â”€ analytics/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ profile/
â”‚   â”‚       â””â”€â”€ page.tsx
â”œâ”€â”€ _components/
â”‚   â”œâ”€â”€ Sidebar.tsx             // Client Component
â”‚   â””â”€â”€ Breadcrumbs.tsx         // Client Component
```

---

## ğŸ“„ **1ï¸âƒ£ Sidebar Client Component**

```tsx
// app/_components/Sidebar.tsx
"use client";

import { useState, useEffect } from "react";
import { useSelectedLayoutSegment } from "next/navigation";
import Link from "next/link";

export default function Sidebar() {
  const segment = useSelectedLayoutSegment();
  const [collapsed, setCollapsed] = useState(false);

  return (
    <aside
      style={{
        width: collapsed ? 60 : 220,
        background: "#f0f0f0",
        padding: 20,
        transition: "width 0.2s",
      }}
    >
      <button onClick={() => setCollapsed(!collapsed)} style={{ marginBottom: 20 }}>
        {collapsed ? "â¡ï¸" : "â¬…ï¸"}
      </button>
      <ul style={{ listStyle: "none", padding: 0, margin: 0 }}>
        <li style={{ fontWeight: segment === null ? "bold" : "normal" }}>
          <Link href="/dashboard">Overview</Link>
        </li>
        <li style={{ fontWeight: segment === "analytics" ? "bold" : "normal" }}>
          <Link href="/dashboard/analytics">Analytics</Link>
        </li>
        <li style={{ fontWeight: segment === "settings" ? "bold" : "normal" }}>
          <Link href="/dashboard/settings">Settings</Link>
        </li>
      </ul>
    </aside>
  );
}
```

---

## ğŸ“„ **2ï¸âƒ£ Breadcrumbs Client Component**

```tsx
// app/_components/Breadcrumbs.tsx
"use client";

import { usePathname } from "next/navigation";
import Link from "next/link";

export default function Breadcrumbs() {
  const pathname = usePathname();
  const segments = pathname.split("/").filter(Boolean);

  return (
    <nav style={{ marginBottom: 16 }}>
      {segments.map((seg, idx) => {
        const href = "/" + segments.slice(0, idx + 1).join("/");
        return (
          <span key={idx}>
            <Link href={href}>{seg}</Link>
            {idx < segments.length - 1 && " / "}
          </span>
        );
      })}
    </nav>
  );
}
```

---

## ğŸ“„ **3ï¸âƒ£ Dashboard Layout (Server Component)**

```tsx
// app/dashboard/layout.tsx
import { ReactNode } from "react";
import Sidebar from "../_components/Sidebar";
import Breadcrumbs from "../_components/Breadcrumbs";

export default function DashboardLayout({ children }: { children: ReactNode }) {
  return (
    <div style={{ display: "flex", minHeight: "100vh" }}>
      {/* Sidebar (Client Component) */}
      <Sidebar />

      {/* Main Content */}
      <main style={{ flex: 1, padding: 24 }}>
        {/* Breadcrumbs (Client Component) */}
        <Breadcrumbs />

        {/* Server-rendered page */}
        {children}
      </main>
    </div>
  );
}
```

---

## ğŸ“„ **4ï¸âƒ£ Pages (Server Components)**

```tsx
// app/dashboard/page.tsx
export default function OverviewPage() {
  return <h2>ğŸ  Dashboard Overview</h2>;
}

// app/dashboard/analytics/page.tsx
export default function AnalyticsPage() {
  return <h2>ğŸ“Š Analytics Section</h2>;
}

// app/dashboard/settings/page.tsx
export default function SettingsPage() {
  return <h2>âš™ï¸ Settings Section</h2>;
}

// app/dashboard/settings/profile/page.tsx
export default function ProfilePage() {
  return <h2>ğŸ‘¤ Profile Settings</h2>;
}
```

---

## ğŸ§  **5ï¸âƒ£ TÃ­nh nÄƒng nÃ¢ng cao**

1. **Sidebar collapsible + active highlight**: `useSelectedLayoutSegment()` Ä‘áº£m báº£o menu Ä‘Ãºng route hiá»‡n táº¡i.
2. **Dynamic breadcrumbs**: cáº­p nháº­t theo URL.
3. **Nested Layouts sÃ¢u**: `/dashboard/settings/profile` cÃ³ thá»ƒ thÃªm layout riÃªng mÃ  váº«n giá»¯ Sidebar.
4. **SPA-style Hydration**: sidebar, breadcrumbs giá»¯ state khi chuyá»ƒn page, page má»›i server-render.
5. **Preserve scroll position**: layout client giá»¯ scroll, khÃ´ng reload khi Ä‘á»•i route con.

---

ğŸ’¡ **Tip**: Báº¡n cÃ³ thá»ƒ thÃªm `useEffect` trong `Sidebar` Ä‘á»ƒ scroll tá»›i menu active khi layout load, giÃºp UX giá»‘ng SPA production-ready.

---
BÃ¢y giá» mÃ¬nh sáº½ nÃ¢ng cáº¥p **Dashboard full version production-ready**, bao gá»“m:

* **Server + Client Components káº¿t há»£p**
* **Data fetching tá»« server (fake API)**
* **Loading Skeleton + Error Boundary**
* **Nested Layouts sÃ¢u**
* **Sidebar + Breadcrumbs giá»¯ tráº¡ng thÃ¡i khi chuyá»ƒn page**
* **Hydration mÆ°á»£t mÃ , SPA-like experience**

---

## ğŸ“‚ **Cáº¥u trÃºc thÆ° má»¥c nÃ¢ng cao**

```
app/
â”œâ”€â”€ layout.tsx                  // Root layout
â”œâ”€â”€ dashboard/
â”‚   â”œâ”€â”€ layout.tsx              // Dashboard nested layout
â”‚   â”œâ”€â”€ page.tsx                // Overview
â”‚   â”œâ”€â”€ analytics/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ profile/
â”‚   â”‚       â””â”€â”€ page.tsx
â”œâ”€â”€ _components/
â”‚   â”œâ”€â”€ Sidebar.tsx             // Client Component
â”‚   â”œâ”€â”€ Breadcrumbs.tsx         // Client Component
â”‚   â”œâ”€â”€ LoadingSkeleton.tsx     // Client Component
â”‚   â””â”€â”€ ErrorBoundary.tsx       // Client Component
```

---

## ğŸ“„ **1ï¸âƒ£ LoadingSkeleton Component**

```tsx
// app/_components/LoadingSkeleton.tsx
"use client";

export default function LoadingSkeleton() {
  return (
    <div style={{ padding: 16 }}>
      <div style={{ background: "#eee", height: 20, width: "50%", marginBottom: 8 }} />
      <div style={{ background: "#eee", height: 20, width: "80%", marginBottom: 8 }} />
      <div style={{ background: "#eee", height: 20, width: "30%" }} />
    </div>
  );
}
```

---

## ğŸ“„ **2ï¸âƒ£ ErrorBoundary Component**

```tsx
// app/_components/ErrorBoundary.tsx
"use client";

import { ReactNode, useState } from "react";

export default function ErrorBoundary({ children }: { children: ReactNode }) {
  const [hasError, setHasError] = useState(false);

  if (hasError) {
    return (
      <div style={{ color: "red", padding: 16 }}>
        <h3>ğŸš¨ Something went wrong!</h3>
        <button onClick={() => setHasError(false)}>Try Again</button>
      </div>
    );
  }

  try {
    return children;
  } catch (err) {
    setHasError(true);
    return null;
  }
}
```

---

## ğŸ“„ **3ï¸âƒ£ Fake Server Data Fetching**

```ts
// app/dashboard/data.ts
export async function fetchDashboardData() {
  await new Promise(res => setTimeout(res, 1000)); // simulate delay
  return {
    users: 120,
    sales: 5400,
    activeSessions: 23,
  };
}
```

---

## ğŸ“„ **4ï¸âƒ£ Dashboard Layout (Server + Client)**

```tsx
// app/dashboard/layout.tsx
import { ReactNode } from "react";
import Sidebar from "../_components/Sidebar";
import Breadcrumbs from "../_components/Breadcrumbs";
import LoadingSkeleton from "../_components/LoadingSkeleton";
import ErrorBoundary from "../_components/ErrorBoundary";

export default function DashboardLayout({ children }: { children: ReactNode }) {
  return (
    <div style={{ display: "flex", minHeight: "100vh" }}>
      {/* Sidebar (Client Component) */}
      <Sidebar />

      {/* Main Content */}
      <main style={{ flex: 1, padding: 24 }}>
        {/* Breadcrumbs */}
        <Breadcrumbs />

        {/* ErrorBoundary wraps server content */}
        <ErrorBoundary>
          <React.Suspense fallback={<LoadingSkeleton />}>
            {children}
          </React.Suspense>
        </ErrorBoundary>
      </main>
    </div>
  );
}
```

---

## ğŸ“„ **5ï¸âƒ£ Overview Page (Server Component + fetch data)**

```tsx
// app/dashboard/page.tsx
import { fetchDashboardData } from "./data";

export default async function OverviewPage() {
  const data = await fetchDashboardData();

  return (
    <div>
      <h2>ğŸ  Dashboard Overview</h2>
      <ul>
        <li>Users: {data.users}</li>
        <li>Sales: ${data.sales}</li>
        <li>Active Sessions: {data.activeSessions}</li>
      </ul>
    </div>
  );
}
```

---

## ğŸ“„ **6ï¸âƒ£ Analytics Page**

```tsx
// app/dashboard/analytics/page.tsx
import { fetchDashboardData } from "../data";

export default async function AnalyticsPage() {
  const data = await fetchDashboardData();

  return (
    <div>
      <h2>ğŸ“Š Analytics</h2>
      <p>Users: {data.users}</p>
      <p>Sales: ${data.sales}</p>
    </div>
  );
}
```

---

## ğŸ“„ **7ï¸âƒ£ Settings Page**

```tsx
// app/dashboard/settings/page.tsx
export default function SettingsPage() {
  return (
    <div>
      <h2>âš™ï¸ Settings</h2>
      <p>Configure your dashboard preferences here.</p>
    </div>
  );
}
```

---

## ğŸ§  **8ï¸âƒ£ NÃ¢ng cao**

1. **Hydration + Suspense**: Server component render dá»¯ liá»‡u, Client component (Sidebar + Breadcrumbs) giá»¯ tráº¡ng thÃ¡i.
2. **Loading Skeleton**: React.Suspense fallback hiá»ƒn thá»‹ khi server fetch data.
3. **ErrorBoundary**: Bao quanh táº¥t cáº£ trang, trÃ¡nh crash toÃ n bá»™ layout.
4. **SPA-like UX**: sidebar giá»¯ state, breadcrumbs tá»± Ä‘á»™ng update.
5. **Nested Layouts sÃ¢u**: CÃ³ thá»ƒ thÃªm `settings/profile/layout.tsx` riÃªng mÃ  váº«n giá»¯ layout cha.

---

ğŸ’¡ **Tip**: Khi dá»± Ã¡n tháº­t, báº¡n cÃ³ thá»ƒ thay `fetchDashboardData` báº±ng Prisma/DB hoáº·c REST/GraphQL API. Layout + Suspense + ErrorBoundary + Client Components combo nÃ y gáº§n nhÆ° **chuáº©n production-ready**.


---
[<< BÃ€I 20](./20.md) | [BÃ€I 22 >>](./22.md)