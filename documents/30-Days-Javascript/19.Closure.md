# Ngày 19

## Closure

**Closure** trong JavaScript xảy ra khi một hàm bên trong (inner function) truy cập các biến của hàm bên ngoài (outer function). Closure cho phép hàm bên trong giữ quyền truy cập vào các biến của hàm bên ngoài ngay cả khi hàm bên ngoài đã thực thi xong. Điều này rất hữu ích để duy trì trạng thái hoặc tạo các hàm với dữ liệu riêng tư.

**Ví dụ 1**:

```js
function outerFunction() {
  let count = 0
  function innerFunction() {
    count++
    return count
  }
  return innerFunction
}
const innerFunc = outerFunction()

console.log(innerFunc()) // 1
console.log(innerFunc()) // 2
console.log(innerFunc()) // 3
```

**Ví dụ 2**:

```js
function outerFunction() {
  let count = 0
  function plusOne() {
    count++
    return count
  }
  function minusOne() {
    count--
    return count
  }
  return {
    plusOne: plusOne,
    minusOne: minusOne
  }
}
const innerFuncs = outerFunction()

console.log(innerFuncs.plusOne()) // 1
console.log(innerFuncs.minusOne()) // 0
console.log(innerFuncs.plusOne()) // 1
```

Trong ví dụ thứ hai, lưu ý rằng `plusOne` và `minusOne` được trả về dưới dạng các hàm, không phải kết quả của việc gọi hàm (loại bỏ `()`). Điều này cho phép gọi các hàm này nhiều lần để cập nhật giá trị `count`.

---

## Bài tập: Ngày 19

### Bài tập: Cấp độ 1

1. **Tạo một closure với một hàm bên trong**

```js
function createCounter() {
  let count = 0
  function increment() {
    count++
    return count
  }
  return increment
}

const counter = createCounter()
console.log(counter()) // 1
console.log(counter()) // 2
console.log(counter()) // 3
```

### Bài tập: Cấp độ 2

1. **Tạo một closure với ba hàm bên trong**

```js
function createCalculator() {
  let value = 0
  function add(num) {
    value += num
    return value
  }
  function subtract(num) {
    value -= num
    return value
  }
  function reset() {
    value = 0
    return value
  }
  return {
    add,
    subtract,
    reset
  }
}

const calc = createCalculator()
console.log(calc.add(5)) // 5
console.log(calc.subtract(2)) // 3
console.log(calc.reset()) // 0
console.log(calc.add(10)) // 10
```

### Bài tập: Cấp độ 3

1. **Tạo hàm personAccount với các biến và hàm bên trong**

```js
function personAccount() {
  let firstName = 'Asabeneh'
  let lastName = 'Yetayeh'
  let incomes = []
  let expenses = []

  function totalIncome() {
    return incomes.reduce((sum, { amount }) => sum + amount, 0)
  }

  function totalExpense() {
    return expenses.reduce((sum, { amount }) => sum + amount, 0)
  }

  function accountInfo() {
    return `${firstName} ${lastName} has a balance of ${accountBalance()}. Total income: ${totalIncome()}, Total expense: ${totalExpense()}`
  }

  function addIncome(amount, description) {
    incomes.push({ amount, description })
  }

  function addExpense(amount, description) {
    expenses.push({ amount, description })
  }

  function accountBalance() {
    return totalIncome() - totalExpense()
  }

  return {
    totalIncome,
    totalExpense,
    accountInfo,
    addIncome,
    addExpense,
    accountBalance
  }
}

const account = personAccount()
account.addIncome(1000, 'Salary')
account.addIncome(500, 'Freelance')
account.addExpense(300, 'Rent')
console.log(account.accountInfo()) // Asabeneh Yetayeh has a balance of 1200. Total income: 1500, Total expense: 300
console.log(account.totalIncome()) // 1500
console.log(account.totalExpense()) // 300
console.log(account.accountBalance()) // 1200
```

---

[<< Ngày 18](./18.Promises.md) | [Ngày 20 >>](./20.Writing_Clean_Codes.md)