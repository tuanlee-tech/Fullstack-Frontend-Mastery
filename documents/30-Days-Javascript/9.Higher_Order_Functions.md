# Ngày 9

## Hàm bậc cao (Higher Order Function)

**Hàm bậc cao**: Hàm nhận hàm khác làm tham số hoặc trả về một hàm.

### Callback

**Callback**: Hàm được truyền vào hàm khác làm tham số.

```js
const callback = n => n ** 2
function cube(callback, n) {
  return callback(n) * n
}
console.log(cube(callback, 3)) // 27
```

### Hàm trả về hàm

Hàm bậc cao có thể trả về một hàm khác.

```js
const higherOrder = n => {
  const doSomething = m => {
    const doWhatEver = t => 2 * n + 3 * m + t
    return doWhatEver
  }
  return doSomething
}
console.log(higherOrder(2)(3)(10)) // 23
```

### Đặt thời gian

- **setInterval**: Thực thi lặp lại sau mỗi khoảng thời gian (ms).

```js
function sayHello() {
  console.log('Hello')
}
setInterval(sayHello, 1000) // In "Hello" mỗi giây
```

- **setTimeout**: Thực thi một lần sau khoảng thời gian (ms).

```js
setTimeout(sayHello, 2000) // In "Hello" sau 2 giây
```

## Lập trình hàm (Functional Programming)

JavaScript cung cấp các phương thức tích hợp như `forEach`, `map`, `filter`, `reduce`, `every`, `find`, `findIndex`, `some`, `sort` để xử lý mảng, sử dụng callback.

### forEach

Lặp qua các phần tử mảng, không trả về giá trị.

```js
const numbers = [1, 2, 3, 4, 5]
numbers.forEach(num => console.log(num)) // 1, 2, 3, 4, 5
```

### map

Tạo mảng mới bằng cách biến đổi từng phần tử.

```js
const numbersSquare = numbers.map(num => num * num)
console.log(numbersSquare) // [1, 4, 9, 16, 25]
```

### filter

Tạo mảng mới với các phần tử thỏa mãn điều kiện.

```js
const countries = ['Finland', 'Sweden', 'Denmark', 'Norway', 'Iceland']
const countriesWithLand = countries.filter(country => country.includes('land'))
console.log(countriesWithLand) // ['Finland', 'Iceland']
```

### reduce

Giảm mảng thành một giá trị duy nhất.

```js
const sum = numbers.reduce((acc, cur) => acc + cur, 0)
console.log(sum) // 15
```

### every

Kiểm tra xem tất cả phần tử có thỏa mãn điều kiện không, trả về boolean.

```js
const allStrings = names.every(name => typeof name === 'string')
console.log(allStrings) // true
```

### find

Trả về phần tử đầu tiên thỏa mãn điều kiện.

```js
const age = [24, 22, 25, 32, 35, 18].find(age => age < 20)
console.log(age) // 18
```

### findIndex

Trả về chỉ số của phần tử đầu tiên thỏa mãn điều kiện.

```js
const index = names.findIndex(name => name.length > 7)
console.log(index) // 0 (Asabeneh)
```

### some

Kiểm tra xem có ít nhất một phần tử thỏa mãn điều kiện không, trả về boolean.

```js
const hasLongName = names.some(name => name.length > 7)
console.log(hasLongName) // true
```

### sort

Sắp xếp mảng, có thể cần callback để so sánh.

- **Chuỗi**:

```js
const products = ['Milk', 'Coffee', 'Sugar']
console.log(products.sort()) // ['Coffee', 'Milk', 'Sugar']
```

- **Số**:

```js
const numbers = [9.81, 3.14, 100, 37]
numbers.sort((a, b) => a - b)
console.log(numbers) // [3.14, 9.81, 37, 100]
```

- **Đối tượng**:

```js
const users = [
  { name: 'Asabeneh', age: 150 },
  { name: 'Brook', age: 50 }
]
users.sort((a, b) => a.age - b.age)
console.log(users) // [{ name: 'Brook', age: 50 }, { name: 'Asabeneh', age: 150 }]
```

---

## Bài tập: Ngày 9

### Bài tập: Cấp độ 1

```js
const countries = ['Finland', 'Sweden', 'Denmark', 'Norway', 'IceLand']
const names = ['Asabeneh', 'Mathias', 'Elias', 'Brook']
const numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
const products = [
  { product: 'banana', price: 3 },
  { product: 'mango', price: 6 },
  { product: 'potato', price: ' ' },
  { product: 'avocado', price: 8 },
  { product: 'coffee', price: 10 },
  { product: 'tea', price: '' }
]
```

1. **Phân biệt forEach, map, filter, reduce**

- `forEach`: Lặp qua mảng, không trả về giá trị, dùng để thực hiện hành động.
- `map`: Tạo mảng mới từ việc biến đổi từng phần tử.
- `filter`: Tạo mảng mới với các phần tử thỏa điều kiện.
- `reduce`: Giảm mảng thành một giá trị duy nhất.

2. **Định nghĩa callback**

Callback là hàm được truyền làm tham số cho hàm khác.

```js
const callback = num => num * 2
numbers.forEach(callback) // Sử dụng callback
```

3. **In các quốc gia với forEach**

```js
countries.forEach(country => console.log(country))
```

4. **In các tên với forEach**

```js
names.forEach(name => console.log(name))
```

5. **In các số với forEach**

```js
numbers.forEach(num => console.log(num))
```

6. **Viết hoa các quốc gia với map**

```js
const upperCountries = countries.map(country => country.toUpperCase())
console.log(upperCountries) // ['FINLAND', 'SWEDEN', 'DENMARK', 'NORWAY', 'ICELAND']
```

7. **Lấy độ dài tên quốc gia với map**

```js
const countryLengths = countries.map(country => country.length)
console.log(countryLengths) // [7, 6, 7, 6, 7]
```

8. **Bình phương số với map**

```js
const squares = numbers.map(num => num * num)
console.log(squares) // [1, 4, 9, 16, 25, 36, 49, 64, 81, 100]
```

9. **Viết hoa tên với map**

```js
const upperNames = names.map(name => name.toUpperCase())
console.log(upperNames) // ['ASABENEH', 'MATHIAS', 'ELIAS', 'BROOK']
```

10. **Lấy giá sản phẩm với map**

```js
const prices = products.map(product => product.price)
console.log(prices) // [3, 6, ' ', 8, 10, '']
```

11. **Lọc quốc gia chứa 'land'**

```js
const landCountries = countries.filter(country => country.includes('land'))
console.log(landCountries) // ['Finland', 'IceLand']
```

12. **Lọc quốc gia có 6 ký tự**

```js
const sixCharCountries = countries.filter(country => country.length === 6)
console.log(sixCharCountries) // ['Sweden', 'Norway']
```

13. **Lọc quốc gia có từ 6 ký tự trở lên**

```js
const longCountries = countries.filter(country => country.length >= 6)
console.log(longCountries) // ['Finland', 'Sweden', 'Denmark', 'Norway', 'IceLand']
```

14. **Lọc quốc gia bắt đầu bằng 'E'**

```js
const eCountries = countries.filter(country => country.startsWith('E'))
console.log(eCountries) // []
```

15. **Lọc giá hợp lệ**

```js
const validPrices = products.filter(product => typeof product.price === 'number')
console.log(validPrices) // [{ product: 'banana', price: 3 }, { product: 'mango', price: 6 }, { product: 'avocado', price: 8 }, { product: 'coffee', price: 10 }]
```

16. **Lấy mảng chuỗi**

```js
function getStringLists(arr) {
  return arr.filter(item => typeof item === 'string')
}
console.log(getStringLists(['a', 1, 'b', true])) // ['a', 'b']
```

17. **Tổng các số với reduce**

```js
const sum = numbers.reduce((acc, num) => acc + num, 0)
console.log(sum) // 55
```

18. **Nối các quốc gia thành câu**

```js
const sentence = countries.reduce((acc, country, i) => {
  if (i === 0) return country
  if (i === countries.length - 1) return `${acc}, and ${country}`
  return `${acc}, ${country}`
}, '') + ' are north European countries'
console.log(sentence) // Finland, Sweden, Denmark, Norway, and IceLand are north European countries
```

19. **Phân biệt some và every**

- `some`: Trả về `true` nếu ít nhất một phần tử thỏa điều kiện.
- `every`: Trả về `true` nếu tất cả phần tử thỏa điều kiện.

20. **Kiểm tra tên dài hơn 7 ký tự với some**

```js
const hasLongName = names.some(name => name.length > 7)
console.log(hasLongName) // true
```

21. **Kiểm tra tất cả quốc gia chứa 'land' với every**

```js
const allHaveLand = countries.every(country => country.includes('land'))
console.log(allHaveLand) // false
```

22. **Phân biệt find và findIndex**

- `find`: Trả về phần tử đầu tiên thỏa điều kiện.
- `findIndex`: Trả về chỉ số của phần tử đầu tiên thỏa điều kiện.

23. **Tìm quốc gia 6 ký tự đầu tiên**

```js
const sixCharCountry = countries.find(country => country.length === 6)
console.log(sixCharCountry) // Sweden
```

24. **Tìm chỉ số quốc gia 6 ký tự đầu tiên**

```js
const sixCharIndex = countries.findIndex(country => country.length === 6)
console.log(sixCharIndex) // 1
```

25. **Tìm chỉ số của Norway**

```js
const norwayIndex = countries.findIndex(country => country === 'Norway')
console.log(norwayIndex) // 3
```

26. **Tìm chỉ số của Russia**

```js
const russiaIndex = countries.findIndex(country => country === 'Russia')
console.log(russiaIndex) // -1
```

### Bài tập: Cấp độ 2

1. **Tổng giá sản phẩm bằng chuỗi iterator**

```js
const totalPrice = products
  .map(product => product.price)
  .filter(price => typeof price === 'number')
  .reduce((sum, price) => sum + price, 0)
console.log(totalPrice) // 27
```

2. **Tổng giá sản phẩm chỉ dùng reduce**

```js
const totalPriceReduce = products.reduce((sum, product) => {
  return typeof product.price === 'number' ? sum + product.price : sum
}, 0)
console.log(totalPriceReduce) // 27
```

3. **Phân loại quốc gia theo mẫu**

```js
function categorizeCountries(pattern) {
  return countries.filter(country => country.includes(pattern))
}
console.log(categorizeCountries('land')) // ['Finland', 'IceLand']
```

4. **Đếm chữ cái đầu của quốc gia**

```js
function countStartingLetters(countries) {
  return countries.reduce((acc, country) => {
    const letter = country[0]
    const existing = acc.find(item => item.letter === letter)
    if (existing) existing.count++
    else acc.push({ letter, count: 1 })
    return acc
  }, [])
}
console.log(countStartingLetters(countries)) // [{letter: 'F', count: 1}, {letter: 'S', count: 1}, ...]
```

5. **Lấy 10 quốc gia đầu tiên**

```js
function getFirstTenCountries(countries) {
  return countries.slice(0, 10)
}
console.log(getFirstTenCountries(countries)) // ['Finland', 'Sweden', 'Denmark', 'Norway', 'IceLand']
```

6. **Lấy 10 quốc gia cuối cùng**

```js
function getLastTenCountries(countries) {
  return countries.slice(-10)
}
console.log(getLastTenCountries(countries)) // ['Finland', 'Sweden', 'Denmark', 'Norway', 'IceLand']
```

7. **Tìm chữ cái đầu phổ biến nhất**

```js
function mostFrequentStartingLetter(countries) {
  const counts = countStartingLetters(countries)
  return counts.reduce((max, item) => (item.count > max.count ? item : max), counts[0]).letter
}
console.log(mostFrequentStartingLetter(countries)) // F (ví dụ)
```

### Bài tập: Cấp độ 3

1. **Sắp xếp quốc gia**

```js
function sortCountries(countries, key) {
  return [...countries].sort((a, b) => {
    if (a[key] < b[key]) return -1
    if (a[key] > b[key]) return 1
    return 0
  })
}
// Sắp xếp theo name, capital, population
console.log(sortCountries(countries, 'name'))
console.log(sortCountries(countries, 'capital'))
console.log(sortCountries(countries, 'population'))
```

2. **10 ngôn ngữ phổ biến nhất**

```js
function mostSpokenLanguages(countries, n) {
  const langCounts = countries.reduce((acc, country) => {
    country.languages.forEach(lang => {
      const existing = acc.find(item => item.country === lang)
      if (existing) existing.count++
      else acc.push({ country: lang, count: 1 })
    })
    return acc
  }, []).sort((a, b) => b.count - a.count)
  return langCounts.slice(0, n)
}
console.log(mostSpokenLanguages(countries, 10)) // [{country: 'English', count: 91}, ...]
```

3. **10 quốc gia đông dân nhất**

```js
function mostPopulatedCountries(countries, n) {
  return countries
    .map(country => ({ country: country.name, population: country.population }))
    .sort((a, b) => b.population - a.population)
    .slice(0, n)
}
console.log(mostPopulatedCountries(countries, 10)) // [{country: 'China', population: 1377422166}, ...]
```

4. **Thống kê số liệu**

```js
const statistics = {
  ages: [31, 26, 34, 37, 27, 26, 32, 32, 26, 27, 27, 24, 32, 33, 27, 25, 26, 38, 37, 31, 34, 24, 33, 29, 26],
  count() {
    return this.ages.length
  },
  sum() {
    return this.ages.reduce((sum, age) => sum + age, 0)
  },
  min() {
    return Math.min(...this.ages)
  },
  max() {
    return Math.max(...this.ages)
  },
  range() {
    return this.max() - this.min()
  },
  mean() {
    return this.sum() / this.count()
  },
  median() {
    const sorted = [...this.ages].sort((a, b) => a - b)
    const mid = Math.floor(sorted.length / 2)
    return sorted.length % 2 === 0 ? (sorted[mid - 1] + sorted[mid]) / 2 : sorted[mid]
  },
  mode() {
    const freq = this.ages.reduce((acc, age) => {
      acc[age] = (acc[age] || 0) + 1
      return acc
    }, {})
    let mode = 0, maxCount = 0
    for (const age in freq) {
      if (freq[age] > maxCount) {
        mode = age
        maxCount = freq[age]
      }
    }
    return { mode: +mode, count: maxCount }
  },
  var() {
    const mean = this.mean()
    return this.ages.reduce((sum, age) => sum + (age - mean) ** 2, 0) / this.count()
  },
  std() {
    return Math.sqrt(this.var())
  },
  freqDist() {
    const freq = this.ages.reduce((acc, age) => {
      acc[age] = (acc[age] || 0) + 1
      return acc
    }, {})
    return Object.entries(freq)
      .map(([age, count]) => [(count / this.count() * 100).toFixed(1), +age])
      .sort((a, b) => b[0] - a[0])
  },
  describe() {
    return `
Count: ${this.count()}
Sum: ${this.sum()}
Min: ${this.min()}
Max: ${this.max()}
Range: ${this.range()}
Mean: ${this.mean()}
Median: ${this.median()}
Mode: (${this.mode().mode}, ${this.mode().count})
Variance: ${this.var().toFixed(1)}
Standard Deviation: ${this.std().toFixed(1)}
Frequency Distribution: ${JSON.stringify(this.freqDist())}`
  }
}
console.log(statistics.describe())
```

---

[<< Ngày 8](./8.Objects.md) | [Ngày 10 >>](./10.Sets_and_Maps.md)