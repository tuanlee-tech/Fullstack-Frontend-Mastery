# Network request
<details>
<summary><strong>1. Tạo HTTP Request trong JavaScript với XMLHttpRequest</strong></summary>

### 1. HTTP là gì?

* **HTTP (HyperText Transfer Protocol)**: giao thức truyền tải siêu văn bản giữa client và server, sử dụng TCP/IP.
* Quy trình cơ bản khi gõ URL trên trình duyệt:

  1. Tìm địa chỉ IP của server qua DNS.
  2. Mở kết nối TCP đến server (cổng 80 cho HTTP).
  3. Gửi yêu cầu (GET/POST/…) đến server.
  4. Nhận phản hồi và render trang web.

---

### 2. Các phương thức request HTTP

| Phương thức | Chức năng                                       |
| ----------- | ----------------------------------------------- |
| GET         | Lấy thông tin từ server, không thay đổi dữ liệu |
| HEAD        | Lấy header và trạng thái của resource           |
| POST        | Gửi dữ liệu từ client lên server                |
| PUT         | Thay thế dữ liệu trên server                    |
| DELETE      | Xóa dữ liệu trên server                         |
| CONNECT     | Tạo kênh truyền đến server                      |
| OPTIONS     | Mô tả các tuỳ chọn giao tiếp đến resource       |
| TRACE       | Thử lặp thông báo với resource                  |

---

### 3. Status Code HTTP

| Loại | Ví dụ    | Ý nghĩa                                     |
| ---- | -------- | ------------------------------------------- |
| 1xx  | 100, 101 | Request được chấp nhận, tiến trình tiếp tục |
| 2xx  | 200-206  | Hành động thành công                        |
| 3xx  | 300-307  | Cần thực hiện thêm hành động                |
| 4xx  | 400-417  | Lỗi từ client (cú pháp, dữ liệu…)           |
| 5xx  | 500-505  | Lỗi từ server                               |

---

### 4. Gửi HTTP request với `XMLHttpRequest`

#### a. GET request đồng bộ

```js
const req = new XMLHttpRequest();
req.open("GET", "https://httpbin.org/get", false); // false = đồng bộ
req.send(null);

console.log(req.status);       // 200
console.log(req.responseText); // Chuỗi JSON trả về từ server
```

* `open(method, url, async)`:

  * `method`: GET, POST, …
  * `url`: địa chỉ server
  * `async`: `false` đồng bộ, `true` bất đồng bộ

* `send(body)`: gửi request đến server. GET → `null`.

* Thêm header:

```js
req.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
```

#### b. POST request đồng bộ

```js
const req = new XMLHttpRequest();
req.open("POST", "https://httpbin.org/post", false);
req.setRequestHeader("Content-Type", "application/json; charset=UTF-8");

const jsonBody = { name: "Thaycacac", url: "tuanlee.edu.vn" };
req.send(JSON.stringify(jsonBody));

console.log(req.status);      
console.log(req.responseText);
```

---

### 5. XMLHttpRequest bất đồng bộ

```js
const req = new XMLHttpRequest();
req.open("GET", "https://httpbin.org/get", true); // true = bất đồng bộ

req.addEventListener("load", () => {
  console.log(req.status);
  console.log(req.responseText);
});

req.addEventListener("error", () => {
  console.log("Error occurred!");
});

req.send(null);
console.log("Sent");
```

* Kết quả: `"Sent"` được in ngay, các log về status và response chỉ xuất hiện khi server trả dữ liệu.
* Bất đồng bộ giúp tránh **đơ trình duyệt** khi request chậm.

---

### 6. Tổng kết

* **HTTP**: giao thức trao đổi dữ liệu client-server.
* **XMLHttpRequest**:

  * Gửi HTTP request từ JS.
  * Hỗ trợ **đồng bộ** và **bất đồng bộ** (khuyến nghị bất đồng bộ).
  * Hỗ trợ mọi phương thức HTTP: GET, POST, PUT, DELETE,…

Tham khảo:

* [HTTP and Forms](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods)
* [HTTP Requests](https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview)
* [HTTP Status Codes](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status)

</details>
<details>
<summary><strong>2. XMLHttpRequest với Promise</strong></summary>

### 1. Promise trong JavaScript

* **Promise**: đối tượng xử lý tác vụ bất đồng bộ.
* Cấu trúc cơ bản:

```js
let p = new Promise((resolve, reject) => {
  // Async task
  if (/* thành công */) resolve(data);
  else reject(error);
});

p.then(
  data => { /* xử lý thành công */ },
  error => { /* xử lý lỗi */ }
).catch(event => { /* xử lý lỗi khác */ });
```

* `resolve`: gọi khi tác vụ thành công.
* `reject`: gọi khi tác vụ thất bại.
* `.then()` nhận 2 callback tương ứng cho resolve và reject.
* `.catch()` để xử lý các lỗi khác.

---

### 2. Tạo XMLHttpRequest hỗ trợ IE

```js
let XMLHttpRequest =
  window.XMLHttpRequest || ActiveXObject("Microsoft.XMLHTTP");

let xmlHttpRequest = new XMLHttpRequest();
```

* Nếu trình duyệt hỗ trợ `XMLHttpRequest` → dùng trực tiếp.
* Nếu IE cũ → dùng `ActiveXObject("Microsoft.XMLHTTP")`.

---

### 3. XMLHttpRequest với Promise

* Hàm GET bất đồng bộ trả về Promise:

```js
function get(requestURL) {
  return new Promise(function (resolve, reject) {
    let XMLHttpRequest =
      window.XMLHttpRequest || ActiveXObject("Microsoft.XMLHTTP");
    let req = new XMLHttpRequest();
    req.open("GET", requestURL, true);

    req.addEventListener("load", function () {
      if (req.status == 200) resolve(req.responseText);
      else if (req.status == 404) reject(new Error(requestURL + " 404"));
    });

    req.addEventListener("error", function (event) {
      reject(event);
    });

    req.send(null);
  });
}
```

* `req.open("GET", requestURL, true)`: `true` → bất đồng bộ.
* `resolve(req.responseText)`: trả về dữ liệu khi thành công.
* `reject(event)`: trả về lỗi khi thất bại.

---

### 4. Sử dụng hàm `get` với Promise

```js
let request = "https://fcc-weather-api.glitch.me/api/current?lat=21&lon=105";

get(request)
  .then(function (data) {
    console.log(data);
    document.querySelector("#result").textContent = data.toString();
  })
  .catch(function (error) {
    console.log(error);
  });
```

* `.then()`: xử lý kết quả thành công.
* `.catch()`: xử lý lỗi khi request thất bại.

---

### 5. Kết luận

* Kết hợp **XMLHttpRequest** với **Promise** giúp quản lý request bất đồng bộ dễ dàng hơn.
* Có thể áp dụng tương tự cho các phương thức POST, PUT, DELETE…

**Tham khảo:**

* [JavaScript Promise API](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)
* [Promise MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)

</details>
