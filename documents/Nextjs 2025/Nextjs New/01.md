# 🧭 PHẦN 1 — GIỚI THIỆU NEXT.JS

## 1️⃣ Next.js là gì

Next.js là **một framework dựa trên React**, giúp bạn xây dựng **ứng dụng web hiện đại, nhanh, tối ưu SEO và dễ mở rộng**.
Khác với React thuần chỉ chạy phía **client (trình duyệt)**, Next.js cho phép chạy cả ở **server** và **client**, giúp:

* Hiển thị nội dung nhanh hơn (vì render sẵn HTML ở server)
* Cải thiện SEO (Google đọc được nội dung HTML)
* Dễ phát triển các tính năng phức tạp như login, routing, API, database,...

---

## 2️⃣ Ưu điểm nổi bật

| Ưu điểm                                         | Mô tả                                                 |
| ----------------------------------------------- | ----------------------------------------------------- |
| ⚡ SSR/SSG                                       | Tăng tốc hiển thị và tối ưu SEO                       |
| 🧭 Routing tự động                              | Không cần React Router, chỉ cần tạo file trong `app/` |
| 🧩 API Routes                                   | Viết API ngay trong dự án                             |
| 🎨 Hỗ trợ sẵn TypeScript, Tailwind, CSS Modules |                                                       |
| ☁️ Dễ deploy lên Vercel, Cloudflare, AWS,...    |                                                       |

---

## 3️⃣ Cách hoạt động (quy trình render trong Next.js)

Hãy xem luồng cơ bản khi người dùng truy cập vào một trang Next.js:

```
Trình duyệt gửi request → Server render sẵn HTML → Trả về cho trình duyệt → React hydrate → Trang hoạt động như app React
```

### 🔹 Giai đoạn 1: Server render

Next.js chạy code React **trên server**, tạo ra **HTML tĩnh** để gửi xuống client.
👉 Người dùng thấy nội dung **ngay lập tức** (tốc độ và SEO tốt).

### 🔹 Giai đoạn 2: Hydration

Sau khi HTML được hiển thị, React trên client **tải lại code JS** và **gắn (attach)** logic React (state, event...) vào HTML.
👉 Lúc này trang trở nên **tương tác** (click, input, update state,...)

---

## 4️⃣ Ví dụ thực tế: Hydration trong Next.js

### 🧱 Cấu trúc thư mục

```
app/
 ├─ page.tsx
 └─ components/
     └─ Counter.tsx
```

---

### 🔹 **`components/Counter.tsx`**

```tsx
'use client';

import { useState } from 'react';

export default function Counter() {
  const [count, setCount] = useState(0);

  return (
    <button
      onClick={() => setCount(count + 1)}
      className="p-2 bg-blue-500 text-white rounded"
    >
      Click me ({count})
    </button>
  );
}
```

* `use client` giúp Next.js biết đây là **Client Component**, được render và hydrate ở phía client.
* Khi server gửi HTML xuống, nó chỉ chứa `<button>Click me (0)</button>`, **chưa có JavaScript**.
* Sau khi JS tải, React **hydrate** → nút hoạt động, tăng số khi click.

---

### 🔹 **`app/page.tsx`**

```tsx
import Counter from './components/Counter';

export default function Page() {
  return (
    <main className="flex flex-col items-center justify-center h-screen">
      <h1 className="text-3xl font-bold mb-4">Hydration Demo</h1>
      <Counter />
    </main>
  );
}
```

---

### 📜 **Khi chạy ứng dụng:**

1. Server render ra HTML:

   ```html
   <h1>Hydration Demo</h1>
   <button>Click me (0)</button>
   ```

   → người dùng **thấy nội dung ngay lập tức**.
2. Sau khi React JS tải, quá trình **hydrate** xảy ra:

   * Gắn lại event `onClick`
   * Theo dõi state `count`
   * Biến nút đó thành React component thật sự
     → Bây giờ bạn click được, số đếm tăng lên.

---

## 5️⃣ Hình dung cơ chế tổng thể

| Giai đoạn     | Trên server       | Trên client                 |
| ------------- | ----------------- | --------------------------- |
| Render        | Tạo HTML từ React | Nhận HTML và hiển thị ngay  |
| Hydration     | —                 | Gắn JS logic vào HTML       |
| Sau Hydration | —                 | App hoạt động như React SPA |

---

## 6️⃣ Cẩn trọng khi Hydration

* Nếu HTML server khác HTML client → lỗi **Hydration Mismatch**.
* Không nên truy cập `window`, `document` trong Server Component.
* Chỉ dùng `use client` khi cần logic tương tác (form, button, event).

---

## 💡 Tóm tắt

> Next.js = React + Server-side Rendering + File-based Routing + API + Performance.
> Hydration = quá trình “thổi hồn” cho HTML tĩnh, biến nó thành ứng dụng React tương tác.

---


# ⚛️ Hiểu rõ về **Hydration trong Next.js (App Router)**



## 🧭 1. Next.js hoạt động như thế nào?

Next.js là framework kết hợp giữa **Server Rendering (SSR)** và **Client Rendering (CSR)**.
Điều đặc biệt là nó **render trước HTML ở server**, sau đó **hydrate (kích hoạt React trên client)** để HTML đó trở nên tương tác được.

---

## 💧 2. Hydration là gì?

> **Hydration** là quá trình **React trên trình duyệt (client)** “gắn” lại các event handlers, state, hooks...
> lên **HTML tĩnh được render từ server**.

Hiểu đơn giản:

* SSR → render HTML (chưa có JavaScript logic).
* Hydration → “bơm” React logic vào HTML đó → trang trở nên tương tác được.

---

## 🧱 3. Ví dụ thực tế

### 📁 Cấu trúc

```
app/
 ├─ page.tsx
 └─ components/
     ├─ ServerInfo.tsx
     └─ Counter.tsx
```

---

### **A. `ServerInfo.tsx` (mặc định là Server Component)**

```tsx
export default async function ServerInfo() {
  const time = new Date().toISOString();

  return (
    <div className="p-4 bg-green-100 rounded">
      <h2 className="text-xl font-semibold">🧩 Server Component</h2>
      <p>Rendered at: {time}</p>
      <p>(HTML được tạo ở server và gửi xuống client)</p>
    </div>
  );
}
```

🧠 **Giải thích:**

* Không có dòng `use client` ở đầu file → **mặc định là Server Component**.
* Chạy **chỉ ở server** → không thể dùng `useState`, `useEffect`, `onClick`, v.v.
* Tạo HTML tĩnh và gửi về client, **không cần JavaScript kèm theo** → tải rất nhanh.

---

### **B. `Counter.tsx` (Client Component)**

```tsx
'use client';

import { useState } from 'react';

export default function Counter() {
  const [count, setCount] = useState(0);

  return (
    <div className="p-4 bg-blue-100 rounded mt-4">
      <h2 className="text-xl font-semibold">⚙️ Client Component</h2>
      <button
        onClick={() => setCount(count + 1)}
        className="px-4 py-2 bg-blue-500 text-white rounded"
      >
        Click me ({count})
      </button>
      <p>(Hydration giúp nút này hoạt động trên client)</p>
    </div>
  );
}
```

🧠 **Giải thích:**

* Có `use client` → được Next.js build thành **Client Component**.
* Component này được **hydrate trên trình duyệt**, vì nó có:

  * State (`useState`)
  * Event (`onClick`)

---

### **C. `page.tsx` (kết hợp cả hai)**

```tsx
import ServerInfo from './components/ServerInfo';
import Counter from './components/Counter';

export default function Page() {
  return (
    <main className="flex flex-col items-center justify-center min-h-screen p-6 space-y-6">
      <h1 className="text-3xl font-bold">🚀 Next.js Hydration Demo</h1>
      <ServerInfo />
      <Counter />
    </main>
  );
}
```

---

## 🔍 4. Điều gì xảy ra khi bạn truy cập trang?

### 🧩 Giai đoạn 1 – **Server Render**

Server chạy `ServerInfo` → render sẵn HTML như:

```html
<div>
  <h2>🧩 Server Component</h2>
  <p>Rendered at: 2025-10-05T07:45:12.345Z</p>
</div>
```

→ HTML này được **gửi thẳng về trình duyệt** và **hiển thị ngay lập tức** ⚡
Trang **đã có nội dung**, nhưng **chưa có logic React**.

---

### ⚙️ Giai đoạn 2 – **Hydration**

Sau khi HTML tải xong, trình duyệt bắt đầu:

* Tải file JS của `Counter.tsx`
* Dùng React để “gắn lại” event `onClick`, state, v.v.

→ Nút “Click me (0)” bây giờ hoạt động → **trang đã hydrate thành công** 🎉

---

## 📚 5. Tóm tắt cơ chế

| Loại Component     | Chạy ở đâu | Có thể dùng hook/state? | Có hydrate không? | Mục đích                        |
| ------------------ | ---------- | ----------------------- | ----------------- | ------------------------------- |
| `Server Component` | Server     | ❌ Không                 | ❌ Không           | Render HTML tĩnh, tối ưu tốc độ |
| `Client Component` | Client     | ✅ Có                    | ✅ Có              | Tạo tương tác, sự kiện, state   |

---

## 🧠 6. Lưu ý tối ưu

* **Mặc định tất cả là Server Component** → hiệu năng tốt hơn.
* Chỉ thêm `use client` khi cần:

  * Có state hoặc event
  * Dùng hook (`useState`, `useEffect`, `useRef`, …)
* Giảm số lượng Client Component → giảm JS bundle & thời gian hydrate.

---

## ✅ 7. Kết luận

Hydration chính là **cầu nối giữa SSR (server render)** và **CSR (client interactivity)**.
Nó giúp Next.js:

* Hiển thị nội dung **siêu nhanh** (SSR)
* Nhưng vẫn có thể **tương tác như React app bình thường** (CSR)


---
[<< README](./README.md) | [BÀI 02 >>](./02.md)