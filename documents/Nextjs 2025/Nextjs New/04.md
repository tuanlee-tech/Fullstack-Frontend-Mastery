## 🏗 **Cấu trúc thư mục hoàn chỉnh**

```
app/
├── layout.tsx
├── page.tsx
├── about/
│   ├── layout.tsx
│   └── page.tsx
└── dashboard/
    ├── layout.tsx
    ├── page.tsx
    └── settings/
        └── page.tsx
```

---

## 🧩 **1️⃣ app/layout.tsx — Root Layout**

```tsx
// app/layout.tsx
import "./globals.css";

export const metadata = {
  title: "Next.js App Router Demo",
  description: "Understanding Layout & Routing Structure",
};

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <body>
        <header style={{ background: "#222", color: "#fff", padding: "1rem" }}>
          🌸 My Global Header
        </header>
        <main style={{ padding: "2rem" }}>{children}</main>
        <footer style={{ background: "#eee", padding: "1rem", marginTop: "2rem" }}>
          © 2025 My Company
        </footer>
      </body>
    </html>
  );
}
```

🧠 **Giải thích:**
Đây là **root layout** — bao quanh toàn bộ ứng dụng (global header/footer).
Nó chỉ render lại **1 lần duy nhất**, không reset khi chuyển trang.

---

## 🏠 **2️⃣ app/page.tsx — Trang chủ**

```tsx
// app/page.tsx
export default function HomePage() {
  return (
    <section>
      <h1>🏡 Welcome to Next.js App Router</h1>
      <p>Đây là trang chủ mặc định của ứng dụng.</p>
    </section>
  );
}
```

---

## 📘 **3️⃣ app/about/layout.tsx — Layout riêng cho /about**

```tsx
// app/about/layout.tsx
export default function AboutLayout({ children }: { children: React.ReactNode }) {
  return (
    <section style={{ border: "2px solid blue", padding: "1rem" }}>
      <header style={{ fontWeight: "bold", color: "blue" }}>📘 About Section</header>
      <div>{children}</div>
    </section>
  );
}
```

📌 **Layout này chỉ áp dụng cho /about và các route con của nó**, không ảnh hưởng đến các phần khác.

---

## 📄 **4️⃣ app/about/page.tsx — Trang /about**

```tsx
// app/about/page.tsx
export default function AboutPage() {
  return (
    <article>
      <h2>Giới thiệu về Next.js App Router</h2>
      <p>
        App Router là kiến trúc routing mới của Next.js (v13+), cho phép tách biệt rõ ràng
        giữa <strong>Server Components</strong> và <strong>Client Components</strong>,
        hỗ trợ layout lồng nhau, streaming, và server actions.
      </p>
    </article>
  );
}
```

---

## ⚙️ **5️⃣ app/dashboard/layout.tsx — Layout riêng cho /dashboard**

```tsx
// app/dashboard/layout.tsx
export default function DashboardLayout({ children }: { children: React.ReactNode }) {
  return (
    <section style={{ border: "2px solid green", padding: "1rem" }}>
      <header style={{ fontWeight: "bold", color: "green" }}>📊 Dashboard Panel</header>
      <div>{children}</div>
    </section>
  );
}
```

---

## 🧭 **6️⃣ app/dashboard/page.tsx — Trang /dashboard**

```tsx
// app/dashboard/page.tsx
export default function DashboardPage() {
  return (
    <div>
      <h2>📈 Dashboard</h2>
      <p>Chào mừng bạn đến trang tổng quan người dùng.</p>
    </div>
  );
}
```

---

## ⚙️ **7️⃣ app/dashboard/settings/page.tsx — Trang /dashboard/settings**

```tsx
// app/dashboard/settings/page.tsx
export default function SettingsPage() {
  return (
    <div>
      <h2>⚙️ Cấu hình người dùng</h2>
      <p>Tại đây bạn có thể thay đổi thông tin cá nhân, bảo mật, và tùy chọn giao diện.</p>
    </div>
  );
}
```

---

## ✅ **Kết quả khi chạy**

| URL                   | Kết quả                                          |
| --------------------- | ------------------------------------------------ |
| `/`                   | Hiển thị trang chủ (Root Layout)                 |
| `/about`              | Có layout riêng màu xanh + nội dung giới thiệu   |
| `/dashboard`          | Có layout riêng màu xanh lá + nội dung Dashboard |
| `/dashboard/settings` | Dùng chung layout Dashboard + nội dung riêng     |

---

## 💡 **Điều bạn nên hiểu sâu ở bài này:**

1. **Mỗi folder = 1 route segment.**
2. **Mỗi segment có thể có layout riêng.**
3. **Layouts được lồng vào nhau theo cây thư mục.**
4. **Chuyển trang không reload layout cha.**
5. **Các file page.tsx chỉ là phần nội dung — layout mới là phần khung.**

---

Hệ thống App Router có **rất nhiều hàm và API đặc trưng**, giúp xử lý:
📦 *rendering, routing, data fetching, metadata, error handling,* và *navigation*.

---

### 🧭 Tổng hợp **Toàn bộ hàm và API có sẵn** trong **Next.js App Router** trước khi chúng ta bắt đầu

Mình chia ra 8 nhóm chính để bạn dễ tra cứu và học theo từng chủ đề.

---

## **1️⃣ — Routing Helpers (Client & Server)**

Các hàm điều hướng (navigate, params, pathname, …)

| Hàm                 | Môi trường   | Mô tả                                                                                     |
| ------------------- | ------------ | ----------------------------------------------------------------------------------------- |
| `useRouter()`       | ✅ **Client** | Trả về đối tượng `router` với các method: `push()`, `replace()`, `back()`, `refresh()`, … |
| `usePathname()`     | ✅ **Client** | Lấy đường dẫn hiện tại (ví dụ: `/blog/react`)                                             |
| `useSearchParams()` | ✅ **Client** | Lấy và xử lý query params: `?page=2&sort=asc`                                             |
| `redirect()`        | ✅ **Server** | Chuyển hướng trong **server component** (trả về HTTP 307)                                 |
| `notFound()`        | ✅ **Server** | Gọi trang `not-found.tsx` tương ứng với route hiện tại                                    |
| `Link` (component)  | ✅ **Client** | Dùng để điều hướng client-side không reload trang                                         |

---

## **2️⃣ — Data Fetching & Caching Helpers**

| Hàm                                  | Môi trường          | Mô tả                                                                               |
| ------------------------------------ | ------------------- | ----------------------------------------------------------------------------------- |
| `fetch()` (được mở rộng bởi Next.js) | ✅ **Server**        | Next.js tự động cache & revalidate theo cấu hình                                    |
| `revalidatePath(path)`               | ✅ **Server Action** | Làm mới (revalidate) cache của route cụ thể                                         |
| `revalidateTag(tag)`                 | ✅ **Server Action** | Revalidate dữ liệu được gắn tag khi fetch (`fetch(url, { next: { tags: [...] } })`) |
| `unstable_noStore()`                 | ✅ **Server**        | Tắt cache cho route hiện tại                                                        |
| `cache(fn)`                          | ✅ **Server**        | Cache kết quả của một hàm server-side                                               |
| `headers()`                          | ✅ **Server**        | Lấy toàn bộ request headers                                                         |
| `cookies()`                          | ✅ **Server**        | Lấy và ghi cookie trong server component hoặc server action                         |

---

## **3️⃣ — File-based Rendering APIs**

Các hàm đặt trong file `page.tsx`, `layout.tsx`, `error.tsx`, ...

| Hàm                                  | Môi trường           | File sử dụng             | Mô tả                                            |
| ------------------------------------ | -------------------- | ------------------------ | ------------------------------------------------ |
| `generateStaticParams()`             | **Server**           | `[slug]/page.tsx`        | Khai báo các param để pre-render SSG             |
| `generateMetadata()`                 | **Server**           | `page.tsx`, `layout.tsx` | Sinh metadata động (SEO) theo param hoặc dữ liệu |
| `default export function Page()`     | **Server (default)** | `page.tsx`               | Render nội dung trang                            |
| `default export function Layout()`   | **Server**           | `layout.tsx`             | Định nghĩa layout bao quanh các route con        |
| `default export function Error()`    | **Client bắt buộc**  | `error.tsx`              | Xử lý lỗi runtime trong layout hoặc route        |
| `default export function Loading()`  | **Server**           | `loading.tsx`            | Hiển thị trạng thái khi đang fetch dữ liệu       |
| `default export function NotFound()` | **Server**           | `not-found.tsx`          | Hiển thị trang 404 riêng cho route               |

---

## **4️⃣ — Metadata API (SEO & Social)**

Khai báo SEO cho từng route/layout.

| API                                        | File                     | Dạng            | Mô tả                                                     |
| ------------------------------------------ | ------------------------ | --------------- | --------------------------------------------------------- |
| `export const metadata = {...}`            | `page.tsx`, `layout.tsx` | Static          | Metadata tĩnh (title, description, openGraph, twitter, …) |
| `export async function generateMetadata()` | `page.tsx`               | Dynamic         | Metadata động dựa theo param hoặc fetch dữ liệu           |
| `Metadata` Type                            | `next`                   | TypeScript type | Định nghĩa chuẩn cho metadata object                      |

Ví dụ:

```tsx
export const metadata = {
  title: "Trang chủ | MyApp",
  description: "Trang giới thiệu sản phẩm",
  openGraph: {
    title: "MyApp OG",
    images: ["/og-image.png"],
  },
};
```

---

## **5️⃣ — Server Actions (Từ Next.js 13.4+)**

| Hàm / Cấu trúc                   | Môi trường    | Mô tả                                                                    |
| -------------------------------- | ------------- | ------------------------------------------------------------------------ |
| `"use server"`                   | Server        | Đánh dấu 1 hàm là **server action** có thể gọi từ client form hoặc event |
| `export async function action()` | Server        | Xử lý logic server-side, ví dụ: form submission                          |
| `revalidatePath()`               | Server Action | Làm mới cache của route sau khi cập nhật dữ liệu                         |
| `revalidateTag()`                | Server Action | Làm mới các fetch theo tag                                               |
| `redirect()` / `notFound()`      | Server Action | Có thể gọi trực tiếp sau khi xử lý form                                  |

Ví dụ:

```tsx
"use server";

import { revalidatePath } from "next/cache";

export async function addPost(data: FormData) {
  const title = data.get("title");
  await saveToDB(title);
  revalidatePath("/blog");
}
```

---

## **6️⃣ — Navigation Components (Client)**

| Thành phần              | Mô tả                                          |
| ----------------------- | ---------------------------------------------- |
| `<Link href="/path">`   | Điều hướng client-side (không reload)          |
| `<Redirect>` (React 19) | Dùng trong client component                    |
| `<Suspense>`            | Bao quanh component async để show `loading` UI |
| `<ErrorBoundary>`       | Bao quanh vùng có thể lỗi                      |

---

## **7️⃣ — Special File Conventions (Hành vi tự động của App Router)**

| File                      | Tác dụng                          |
| ------------------------- | --------------------------------- |
| `page.tsx`                | Nội dung chính của route          |
| `layout.tsx`              | Layout bao quanh các route con    |
| `loading.tsx`             | UI khi đang loading               |
| `error.tsx`               | UI khi gặp lỗi                    |
| `not-found.tsx`           | UI cho lỗi 404                    |
| `route.ts`                | API Route (tương tự `/api/...`)   |
| `template.tsx`            | Layout reset lại khi chuyển route |
| `head.tsx` *(deprecated)* | Cũ, thay bằng `metadata`          |

---

## **8️⃣ — Others (Utility & Context)**

| Hàm                           | Môi trường | Mô tả                                                                      |
| ----------------------------- | ---------- | -------------------------------------------------------------------------- |
| `useServerInsertedHTML()`     | Server     | Chèn HTML tùy chỉnh trong quá trình render                                 |
| `useSelectedLayoutSegments()` | Client     | Lấy các segment hiện tại trong URL (App Router)                            |
| `useParams()` *(Next 15)*     | Client     | Lấy trực tiếp params trong Client Component (thay cho `useRouter().query`) |

---

## 🧩 **Tổng hợp ngắn gọn cho dev nhớ nhanh**

| Nhóm                  | Hàm / File chính                                                                  |
| --------------------- | --------------------------------------------------------------------------------- |
| **Routing**           | `useRouter`, `redirect`, `notFound`                                               |
| **Params & Query**    | `useParams`, `useSearchParams`, `usePathname`                                     |
| **Static Generation** | `generateStaticParams`                                                            |
| **SEO**               | `generateMetadata`, `metadata`                                                    |
| **UI States**         | `loading.tsx`, `error.tsx`, `not-found.tsx`                                       |
| **Server Actions**    | `"use server"`, `revalidatePath`, `redirect`                                      |
| **Cache Control**     | `fetch(..., { next: { revalidate, tags } })`, `revalidateTag`, `unstable_noStore` |
| **API Route**         | `route.ts`                                                                        |


---
[<< BÀI 03](./03.md) | [BÀI 05 >>](./05.md)