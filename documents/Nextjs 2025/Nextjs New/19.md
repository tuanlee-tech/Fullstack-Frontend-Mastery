# 🎯 **Linking & Navigation trong Next.js App Router**


## 🧩 1. `Link` Component – Điều hướng nội bộ

Trong App Router, `next/link` là cách **chính thống** để chuyển trang giữa các route nội bộ mà **không reload toàn bộ trang**.

### ✅ Cú pháp cơ bản

```tsx
import Link from "next/link";

export default function Home() {
  return (
    <div>
      <h1>Trang chủ</h1>
      <Link href="/about">Đến trang giới thiệu</Link>
    </div>
  );
}
```

🧠 Khi bấm vào `<Link>`, Next.js:

* **Không reload trang** (client-side navigation)
* **Prefetch** dữ liệu của trang `/about` khi link hiển thị trong viewport
  → Giúp trang load **tức thì** khi người dùng click.

---

## ⚙️ 2. Thuộc tính của `<Link>`

| Thuộc tính | Mô tả                                                                                 |
| ---------- | ------------------------------------------------------------------------------------- |
| `href`     | Đường dẫn cần điều hướng                                                              |
| `prefetch` | Tự động prefetch khi link xuất hiện trong viewport (mặc định: `true` trên production) |
| `replace`  | Thay vì `push` vào history, dùng `replace` để không tạo bản ghi mới                   |
| `scroll`   | Cuộn lên đầu trang sau khi điều hướng (mặc định: `true`)                              |

### Ví dụ nâng cao

```tsx
<Link href="/dashboard" prefetch={false} replace scroll={false}>
  Mở Dashboard (không prefetch, không scroll)
</Link>
```

---

## 🧠 3. Prefetch hoạt động như thế nào?

Next.js sẽ **tự động preload** dữ liệu (HTML + JS) cho trang được liên kết **khi link hiển thị trong viewport**.

Ví dụ:
Khi bạn cuộn xuống và thấy `<Link href="/about" />` → Next.js tải ngầm trước `/about` → Click vào là mở tức thì ⚡

Nếu bạn đang phát triển (`next dev`), prefetch sẽ **tắt mặc định** để tránh log rác.

---

## 🧭 4. `useRouter` Hook – Điều hướng bằng code

Khi cần **điều hướng bằng hành động logic** (sau form, nút bấm...), ta dùng `useRouter` từ `next/navigation`.

```tsx
"use client";

import { useRouter } from "next/navigation";

export default function LoginButton() {
  const router = useRouter();

  const handleLogin = async () => {
    await fakeLogin();
    router.push("/dashboard");
  };

  return <button onClick={handleLogin}>Đăng nhập</button>;
};
```

### Các hàm điều hướng phổ biến

| Hàm                   | Mô tả                                                       |
| --------------------- | ----------------------------------------------------------- |
| `router.push(url)`    | Chuyển sang trang mới, thêm vào history                     |
| `router.replace(url)` | Chuyển sang trang mới, không thêm vào history               |
| `router.back()`       | Quay lại trang trước                                        |
| `router.forward()`    | Tiến tới trang tiếp theo                                    |
| `router.refresh()`    | Làm mới dữ liệu server (fetch lại nhưng không reload trang) |

---

## 🚦 5. Link và Navigation trong Server Components

* `<Link>` có thể dùng trong **Server Component**
* Nhưng `useRouter()` chỉ dùng được trong **Client Component**

👉 Nếu bạn cần điều hướng bằng code, hãy thêm `"use client"` trên đầu file.

---

## 🧱 6. Code mẫu hoàn chỉnh

**📁 app/page.tsx**

```tsx
import Link from "next/link";

export default function HomePage() {
  return (
    <main className="p-8">
      <h1 className="text-2xl font-bold mb-4">Trang chủ</h1>
      <ul className="space-y-2">
        <li>
          <Link href="/about" className="text-blue-600 hover:underline">
            Giới thiệu
          </Link>
        </li>
        <li>
          <Link href="/blog" prefetch={false}>
            Blog (không prefetch)
          </Link>
        </li>
      </ul>
    </main>
  );
}
```

**📁 app/about/page.tsx**

```tsx
export default function AboutPage() {
  return (
    <div className="p-8">
      <h1 className="text-xl font-semibold">Về chúng tôi</h1>
      <p>Đây là trang giới thiệu trong Next.js App Router.</p>
    </div>
  );
}
```

**📁 app/login/page.tsx (client)**

```tsx
"use client";

import { useRouter } from "next/navigation";

export default function LoginPage() {
  const router = useRouter();

  const handleSubmit = () => {
    // Xử lý login giả lập
    setTimeout(() => {
      router.push("/dashboard");
    }, 1000);
  };

  return (
    <div className="p-8">
      <button
        onClick={handleSubmit}
        className="px-4 py-2 bg-green-600 text-white rounded-md"
      >
        Đăng nhập
      </button>
    </div>
  );
}
```

---

## 💡 Tổng kết

| Tính năng   | Mô tả                                        | Dùng ở đâu              |
| ----------- | -------------------------------------------- | ----------------------- |
| `<Link>`    | Điều hướng client-side (prefetch tự động)    | Server/Client Component |
| `useRouter` | Điều hướng qua code (push, replace, refresh) | Chỉ Client Component    |
| `prefetch`  | Tải sẵn trang khi link xuất hiện             | Tăng tốc điều hướng     |
| `scroll`    | Kiểm soát cuộn sau khi navigate              | Mặc định: true          |

---

# ⚡ Bonus: Prefetch & router.refresh trong App Router



## 🧠 1️⃣ Prefetch là gì?

> Prefetch = Next.js **tải sẵn** code và dữ liệu của trang **trước khi người dùng click** vào link.

📦 Khi `<Link>` nằm trong viewport → Next.js ngầm gọi:

* tải trước JS chunk của page
* tải trước `layout`, `page`, và `loading` tương ứng
* cache sẵn kết quả

👉 Nhờ vậy, khi click vào → **trang mở gần như tức thì** (SPA cảm giác mượt mà như native app)

---

### ✳️ Khi nào prefetch hoạt động?

| Môi trường                  | Trạng thái       | Mặc định       |
| --------------------------- | ---------------- | -------------- |
| `next dev`                  | Không prefetch   | ❌ Tắt để debug |
| `next build` + `next start` | Prefetch tự động | ✅ Bật          |

---

### ✳️ Tắt thủ công khi cần

Ví dụ khi có quá nhiều link (menu lớn → tốn băng thông):

```tsx
<Link href="/about" prefetch={false}>
  Giới thiệu
</Link>
```

---

## 🔄 2️⃣ `router.refresh()` là gì?

Trong App Router, `router.refresh()` cho phép bạn **tải lại dữ liệu server** mà **không reload toàn bộ trang**.

### 📍Ví dụ:

```tsx
"use client";

import { useRouter } from "next/navigation";

export default function RefreshButton() {
  const router = useRouter();

  return (
    <button
      onClick={() => router.refresh()}
      className="px-4 py-2 bg-blue-600 text-white rounded"
    >
      🔄 Làm mới dữ liệu
    </button>
  );
}
```

Khi bấm:

* Component server (fetch data) sẽ **render lại**
* Nhưng **state client** không bị mất (không reload toàn trang)
* Rất hữu ích sau khi update/delete dữ liệu trong CRUD

---

### 🧩 Khi nào nên dùng `router.refresh()`

| Tình huống                                      | Giải thích                                  |
| ----------------------------------------------- | ------------------------------------------- |
| Sau khi gửi form (server action)                | Muốn cập nhật lại danh sách mà không reload |
| Sau khi xoá hoặc thêm record                    | Muốn re-fetch lại dữ liệu server            |
| Khi gọi API không nằm trong React query hay SWR | Muốn trigger lại render server component    |

---

### 🧠 Ví dụ kết hợp:

```tsx
"use client";
import { useRouter } from "next/navigation";

export default function DeletePostButton({ id }: { id: string }) {
  const router = useRouter();

  const handleDelete = async () => {
    await fetch(`/api/posts/${id}`, { method: "DELETE" });
    router.refresh(); // ⚡ cập nhật lại danh sách
  };

  return (
    <button
      onClick={handleDelete}
      className="px-3 py-1 bg-red-600 text-white rounded"
    >
      🗑️ Xoá bài
    </button>
  );
}
```

---

## ✅ Tổng kết nhanh

| Tính năng          | Mục đích                               | Dùng ở đâu                 | Ghi nhớ             |
| ------------------ | -------------------------------------- | -------------------------- | ------------------- |
| `prefetch`         | Tải sẵn trang để tăng tốc              | `<Link>`                   | Mặc định bật (prod) |
| `router.refresh()` | Làm mới dữ liệu server (re-render RSC) | `useRouter()` trong client | Không reload trang  |

---
[<< BÀI 18](./18.md) | [BÀI 20 >>](./20.md)