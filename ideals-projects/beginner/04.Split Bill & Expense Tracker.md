

## 💰 **PROJECT 4: Split Bill & Expense Tracker**

### 📖 **Project Overview**
Ứng dụng chia bill thông minh giúp nhóm bạn tính toán ai nợ ai bao nhiêu sau chuyến đi chơi, đi ăn, hoặc du lịch chung. Sử dụng thuật toán tối ưu hóa để giảm số lượng giao dịch thanh toán. Giải quyết vấn đề: "Sau chuyến đi nhóm, làm sao chia tiền cho công bằng và đơn giản?"

### 🎯 **Target Users**
- Nhóm bạn đi du lịch chung
- Bạn cùng phòng chia tiền thuê nhà, điện nước
- Đồng nghiệp đi ăn trưa chung
- Cặp đôi muốn quản lý chi tiêu chung
- Gia đình chia tiền mua sắm

### 🚀 **MVP - Week 1-2 (Core Features)**

**User Story 1: Create Group**
```
AS A user
I WANT TO create an expense group
SO THAT we can track shared expenses
```
**Acceptance Criteria:**
- ✅ Group name (e.g., "Đà Lạt Trip 2024")
- ✅ Group description (optional)
- ✅ Group avatar/cover image
- ✅ Add members (by email, phone, or username)
- ✅ Set default currency (VND, USD, EUR, etc.)
- ✅ Group creator becomes admin
- ✅ Generate shareable invite link
- ✅ QR code for quick join

**User Story 2: Add Expense**
```
AS A user
I WANT TO record a shared expense
SO THAT everyone knows who paid and who owes
```
**Acceptance Criteria:**
- ✅ Expense description ("Dinner at Nhà Hàng")
- ✅ Total amount
- ✅ Who paid? (select from group members)
- ✅ Split method:
  - Equal split (divide evenly)
  - Exact amounts (each person custom amount)
  - Percentages (each person %)
  - Shares (1 person = 1 share, 2 shares for couples)
- ✅ Who participated? (select subset of group)
- ✅ Date (default: today)
- ✅ Category (Food, Transport, Accommodation, Entertainment, Other)
- ✅ Receipt photo (optional)
- ✅ Notes (optional)

**User Story 3: View Balances**
```
AS A user
I WANT TO see who owes whom
SO THAT I know how much to pay/receive
```
**Acceptance Criteria:**
- ✅ **Overview Card**: "You owe [amount]" or "You are owed [amount]"
- ✅ **Detailed Balances**: 
  - "You owe Alice 500,000₫"
  - "Bob owes you 300,000₫"
- ✅ Net balance (total you owe - total owed to you)
- ✅ Visual indicator (red for debt, green for credit)
- ✅ Tap to see transaction history with that person

**User Story 4: Settle Debt**
```
AS A user
I WANT TO record a payment
SO THAT balances are updated
```
**Acceptance Criteria:**
- ✅ Record payment: From [person] to [person], Amount
- ✅ Payment method (Cash, Bank Transfer, Momo, ZaloPay, etc.)
- ✅ Payment proof (screenshot, photo)
- ✅ Payment note
- ✅ Auto-update balances
- ✅ Notification to recipient
- ✅ Confirm receipt (recipient verifies)

**User Story 5: Expense List & History**
```
AS A user
I WANT TO see all group expenses
SO THAT I can review spending
```
**Acceptance Criteria:**
- ✅ List all expenses (newest first)
- ✅ Show: Description, Amount, Paid by, Date, Category icon
- ✅ Filter by: Category, Date range, Who paid, Who participated
- ✅ Search by description
- ✅ Total expenses summary
- ✅ Tap expense to see split details
- ✅ Edit expense (only creator or admin)
- ✅ Delete expense (only creator or admin, with confirmation)

**Database Schema (MVP):**
```prisma
model User {
  id            String          @id @default(cuid())
  email         String?         @unique
  phone         String?         @unique
  name          String
  avatar        String?
  groupMembers  GroupMember[]
  expenses      Expense[]       // Expenses user paid for
  balances      Balance[]       @relation("UserBalances")
  payments      Payment[]       @relation("PaymentFrom")
  receivedPayments Payment[]    @relation("PaymentTo")
  createdAt     DateTime        @default(now())
}

model Group {
  id            String        @id @default(cuid())
  name          String
  description   String?
  avatar        String?
  currency      String        @default("VND")
  inviteCode    String        @unique
  members       GroupMember[]
  expenses      Expense[]
  balances      Balance[]
  payments      Payment[]
  createdBy     String
  createdAt     DateTime      @default(now())
}

model GroupMember {
  id        String   @id @default(cuid())
  groupId   String
  userId    String
  role      String   // "admin" | "member"
  joinedAt  DateTime @default(now())
  
  @@unique([groupId, userId])
}

model Expense {
  id            String          @id @default(cuid())
  groupId       String
  description   String
  totalAmount   Decimal         @db.Decimal(12, 2)
  currency      String          @default("VND")
  paidBy        String          // User ID
  splitMethod   String          // "equal" | "exact" | "percentage" | "shares"
  category      String
  date          DateTime
  receiptUrl    String?
  notes         String?
  splits        ExpenseSplit[]
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
}

model ExpenseSplit {
  id          String   @id @default(cuid())
  expenseId   String
  userId      String
  amount      Decimal  @db.Decimal(12, 2)  // How much this person owes
  percentage  Decimal? @db.Decimal(5, 2)    // If split by percentage
  shares      Int?                           // If split by shares
  
  @@unique([expenseId, userId])
}

model Balance {
  id        String   @id @default(cuid())
  groupId   String
  fromUser  String   // User who owes
  toUser    String   // User who is owed
  amount    Decimal  @db.Decimal(12, 2)
  currency  String   @default("VND")
  updatedAt DateTime @updatedAt
  
  @@unique([groupId, fromUser, toUser])
}

model Payment {
  id            String   @id @default(cuid())
  groupId       String
  fromUser      String
  toUser        String
  amount        Decimal  @db.Decimal(12, 2)
  currency      String   @default("VND")
  method        String   // "cash" | "bank_transfer" | "momo" | "zalopay"
  proofUrl      String?
  note          String?
  status        String   // "pending" | "confirmed" | "disputed"
  createdAt     DateTime @default(now())
}
```

---

### 📈 **Phase 2 - Week 3 (Advanced Features)**

**Feature 1: Debt Simplification Algorithm**
```
AS A user
I WANT TO minimize the number of transactions needed to settle
SO THAT settling up is simpler
```

**Problem Example:**
```
Before Simplification:
- Alice owes Bob 100₫
- Bob owes Charlie 100₫
- Alice owes Charlie 50₫

After Simplification:
- Alice owes Charlie 150₫
(Bob is removed from transactions!)
```

**Acceptance Criteria:**
- ✅ Implement graph-based debt simplification algorithm
- ✅ "Simplify Debts" button
- ✅ Show before/after comparison (X transactions → Y transactions)
- ✅ Explain savings (e.g., "Saved 3 transactions!")
- ✅ Suggest optimal payment plan
- ✅ Settlement suggestions: "Alice should pay Charlie 150₫"

**Feature 2: Multi-Currency Support**
```
AS A user traveling internationally
I WANT TO handle multiple currencies
SO THAT I accurately track expenses abroad
```
**Acceptance Criteria:**
- ✅ Add expense in any currency
- ✅ Auto-convert to group's default currency (exchange rate API)
- ✅ Show original currency + converted amount
- ✅ Historical exchange rates (date of expense)
- ✅ Manual exchange rate override (if needed)
- ✅ Currency breakdown chart (spent X in USD, Y in VND, etc.)

**Feature 3: Receipt Scanning (OCR)**
```
AS A user
I WANT TO scan receipts to auto-fill expense details
SO THAT I save time entering data
```
**Acceptance Criteria:**
- ✅ Camera capture or upload receipt image
- ✅ OCR extract: Total amount, Date, Merchant name
- ✅ Pre-fill expense form with extracted data
- ✅ User can review/edit before saving
- ✅ Store original receipt image
- ✅ Support multiple receipt formats (restaurant, taxi, hotel, etc.)
- ✅ Use Tesseract.js (client-side OCR) or Google Vision API

**Feature 4: Recurring Expenses**
```
AS A user sharing apartment costs
I WANT TO set up recurring expenses
SO THAT monthly bills are auto-added
```
**Acceptance Criteria:**
- ✅ Mark expense as recurring
- ✅ Set frequency: Weekly, Monthly, Yearly
- ✅ Set end date or "ongoing"
- ✅ Auto-create expense on due date (cron job)
- ✅ Notification before auto-creation
- ✅ Edit/Delete recurring expense template
- ✅ View upcoming recurring expenses

**Feature 5: Expense Categories & Analytics**
```
AS A user
I WANT TO see spending breakdown by category
SO THAT I understand where money went
```
**Acceptance Criteria:**
- ✅ Pie chart: Expense by category
- ✅ Bar chart: Spending over time (daily, weekly, monthly)
- ✅ Top spenders in group
- ✅ Most expensive expense
- ✅ Average expense per person
- ✅ Category trends (spent more/less than last month)
- ✅ Export report (PDF with charts)

**Feature 6: Activity Feed**
```
AS A user
I WANT TO see recent group activity
SO THAT I stay updated
```
**Acceptance Criteria:**
- ✅ Real-time feed: "[Alice] added expense 'Dinner' (500,000₫)"
- ✅ "[Bob] paid [Alice] 200,000₫"
- ✅ "[Charlie] joined the group"
- ✅ "[Alice] edited expense 'Taxi'"
- ✅ Timestamp (e.g., "2 hours ago")
- ✅ Push notifications for important events
- ✅ Filter feed (Expenses only, Payments only, All)

---

### 🚀 **Phase 3 - Week 4 (Expert Features)**

**Feature 1: Advanced Split Methods**

**1. Itemized Split (Restaurant Bill):**
```
AS A user
I WANT TO split
```